2025-05-24 07:43:37.008 +07:00 [INF] Executed DbCommand (36ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-24 07:43:37.160 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-24 07:43:37.269 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-24 07:43:37.277 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-24 07:43:37.279 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-24 07:43:37.279 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-24 07:43:37.280 +07:00 [INF] Hosting environment: Development
2025-05-24 07:43:37.280 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-24 07:46:37.731 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.232:5053/api/Auth/login - application/json 58
2025-05-24 07:46:37.821 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-24 07:46:37.855 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-24 07:46:37.889 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-24 07:46:38.199 +07:00 [INF] Executed DbCommand (88ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-24 07:46:38.296 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-24 07:46:38.339 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 446.7938ms
2025-05-24 07:46:38.340 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-24 07:46:38.347 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.232:5053/api/Auth/login - 200 null application/json; charset=utf-8 618.7557ms
2025-05-24 07:46:39.971 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/ws/chat?userId=2 - null null
2025-05-24 07:46:39.987 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-24 07:46:40.105 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/friends/GetAllFriends/2 - null null
2025-05-24 07:46:40.105 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/Conversation/get_conversations/2 - null null
2025-05-24 07:46:40.110 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-24 07:46:40.110 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-24 07:46:40.115 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 07:46:40.115 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 07:46:40.233 +07:00 [INF] Executed DbCommand (46ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-24 07:46:40.250 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-24 07:46:40.251 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-24 07:46:40.254 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-24 07:46:40.254 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-24 07:46:40.255 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-24 07:46:40.258 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-24 07:46:40.259 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-24 07:46:40.260 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-24 07:46:40.261 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-24 07:46:40.261 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-24 07:46:40.262 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-24 07:46:40.263 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-24 07:46:40.263 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-24 07:46:40.264 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-24 07:46:40.265 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-24 07:46:40.266 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-24 07:46:40.266 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-24 07:46:40.267 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-24 07:46:40.268 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-24 07:46:40.270 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-24 07:46:40.271 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-24 07:46:40.272 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-24 07:46:40.273 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-24 07:46:40.273 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-24 07:46:40.274 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-24 07:46:40.275 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-24 07:46:40.276 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-24 07:46:40.277 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-24 07:46:40.277 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-24 07:46:40.278 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-24 07:46:40.280 +07:00 [INF] Executed DbCommand (47ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 07:46:40.289 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 07:46:40.298 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 182.4552ms
2025-05-24 07:46:40.298 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-24 07:46:40.299 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 193.1707ms
2025-05-24 07:46:40.317 +07:00 [INF] Executed DbCommand (70ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-24 07:46:40.363 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-24 07:46:40.413 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 296.9047ms
2025-05-24 07:46:40.413 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-24 07:46:40.413 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 307.587ms
2025-05-24 07:46:45.555 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-24 07:46:45.556 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-24 07:46:45.583 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-24 07:46:45.586 +07:00 [ERR] Connection id "0HNCQBHOC6MA7", Request id "0HNCQBHOC6MA7:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-24 07:46:45.590 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/ws/chat?userId=2 - 101 null null 5619.1656ms
2025-05-24 08:00:08.584 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.232:5053/api/Auth/login - application/json 58
2025-05-24 08:00:08.590 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-24 08:00:08.590 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-24 08:00:08.884 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-24 08:00:08.887 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-24 08:00:08.887 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 296.5957ms
2025-05-24 08:00:08.888 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-24 08:00:08.888 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.232:5053/api/Auth/login - 200 null application/json; charset=utf-8 304.3415ms
2025-05-24 08:00:10.707 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/friends/GetAllFriends/2 - null null
2025-05-24 08:00:10.710 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-24 08:00:10.710 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:00:10.742 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:00:10.752 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:00:10.754 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 43.8509ms
2025-05-24 08:00:10.755 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-24 08:00:10.756 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/Conversation/get_conversations/2 - null null
2025-05-24 08:00:10.755 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 47.9616ms
2025-05-24 08:00:10.760 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-24 08:00:10.761 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 08:00:10.796 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-24 08:00:10.837 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-24 08:00:10.869 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 108.6104ms
2025-05-24 08:00:10.870 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-24 08:00:10.870 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 113.8935ms
2025-05-24 08:00:11.304 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/ws/chat?userId=2 - null null
2025-05-24 08:00:11.306 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-24 08:00:11.394 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-24 08:00:11.396 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-24 08:00:11.396 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-24 08:00:11.397 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-24 08:00:11.397 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-24 08:00:11.398 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-24 08:00:11.398 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-24 08:00:11.398 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-24 08:00:11.398 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-24 08:00:11.398 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-24 08:00:11.398 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-24 08:00:11.398 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-24 08:00:11.399 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-24 08:00:11.400 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-24 08:00:11.400 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-24 08:00:11.400 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-24 08:00:11.400 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-24 08:00:11.400 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-24 08:00:11.400 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-24 08:00:11.400 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-24 08:00:11.400 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-24 08:00:11.400 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-24 08:00:11.400 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-24 08:00:11.400 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-24 08:00:11.401 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-24 08:00:11.401 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-24 08:00:11.401 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-24 08:00:11.401 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-24 08:00:11.401 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-24 08:00:11.401 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-24 08:00:11.401 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-24 08:00:19.385 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-24 08:00:19.387 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:19.400 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 14.274ms
2025-05-24 08:00:19.406 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-24 08:00:19.406 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:19.411 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:19.411 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-24 08:00:19.411 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-24 08:00:19.428 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-24 08:00:19.429 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-24 08:00:19.432 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 20.3725ms
2025-05-24 08:00:19.432 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-24 08:00:19.432 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 26.7011ms
2025-05-24 08:00:19.466 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-24 08:00:19.466 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:19.466 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:19.466 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-24 08:00:19.636 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-24 08:00:19.636 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:19.636 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:19.636 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-24 08:00:19.637 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:00:19.642 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:00:19.645 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:00:19.645 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 8.6221ms
2025-05-24 08:00:19.646 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-24 08:00:19.646 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 9.8918ms
2025-05-24 08:00:19.814 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-24 08:00:19.815 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-24 08:00:19.831 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-24 08:00:19.832 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-24 08:00:19.832 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-24 08:00:19.834 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-24 08:00:19.834 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-24 08:00:19.834 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-24 08:00:19.834 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-24 08:00:19.836 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-24 08:00:19.837 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-24 08:00:19.907 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-24 08:00:19.907 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:19.908 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 1.1164ms
2025-05-24 08:00:19.910 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-24 08:00:19.910 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:19.910 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:19.910 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-24 08:00:19.910 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 08:00:19.924 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-24 08:00:19.978 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-24 08:00:19.981 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 70.3467ms
2025-05-24 08:00:19.981 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-24 08:00:19.982 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 71.9251ms
2025-05-24 08:00:24.561 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/Message/getMessages/51/2 - null null
2025-05-24 08:00:24.561 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-24 08:00:24.582 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-24 08:00:24.673 +07:00 [INF] Retrieved 1 messages from Redis for conversation 51
2025-05-24 08:00:24.679 +07:00 [INF] Retrieved 1 messages from Redis for conversation 51 and user 2
2025-05-24 08:00:24.679 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-24 08:00:24.685 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 102.7725ms
2025-05-24 08:00:24.686 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-24 08:00:24.686 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/Message/getMessages/51/2 - 200 null application/json; charset=utf-8 124.9093ms
2025-05-24 08:00:24.826 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/Conversation/get_first_conversation/51 - null null
2025-05-24 08:00:24.827 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-24 08:00:24.832 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 08:00:24.912 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-24 08:00:24.987 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-24 08:00:24.992 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 159.5365ms
2025-05-24 08:00:24.992 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-24 08:00:24.992 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/Conversation/get_first_conversation/51 - 200 null application/json; charset=utf-8 166.4052ms
2025-05-24 08:00:26.389 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/3 - null null
2025-05-24 08:00:26.389 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:26.391 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/3 - 204 null null 1.4163ms
2025-05-24 08:00:26.392 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/3 - null null
2025-05-24 08:00:26.393 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:26.394 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:26.394 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-24 08:00:26.395 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-24 08:00:26.402 +07:00 [INF] Retrieved 2 messages from Redis for conversation 51
2025-05-24 08:00:26.409 +07:00 [INF] Retrieved 2 messages from Redis for conversation 51 and user 3
2025-05-24 08:00:26.409 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-24 08:00:26.420 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 25.1533ms
2025-05-24 08:00:26.420 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-24 08:00:26.420 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/3 - 200 null application/json; charset=utf-8 27.9163ms
2025-05-24 08:00:26.427 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-05-24 08:00:26.428 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:26.428 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - 204 null null 0.8329ms
2025-05-24 08:00:26.430 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-05-24 08:00:26.431 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:26.431 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:26.431 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-24 08:00:26.431 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 08:00:26.455 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-24 08:00:26.458 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-24 08:00:26.459 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 27.3946ms
2025-05-24 08:00:26.459 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-24 08:00:26.460 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - 200 null application/json; charset=utf-8 29.5123ms
2025-05-24 08:00:26.467 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - null null
2025-05-24 08:00:26.467 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:26.468 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - 204 null null 0.3842ms
2025-05-24 08:00:26.469 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - null null
2025-05-24 08:00:26.469 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:26.469 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:00:26.469 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:00:26.480 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-24 08:00:26.498 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-24 08:00:26.499 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/Participant/get_participants/51 - null null
2025-05-24 08:00:26.501 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:00:26.501 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-24 08:00:26.503 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:00:26.504 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-24 08:00:26.513 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:00:26.513 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 12.3491ms
2025-05-24 08:00:26.513 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 33.5099ms
2025-05-24 08:00:26.514 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:00:26.514 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:00:26.514 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 15.1632ms
2025-05-24 08:00:26.514 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 45.3594ms
2025-05-24 08:00:30.012 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.232:5053/api/Message/uploadFile - multipart/form-data; boundary=--dio-boundary-2955134232 241881
2025-05-24 08:00:30.013 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-05-24 08:00:30.030 +07:00 [INF] Route matched with {action = "UploadFile", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UploadFile(Microsoft.AspNetCore.Http.IFormFile) on controller server.Controllers.MessageController (Message_app).
2025-05-24 08:00:33.689 +07:00 [INF] Executed DbCommand (64ms) [Parameters=[@p0='?' (DbType = Single), @p1='?' (Size = 50), @p2='?' (Size = 255), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Attachments] ([FileSize], [file_type], [file_url], [is_temporary], [message_id], [uploaded_at])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-05-24 08:00:33.728 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:00:33.732 +07:00 [INF] Executed action server.Controllers.MessageController.UploadFile (Message_app) in 3700.9083ms
2025-05-24 08:00:33.732 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-05-24 08:00:33.734 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.232:5053/api/Message/uploadFile - 200 null application/json; charset=utf-8 3722.0932ms
2025-05-24 08:00:33.787 +07:00 [INF] Handling message from user 2: FILE
2025-05-24 08:00:33.824 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-24 08:00:33.917 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-24 08:00:33.934 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-24 08:00:33.938 +07:00 [INF] Message saved to DB with ID: 417
2025-05-24 08:00:33.956 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM [Attachments] AS [a]
WHERE [a].[id] = @__p_0
2025-05-24 08:00:33.978 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-24 08:00:33.996 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@p6='?' (DbType = Int32), @p0='?' (DbType = Single), @p1='?' (Size = 50), @p2='?' (Size = 255), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2), @p14='?' (DbType = Int32), @p7='?' (DbType = DateTime2), @p8='?' (Size = 4000), @p9='?' (DbType = Boolean), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (DbType = DateTime2), @p13='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Attachments] SET [FileSize] = @p0, [file_type] = @p1, [file_url] = @p2, [is_temporary] = @p3, [message_id] = @p4, [uploaded_at] = @p5
OUTPUT 1
WHERE [id] = @p6;
UPDATE [Conversations] SET [created_at] = @p7, [img_url] = @p8, [is_group] = @p9, [lastMessage] = @p10, [lastMessageSender] = @p11, [lastMessageTime] = @p12, [name] = @p13
OUTPUT 1
WHERE [id] = @p14;
2025-05-24 08:00:34.012 +07:00 [INF] Transaction committed for message: 417
2025-05-24 08:00:34.020 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-24 08:00:34.031 +07:00 [INF] Saved message 417 to Redis
2025-05-24 08:00:34.034 +07:00 [INF] Added message 417 to conversation 51
2025-05-24 08:00:34.065 +07:00 [INF] Published message to channel conversation:51
2025-05-24 08:00:54.876 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/Participant/get_participants/51 - null null
2025-05-24 08:00:54.877 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:00:54.878 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-24 08:00:54.901 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-24 08:00:54.920 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:00:54.921 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 42.3464ms
2025-05-24 08:00:54.921 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:00:54.922 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 45.7073ms
2025-05-24 08:01:47.394 +07:00 [INF] Request starting HTTP/1.1 PUT http://192.168.1.232:5053/api/Conversation/update_conversation_name/51 - application/json 9
2025-05-24 08:01:47.395 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.UpdateConversationName (Message_app)'
2025-05-24 08:01:47.402 +07:00 [INF] Route matched with {action = "UpdateConversationName", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateConversationName(Int32, System.String) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 08:01:47.443 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-24 08:01:47.465 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-24 08:01:47.475 +07:00 [INF] Message 0 already exists in Redis
2025-05-24 08:01:47.486 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-24 08:01:47.489 +07:00 [INF] Executed action server.Controllers.ConversationController.UpdateConversationName (Message_app) in 86.7239ms
2025-05-24 08:01:47.489 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.UpdateConversationName (Message_app)'
2025-05-24 08:01:47.489 +07:00 [INF] Request finished HTTP/1.1 PUT http://192.168.1.232:5053/api/Conversation/update_conversation_name/51 - 200 null application/json; charset=utf-8 94.7046ms
2025-05-24 08:01:57.443 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/friends/GetAllFriends/2 - null null
2025-05-24 08:01:57.444 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-24 08:01:57.444 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:01:57.476 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:01:57.487 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:01:57.487 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 43.3163ms
2025-05-24 08:01:57.487 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-24 08:01:57.488 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 44.4498ms
2025-05-24 08:02:03.610 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/3 - null null
2025-05-24 08:02:03.610 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:03.611 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/3 - 204 null null 0.8819ms
2025-05-24 08:02:03.612 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/3 - null null
2025-05-24 08:02:03.613 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:03.613 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:03.613 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-24 08:02:03.614 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-24 08:02:03.618 +07:00 [INF] Retrieved 3 messages from Redis for conversation 51
2025-05-24 08:02:03.618 +07:00 [INF] Retrieved 3 messages from Redis for conversation 51 and user 3
2025-05-24 08:02:03.618 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-24 08:02:03.619 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.7867ms
2025-05-24 08:02:03.619 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-24 08:02:03.619 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/3 - 200 null application/json; charset=utf-8 6.4739ms
2025-05-24 08:02:03.625 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-05-24 08:02:03.625 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:03.625 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - 204 null null 0.336ms
2025-05-24 08:02:03.627 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-05-24 08:02:03.628 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:03.628 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:03.628 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-24 08:02:03.628 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 08:02:03.636 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-24 08:02:03.641 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-24 08:02:03.641 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 12.9431ms
2025-05-24 08:02:03.641 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-24 08:02:03.641 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - 200 null application/json; charset=utf-8 14.0623ms
2025-05-24 08:02:03.652 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - null null
2025-05-24 08:02:03.653 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:03.653 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - 204 null null 0.5047ms
2025-05-24 08:02:03.661 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - null null
2025-05-24 08:02:03.662 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:03.662 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:03.662 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:02:03.662 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-24 08:02:03.673 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-24 08:02:03.677 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:02:03.678 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 15.6805ms
2025-05-24 08:02:03.678 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:02:03.679 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 24.5473ms
2025-05-24 08:02:04.991 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - null null
2025-05-24 08:02:04.991 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:04.991 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:04.991 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:02:04.992 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-24 08:02:05.005 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-24 08:02:05.015 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:02:05.019 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 23.377ms
2025-05-24 08:02:05.019 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:02:05.021 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 29.2598ms
2025-05-24 08:02:07.864 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/leave_group/51/3 - null null
2025-05-24 08:02:07.864 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:07.864 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/leave_group/51/3 - 204 null null 0.3671ms
2025-05-24 08:02:07.867 +07:00 [INF] Request starting HTTP/1.1 DELETE http://localhost:5053/api/Participant/leave_group/51/3 - null null
2025-05-24 08:02:07.867 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:07.867 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:07.867 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.LeaveGroup (Message_app)'
2025-05-24 08:02:07.889 +07:00 [INF] Route matched with {action = "LeaveGroup", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] LeaveGroup(Int32, Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-24 08:02:07.925 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32), @__user_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[user_id] = @__user_id_1
2025-05-24 08:02:07.948 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
DELETE FROM [Participants]
OUTPUT 1
WHERE [id] = @p0;
2025-05-24 08:02:07.957 +07:00 [INF] Unsubscribed user 3 from channel conversation:51
2025-05-24 08:02:07.958 +07:00 [INF] Message 0 already exists in Redis
2025-05-24 08:02:07.960 +07:00 [INF] Published message to channel conversation:51
2025-05-24 08:02:07.963 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType18`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-24 08:02:07.969 +07:00 [INF] Executed action server.Controllers.ParticipantController.LeaveGroup (Message_app) in 78.8495ms
2025-05-24 08:02:07.969 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.LeaveGroup (Message_app)'
2025-05-24 08:02:07.970 +07:00 [INF] Request finished HTTP/1.1 DELETE http://localhost:5053/api/Participant/leave_group/51/3 - 200 null application/json; charset=utf-8 103.736ms
2025-05-24 08:02:10.945 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/Participant/get_participants/51 - null null
2025-05-24 08:02:10.946 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:02:10.947 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-24 08:02:10.965 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-24 08:02:10.999 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:02:10.999 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 52.4551ms
2025-05-24 08:02:10.999 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:02:10.999 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 54.0512ms
2025-05-24 08:02:13.003 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/friends/GetAllFriends/2 - null null
2025-05-24 08:02:13.003 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-24 08:02:13.003 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:02:13.011 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:02:13.023 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:02:13.024 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 20.4066ms
2025-05-24 08:02:13.026 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-24 08:02:13.028 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 23.6938ms
2025-05-24 08:02:16.019 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.232:5053/api/Participant/add_member/51/3 - null 0
2025-05-24 08:02:16.020 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.AddMember (Message_app)'
2025-05-24 08:02:16.028 +07:00 [INF] Route matched with {action = "AddMember", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddMember(Int32, Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-24 08:02:16.068 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Conversations] AS [c]
        WHERE [c].[id] = @__conversation_id_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-05-24 08:02:16.079 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__user_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] = @__user_id_0
2025-05-24 08:02:16.091 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32), @__user_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[user_id] = @__user_id_1) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-05-24 08:02:16.101 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Participants] ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-24 08:02:16.105 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-24 08:02:16.106 +07:00 [INF] Message 0 already exists in Redis
2025-05-24 08:02:16.108 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType18`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-24 08:02:16.109 +07:00 [INF] Executed action server.Controllers.ParticipantController.AddMember (Message_app) in 80.6714ms
2025-05-24 08:02:16.109 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.AddMember (Message_app)'
2025-05-24 08:02:16.109 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.232:5053/api/Participant/add_member/51/3 - 200 null application/json; charset=utf-8 89.3416ms
2025-05-24 08:02:16.170 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/Participant/get_participants/51 - null null
2025-05-24 08:02:16.171 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:02:16.171 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-24 08:02:16.175 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-24 08:02:16.180 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:02:16.182 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 10.5144ms
2025-05-24 08:02:16.182 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:02:16.182 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 12.024ms
2025-05-24 08:02:16.261 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversationDto/3/51 - null null
2025-05-24 08:02:16.262 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:16.262 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversationDto/3/51 - 204 null null 0.6406ms
2025-05-24 08:02:16.264 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/3/51 - null null
2025-05-24 08:02:16.264 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:16.264 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:16.264 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-05-24 08:02:16.271 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 08:02:16.289 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-24 08:02:16.290 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 17.9236ms
2025-05-24 08:02:16.290 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-05-24 08:02:16.290 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/3/51 - 200 null application/json; charset=utf-8 26.8019ms
2025-05-24 08:02:24.452 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/3 - null null
2025-05-24 08:02:24.452 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:24.452 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/3 - 204 null null 0.367ms
2025-05-24 08:02:24.454 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/3 - null null
2025-05-24 08:02:24.454 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:24.454 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:24.454 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-24 08:02:24.455 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-24 08:02:24.458 +07:00 [INF] Retrieved 3 messages from Redis for conversation 51
2025-05-24 08:02:24.459 +07:00 [INF] Retrieved 3 messages from Redis for conversation 51 and user 3
2025-05-24 08:02:24.459 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-24 08:02:24.459 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.3079ms
2025-05-24 08:02:24.459 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-24 08:02:24.463 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/3 - 200 null application/json; charset=utf-8 9.0119ms
2025-05-24 08:02:24.468 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-05-24 08:02:24.468 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:24.468 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - 204 null null 0.2854ms
2025-05-24 08:02:24.469 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-05-24 08:02:24.469 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:24.470 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:24.471 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-24 08:02:24.471 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 08:02:24.477 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-24 08:02:24.484 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-24 08:02:24.485 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 13.8217ms
2025-05-24 08:02:24.485 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-24 08:02:24.485 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - 200 null application/json; charset=utf-8 15.9771ms
2025-05-24 08:02:24.492 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - null null
2025-05-24 08:02:24.492 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:24.492 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - 204 null null 0.3258ms
2025-05-24 08:02:24.494 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - null null
2025-05-24 08:02:24.494 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:24.494 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:24.494 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:02:24.494 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-24 08:02:24.498 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-24 08:02:24.502 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:02:24.502 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.4634ms
2025-05-24 08:02:24.502 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:02:24.503 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 8.9093ms
2025-05-24 08:02:30.831 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.232:5053/api/Message/uploadFile - multipart/form-data; boundary=--dio-boundary-1688705102 241881
2025-05-24 08:02:30.831 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-05-24 08:02:30.831 +07:00 [INF] Route matched with {action = "UploadFile", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UploadFile(Microsoft.AspNetCore.Http.IFormFile) on controller server.Controllers.MessageController (Message_app).
2025-05-24 08:02:34.720 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (DbType = Single), @p1='?' (Size = 50), @p2='?' (Size = 255), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Attachments] ([FileSize], [file_type], [file_url], [is_temporary], [message_id], [uploaded_at])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-05-24 08:02:34.722 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:02:34.722 +07:00 [INF] Executed action server.Controllers.MessageController.UploadFile (Message_app) in 3890.81ms
2025-05-24 08:02:34.722 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-05-24 08:02:34.723 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.232:5053/api/Message/uploadFile - 200 null application/json; charset=utf-8 3892.319ms
2025-05-24 08:02:35.185 +07:00 [INF] Request starting HTTP/1.1 PUT http://192.168.1.232:5053/api/Conversation/update_conversation_image/51 - application/json 133
2025-05-24 08:02:35.186 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.UpdateConversationImage (Message_app)'
2025-05-24 08:02:35.191 +07:00 [INF] Route matched with {action = "UpdateConversationImage", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateConversationImage(Int32, System.String) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 08:02:35.213 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-24 08:02:35.223 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-24 08:02:35.224 +07:00 [INF] Message 0 already exists in Redis
2025-05-24 08:02:35.226 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-24 08:02:35.226 +07:00 [INF] Executed action server.Controllers.ConversationController.UpdateConversationImage (Message_app) in 34.713ms
2025-05-24 08:02:35.226 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.UpdateConversationImage (Message_app)'
2025-05-24 08:02:35.234 +07:00 [INF] Request finished HTTP/1.1 PUT http://192.168.1.232:5053/api/Conversation/update_conversation_image/51 - 200 null application/json; charset=utf-8 42.0554ms
2025-05-24 08:02:43.584 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/3 - null null
2025-05-24 08:02:43.584 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:43.585 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/3 - 204 null null 0.2845ms
2025-05-24 08:02:43.586 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/3 - null null
2025-05-24 08:02:43.586 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:43.586 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:43.586 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-24 08:02:43.586 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-24 08:02:43.590 +07:00 [INF] Retrieved 3 messages from Redis for conversation 51
2025-05-24 08:02:43.590 +07:00 [INF] Retrieved 3 messages from Redis for conversation 51 and user 3
2025-05-24 08:02:43.590 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-24 08:02:43.591 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.041ms
2025-05-24 08:02:43.591 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-24 08:02:43.591 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/3 - 200 null application/json; charset=utf-8 5.1676ms
2025-05-24 08:02:43.604 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-05-24 08:02:43.604 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:43.604 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - 204 null null 0.2375ms
2025-05-24 08:02:43.606 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-05-24 08:02:43.606 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:43.606 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:43.607 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-24 08:02:43.607 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 08:02:43.632 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-24 08:02:43.635 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-24 08:02:43.636 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 28.6184ms
2025-05-24 08:02:43.636 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-24 08:02:43.636 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - 200 null application/json; charset=utf-8 30.2187ms
2025-05-24 08:02:43.643 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - null null
2025-05-24 08:02:43.644 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:43.644 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - 204 null null 0.5089ms
2025-05-24 08:02:43.646 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - null null
2025-05-24 08:02:43.646 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:43.646 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:02:43.646 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:02:43.646 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-24 08:02:43.653 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-24 08:02:43.657 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:02:43.657 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 11.2049ms
2025-05-24 08:02:43.658 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:02:43.658 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 11.9456ms
2025-05-24 08:03:32.215 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/ws/chat?userId=2 - null null
2025-05-24 08:03:32.215 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-24 08:03:41.390 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-24 08:03:41.391 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-24 08:03:41.399 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-24 08:03:41.399 +07:00 [ERR] Connection id "0HNCQBHOC6MAD", Request id "0HNCQBHOC6MAD:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-24 08:03:41.405 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/ws/chat?userId=2 - 101 null null 210100.2869ms
2025-05-24 08:04:01.851 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.232:5053/api/Conversation/create_group - application/json 52
2025-05-24 08:04:01.852 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-05-24 08:04:01.858 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 08:04:01.914 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-24 08:04:01.946 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-05-24 08:04:01.959 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-05-24 08:04:01.961 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-05-24 08:04:01.964 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-05-24 08:04:01.969 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-05-24 08:04:02.066 +07:00 [INF] Executed DbCommand (59ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32), @p24='?' (Size = 4000), @p25='?' (DbType = Int32), @p26='?' (Size = 4000), @p27='?' (DbType = Boolean), @p28='?' (DbType = DateTime2), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2),
(@p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, 3)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-24 08:04:02.069 +07:00 [WRN] Client 6 not found
2025-05-24 08:04:02.070 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-24 08:04:02.070 +07:00 [WRN] Client 5 not found
2025-05-24 08:04:02.070 +07:00 [WRN] Client 2 not found
2025-05-24 08:04:02.070 +07:00 [INF] Message 0 already exists in Redis
2025-05-24 08:04:02.071 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-24 08:04:02.072 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 213.6763ms
2025-05-24 08:04:02.072 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-05-24 08:04:02.072 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.232:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 220.7706ms
2025-05-24 08:04:02.202 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversationDto/3/53 - null null
2025-05-24 08:04:02.203 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:02.203 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversationDto/3/53 - 204 null null 0.4621ms
2025-05-24 08:04:02.206 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/3/53 - null null
2025-05-24 08:04:02.206 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:02.207 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:02.207 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-05-24 08:04:02.208 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 08:04:02.255 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-24 08:04:02.266 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-24 08:04:02.268 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 59.9484ms
2025-05-24 08:04:02.268 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-05-24 08:04:02.269 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/3/53 - 200 null application/json; charset=utf-8 63.457ms
2025-05-24 08:04:07.789 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-24 08:04:07.789 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:07.790 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.8919ms
2025-05-24 08:04:07.791 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-24 08:04:07.792 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:07.792 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:07.792 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-24 08:04:07.792 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-24 08:04:07.799 +07:00 [INF] Retrieved 0 messages from Redis for conversation 53
2025-05-24 08:04:07.885 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-24 08:04:07.921 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-24 08:04:07.923 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-24 08:04:07.924 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 131.0921ms
2025-05-24 08:04:07.924 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-24 08:04:07.924 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 404 null text/plain; charset=utf-8 132.7752ms
2025-05-24 08:04:07.943 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-24 08:04:07.943 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:07.943 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.462ms
2025-05-24 08:04:07.944 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-24 08:04:07.944 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:07.944 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:07.944 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-24 08:04:07.944 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-24 08:04:07.953 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-24 08:04:07.956 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-24 08:04:07.956 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 11.6867ms
2025-05-24 08:04:07.956 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-24 08:04:07.956 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 12.1744ms
2025-05-24 08:04:07.967 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-24 08:04:07.967 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:07.967 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.5418ms
2025-05-24 08:04:07.969 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-24 08:04:07.969 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:07.969 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:07.969 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:04:07.970 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-24 08:04:07.976 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-24 08:04:07.978 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:07.979 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.9313ms
2025-05-24 08:04:07.979 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-24 08:04:07.979 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 10.1424ms
2025-05-24 08:04:32.185 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/list/3 - null null
2025-05-24 08:04:32.185 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:32.185 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:32.186 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:32.192 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendsAsync(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:32.235 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END, [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[bio], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[fcmToken], [u0].[gender], [u0].[interests], [u0].[location], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:32.243 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:32.254 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:32.259 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:32.261 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:32.262 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:32.267 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendsAsync (Message_app) in 74.4922ms
2025-05-24 08:04:32.267 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:32.267 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/list/3 - 200 null application/json; charset=utf-8 82.4253ms
2025-05-24 08:04:32.268 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/list/3 - null null
2025-05-24 08:04:32.268 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:32.269 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:32.269 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:32.269 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendsAsync(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:32.272 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END, [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[bio], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[fcmToken], [u0].[gender], [u0].[interests], [u0].[location], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:32.274 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:32.276 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:32.278 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:32.284 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:32.284 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:32.284 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendsAsync (Message_app) in 15.4882ms
2025-05-24 08:04:32.284 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:32.285 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/list/3 - 200 null application/json; charset=utf-8 16.1605ms
2025-05-24 08:04:33.089 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/UserProfile/3/profile - null null
2025-05-24 08:04:33.089 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:33.103 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:33.103 +07:00 [INF] Executing endpoint 'server.Controllers.UserProfileController.GetUserProfile (Message_app)'
2025-05-24 08:04:33.108 +07:00 [INF] Route matched with {action = "GetUserProfile", controller = "UserProfile"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserProfile(Int32) on controller server.Controllers.UserProfileController (Message_app).
2025-05-24 08:04:33.145 +07:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-05-24 08:04:33.169 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[avatar_url], [t].[bio], [t].[birthday], [t].[created_at], [t].[email], [t].[fcmToken], [t].[gender], [t].[interests], [t].[location], [t].[password], [t].[passwordSalt], [t].[username], [f].[Id], [f].[CreatedAt], [f].[UserId1], [f].[UserId2], [f0].[Id], [f0].[CreatedAt], [f0].[UserId1], [f0].[UserId2]
FROM (
    SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
    FROM [Users] AS [u]
    WHERE [u].[id] = @__userId_0
) AS [t]
LEFT JOIN [Friends] AS [f] ON [t].[id] = [f].[UserId1]
LEFT JOIN [Friends] AS [f0] ON [t].[id] = [f0].[UserId2]
ORDER BY [t].[id], [f].[Id]
2025-05-24 08:04:33.186 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType22`11[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateOnly, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:33.194 +07:00 [INF] Executed action server.Controllers.UserProfileController.GetUserProfile (Message_app) in 85.704ms
2025-05-24 08:04:33.194 +07:00 [INF] Executed endpoint 'server.Controllers.UserProfileController.GetUserProfile (Message_app)'
2025-05-24 08:04:33.194 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/UserProfile/3/profile - 200 null application/json; charset=utf-8 104.8911ms
2025-05-24 08:04:36.861 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/3 - null null
2025-05-24 08:04:36.862 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:36.862 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:36.862 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-24 08:04:36.870 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:36.925 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-24 08:04:36.926 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:36.929 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 57.7932ms
2025-05-24 08:04:36.929 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-24 08:04:36.929 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/3 - 200 null application/json; charset=utf-8 67.9452ms
2025-05-24 08:04:36.930 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/3 - null null
2025-05-24 08:04:36.931 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:36.931 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:36.932 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-24 08:04:36.932 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:36.935 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-24 08:04:36.935 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:36.935 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 2.8547ms
2025-05-24 08:04:36.935 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-24 08:04:36.936 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/3 - 200 null application/json; charset=utf-8 5.2815ms
2025-05-24 08:04:36.937 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/3 - null null
2025-05-24 08:04:36.937 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:36.938 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:36.938 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-24 08:04:36.938 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:36.941 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-24 08:04:36.941 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:36.941 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 2.8206ms
2025-05-24 08:04:36.942 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-24 08:04:36.942 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/3 - 200 null application/json; charset=utf-8 4.4549ms
2025-05-24 08:04:36.943 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/3 - null null
2025-05-24 08:04:36.943 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:36.943 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:36.943 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-24 08:04:36.943 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:36.946 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-24 08:04:36.946 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:36.947 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 4.0484ms
2025-05-24 08:04:36.947 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-24 08:04:36.947 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/3 - 200 null application/json; charset=utf-8 4.7364ms
2025-05-24 08:04:36.963 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/3 - null null
2025-05-24 08:04:36.964 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:36.966 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:36.966 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-24 08:04:36.971 +07:00 [INF] Route matched with {action = "GetSentFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetSentFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:36.990 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[ReceiverId] = [u].[id]
WHERE [f].[SenderId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-24 08:04:36.991 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType13`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:36.993 +07:00 [INF] Executed action server.Controllers.FriendsController.GetSentFriendRequests (Message_app) in 21.1519ms
2025-05-24 08:04:36.993 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-24 08:04:36.993 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/3 - 200 null application/json; charset=utf-8 29.5515ms
2025-05-24 08:04:36.994 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/3 - null null
2025-05-24 08:04:36.994 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:36.994 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:36.994 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-24 08:04:36.994 +07:00 [INF] Route matched with {action = "GetSentFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetSentFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:36.996 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[ReceiverId] = [u].[id]
WHERE [f].[SenderId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-24 08:04:36.997 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType13`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:36.999 +07:00 [INF] Executed action server.Controllers.FriendsController.GetSentFriendRequests (Message_app) in 4.6696ms
2025-05-24 08:04:36.999 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-24 08:04:37.000 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/3 - 200 null application/json; charset=utf-8 5.8724ms
2025-05-24 08:04:37.000 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/3 - null null
2025-05-24 08:04:37.001 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.001 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.001 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-24 08:04:37.001 +07:00 [INF] Route matched with {action = "GetSentFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetSentFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:37.003 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[ReceiverId] = [u].[id]
WHERE [f].[SenderId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-24 08:04:37.004 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType13`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:37.004 +07:00 [INF] Executed action server.Controllers.FriendsController.GetSentFriendRequests (Message_app) in 3.3317ms
2025-05-24 08:04:37.004 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-24 08:04:37.005 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/3 - 200 null application/json; charset=utf-8 4.5744ms
2025-05-24 08:04:37.006 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/3 - null null
2025-05-24 08:04:37.006 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.006 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.006 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-24 08:04:37.007 +07:00 [INF] Route matched with {action = "GetSentFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetSentFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:37.009 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[ReceiverId] = [u].[id]
WHERE [f].[SenderId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-24 08:04:37.009 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType13`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:37.009 +07:00 [INF] Executed action server.Controllers.FriendsController.GetSentFriendRequests (Message_app) in 2.1749ms
2025-05-24 08:04:37.009 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-24 08:04:37.010 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/3 - 200 null application/json; charset=utf-8 3.5205ms
2025-05-24 08:04:37.033 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/3 - null null
2025-05-24 08:04:37.033 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.033 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.034 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-24 08:04:37.039 +07:00 [INF] Route matched with {action = "GetFriendSuggestions", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendSuggestions(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:37.058 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__userId_0
2025-05-24 08:04:37.060 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:37.144 +07:00 [INF] Executed DbCommand (73ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-24 08:04:37.152 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-24 08:04:37.154 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-24 08:04:37.169 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[ReceiverId]
FROM [FriendRequests] AS [f]
WHERE [f].[SenderId] = @__userId_0
2025-05-24 08:04:37.175 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[SenderId]
FROM [FriendRequests] AS [f]
WHERE [f].[ReceiverId] = @__userId_0
2025-05-24 08:04:37.190 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__fof_Key_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__fof_Key_0
2025-05-24 08:04:37.195 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType12`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendSuggestionDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:37.202 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendSuggestions (Message_app) in 162.9283ms
2025-05-24 08:04:37.202 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-24 08:04:37.202 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/3 - 200 null application/json; charset=utf-8 169.1177ms
2025-05-24 08:04:37.204 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/3 - null null
2025-05-24 08:04:37.204 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.204 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.204 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-24 08:04:37.204 +07:00 [INF] Route matched with {action = "GetFriendSuggestions", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendSuggestions(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:37.206 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__userId_0
2025-05-24 08:04:37.208 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:37.209 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-24 08:04:37.210 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-24 08:04:37.211 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/list/3 - null null
2025-05-24 08:04:37.211 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.211 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.211 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:37.211 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendsAsync(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:37.211 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-24 08:04:37.212 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[ReceiverId]
FROM [FriendRequests] AS [f]
WHERE [f].[SenderId] = @__userId_0
2025-05-24 08:04:37.214 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END, [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[bio], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[fcmToken], [u0].[gender], [u0].[interests], [u0].[location], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:37.216 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:37.217 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:37.218 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:37.219 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:37.220 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:37.221 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendsAsync (Message_app) in 10.1769ms
2025-05-24 08:04:37.222 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:37.222 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/list/3 - 200 null application/json; charset=utf-8 11.5052ms
2025-05-24 08:04:37.228 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[SenderId]
FROM [FriendRequests] AS [f]
WHERE [f].[ReceiverId] = @__userId_0
2025-05-24 08:04:37.233 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__fof_Key_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__fof_Key_0
2025-05-24 08:04:37.237 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType12`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendSuggestionDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:37.237 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendSuggestions (Message_app) in 32.9774ms
2025-05-24 08:04:37.238 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-24 08:04:37.238 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/3 - 200 null application/json; charset=utf-8 34.0216ms
2025-05-24 08:04:37.239 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/3 - null null
2025-05-24 08:04:37.239 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.239 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.240 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-24 08:04:37.240 +07:00 [INF] Route matched with {action = "GetFriendSuggestions", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendSuggestions(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:37.242 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__userId_0
2025-05-24 08:04:37.244 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:37.245 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-24 08:04:37.246 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-24 08:04:37.249 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-24 08:04:37.251 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[ReceiverId]
FROM [FriendRequests] AS [f]
WHERE [f].[SenderId] = @__userId_0
2025-05-24 08:04:37.252 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[SenderId]
FROM [FriendRequests] AS [f]
WHERE [f].[ReceiverId] = @__userId_0
2025-05-24 08:04:37.253 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__fof_Key_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__fof_Key_0
2025-05-24 08:04:37.256 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType12`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendSuggestionDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:37.256 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendSuggestions (Message_app) in 16.6786ms
2025-05-24 08:04:37.256 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-24 08:04:37.257 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/3 - 200 null application/json; charset=utf-8 17.271ms
2025-05-24 08:04:37.258 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/3 - null null
2025-05-24 08:04:37.258 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.258 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.258 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-24 08:04:37.258 +07:00 [INF] Route matched with {action = "GetFriendSuggestions", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendSuggestions(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:37.261 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__userId_0
2025-05-24 08:04:37.262 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:37.264 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-24 08:04:37.266 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-24 08:04:37.268 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-24 08:04:37.269 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[ReceiverId]
FROM [FriendRequests] AS [f]
WHERE [f].[SenderId] = @__userId_0
2025-05-24 08:04:37.270 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[SenderId]
FROM [FriendRequests] AS [f]
WHERE [f].[ReceiverId] = @__userId_0
2025-05-24 08:04:37.272 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__fof_Key_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__fof_Key_0
2025-05-24 08:04:37.274 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType12`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendSuggestionDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:37.274 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendSuggestions (Message_app) in 15.9269ms
2025-05-24 08:04:37.274 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-24 08:04:37.274 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/3 - 200 null application/json; charset=utf-8 16.6667ms
2025-05-24 08:04:37.301 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/list/3 - null null
2025-05-24 08:04:37.301 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.301 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.301 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:37.301 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendsAsync(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:37.303 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END, [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[bio], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[fcmToken], [u0].[gender], [u0].[interests], [u0].[location], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:37.304 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:37.306 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:37.307 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:37.308 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:37.308 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:37.308 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendsAsync (Message_app) in 6.9135ms
2025-05-24 08:04:37.308 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:37.308 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/list/3 - 200 null application/json; charset=utf-8 7.7057ms
2025-05-24 08:04:37.310 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/list/3 - null null
2025-05-24 08:04:37.310 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.310 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.310 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:37.310 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendsAsync(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:37.314 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END, [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[bio], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[fcmToken], [u0].[gender], [u0].[interests], [u0].[location], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:37.316 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:37.317 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:37.319 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:37.320 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:37.321 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:37.321 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendsAsync (Message_app) in 10.97ms
2025-05-24 08:04:37.322 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:37.322 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/list/3 - 200 null application/json; charset=utf-8 12.1745ms
2025-05-24 08:04:37.323 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/list/3 - null null
2025-05-24 08:04:37.323 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.323 +07:00 [INF] CORS policy execution successful.
2025-05-24 08:04:37.324 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:37.324 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendsAsync(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:37.328 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END, [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[bio], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[fcmToken], [u0].[gender], [u0].[interests], [u0].[location], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:37.329 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:37.331 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:37.333 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:37.334 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:37.334 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:37.335 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendsAsync (Message_app) in 10.202ms
2025-05-24 08:04:37.335 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:37.336 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/list/3 - 200 null application/json; charset=utf-8 12.3559ms
2025-05-24 08:04:38.412 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/friends/list/2 - null null
2025-05-24 08:04:38.413 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:38.414 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendsAsync(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:38.416 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END, [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[bio], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[fcmToken], [u0].[gender], [u0].[interests], [u0].[location], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:38.420 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:38.442 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:38.457 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:38.475 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:38.476 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:38.476 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendsAsync (Message_app) in 62.2804ms
2025-05-24 08:04:38.477 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:38.477 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/friends/list/2 - 200 null application/json; charset=utf-8 64.4977ms
2025-05-24 08:04:39.416 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.232:5053/api/friends/list/2 - null null
2025-05-24 08:04:39.417 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:39.417 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendsAsync(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-24 08:04:39.419 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END, [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[bio], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[fcmToken], [u0].[gender], [u0].[interests], [u0].[location], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:39.422 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-24 08:04:39.423 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:39.434 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:39.437 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-24 08:04:39.438 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-24 08:04:39.438 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendsAsync (Message_app) in 21.1476ms
2025-05-24 08:04:39.438 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-24 08:04:39.438 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/api/friends/list/2 - 200 null application/json; charset=utf-8 21.8199ms
2025-05-24 08:11:55.874 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-24 08:11:55.875 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-24 08:11:55.883 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-24 08:11:55.884 +07:00 [ERR] Connection id "0HNCQBHOC6MAS", Request id "0HNCQBHOC6MAS:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-24 08:11:55.887 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.232:5053/ws/chat?userId=2 - 101 null null 503672.2119ms
2025-05-24 08:19:49.015 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-24 08:19:49.016 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-24 08:19:49.018 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-24 08:19:49.018 +07:00 [ERR] Connection id "0HNCQBHOC6MAF", Request id "0HNCQBHOC6MAF:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-24 08:19:49.019 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1169552.7238ms
2025-05-24 14:14:20.660 +07:00 [INF] Application is shutting down...
