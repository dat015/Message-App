2025-05-22 08:21:58.509 +07:00 [INF] Executed DbCommand (60ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 08:21:58.926 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 08:21:59.025 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 08:21:59.036 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 08:21:59.036 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 08:21:59.037 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 08:21:59.037 +07:00 [INF] Hosting environment: Development
2025-05-22 08:21:59.037 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 08:25:58.201 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-22 08:25:58.386 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:25:58.421 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 228.5052ms
2025-05-22 08:25:58.477 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-22 08:25:58.483 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:25:58.599 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:25:58.605 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 08:25:58.710 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 08:25:58.844 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 08:26:02.780 +07:00 [INF] Executed DbCommand (3,236ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 08:26:03.118 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 08:26:03.285 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 4433.4336ms
2025-05-22 08:26:03.286 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 08:26:03.306 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 4828.2919ms
2025-05-22 08:26:03.342 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 08:26:03.371 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:26:03.373 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:26:03.377 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 08:26:03.633 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 08:26:03.634 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:26:03.639 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:26:03.645 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 08:26:03.668 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 08:26:04.058 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 08:26:04.058 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:26:04.059 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.7853ms
2025-05-22 08:26:04.063 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 08:26:04.064 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:26:04.064 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:26:04.065 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 08:26:04.078 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 08:26:04.376 +07:00 [INF] Executed DbCommand (235ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 08:26:04.424 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-22 08:26:04.428 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-22 08:26:04.431 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-22 08:26:04.436 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-22 08:26:04.442 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-22 08:26:04.445 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-22 08:26:04.446 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-22 08:26:04.449 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-22 08:26:04.451 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-22 08:26:04.453 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-22 08:26:04.455 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-22 08:26:04.460 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-22 08:26:04.462 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-22 08:26:04.469 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-22 08:26:04.472 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-22 08:26:04.482 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-22 08:26:04.503 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-22 08:26:04.506 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-22 08:26:04.519 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-22 08:26:04.523 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-22 08:26:04.529 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-22 08:26:04.603 +07:00 [INF] Executed DbCommand (230ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 08:26:04.609 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 08:26:04.634 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 965.5118ms
2025-05-22 08:26:04.634 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 08:26:04.635 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 1001.7388ms
2025-05-22 08:26:04.754 +07:00 [INF] Executed DbCommand (331ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 08:26:04.906 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 08:26:04.941 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 861.9544ms
2025-05-22 08:26:04.941 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 08:26:04.946 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 883.1609ms
2025-05-22 08:29:43.865 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - application/json 58
2025-05-22 08:29:43.873 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 08:29:43.873 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 08:29:43.899 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 08:29:43.900 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 08:29:43.900 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 26.9284ms
2025-05-22 08:29:43.901 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 08:29:43.901 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - 200 null application/json; charset=utf-8 35.6332ms
2025-05-22 08:29:45.171 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 08:29:45.172 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - null null
2025-05-22 08:29:45.172 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 08:29:45.173 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 08:29:45.173 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 08:29:45.187 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 08:29:45.193 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 08:29:45.193 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 20.382ms
2025-05-22 08:29:45.194 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 08:29:45.194 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 22.1269ms
2025-05-22 08:29:45.253 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 08:29:45.254 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-22 08:29:45.255 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-22 08:29:45.257 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-22 08:29:45.258 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-22 08:29:45.258 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-22 08:29:45.258 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-22 08:29:45.258 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-22 08:29:45.258 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-22 08:29:45.258 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-22 08:29:45.394 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - null null
2025-05-22 08:29:45.395 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 08:29:45.395 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 08:29:45.417 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 08:29:45.425 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 08:29:45.426 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 31.0394ms
2025-05-22 08:29:45.426 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 08:29:45.426 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 32.8413ms
2025-05-22 08:29:50.434 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 08:29:50.434 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:29:50.435 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - 204 null null 0.3178ms
2025-05-22 08:29:50.436 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 08:29:50.436 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:29:50.436 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:29:50.436 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 08:29:50.442 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 08:29:50.462 +07:00 [INF] Retrieved 0 messages from Redis for conversation 45
2025-05-22 08:29:50.491 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-22 08:29:50.552 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-22 08:29:50.553 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-22 08:29:50.554 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 112.2345ms
2025-05-22 08:29:50.554 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 08:29:50.554 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - 404 null text/plain; charset=utf-8 118.3675ms
2025-05-22 08:29:50.675 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 08:29:50.675 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:29:50.675 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - 204 null null 0.2373ms
2025-05-22 08:29:50.676 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 08:29:50.677 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:29:50.677 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:29:50.677 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 08:29:50.679 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 08:29:50.701 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 08:29:50.738 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 08:29:50.740 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 61.0504ms
2025-05-22 08:29:50.740 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 08:29:50.740 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 63.7031ms
2025-05-22 08:29:50.752 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 08:29:50.752 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:29:50.752 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.308ms
2025-05-22 08:29:50.754 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 08:29:50.754 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:29:50.754 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:29:50.754 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:29:50.757 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 08:29:50.767 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 08:29:50.770 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 08:29:50.772 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 15.1091ms
2025-05-22 08:29:50.772 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:29:50.772 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 18.7025ms
2025-05-22 08:29:53.965 +07:00 [INF] Handling message from user 3: jj
2025-05-22 08:29:53.989 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 08:29:54.157 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 08:29:54.190 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 08:29:54.205 +07:00 [INF] Message saved to DB with ID: 343
2025-05-22 08:29:54.208 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 08:29:54.219 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 08:29:54.226 +07:00 [INF] Transaction committed for message: 343
2025-05-22 08:29:54.232 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 08:29:54.239 +07:00 [INF] Saved message 343 to Redis
2025-05-22 08:29:54.241 +07:00 [INF] Added message 343 to conversation 45
2025-05-22 08:29:54.245 +07:00 [INF] Published message to channel conversation:45
2025-05-22 08:29:56.342 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Message/getMessages/45/2 - null null
2025-05-22 08:29:56.343 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 08:29:56.343 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 08:29:56.375 +07:00 [INF] Retrieved 1 messages from Redis for conversation 45
2025-05-22 08:29:56.376 +07:00 [INF] Retrieved 1 messages from Redis for conversation 45 and user 2
2025-05-22 08:29:56.376 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 08:29:56.378 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 34.2997ms
2025-05-22 08:29:56.378 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 08:29:56.378 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Message/getMessages/45/2 - 200 null application/json; charset=utf-8 36.3233ms
2025-05-22 08:29:56.407 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 08:29:56.407 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 08:29:56.407 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 08:29:56.410 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 08:29:56.412 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 08:29:56.412 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.0472ms
2025-05-22 08:29:56.412 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 08:29:56.412 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 5.7625ms
2025-05-22 08:29:56.447 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Participant/get_participants/45 - null null
2025-05-22 08:29:56.449 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:29:56.449 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 08:29:56.453 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 08:29:56.455 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 08:29:56.456 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.7843ms
2025-05-22 08:29:56.456 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:29:56.456 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 8.6212ms
2025-05-22 08:29:57.455 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Participant/get_participants/45 - null null
2025-05-22 08:29:57.456 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:29:57.457 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 08:29:57.476 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 08:29:57.479 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 08:29:57.479 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 22.4571ms
2025-05-22 08:29:57.479 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:29:57.479 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 24.1246ms
2025-05-22 08:30:07.914 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Message/uploadFile - multipart/form-data; boundary=--dio-boundary-3440754403 1251246
2025-05-22 08:30:07.915 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-05-22 08:30:07.920 +07:00 [INF] Route matched with {action = "UploadFile", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UploadFile(Microsoft.AspNetCore.Http.IFormFile) on controller server.Controllers.MessageController (Message_app).
2025-05-22 08:30:19.578 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@p0='?' (DbType = Single), @p1='?' (Size = 50), @p2='?' (Size = 255), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Attachments] ([FileSize], [file_type], [file_url], [is_temporary], [message_id], [uploaded_at])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-05-22 08:30:19.581 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 08:30:19.583 +07:00 [INF] Executed action server.Controllers.MessageController.UploadFile (Message_app) in 11662.5763ms
2025-05-22 08:30:19.583 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-05-22 08:30:19.584 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Message/uploadFile - 200 null application/json; charset=utf-8 11670.0049ms
2025-05-22 08:30:19.978 +07:00 [INF] Request starting HTTP/1.1 PUT http://192.168.1.5:5053/api/Conversation/update_conversation_image/45 - application/json 133
2025-05-22 08:30:19.978 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.UpdateConversationImage (Message_app)'
2025-05-22 08:30:19.981 +07:00 [INF] Route matched with {action = "UpdateConversationImage", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateConversationImage(Int32, System.String) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 08:30:19.991 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 08:30:19.998 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 08:30:20.000 +07:00 [INF] Message 0 already exists in Redis
2025-05-22 08:30:20.005 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 08:30:20.006 +07:00 [INF] Executed action server.Controllers.ConversationController.UpdateConversationImage (Message_app) in 25.2596ms
2025-05-22 08:30:20.006 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.UpdateConversationImage (Message_app)'
2025-05-22 08:30:20.007 +07:00 [INF] Request finished HTTP/1.1 PUT http://192.168.1.5:5053/api/Conversation/update_conversation_image/45 - 200 null application/json; charset=utf-8 28.7742ms
2025-05-22 08:31:04.085 +07:00 [INF] Request starting HTTP/1.1 DELETE http://192.168.1.5:5053/api/Participant/leave_group/45/2 - null null
2025-05-22 08:31:04.085 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.LeaveGroup (Message_app)'
2025-05-22 08:31:04.088 +07:00 [INF] Route matched with {action = "LeaveGroup", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] LeaveGroup(Int32, Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 08:31:04.110 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32), @__user_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[user_id] = @__user_id_1
2025-05-22 08:31:04.129 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
DELETE FROM [Participants]
OUTPUT 1
WHERE [id] = @p0;
2025-05-22 08:31:04.135 +07:00 [INF] Unsubscribed user 2 from channel conversation:45
2025-05-22 08:31:04.135 +07:00 [INF] Message 0 already exists in Redis
2025-05-22 08:31:04.136 +07:00 [INF] Published message to channel conversation:45
2025-05-22 08:31:04.136 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType18`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 08:31:04.139 +07:00 [INF] Executed action server.Controllers.ParticipantController.LeaveGroup (Message_app) in 51.0856ms
2025-05-22 08:31:04.139 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.LeaveGroup (Message_app)'
2025-05-22 08:31:04.140 +07:00 [INF] Request finished HTTP/1.1 DELETE http://192.168.1.5:5053/api/Participant/leave_group/45/2 - 200 null application/json; charset=utf-8 54.9565ms
2025-05-22 08:31:06.800 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 08:31:06.801 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:06.801 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - 204 null null 0.6017ms
2025-05-22 08:31:06.803 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 08:31:06.803 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:06.803 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:06.803 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 08:31:06.803 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 08:31:06.805 +07:00 [INF] Retrieved 1 messages from Redis for conversation 45
2025-05-22 08:31:06.805 +07:00 [INF] Retrieved 1 messages from Redis for conversation 45 and user 3
2025-05-22 08:31:06.805 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 08:31:06.805 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.0635ms
2025-05-22 08:31:06.805 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 08:31:06.805 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - 200 null application/json; charset=utf-8 2.8913ms
2025-05-22 08:31:06.812 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 08:31:06.813 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:06.813 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - 204 null null 0.4207ms
2025-05-22 08:31:06.815 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 08:31:06.815 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:06.815 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:06.815 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 08:31:06.815 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 08:31:06.835 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 08:31:06.838 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 08:31:06.838 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 22.8808ms
2025-05-22 08:31:06.838 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 08:31:06.839 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 23.8066ms
2025-05-22 08:31:06.845 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 08:31:06.846 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:06.846 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.2695ms
2025-05-22 08:31:06.848 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 08:31:06.848 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:06.848 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:06.849 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:31:06.851 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 08:31:06.887 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 08:31:06.890 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 08:31:06.890 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 38.6305ms
2025-05-22 08:31:06.890 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:31:06.891 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 43.0467ms
2025-05-22 08:31:09.408 +07:00 [INF] Handling message from user 3: d
2025-05-22 08:31:09.420 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 08:31:09.425 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 08:31:09.433 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 08:31:09.434 +07:00 [INF] Message saved to DB with ID: 344
2025-05-22 08:31:09.435 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 08:31:09.439 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 08:31:09.440 +07:00 [INF] Transaction committed for message: 344
2025-05-22 08:31:09.446 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 08:31:09.447 +07:00 [INF] Saved message 344 to Redis
2025-05-22 08:31:09.448 +07:00 [INF] Added message 344 to conversation 45
2025-05-22 08:31:09.448 +07:00 [INF] Published message to channel conversation:45
2025-05-22 08:31:13.361 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 08:31:13.361 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:13.361 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.3066ms
2025-05-22 08:31:13.362 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 08:31:13.363 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:13.363 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:13.363 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:31:13.363 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 08:31:13.368 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 08:31:13.371 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 08:31:13.371 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.2779ms
2025-05-22 08:31:13.372 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:31:13.372 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 9.3548ms
2025-05-22 08:31:17.589 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 08:31:17.589 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:17.589 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:17.589 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 08:31:17.590 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 08:31:17.599 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 08:31:17.600 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 08:31:17.600 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.6725ms
2025-05-22 08:31:17.601 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 08:31:17.601 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 11.9669ms
2025-05-22 08:31:19.935 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/add_member/45/2 - null null
2025-05-22 08:31:19.935 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:19.935 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/add_member/45/2 - 204 null null 0.5821ms
2025-05-22 08:31:19.937 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Participant/add_member/45/2 - null 0
2025-05-22 08:31:19.937 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:19.937 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:19.937 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.AddMember (Message_app)'
2025-05-22 08:31:19.940 +07:00 [INF] Route matched with {action = "AddMember", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddMember(Int32, Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 08:31:19.959 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Conversations] AS [c]
        WHERE [c].[id] = @__conversation_id_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-05-22 08:31:19.968 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__user_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] = @__user_id_0
2025-05-22 08:31:19.978 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32), @__user_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[user_id] = @__user_id_1) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-05-22 08:31:19.986 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Participants] ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 08:31:19.989 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-22 08:31:19.990 +07:00 [INF] Message 0 already exists in Redis
2025-05-22 08:31:19.993 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType18`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 08:31:19.993 +07:00 [INF] Executed action server.Controllers.ParticipantController.AddMember (Message_app) in 52.6878ms
2025-05-22 08:31:19.993 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.AddMember (Message_app)'
2025-05-22 08:31:19.993 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Participant/add_member/45/2 - 200 null application/json; charset=utf-8 56.4297ms
2025-05-22 08:31:19.998 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 08:31:19.998 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:19.998 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.401ms
2025-05-22 08:31:20.000 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 08:31:20.000 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:20.000 +07:00 [INF] CORS policy execution successful.
2025-05-22 08:31:20.001 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:31:20.001 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 08:31:20.004 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 08:31:20.007 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 08:31:20.007 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.9179ms
2025-05-22 08:31:20.007 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:31:20.007 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 7.0344ms
2025-05-22 08:31:20.244 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversationDto/2/45 - null null
2025-05-22 08:31:20.244 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-05-22 08:31:20.248 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 08:31:20.263 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-22 08:31:20.263 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 15.4772ms
2025-05-22 08:31:20.264 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-05-22 08:31:20.264 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversationDto/2/45 - 200 null application/json; charset=utf-8 19.9765ms
2025-05-22 08:31:42.397 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Message/getMessages/45/2 - null null
2025-05-22 08:31:42.398 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 08:31:42.398 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 08:31:42.400 +07:00 [INF] Retrieved 2 messages from Redis for conversation 45
2025-05-22 08:31:42.402 +07:00 [INF] Retrieved 2 messages from Redis for conversation 45 and user 2
2025-05-22 08:31:42.402 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 08:31:42.402 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.4712ms
2025-05-22 08:31:42.402 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 08:31:42.402 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Message/getMessages/45/2 - 200 null application/json; charset=utf-8 5.4265ms
2025-05-22 08:31:42.443 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 08:31:42.443 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 08:31:42.443 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 08:31:42.450 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 08:31:42.453 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 08:31:42.454 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.4587ms
2025-05-22 08:31:42.454 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 08:31:42.454 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 11.1099ms
2025-05-22 08:31:42.510 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Participant/get_participants/45 - null null
2025-05-22 08:31:42.510 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:31:42.510 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 08:31:42.514 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 08:31:42.516 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 08:31:42.517 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.681ms
2025-05-22 08:31:42.517 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:31:42.518 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 7.8657ms
2025-05-22 08:31:51.622 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Message/getMessages/45/2 - null null
2025-05-22 08:31:51.623 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 08:31:51.623 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 08:31:51.625 +07:00 [INF] Retrieved 2 messages from Redis for conversation 45
2025-05-22 08:31:51.625 +07:00 [INF] Retrieved 2 messages from Redis for conversation 45 and user 2
2025-05-22 08:31:51.626 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 08:31:51.626 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.6364ms
2025-05-22 08:31:51.626 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 08:31:51.626 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Message/getMessages/45/2 - 200 null application/json; charset=utf-8 3.4366ms
2025-05-22 08:31:51.678 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 08:31:51.679 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 08:31:51.679 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 08:31:51.687 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 08:31:51.690 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 08:31:51.690 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 11.292ms
2025-05-22 08:31:51.690 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 08:31:51.691 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 12.3375ms
2025-05-22 08:31:51.722 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Participant/get_participants/45 - null null
2025-05-22 08:31:51.723 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:31:51.723 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 08:31:51.733 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 08:31:51.743 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 08:31:51.743 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 20.0271ms
2025-05-22 08:31:51.743 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 08:31:51.744 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 21.1207ms
2025-05-22 08:46:49.660 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 08:46:49.663 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 08:46:49.713 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 08:46:49.714 +07:00 [ERR] Connection id "0HNCOPUDD1LIK", Request id "0HNCOPUDD1LIK:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 08:46:49.718 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 1023420.5212ms
2025-05-22 08:47:02.468 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 08:47:02.469 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 08:47:02.469 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 08:47:02.470 +07:00 [ERR] Connection id "0HNCOPUDD1LIH", Request id "0HNCOPUDD1LIH:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 08:47:02.471 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1258002.1218ms
2025-05-22 08:58:25.066 +07:00 [INF] Application is shutting down...
2025-05-22 10:00:13.791 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 10:00:13.912 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 10:00:13.992 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 10:00:13.999 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 10:00:14.000 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 10:00:14.000 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 10:00:14.000 +07:00 [INF] Hosting environment: Development
2025-05-22 10:00:14.000 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 10:02:48.798 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-22 10:02:48.854 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:02:48.868 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 73.6498ms
2025-05-22 10:02:48.874 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-22 10:02:48.878 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:02:48.929 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:02:48.930 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 10:02:48.985 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:02:49.028 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 10:02:49.399 +07:00 [INF] Executed DbCommand (86ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 10:02:49.508 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 10:02:49.558 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 526.8479ms
2025-05-22 10:02:49.559 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:02:49.566 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 692.2907ms
2025-05-22 10:02:49.584 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 10:02:49.595 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:02:49.596 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:02:49.597 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:02:49.793 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 10:02:49.794 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:02:49.796 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:02:49.798 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:02:49.807 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 10:02:49.952 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 10:02:49.954 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 10:02:49.965 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 157.7657ms
2025-05-22 10:02:49.965 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:02:49.966 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 173.2908ms
2025-05-22 10:02:50.021 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:02:50.044 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-22 10:02:50.045 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-22 10:02:50.046 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-22 10:02:50.047 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-22 10:02:50.048 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-22 10:02:50.048 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-22 10:02:50.049 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-22 10:02:50.050 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-22 10:02:50.050 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-22 10:02:50.051 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-22 10:02:50.052 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-22 10:02:50.052 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-22 10:02:50.054 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-22 10:02:50.055 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-22 10:02:50.057 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-22 10:02:50.058 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-22 10:02:50.058 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-22 10:02:50.059 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-22 10:02:50.060 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-22 10:02:50.061 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-22 10:02:50.062 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-22 10:02:50.109 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 10:02:50.109 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:02:50.110 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.641ms
2025-05-22 10:02:50.113 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 10:02:50.114 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:02:50.114 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:02:50.114 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:02:50.120 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 10:02:50.300 +07:00 [INF] Executed DbCommand (34ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 10:02:50.321 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 10:02:50.335 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 213.6109ms
2025-05-22 10:02:50.335 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:02:50.335 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 221.7494ms
2025-05-22 10:04:48.256 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 10:04:48.259 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:04:48.290 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 10:04:48.292 +07:00 [ERR] Connection id "0HNCORKH532Q7", Request id "0HNCORKH532Q7:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 10:04:48.295 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 118710.5661ms
2025-05-22 10:09:54.006 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - application/json 169
2025-05-22 10:09:54.096 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - 404 0 null 92.0072ms
2025-05-22 10:09:54.103 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://192.168.1.5:5053/api/Notification/token, Response status code: 404
2025-05-22 10:10:27.848 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - application/json 57
2025-05-22 10:10:27.865 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:10:27.876 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 10:10:28.211 +07:00 [INF] Executed DbCommand (52ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 10:10:28.220 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-05-22 10:10:28.223 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 346.2477ms
2025-05-22 10:10:28.224 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:10:28.224 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - 400 null application/json; charset=utf-8 376.9733ms
2025-05-22 10:10:31.624 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - application/json 58
2025-05-22 10:10:31.625 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:10:31.625 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 10:10:31.637 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 10:10:31.643 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 10:10:31.643 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 18.3485ms
2025-05-22 10:10:31.643 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:10:31.643 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - 200 null application/json; charset=utf-8 19.1265ms
2025-05-22 10:10:32.779 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 10:10:32.781 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:10:33.021 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - null null
2025-05-22 10:10:33.025 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:10:33.026 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 10:10:33.030 +07:00 [INF] Executed DbCommand (36ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:10:33.034 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-22 10:10:33.035 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-22 10:10:33.038 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-22 10:10:33.039 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-22 10:10:33.039 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-22 10:10:33.039 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-22 10:10:33.040 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-22 10:10:33.040 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-22 10:10:33.040 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-22 10:10:33.040 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-22 10:10:33.041 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-22 10:10:33.041 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-22 10:10:33.041 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-22 10:10:33.042 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-22 10:10:33.042 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-22 10:10:33.042 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-22 10:10:33.043 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-22 10:10:33.043 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-22 10:10:33.044 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-22 10:10:33.044 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-22 10:10:33.044 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-22 10:10:33.044 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-22 10:10:33.044 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-22 10:10:33.070 +07:00 [INF] Executed DbCommand (38ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 10:10:33.083 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 10:10:33.090 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 63.7461ms
2025-05-22 10:10:33.090 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:10:33.090 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 68.8574ms
2025-05-22 10:10:33.783 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - null null
2025-05-22 10:10:33.792 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:10:33.792 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 10:10:33.818 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 10:10:33.823 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 10:10:33.823 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 30.7579ms
2025-05-22 10:10:33.823 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:10:33.824 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 40.5634ms
2025-05-22 10:12:44.829 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-22 10:12:44.831 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:44.833 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 4.0852ms
2025-05-22 10:12:44.835 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-22 10:12:44.835 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:44.835 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:44.835 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:12:44.835 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 10:12:44.848 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 10:12:44.849 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 10:12:44.850 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 14.2911ms
2025-05-22 10:12:44.850 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:12:44.850 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 15.4608ms
2025-05-22 10:12:44.869 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 10:12:44.870 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:44.870 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:44.870 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:12:44.890 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:12:44.891 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-22 10:12:44.891 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-22 10:12:44.891 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-22 10:12:44.891 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-22 10:12:44.891 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-22 10:12:44.891 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-22 10:12:44.891 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-22 10:12:44.891 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-22 10:12:44.891 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-22 10:12:44.891 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-22 10:12:44.891 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-22 10:12:44.892 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-22 10:12:44.892 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-22 10:12:44.892 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-22 10:12:44.892 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-22 10:12:44.892 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-22 10:12:44.892 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-22 10:12:44.892 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-22 10:12:44.892 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-22 10:12:44.892 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-22 10:12:44.892 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-22 10:12:44.996 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 10:12:44.996 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:44.996 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:44.996 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:12:44.997 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 10:12:45.006 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 10:12:45.007 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 10:12:45.007 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.2588ms
2025-05-22 10:12:45.007 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:12:45.007 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 11.0943ms
2025-05-22 10:12:45.226 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 10:12:45.226 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:45.226 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3715ms
2025-05-22 10:12:45.227 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 10:12:45.228 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:45.228 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:45.228 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:12:45.228 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 10:12:45.250 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 10:12:45.258 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 10:12:45.260 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 32.3184ms
2025-05-22 10:12:45.261 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:12:45.261 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 33.2018ms
2025-05-22 10:12:48.882 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Message/getMessages/45/2 - null null
2025-05-22 10:12:48.885 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 10:12:48.900 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 10:12:48.966 +07:00 [INF] Retrieved 2 messages from Redis for conversation 45
2025-05-22 10:12:48.969 +07:00 [INF] Retrieved 2 messages from Redis for conversation 45 and user 2
2025-05-22 10:12:48.970 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 10:12:48.974 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 73.776ms
2025-05-22 10:12:48.974 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 10:12:48.974 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Message/getMessages/45/2 - 200 null application/json; charset=utf-8 91.7053ms
2025-05-22 10:12:49.027 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 10:12:49.027 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 10:12:49.030 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 10:12:49.117 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 10:12:49.162 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 10:12:49.164 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 134.1989ms
2025-05-22 10:12:49.164 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 10:12:49.165 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 137.7906ms
2025-05-22 10:12:49.267 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Participant/get_participants/45 - null null
2025-05-22 10:12:49.267 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 10:12:49.271 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 10:12:49.282 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 10:12:49.285 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 10:12:49.289 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 18.6219ms
2025-05-22 10:12:49.290 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 10:12:49.290 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 23.152ms
2025-05-22 10:12:51.751 +07:00 [INF] Handling message from user 2: 
2025-05-22 10:12:51.774 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 10:12:51.889 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:12:51.928 +07:00 [INF] Executed DbCommand (37ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 10:12:51.944 +07:00 [INF] Message saved to DB with ID: 345
2025-05-22 10:12:51.946 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:12:51.957 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 10:12:51.964 +07:00 [INF] Transaction committed for message: 345
2025-05-22 10:12:51.970 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:12:51.976 +07:00 [INF] Saved message 345 to Redis
2025-05-22 10:12:51.979 +07:00 [INF] Added message 345 to conversation 45
2025-05-22 10:12:51.992 +07:00 [INF] Published message to channel conversation:45
2025-05-22 10:12:52.000 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/send - application/json 63
2025-05-22 10:12:52.001 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:12:52.005 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:12:52.011 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 5.9379ms
2025-05-22 10:12:52.013 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:12:52.017 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method500(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:12:52.043 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/send - 500 null text/plain; charset=utf-8 43.658ms
2025-05-22 10:12:52.228 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/send - application/json 63
2025-05-22 10:12:52.229 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:12:52.229 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:12:52.229 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.2759ms
2025-05-22 10:12:52.229 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:12:52.229 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method500(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:12:52.232 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/send - 500 null text/plain; charset=utf-8 3.5533ms
2025-05-22 10:12:52.246 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/send - application/json 63
2025-05-22 10:12:52.246 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:12:52.246 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:12:52.247 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.251ms
2025-05-22 10:12:52.247 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:12:52.247 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method500(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:12:52.249 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/send - 500 null text/plain; charset=utf-8 3.8809ms
2025-05-22 10:12:54.809 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 10:12:54.809 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:54.809 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - 204 null null 0.4826ms
2025-05-22 10:12:54.810 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 10:12:54.811 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:54.811 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:54.812 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 10:12:54.812 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 10:12:54.814 +07:00 [INF] Retrieved 3 messages from Redis for conversation 45
2025-05-22 10:12:54.815 +07:00 [INF] Retrieved 3 messages from Redis for conversation 45 and user 3
2025-05-22 10:12:54.815 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 10:12:54.815 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 3.0564ms
2025-05-22 10:12:54.815 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 10:12:54.815 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - 200 null application/json; charset=utf-8 4.7417ms
2025-05-22 10:12:54.821 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 10:12:54.821 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:54.822 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - 204 null null 0.4678ms
2025-05-22 10:12:54.824 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 10:12:54.824 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:54.824 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:54.824 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 10:12:54.824 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 10:12:54.829 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 10:12:54.830 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 10:12:54.830 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.945ms
2025-05-22 10:12:54.831 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 10:12:54.831 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 6.636ms
2025-05-22 10:12:54.837 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 10:12:54.838 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:54.838 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.3875ms
2025-05-22 10:12:54.839 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 10:12:54.840 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:54.841 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:54.841 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 10:12:54.841 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 10:12:54.843 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 10:12:54.845 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 10:12:54.845 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.2809ms
2025-05-22 10:12:54.846 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 10:12:54.846 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 6.3629ms
2025-05-22 10:12:58.576 +07:00 [INF] Handling message from user 3: sdf
2025-05-22 10:12:58.582 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 10:12:58.595 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:12:58.598 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 10:12:58.598 +07:00 [INF] Message saved to DB with ID: 346
2025-05-22 10:12:58.600 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:12:58.603 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 10:12:58.605 +07:00 [INF] Transaction committed for message: 346
2025-05-22 10:12:58.608 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:12:58.611 +07:00 [INF] Saved message 346 to Redis
2025-05-22 10:12:58.611 +07:00 [INF] Added message 346 to conversation 45
2025-05-22 10:12:58.612 +07:00 [INF] Published message to channel conversation:45
2025-05-22 10:12:58.756 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 10:12:58.756 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:58.757 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.5312ms
2025-05-22 10:12:58.758 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:12:58.758 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:58.758 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:58.758 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:12:58.758 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:12:58.759 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.1955ms
2025-05-22 10:12:58.759 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:12:58.759 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method500(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:12:58.763 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 4.7035ms
2025-05-22 10:12:58.774 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:12:58.774 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:58.775 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:58.775 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:12:58.775 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:12:58.775 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.1233ms
2025-05-22 10:12:58.775 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:12:58.775 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method500(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:12:58.777 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 2.6922ms
2025-05-22 10:12:58.783 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:12:58.783 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:58.783 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:12:58.783 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:12:58.783 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:12:58.783 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.1361ms
2025-05-22 10:12:58.784 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:12:58.784 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method500(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:12:58.786 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 3.3096ms
2025-05-22 10:14:20.820 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-22 10:14:20.820 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:20.820 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.4081ms
2025-05-22 10:14:20.822 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-22 10:14:20.822 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:20.822 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:20.822 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:14:20.824 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 10:14:20.843 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 10:14:20.844 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 10:14:20.845 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 21.0992ms
2025-05-22 10:14:20.845 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:14:20.845 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 23.4741ms
2025-05-22 10:14:20.862 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 10:14:20.862 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:20.863 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:20.863 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:14:20.869 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 10:14:20.870 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:14:20.874 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 10:14:20.875 +07:00 [ERR] Connection id "0HNCORKH532QF", Request id "0HNCORKH532QF:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 10:14:20.878 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 96008.7453ms
2025-05-22 10:14:20.881 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:14:20.882 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-22 10:14:20.882 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-22 10:14:20.882 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-22 10:14:20.882 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-22 10:14:20.882 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-22 10:14:20.883 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-22 10:14:20.980 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 10:14:20.980 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:20.980 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:20.980 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:14:20.981 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 10:14:20.991 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 10:14:20.991 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 10:14:20.992 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.6543ms
2025-05-22 10:14:20.992 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:14:20.992 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 12.5532ms
2025-05-22 10:14:21.133 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 10:14:21.133 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:21.133 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2909ms
2025-05-22 10:14:21.134 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 10:14:21.134 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:21.134 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:21.135 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:14:21.135 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 10:14:21.152 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 10:14:21.161 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 10:14:21.162 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 27.1976ms
2025-05-22 10:14:21.162 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:14:21.162 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 28.1939ms
2025-05-22 10:14:24.309 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 10:14:24.309 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:24.309 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - 204 null null 0.2608ms
2025-05-22 10:14:24.310 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 10:14:24.310 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:24.310 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:24.311 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 10:14:24.311 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 10:14:24.317 +07:00 [INF] Retrieved 4 messages from Redis for conversation 45
2025-05-22 10:14:24.317 +07:00 [INF] Retrieved 4 messages from Redis for conversation 45 and user 3
2025-05-22 10:14:24.318 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 10:14:24.318 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 6.9645ms
2025-05-22 10:14:24.318 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 10:14:24.318 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - 200 null application/json; charset=utf-8 7.7901ms
2025-05-22 10:14:24.324 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 10:14:24.324 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:24.325 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - 204 null null 0.9668ms
2025-05-22 10:14:24.326 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 10:14:24.326 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:24.326 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:24.327 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 10:14:24.327 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 10:14:24.333 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 10:14:24.334 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 10:14:24.335 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.2926ms
2025-05-22 10:14:24.335 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 10:14:24.335 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 8.8669ms
2025-05-22 10:14:24.341 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 10:14:24.341 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:24.341 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.249ms
2025-05-22 10:14:24.343 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 10:14:24.343 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:24.343 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:24.343 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 10:14:24.344 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 10:14:24.350 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 10:14:24.352 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 10:14:24.353 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.2472ms
2025-05-22 10:14:24.353 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 10:14:24.353 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 9.7874ms
2025-05-22 10:14:25.988 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 10:14:25.988 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:25.988 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:25.990 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:14:26.892 +07:00 [INF] Handling message from user 3: a
2025-05-22 10:14:26.901 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 10:14:26.918 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:14:26.925 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 10:14:26.926 +07:00 [INF] Message saved to DB with ID: 347
2025-05-22 10:14:26.927 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:14:26.932 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 10:14:26.934 +07:00 [INF] Transaction committed for message: 347
2025-05-22 10:14:26.938 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:14:26.940 +07:00 [INF] Saved message 347 to Redis
2025-05-22 10:14:26.941 +07:00 [INF] Added message 347 to conversation 45
2025-05-22 10:14:26.941 +07:00 [INF] Published message to channel conversation:45
2025-05-22 10:14:27.052 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 10:14:27.052 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:27.052 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.3036ms
2025-05-22 10:14:27.053 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:14:27.053 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:27.053 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:27.053 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:14:27.053 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:14:27.053 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.1147ms
2025-05-22 10:14:27.053 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:14:27.055 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method500(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:14:27.057 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 3.9543ms
2025-05-22 10:14:27.072 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:14:27.074 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:27.074 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:27.074 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:14:27.074 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:14:27.075 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.4851ms
2025-05-22 10:14:27.075 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:14:27.075 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method500(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:14:27.078 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 5.5438ms
2025-05-22 10:14:27.090 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:14:27.090 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:27.091 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:14:27.092 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:14:27.093 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:14:27.093 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.1873ms
2025-05-22 10:14:27.093 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:14:27.093 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method500(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:14:27.095 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 4.656ms
2025-05-22 10:15:20.589 +07:00 [INF] Handling message from user 3: s
2025-05-22 10:15:20.614 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 10:15:20.615 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:15:20.627 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 10:15:20.627 +07:00 [INF] Message saved to DB with ID: 348
2025-05-22 10:15:20.628 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:15:20.633 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 10:15:20.634 +07:00 [INF] Transaction committed for message: 348
2025-05-22 10:15:20.640 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:15:20.642 +07:00 [INF] Saved message 348 to Redis
2025-05-22 10:15:20.642 +07:00 [INF] Added message 348 to conversation 45
2025-05-22 10:15:20.644 +07:00 [INF] Published message to channel conversation:45
2025-05-22 10:15:20.775 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 10:15:20.775 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:15:20.775 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.2885ms
2025-05-22 10:15:20.776 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:15:20.776 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:15:20.777 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:15:20.777 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:15:20.780 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:15:20.780 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.1448ms
2025-05-22 10:15:20.780 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:15:20.780 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method508(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:15:20.781 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 4.7873ms
2025-05-22 10:15:20.789 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:15:20.790 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:15:20.792 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:15:20.792 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:15:20.792 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:15:20.792 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.1379ms
2025-05-22 10:15:20.792 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:15:20.792 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method508(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:15:20.793 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 3.5803ms
2025-05-22 10:15:20.801 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:15:20.801 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:15:20.801 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:15:20.801 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:15:20.801 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:15:20.801 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.2641ms
2025-05-22 10:15:20.801 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:15:20.801 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method508(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:15:20.802 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 1.3651ms
2025-05-22 10:26:19.630 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 10:26:19.630 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:26:19.636 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 10:26:19.636 +07:00 [ERR] Connection id "0HNCORKH532QB", Request id "0HNCORKH532QB:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 10:26:19.638 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 946859.2253ms
2025-05-22 10:26:29.441 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 10:26:29.441 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 723453.572ms
2025-05-22 10:26:29.443 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 10:26:29.443 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:26:29.445 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 10:26:29.445 +07:00 [ERR] Connection id "0HNCORKH532QL", Request id "0HNCORKH532QL:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 10:26:29.446 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 728584.125ms
2025-05-22 10:28:04.338 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - application/json 169
2025-05-22 10:28:04.351 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - 404 0 null 13.4548ms
2025-05-22 10:28:04.359 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://192.168.1.5:5053/api/Notification/token, Response status code: 404
2025-05-22 10:28:12.720 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-22 10:28:12.720 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:28:12.721 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 1.4271ms
2025-05-22 10:28:12.723 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-22 10:28:12.723 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:28:12.723 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:28:12.724 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:28:12.762 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 10:28:13.145 +07:00 [INF] Executed DbCommand (80ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 10:28:13.155 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 10:28:13.175 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 412.375ms
2025-05-22 10:28:13.175 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:28:13.175 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 452.6093ms
2025-05-22 10:28:13.200 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 10:28:13.203 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:28:13.203 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:28:13.203 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:28:13.328 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 10:28:13.329 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:28:13.329 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:28:13.329 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:28:13.334 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 10:28:13.366 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 10:28:13.367 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 10:28:13.372 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 37.6859ms
2025-05-22 10:28:13.372 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:28:13.372 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 43.6354ms
2025-05-22 10:28:13.516 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:28:13.518 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-22 10:28:13.519 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-22 10:28:13.519 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-22 10:28:13.519 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-22 10:28:13.519 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-22 10:28:13.519 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-22 10:28:13.519 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-22 10:28:13.519 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-22 10:28:13.519 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-22 10:28:13.519 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-22 10:28:13.519 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-22 10:28:13.519 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-22 10:28:13.519 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-22 10:28:13.520 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-22 10:28:13.520 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-22 10:28:13.520 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-22 10:28:13.520 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-22 10:28:13.520 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-22 10:28:13.520 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-22 10:28:13.520 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-22 10:28:13.520 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-22 10:28:13.593 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 10:28:13.593 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:28:13.593 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.7715ms
2025-05-22 10:28:13.595 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 10:28:13.596 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:28:13.596 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:28:13.596 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:28:13.599 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 10:28:13.643 +07:00 [INF] Executed DbCommand (42ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 10:28:13.657 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 10:28:13.660 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 60.7592ms
2025-05-22 10:28:13.660 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:28:13.660 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 65.1748ms
2025-05-22 10:29:44.104 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - application/json 58
2025-05-22 10:29:44.106 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:29:44.106 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 10:29:44.118 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 10:29:44.119 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 10:29:44.120 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 13.225ms
2025-05-22 10:29:44.120 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:29:44.120 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - 200 null application/json; charset=utf-8 15.6787ms
2025-05-22 10:29:45.349 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 10:29:45.350 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:29:45.354 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - null null
2025-05-22 10:29:45.356 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:29:45.356 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 10:29:45.370 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 10:29:45.374 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 10:29:45.374 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 17.9431ms
2025-05-22 10:29:45.374 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:29:45.375 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 20.2274ms
2025-05-22 10:29:45.424 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:29:45.425 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-22 10:29:45.425 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-22 10:29:45.425 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-22 10:29:45.427 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-22 10:29:45.427 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-22 10:29:45.427 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-22 10:29:45.427 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-22 10:29:45.427 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-22 10:29:45.427 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-22 10:29:45.427 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-22 10:29:45.427 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-22 10:29:45.427 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-22 10:29:45.427 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-22 10:29:45.427 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-22 10:29:45.427 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-22 10:29:45.428 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-22 10:29:45.428 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-22 10:29:45.429 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-22 10:29:45.429 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-22 10:29:45.429 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-22 10:29:45.429 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-22 10:29:45.429 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-22 10:29:45.429 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-22 10:29:45.613 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - null null
2025-05-22 10:29:45.616 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:29:45.616 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 10:29:45.631 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 10:29:45.640 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 10:29:45.641 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 24.9355ms
2025-05-22 10:29:45.641 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:29:45.641 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 27.9867ms
2025-05-22 10:29:51.241 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 10:29:51.241 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:51.241 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - 204 null null 0.2557ms
2025-05-22 10:29:51.243 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 10:29:51.244 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:51.244 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:51.244 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 10:29:51.246 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 10:29:51.255 +07:00 [INF] Retrieved 6 messages from Redis for conversation 45
2025-05-22 10:29:51.256 +07:00 [INF] Retrieved 6 messages from Redis for conversation 45 and user 3
2025-05-22 10:29:51.256 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 10:29:51.258 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 11.0241ms
2025-05-22 10:29:51.258 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 10:29:51.258 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - 200 null application/json; charset=utf-8 15.5667ms
2025-05-22 10:29:51.265 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 10:29:51.265 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:51.266 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - 204 null null 0.2654ms
2025-05-22 10:29:51.268 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 10:29:51.268 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:51.268 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:51.268 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 10:29:51.271 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 10:29:51.284 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 10:29:51.288 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 10:29:51.289 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 17.8815ms
2025-05-22 10:29:51.289 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 10:29:51.289 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 21.6936ms
2025-05-22 10:29:51.296 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 10:29:51.296 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:51.296 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.168ms
2025-05-22 10:29:51.298 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 10:29:51.298 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:51.298 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:51.299 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 10:29:51.301 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 10:29:51.305 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 10:29:51.306 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 10:29:51.307 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.9586ms
2025-05-22 10:29:51.307 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 10:29:51.307 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 9.6169ms
2025-05-22 10:29:55.525 +07:00 [INF] Handling message from user 3: m
2025-05-22 10:29:55.541 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 10:29:55.556 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:29:55.595 +07:00 [INF] Executed DbCommand (38ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 10:29:55.595 +07:00 [INF] Message saved to DB with ID: 349
2025-05-22 10:29:55.596 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:29:55.604 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 10:29:55.606 +07:00 [INF] Transaction committed for message: 349
2025-05-22 10:29:55.609 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:29:55.613 +07:00 [INF] Saved message 349 to Redis
2025-05-22 10:29:55.614 +07:00 [INF] Added message 349 to conversation 45
2025-05-22 10:29:55.615 +07:00 [INF] Published message to channel conversation:45
2025-05-22 10:29:55.631 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 10:29:55.632 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:55.632 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.8559ms
2025-05-22 10:29:55.634 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:29:55.634 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:55.634 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:55.634 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:29:55.635 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:29:55.637 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 2.7591ms
2025-05-22 10:29:55.638 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:29:55.638 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method508(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:29:55.651 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 17.6089ms
2025-05-22 10:29:55.746 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:29:55.746 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:55.746 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:55.746 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:29:55.746 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:29:55.746 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.1169ms
2025-05-22 10:29:55.746 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:29:55.746 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method508(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:29:55.749 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 4.5008ms
2025-05-22 10:29:55.761 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:29:55.761 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:55.762 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:29:55.762 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:29:55.762 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:29:55.762 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.1253ms
2025-05-22 10:29:55.762 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:29:55.762 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method508(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:29:55.764 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 3.1606ms
2025-05-22 10:30:34.044 +07:00 [INF] Application is shutting down...
2025-05-22 10:30:59.612 +07:00 [INF] Handling message from user 3: a
2025-05-22 10:30:59.623 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 10:30:59.625 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:30:59.635 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 10:30:59.635 +07:00 [INF] Message saved to DB with ID: 350
2025-05-22 10:30:59.636 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:30:59.642 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 10:30:59.643 +07:00 [INF] Transaction committed for message: 350
2025-05-22 10:30:59.648 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:30:59.650 +07:00 [INF] Saved message 350 to Redis
2025-05-22 10:30:59.650 +07:00 [INF] Added message 350 to conversation 45
2025-05-22 10:30:59.651 +07:00 [INF] Published message to channel conversation:45
2025-05-22 10:31:04.090 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 10:31:04.090 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 10:31:04.090 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 78740.7933ms
2025-05-22 10:31:04.090 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 170890.0448ms
