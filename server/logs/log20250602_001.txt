2025-06-02 15:54:47.631 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-02 15:54:47.820 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-02 15:54:47.898 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-02 15:54:47.909 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-02 15:54:47.910 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-02 15:54:47.911 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-02 15:54:47.911 +07:00 [INF] Hosting environment: Development
2025-06-02 15:54:47.911 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-02 15:55:07.182 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 15:55:07.304 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-02 15:55:07.420 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 15:55:57.944 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 53
2025-06-02 15:55:57.948 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 15:55:57.965 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 15:56:08.532 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 15:56:08.586 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:56:08.622 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:56:08.623 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:56:08.624 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:56:08.625 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:56:08.679 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32), @p24='?' (Size = 4000), @p25='?' (DbType = Int32), @p26='?' (Size = 4000), @p27='?' (DbType = Boolean), @p28='?' (DbType = DateTime2), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2),
(@p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, 3)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 15:56:08.686 +07:00 [WRN] Client 6 not found
2025-06-02 15:56:08.686 +07:00 [WRN] Client 3 not found
2025-06-02 15:56:08.686 +07:00 [WRN] Client 5 not found
2025-06-02 15:56:08.686 +07:00 [WRN] Client 2 not found
2025-06-02 15:56:08.690 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 15:56:08.716 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 15:56:08.729 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 10762.2081ms
2025-06-02 15:56:08.731 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 15:56:08.734 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 10790.4079ms
2025-06-02 15:56:08.862 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting - application/json 110
2025-06-02 15:56:08.871 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting - 404 0 null 9.5703ms
2025-06-02 15:56:08.872 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://192.168.1.2:5053/api/GroupSetting, Response status code: 404
2025-06-02 15:59:15.804 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 15:59:15.806 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 15:59:15.825 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 15:59:15.992 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 15:59:16.036 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 15:59:16.149 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 323.7476ms
2025-06-02 15:59:16.149 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 15:59:16.150 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 345.403ms
2025-06-02 15:59:16.337 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 15:59:16.368 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 15:59:16.372 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 15:59:16.384 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 15:59:16.393 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 15:59:16.396 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 15:59:16.402 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 15:59:16.404 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 15:59:16.406 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 15:59:16.409 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 15:59:16.411 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 15:59:16.414 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 15:59:16.416 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 15:59:16.419 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 15:59:16.421 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 15:59:16.425 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 15:59:16.427 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 15:59:16.430 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 15:59:16.432 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 15:59:16.434 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 15:59:16.437 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 15:59:16.439 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 15:59:16.441 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 15:59:16.442 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 15:59:16.444 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 15:59:16.446 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 15:59:16.450 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 15:59:16.451 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 15:59:16.452 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 15:59:16.456 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 15:59:16.458 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 15:59:16.460 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 15:59:16.462 +07:00 [INF] User 2 subscribed to channel conversation:54
2025-06-02 15:59:16.463 +07:00 [INF] User 2 subscribed to channel conversation:55
2025-06-02 15:59:16.466 +07:00 [INF] User 2 subscribed to channel conversation:56
2025-06-02 15:59:17.026 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 15:59:17.028 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 15:59:17.038 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 15:59:17.081 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 15:59:17.088 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 15:59:17.103 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 15:59:17.216 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 15:59:17.233 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 15:59:17.269 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 230.9553ms
2025-06-02 15:59:17.270 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 15:59:17.270 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 243.5552ms
2025-06-02 15:59:17.270 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 15:59:17.440 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 15:59:17.486 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 383.6981ms
2025-06-02 15:59:17.487 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 15:59:17.487 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 405.548ms
2025-06-02 15:59:35.537 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 55
2025-06-02 15:59:35.538 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 15:59:35.538 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 15:59:35.553 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 15:59:35.558 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:59:35.560 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:59:35.561 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:59:35.562 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:59:35.563 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:59:35.581 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32), @p24='?' (Size = 4000), @p25='?' (DbType = Int32), @p26='?' (Size = 4000), @p27='?' (DbType = Boolean), @p28='?' (DbType = DateTime2), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2),
(@p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, 3)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 15:59:35.582 +07:00 [WRN] Client 6 not found
2025-06-02 15:59:35.582 +07:00 [WRN] Client 3 not found
2025-06-02 15:59:35.582 +07:00 [WRN] Client 5 not found
2025-06-02 15:59:35.583 +07:00 [INF] User 2 subscribed to channel conversation:57
2025-06-02 15:59:35.586 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 15:59:35.588 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 15:59:35.589 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 50.2071ms
2025-06-02 15:59:35.589 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 15:59:35.589 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 51.8645ms
2025-06-02 15:59:35.790 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/57 - null null
2025-06-02 15:59:35.790 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 15:59:35.793 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 15:59:35.818 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/57 - null null
2025-06-02 15:59:35.818 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 110
2025-06-02 15:59:35.818 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 15:59:35.818 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 15:59:35.818 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 15:59:35.826 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 15:59:35.826 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 15:59:48.429 +07:00 [INF] Executed DbCommand (12,595ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 15:59:48.452 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 15:59:48.459 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 12666.0799ms
2025-06-02 15:59:48.459 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 15:59:48.460 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/57 - 200 null application/json; charset=utf-8 12669.5586ms
2025-06-02 15:59:48.466 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 15:59:48.467 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 12648.2753ms
2025-06-02 15:59:48.467 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 15:59:48.467 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/57 - 200 null application/json; charset=utf-8 12649.1967ms
2025-06-02 15:59:48.468 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-02 15:59:48.469 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 12643.0132ms
2025-06-02 15:59:48.469 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 15:59:48.469 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 500 null text/plain; charset=utf-8 12651.6999ms
2025-06-02 16:01:19.188 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 58
2025-06-02 16:01:19.188 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:01:19.188 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:02:15.929 +07:00 [INF] Executed DbCommand (29ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 16:02:15.938 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:02:15.942 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:02:15.948 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:02:15.958 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:02:15.959 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:02:15.983 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32), @p24='?' (Size = 4000), @p25='?' (DbType = Int32), @p26='?' (Size = 4000), @p27='?' (DbType = Boolean), @p28='?' (DbType = DateTime2), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2),
(@p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, 3)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 16:02:15.985 +07:00 [WRN] Client 6 not found
2025-06-02 16:02:15.986 +07:00 [WRN] Client 3 not found
2025-06-02 16:02:15.986 +07:00 [WRN] Client 5 not found
2025-06-02 16:02:15.987 +07:00 [INF] User 2 subscribed to channel conversation:58
2025-06-02 16:02:15.988 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 16:02:15.990 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:02:15.999 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 56810.0962ms
2025-06-02 16:02:15.999 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:02:15.999 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 499 null application/json; charset=utf-8 56811.163ms
2025-06-02 16:02:16.092 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/58 - null null
2025-06-02 16:02:16.092 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:02:16.092 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:02:16.107 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:02:16.114 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:02:16.115 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 22.8196ms
2025-06-02 16:02:16.116 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:02:16.117 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/58 - 200 null application/json; charset=utf-8 24.8693ms
2025-06-02 16:02:16.253 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/58 - null null
2025-06-02 16:02:16.254 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:02:16.254 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:02:16.277 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:02:16.277 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 23.0926ms
2025-06-02 16:02:16.279 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:02:16.279 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/58 - 200 null application/json; charset=utf-8 25.6797ms
2025-06-02 16:02:32.003 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 50
2025-06-02 16:02:32.004 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:02:32.004 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:02:36.094 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 16:02:36.095 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:02:36.097 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:02:36.100 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:02:36.101 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:02:36.102 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:02:36.107 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32), @p24='?' (Size = 4000), @p25='?' (DbType = Int32), @p26='?' (Size = 4000), @p27='?' (DbType = Boolean), @p28='?' (DbType = DateTime2), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2),
(@p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, 3)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 16:02:36.107 +07:00 [WRN] Client 6 not found
2025-06-02 16:02:36.107 +07:00 [WRN] Client 3 not found
2025-06-02 16:02:36.107 +07:00 [WRN] Client 5 not found
2025-06-02 16:02:36.109 +07:00 [INF] User 2 subscribed to channel conversation:59
2025-06-02 16:02:36.110 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 16:02:36.111 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:02:36.111 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 4107.4077ms
2025-06-02 16:02:36.111 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:02:36.111 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 4108.0334ms
2025-06-02 16:02:36.516 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/59 - null null
2025-06-02 16:02:36.516 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:02:36.516 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:02:36.523 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:02:36.523 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/59 - null null
2025-06-02 16:02:36.524 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:02:36.524 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:02:36.528 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:02:36.530 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:02:36.530 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 13.6889ms
2025-06-02 16:02:36.530 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:02:36.531 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:02:36.531 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 6.7862ms
2025-06-02 16:02:36.531 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:02:36.531 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/59 - 200 null application/json; charset=utf-8 7.3229ms
2025-06-02 16:02:36.531 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/59 - 200 null application/json; charset=utf-8 15.1122ms
2025-06-02 16:03:57.401 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 51
2025-06-02 16:03:57.402 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:03:57.403 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:04:00.084 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 16:04:00.090 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:04:00.094 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:04:00.099 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:04:00.102 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:04:00.106 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:04:00.131 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32), @p24='?' (Size = 4000), @p25='?' (DbType = Int32), @p26='?' (Size = 4000), @p27='?' (DbType = Boolean), @p28='?' (DbType = DateTime2), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2),
(@p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, 3)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 16:04:00.131 +07:00 [WRN] Client 6 not found
2025-06-02 16:04:00.131 +07:00 [WRN] Client 3 not found
2025-06-02 16:04:00.131 +07:00 [WRN] Client 5 not found
2025-06-02 16:04:00.132 +07:00 [INF] User 2 subscribed to channel conversation:60
2025-06-02 16:04:00.132 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 16:04:00.133 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:04:00.134 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 2730.5348ms
2025-06-02 16:04:00.134 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:04:00.134 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 2733.3692ms
2025-06-02 16:04:00.775 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/60 - null null
2025-06-02 16:04:00.775 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:04:00.776 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:04:00.786 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:04:00.788 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:04:00.788 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 12.5892ms
2025-06-02 16:04:00.788 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:04:00.788 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/60 - 200 null application/json; charset=utf-8 13.3593ms
2025-06-02 16:04:00.829 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 110
2025-06-02 16:04:00.830 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:04:00.831 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:04:12.806 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/60 - null null
2025-06-02 16:04:12.806 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:04:12.806 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:04:12.826 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:04:12.827 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 20.6645ms
2025-06-02 16:04:12.830 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:04:12.830 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/60 - 200 null application/json; charset=utf-8 24.0693ms
2025-06-02 16:04:12.839 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-02 16:04:12.839 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 12008.0159ms
2025-06-02 16:04:12.839 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:04:12.839 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 500 null text/plain; charset=utf-8 12009.4256ms
2025-06-02 16:04:46.197 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 52
2025-06-02 16:04:46.198 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:04:46.198 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:04:48.753 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 16:04:48.758 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:04:48.764 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:04:48.766 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:04:48.769 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:04:48.772 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:04:48.816 +07:00 [INF] Executed DbCommand (38ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32), @p24='?' (Size = 4000), @p25='?' (DbType = Int32), @p26='?' (Size = 4000), @p27='?' (DbType = Boolean), @p28='?' (DbType = DateTime2), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2),
(@p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, 3)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 16:04:48.817 +07:00 [WRN] Client 6 not found
2025-06-02 16:04:48.817 +07:00 [WRN] Client 3 not found
2025-06-02 16:04:48.817 +07:00 [WRN] Client 5 not found
2025-06-02 16:04:48.821 +07:00 [INF] User 2 subscribed to channel conversation:61
2025-06-02 16:04:48.823 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 16:04:48.826 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:04:48.827 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 2628.2292ms
2025-06-02 16:04:48.827 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:04:48.827 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 2629.9601ms
2025-06-02 16:04:49.616 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/61 - null null
2025-06-02 16:04:49.617 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:04:49.617 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:04:49.623 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/61 - null null
2025-06-02 16:04:49.624 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:04:49.624 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:04:49.634 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 111
2025-06-02 16:04:49.635 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:04:49.635 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:04:49.650 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:04:56.940 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:04:56.956 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:04:56.956 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 7331.9256ms
2025-06-02 16:04:56.956 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:04:56.956 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/61 - 200 null application/json; charset=utf-8 7334.627ms
2025-06-02 16:04:56.998 +07:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType6`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:04:57.000 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 7382.1624ms
2025-06-02 16:04:57.000 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:04:57.000 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/61 - 500 null application/json; charset=utf-8 7384.1275ms
2025-06-02 16:04:57.008 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:04:57.031 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?' (DbType = Boolean), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [GroupSettings] ([AllowMemberEdit], [AllowMemberInvite], [AllowMemberRemove], [ConversationId], [CreatedAt], [CreatedBy])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-06-02 16:04:57.033 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:04:57.034 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 7398.2071ms
2025-06-02 16:04:57.034 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:04:57.034 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 200 null application/json; charset=utf-8 7405.2061ms
2025-06-02 16:06:50.740 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 53
2025-06-02 16:06:50.740 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:06:50.740 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:06:57.312 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 16:06:57.317 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:06:57.349 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:06:57.358 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:06:57.363 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:06:57.398 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:06:57.428 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32), @p24='?' (Size = 4000), @p25='?' (DbType = Int32), @p26='?' (Size = 4000), @p27='?' (DbType = Boolean), @p28='?' (DbType = DateTime2), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2),
(@p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, 3)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 16:06:57.428 +07:00 [WRN] Client 6 not found
2025-06-02 16:06:57.428 +07:00 [WRN] Client 3 not found
2025-06-02 16:06:57.428 +07:00 [WRN] Client 5 not found
2025-06-02 16:06:57.431 +07:00 [INF] User 2 subscribed to channel conversation:62
2025-06-02 16:06:57.436 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 16:06:57.439 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:06:57.443 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 6701.9926ms
2025-06-02 16:06:57.443 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:06:57.444 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 6703.8387ms
2025-06-02 16:06:58.188 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/62 - null null
2025-06-02 16:06:58.191 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:06:58.191 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:06:58.197 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/62 - null null
2025-06-02 16:06:58.199 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:06:58.200 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:06:58.210 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 111
2025-06-02 16:06:58.211 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:06:58.212 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:06:58.218 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:06:59.477 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:06:59.477 +07:00 [INF] Executed DbCommand (1,259ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:06:59.498 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:06:59.499 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 1307.4452ms
2025-06-02 16:06:59.499 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:06:59.511 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/62 - 200 null application/json; charset=utf-8 1322.1399ms
2025-06-02 16:06:59.527 +07:00 [INF] Executed DbCommand (38ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:06:59.527 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:06:59.537 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 1336.9439ms
2025-06-02 16:06:59.538 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:06:59.541 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/62 - 200 null application/json; charset=utf-8 1343.6099ms
2025-06-02 16:06:59.553 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?' (DbType = Boolean), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [GroupSettings] ([AllowMemberEdit], [AllowMemberInvite], [AllowMemberRemove], [ConversationId], [CreatedAt], [CreatedBy])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-06-02 16:06:59.555 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:06:59.555 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 1339.4808ms
2025-06-02 16:06:59.555 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:06:59.555 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 200 null application/json; charset=utf-8 1345.16ms
2025-06-02 16:09:16.538 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 54
2025-06-02 16:09:16.538 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:09:16.538 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:09:26.339 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 16:09:26.343 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:09:26.345 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:09:26.346 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:09:26.347 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:09:26.349 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:09:26.365 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32), @p24='?' (Size = 4000), @p25='?' (DbType = Int32), @p26='?' (Size = 4000), @p27='?' (DbType = Boolean), @p28='?' (DbType = DateTime2), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2),
(@p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, 3)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 16:09:26.365 +07:00 [WRN] Client 6 not found
2025-06-02 16:09:26.365 +07:00 [WRN] Client 3 not found
2025-06-02 16:09:26.365 +07:00 [WRN] Client 5 not found
2025-06-02 16:09:26.366 +07:00 [INF] User 2 subscribed to channel conversation:63
2025-06-02 16:09:26.366 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 16:09:26.367 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:09:26.367 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 9829.234ms
2025-06-02 16:09:26.368 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:09:26.369 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 9831.0056ms
2025-06-02 16:09:26.694 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/63 - null null
2025-06-02 16:09:26.694 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:09:26.695 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:09:26.700 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/63 - null null
2025-06-02 16:09:26.701 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:09:26.701 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:09:26.709 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:09:26.710 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 111
2025-06-02 16:09:26.710 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:09:26.711 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:09:43.942 +07:00 [INF] Executed DbCommand (17,236ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:09:43.952 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:09:43.958 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:09:43.959 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 17258.5908ms
2025-06-02 16:09:43.959 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:09:43.964 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/63 - 200 null application/json; charset=utf-8 17263.6993ms
2025-06-02 16:09:43.985 +07:00 [INF] Executed DbCommand (33ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:09:43.991 +07:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType6`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:09:43.992 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 17297.1703ms
2025-06-02 16:09:43.992 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:09:43.992 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/63 - 500 null application/json; charset=utf-8 17297.8617ms
2025-06-02 16:09:43.999 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?' (DbType = Boolean), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [GroupSettings] ([AllowMemberEdit], [AllowMemberInvite], [AllowMemberRemove], [ConversationId], [CreatedAt], [CreatedBy])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-06-02 16:09:49.332 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:09:49.332 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 22621.6849ms
2025-06-02 16:09:49.332 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:09:49.333 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 200 null application/json; charset=utf-8 22622.6676ms
2025-06-02 16:11:11.286 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/63 - null null
2025-06-02 16:11:11.287 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:11:11.292 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:11:11.307 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:11:11.309 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:11:11.312 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 19.9747ms
2025-06-02 16:11:11.312 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:11:11.312 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/63 - 200 null application/json; charset=utf-8 26.2428ms
2025-06-02 16:11:11.674 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/63/2 - null null
2025-06-02 16:11:11.675 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:11:11.684 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:11:11.710 +07:00 [INF] Retrieved 0 messages from Redis for conversation 63
2025-06-02 16:11:11.732 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-02 16:11:11.770 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-02 16:11:11.773 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-06-02 16:11:11.773 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 88.6631ms
2025-06-02 16:11:11.773 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:11:11.774 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/63/2 - 404 null text/plain; charset=utf-8 99.4562ms
2025-06-02 16:11:11.799 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/63 - null null
2025-06-02 16:11:11.799 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:11:11.806 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:11:11.815 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:11:11.821 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:11:11.825 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 18.8981ms
2025-06-02 16:11:11.825 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:11:11.825 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/63 - 200 null application/json; charset=utf-8 26.2597ms
2025-06-02 16:11:11.866 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/63 - null null
2025-06-02 16:11:11.869 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:11:11.869 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:11:11.875 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:11:11.879 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:11:11.880 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 10.4531ms
2025-06-02 16:11:11.880 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:11:11.880 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/63 - 200 null application/json; charset=utf-8 14.7023ms
2025-06-02 16:12:56.300 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-02 16:12:56.408 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-02 16:12:56.449 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-02 16:12:56.458 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-02 16:12:56.458 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-02 16:12:56.458 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-02 16:12:56.458 +07:00 [INF] Hosting environment: Development
2025-06-02 16:12:56.458 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-02 16:13:00.188 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 16:13:00.223 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-02 16:13:00.236 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 16:13:07.805 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/63/2 - null null
2025-06-02 16:13:07.811 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:13:07.843 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:13:07.894 +07:00 [INF] Retrieved 0 messages from Redis for conversation 63
2025-06-02 16:13:08.010 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-02 16:13:08.193 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-02 16:13:08.205 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-06-02 16:13:08.212 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 363.8338ms
2025-06-02 16:13:08.215 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:13:08.225 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/63/2 - 404 null text/plain; charset=utf-8 419.7353ms
2025-06-02 16:13:08.335 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/63 - null null
2025-06-02 16:13:08.342 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:13:08.351 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:13:08.476 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:13:08.616 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:13:08.768 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 417.123ms
2025-06-02 16:13:08.769 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:13:08.769 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/63 - 200 null application/json; charset=utf-8 434.3974ms
2025-06-02 16:13:09.470 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/63 - null null
2025-06-02 16:13:09.471 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:13:09.478 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:13:09.499 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:13:09.505 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:13:09.522 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 44.284ms
2025-06-02 16:13:09.523 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:13:09.523 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/63 - 200 null application/json; charset=utf-8 52.6541ms
2025-06-02 16:13:12.006 +07:00 [INF] Handling message from user 2: hello
2025-06-02 16:13:12.037 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 16:13:12.257 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 16:13:12.268 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 16:13:12.316 +07:00 [INF] Message saved to DB with ID: 446
2025-06-02 16:13:12.328 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 16:13:12.339 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 16:13:12.367 +07:00 [INF] Transaction committed for message: 446
2025-06-02 16:13:12.394 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 16:13:12.415 +07:00 [INF] Saved message 446 to Redis
2025-06-02 16:13:12.420 +07:00 [INF] Added message 446 to conversation 63
2025-06-02 16:13:12.437 +07:00 [INF] Published message to channel conversation:63
2025-06-02 16:13:20.324 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/63/2 - null null
2025-06-02 16:13:20.327 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:13:20.327 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:13:20.358 +07:00 [INF] Retrieved 1 messages from Redis for conversation 63
2025-06-02 16:13:20.361 +07:00 [INF] Retrieved 1 messages from Redis for conversation 63 and user 2
2025-06-02 16:13:20.362 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:13:20.366 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 39.1297ms
2025-06-02 16:13:20.366 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:13:20.368 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/63/2 - 200 null application/json; charset=utf-8 44.0547ms
2025-06-02 16:13:20.390 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/63 - null null
2025-06-02 16:13:20.393 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:13:20.393 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:13:20.402 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:13:20.416 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:13:20.417 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 23.6489ms
2025-06-02 16:13:20.418 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:13:20.418 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/63 - 200 null application/json; charset=utf-8 28.6495ms
2025-06-02 16:13:20.459 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/63 - null null
2025-06-02 16:13:20.462 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:13:20.463 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:13:20.470 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:13:20.481 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:13:20.483 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 20.5327ms
2025-06-02 16:13:20.484 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:13:20.484 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/63 - 200 null application/json; charset=utf-8 25.0465ms
2025-06-02 16:13:25.698 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 16:13:25.699 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 16:13:25.736 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 16:13:25.739 +07:00 [ERR] Connection id "0HND1MMLU4SJA", Request id "0HND1MMLU4SJA:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 16:13:25.753 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - 101 null null 25566.104ms
2025-06-02 16:15:02.875 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 16:15:02.881 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 16:15:02.888 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 16:15:02.957 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 16:15:03.058 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 16:15:03.069 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 181.341ms
2025-06-02 16:15:03.069 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 16:15:03.069 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 194.0582ms
2025-06-02 16:15:03.780 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 16:15:03.784 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 16:15:04.211 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 16:15:04.212 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:15:04.218 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 16:15:04.219 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 16:15:04.248 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 16:15:04.252 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 16:15:04.254 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 16:15:04.255 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 16:15:04.256 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 16:15:04.258 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 16:15:04.258 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 16:15:04.260 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 16:15:04.261 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 16:15:04.261 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 16:15:04.264 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 16:15:04.264 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 16:15:04.267 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 16:15:04.269 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 16:15:04.270 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 16:15:04.271 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 16:15:04.272 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 16:15:04.273 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 16:15:04.274 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 16:15:04.274 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 16:15:04.275 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 16:15:04.278 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 16:15:04.278 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 16:15:04.280 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 16:15:04.280 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 16:15:04.285 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 16:15:04.286 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 16:15:04.287 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 16:15:04.288 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 16:15:04.289 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 16:15:04.290 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 16:15:04.291 +07:00 [INF] User 2 subscribed to channel conversation:54
2025-06-02 16:15:04.292 +07:00 [INF] User 2 subscribed to channel conversation:55
2025-06-02 16:15:04.294 +07:00 [INF] User 2 subscribed to channel conversation:56
2025-06-02 16:15:04.295 +07:00 [INF] User 2 subscribed to channel conversation:57
2025-06-02 16:15:04.295 +07:00 [INF] User 2 subscribed to channel conversation:58
2025-06-02 16:15:04.296 +07:00 [INF] User 2 subscribed to channel conversation:59
2025-06-02 16:15:04.297 +07:00 [INF] User 2 subscribed to channel conversation:60
2025-06-02 16:15:04.300 +07:00 [INF] User 2 subscribed to channel conversation:61
2025-06-02 16:15:04.301 +07:00 [INF] User 2 subscribed to channel conversation:62
2025-06-02 16:15:04.302 +07:00 [INF] User 2 subscribed to channel conversation:63
2025-06-02 16:15:04.304 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 16:15:04.310 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:15:04.319 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 100.3865ms
2025-06-02 16:15:04.319 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:15:04.319 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 107.9183ms
2025-06-02 16:15:04.403 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 16:15:04.403 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 16:15:04.407 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:15:04.477 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 16:15:04.527 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:15:04.617 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 209.677ms
2025-06-02 16:15:04.617 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 16:15:04.617 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 214.7568ms
2025-06-02 16:15:07.923 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/63/2 - null null
2025-06-02 16:15:07.923 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:15:07.923 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:15:07.927 +07:00 [INF] Retrieved 1 messages from Redis for conversation 63
2025-06-02 16:15:07.929 +07:00 [INF] Retrieved 1 messages from Redis for conversation 63 and user 2
2025-06-02 16:15:07.929 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:15:07.929 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 5.5335ms
2025-06-02 16:15:07.929 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:15:07.929 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/63/2 - 200 null application/json; charset=utf-8 6.4881ms
2025-06-02 16:15:08.018 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/63 - null null
2025-06-02 16:15:08.019 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:15:08.019 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:15:08.029 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:15:08.038 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:15:08.040 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 20.3633ms
2025-06-02 16:15:08.040 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:15:08.040 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/63 - 200 null application/json; charset=utf-8 22.4814ms
2025-06-02 16:15:08.075 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/63 - null null
2025-06-02 16:15:08.077 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:15:08.078 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:15:08.084 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:15:08.088 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:15:08.089 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 10.8776ms
2025-06-02 16:15:08.089 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:15:08.089 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/63 - 200 null application/json; charset=utf-8 14.7504ms
2025-06-02 16:15:10.394 +07:00 [INF] Handling message from user 2: ok
2025-06-02 16:15:10.400 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 16:15:10.421 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 16:15:10.433 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 16:15:10.434 +07:00 [INF] Message saved to DB with ID: 447
2025-06-02 16:15:10.436 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 16:15:10.444 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 16:15:10.447 +07:00 [INF] Transaction committed for message: 447
2025-06-02 16:15:10.458 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 16:15:10.471 +07:00 [INF] Saved message 447 to Redis
2025-06-02 16:15:10.472 +07:00 [INF] Added message 447 to conversation 63
2025-06-02 16:15:10.478 +07:00 [INF] Published message to channel conversation:63
2025-06-02 16:15:17.013 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Message/uploadFile - multipart/form-data; boundary=--dio-boundary-1005823575 586279
2025-06-02 16:15:17.014 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-06-02 16:15:17.023 +07:00 [INF] Route matched with {action = "UploadFile", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UploadFile(Microsoft.AspNetCore.Http.IFormFile) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:15:28.411 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (DbType = Single), @p1='?' (Size = 50), @p2='?' (Size = 255), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Attachments] ([FileSize], [file_type], [file_url], [is_temporary], [message_id], [uploaded_at])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-06-02 16:15:28.415 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType18`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:15:28.418 +07:00 [INF] Executed action server.Controllers.MessageController.UploadFile (Message_app) in 11394.8716ms
2025-06-02 16:15:28.418 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-06-02 16:15:28.420 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Message/uploadFile - 200 null application/json; charset=utf-8 11406.8688ms
2025-06-02 16:15:28.472 +07:00 [INF] Handling message from user 2: FILE
2025-06-02 16:15:28.477 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 16:15:28.495 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 16:15:28.500 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 16:15:28.501 +07:00 [INF] Message saved to DB with ID: 448
2025-06-02 16:15:28.512 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM [Attachments] AS [a]
WHERE [a].[id] = @__p_0
2025-06-02 16:15:28.523 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 16:15:28.532 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p6='?' (DbType = Int32), @p0='?' (DbType = Single), @p1='?' (Size = 50), @p2='?' (Size = 255), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2), @p14='?' (DbType = Int32), @p7='?' (DbType = DateTime2), @p8='?' (Size = 4000), @p9='?' (DbType = Boolean), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (DbType = DateTime2), @p13='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Attachments] SET [FileSize] = @p0, [file_type] = @p1, [file_url] = @p2, [is_temporary] = @p3, [message_id] = @p4, [uploaded_at] = @p5
OUTPUT 1
WHERE [id] = @p6;
UPDATE [Conversations] SET [created_at] = @p7, [img_url] = @p8, [is_group] = @p9, [lastMessage] = @p10, [lastMessageSender] = @p11, [lastMessageTime] = @p12, [name] = @p13
OUTPUT 1
WHERE [id] = @p14;
2025-06-02 16:15:28.536 +07:00 [INF] Transaction committed for message: 448
2025-06-02 16:15:28.541 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 16:15:28.547 +07:00 [INF] Saved message 448 to Redis
2025-06-02 16:15:28.548 +07:00 [INF] Added message 448 to conversation 63
2025-06-02 16:15:28.556 +07:00 [INF] Published message to channel conversation:63
2025-06-02 16:17:05.218 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 51
2025-06-02 16:17:05.218 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:17:05.223 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:17:05.241 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 16:17:05.257 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:17:05.260 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:17:05.261 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:17:05.261 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:17:05.264 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:17:05.293 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32), @p24='?' (Size = 4000), @p25='?' (DbType = Int32), @p26='?' (Size = 4000), @p27='?' (DbType = Boolean), @p28='?' (DbType = DateTime2), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2),
(@p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, 3)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 16:17:05.295 +07:00 [WRN] Client 6 not found
2025-06-02 16:17:05.296 +07:00 [WRN] Client 3 not found
2025-06-02 16:17:05.296 +07:00 [WRN] Client 5 not found
2025-06-02 16:17:05.297 +07:00 [INF] User 2 subscribed to channel conversation:64
2025-06-02 16:17:05.298 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 16:17:05.302 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:17:05.302 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 78.6853ms
2025-06-02 16:17:05.302 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:17:05.302 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 84.6233ms
2025-06-02 16:17:05.427 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/64 - null null
2025-06-02 16:17:05.427 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:17:05.433 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:17:05.448 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 111
2025-06-02 16:17:05.449 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:17:05.456 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:17:05.480 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:17:05.486 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:17:05.491 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:17:05.492 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 58.6908ms
2025-06-02 16:17:05.492 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:17:05.492 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/64 - 200 null application/json; charset=utf-8 65.1032ms
2025-06-02 16:17:05.493 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:17:05.509 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?' (DbType = Boolean), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [GroupSettings] ([AllowMemberEdit], [AllowMemberInvite], [AllowMemberRemove], [ConversationId], [CreatedAt], [CreatedBy])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-06-02 16:17:05.511 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:17:05.512 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 55.0278ms
2025-06-02 16:17:05.512 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:17:05.512 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 200 null application/json; charset=utf-8 63.9189ms
2025-06-02 16:18:03.062 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 54
2025-06-02 16:18:03.062 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:18:03.063 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:18:03.082 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 16:18:03.088 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:18:03.091 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:18:03.093 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:18:03.096 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:18:03.121 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 16:18:03.122 +07:00 [WRN] Client 6 not found
2025-06-02 16:18:03.122 +07:00 [WRN] Client 3 not found
2025-06-02 16:18:03.124 +07:00 [INF] User 2 subscribed to channel conversation:65
2025-06-02 16:18:03.132 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 16:18:03.134 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:18:03.135 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 71.8996ms
2025-06-02 16:18:03.135 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:18:03.137 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 74.976ms
2025-06-02 16:18:03.390 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/65 - null null
2025-06-02 16:18:03.390 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:18:03.390 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:18:03.401 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:18:03.417 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:18:03.417 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 27.065ms
2025-06-02 16:18:03.418 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:18:03.418 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/65 - 200 null application/json; charset=utf-8 27.9734ms
2025-06-02 16:18:03.675 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 111
2025-06-02 16:18:03.677 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:18:03.678 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:18:03.682 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:18:03.691 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:18:03.707 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?' (DbType = Boolean), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [GroupSettings] ([AllowMemberEdit], [AllowMemberInvite], [AllowMemberRemove], [ConversationId], [CreatedAt], [CreatedBy])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-06-02 16:18:03.708 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:18:03.709 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 31.0346ms
2025-06-02 16:18:03.709 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:18:03.709 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 200 null application/json; charset=utf-8 34.0329ms
2025-06-02 16:18:20.452 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/65/2 - null null
2025-06-02 16:18:20.452 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:18:20.452 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:18:20.453 +07:00 [INF] Retrieved 0 messages from Redis for conversation 65
2025-06-02 16:18:20.461 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-02 16:18:20.470 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-02 16:18:20.471 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-06-02 16:18:20.471 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 19.0211ms
2025-06-02 16:18:20.471 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:18:20.471 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/65/2 - 404 null text/plain; charset=utf-8 19.6556ms
2025-06-02 16:18:20.508 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/65 - null null
2025-06-02 16:18:20.508 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:18:20.508 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:18:20.515 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:18:20.520 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:18:20.521 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 12.2924ms
2025-06-02 16:18:20.521 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:18:20.521 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/65 - 200 null application/json; charset=utf-8 13.1802ms
2025-06-02 16:18:20.567 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/65 - null null
2025-06-02 16:18:20.568 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:18:20.568 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:18:20.574 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:18:20.576 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:18:20.577 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.8713ms
2025-06-02 16:18:20.577 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:18:20.578 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/65 - 200 null application/json; charset=utf-8 10.4847ms
2025-06-02 16:18:22.138 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/65 - null null
2025-06-02 16:18:22.139 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/65 - null null
2025-06-02 16:18:22.139 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:18:22.139 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:18:22.139 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:18:22.147 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:18:22.147 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:18:22.154 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:18:22.155 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 15.5711ms
2025-06-02 16:18:22.155 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:18:22.155 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/65 - 200 null application/json; charset=utf-8 16.6265ms
2025-06-02 16:18:22.228 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 16:18:22.229 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:18:22.234 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 87.2652ms
2025-06-02 16:18:22.234 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:18:22.235 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/65 - 200 null application/json; charset=utf-8 95.6257ms
2025-06-02 16:20:14.884 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 55
2025-06-02 16:20:14.884 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:20:14.888 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:20:14.904 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 16:20:14.908 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:20:14.909 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:20:14.911 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:20:14.912 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:20:14.930 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = -1), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 16:20:14.930 +07:00 [WRN] Client 3 not found
2025-06-02 16:20:14.930 +07:00 [WRN] Client 6 not found
2025-06-02 16:20:14.931 +07:00 [INF] User 2 subscribed to channel conversation:66
2025-06-02 16:20:14.931 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 16:20:14.934 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:20:14.936 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 48.366ms
2025-06-02 16:20:14.936 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:20:14.936 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 52.6412ms
2025-06-02 16:20:15.153 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/66 - null null
2025-06-02 16:20:15.157 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:20:15.159 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:20:15.175 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:20:15.180 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:20:15.180 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 20.209ms
2025-06-02 16:20:15.180 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:20:15.180 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/66 - 200 null application/json; charset=utf-8 27.2387ms
2025-06-02 16:20:15.181 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 111
2025-06-02 16:20:15.181 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:20:15.184 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:20:15.188 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:20:15.193 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:20:15.200 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?' (DbType = Boolean), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [GroupSettings] ([AllowMemberEdit], [AllowMemberInvite], [AllowMemberRemove], [ConversationId], [CreatedAt], [CreatedBy])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-06-02 16:20:15.200 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:20:15.202 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 18.2192ms
2025-06-02 16:20:15.202 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:20:15.202 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 200 null application/json; charset=utf-8 20.8879ms
2025-06-02 16:20:17.425 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/66/2 - null null
2025-06-02 16:20:17.425 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:20:17.428 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:20:17.430 +07:00 [INF] Retrieved 0 messages from Redis for conversation 66
2025-06-02 16:20:17.436 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-02 16:20:17.445 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-02 16:20:17.445 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-06-02 16:20:17.445 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 17.1685ms
2025-06-02 16:20:17.446 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:20:17.446 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/66/2 - 404 null text/plain; charset=utf-8 21.2264ms
2025-06-02 16:20:17.473 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/66 - null null
2025-06-02 16:20:17.474 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:20:17.476 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:20:17.478 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:20:17.479 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:20:17.483 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.07ms
2025-06-02 16:20:17.483 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:20:17.483 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/66 - 200 null application/json; charset=utf-8 10.2343ms
2025-06-02 16:20:17.512 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - null null
2025-06-02 16:20:17.513 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:20:17.515 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:20:17.521 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:20:17.522 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:20:17.523 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.3223ms
2025-06-02 16:20:17.523 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:20:17.523 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - 200 null application/json; charset=utf-8 10.6159ms
2025-06-02 16:20:19.446 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - null null
2025-06-02 16:20:19.446 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/66 - null null
2025-06-02 16:20:19.448 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:20:19.448 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:20:19.449 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:20:19.452 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:20:19.453 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:20:19.454 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:20:19.454 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.8536ms
2025-06-02 16:20:19.455 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:20:19.455 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - 200 null application/json; charset=utf-8 9.5926ms
2025-06-02 16:20:19.464 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 16:20:19.465 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:20:19.468 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 15.5192ms
2025-06-02 16:20:19.469 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:20:19.469 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/66 - 200 null application/json; charset=utf-8 22.8942ms
2025-06-02 16:21:58.401 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 55
2025-06-02 16:21:58.402 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:21:58.402 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:21:58.410 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 16:21:58.413 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:21:58.416 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:21:58.418 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:21:58.418 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:21:58.434 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 16:21:58.435 +07:00 [WRN] Client 6 not found
2025-06-02 16:21:58.435 +07:00 [WRN] Client 3 not found
2025-06-02 16:21:58.436 +07:00 [INF] User 2 subscribed to channel conversation:67
2025-06-02 16:21:58.437 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 16:21:58.438 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:21:58.439 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 36.81ms
2025-06-02 16:21:58.439 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:21:58.439 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 37.8026ms
2025-06-02 16:21:58.717 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/67 - null null
2025-06-02 16:21:58.717 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:21:58.717 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:21:58.730 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:21:58.734 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:21:58.735 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 17.7789ms
2025-06-02 16:21:58.735 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:21:58.735 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/67 - 200 null application/json; charset=utf-8 18.289ms
2025-06-02 16:21:58.921 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 111
2025-06-02 16:21:58.921 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:21:58.921 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:21:58.922 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:21:58.927 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:21:58.948 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?' (DbType = Boolean), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [GroupSettings] ([AllowMemberEdit], [AllowMemberInvite], [AllowMemberRemove], [ConversationId], [CreatedAt], [CreatedBy])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-06-02 16:21:58.948 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:21:58.949 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 27.8148ms
2025-06-02 16:21:58.949 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:21:58.951 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 200 null application/json; charset=utf-8 30.4343ms
2025-06-02 16:22:30.255 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 55
2025-06-02 16:22:30.255 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:22:30.256 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:22:30.263 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 16:22:30.265 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:22:30.268 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:22:30.269 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:22:30.270 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:22:30.278 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 16:22:30.278 +07:00 [WRN] Client 6 not found
2025-06-02 16:22:30.278 +07:00 [WRN] Client 3 not found
2025-06-02 16:22:30.279 +07:00 [INF] User 2 subscribed to channel conversation:68
2025-06-02 16:22:30.280 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 16:22:30.282 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:22:30.283 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 26.9755ms
2025-06-02 16:22:30.283 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:22:30.283 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 27.9918ms
2025-06-02 16:22:30.750 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/68 - null null
2025-06-02 16:22:30.750 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:22:30.750 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:22:30.753 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:22:30.760 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:22:30.761 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 10.2761ms
2025-06-02 16:22:30.761 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:22:30.761 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/68 - 200 null application/json; charset=utf-8 11.088ms
2025-06-02 16:22:30.869 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 111
2025-06-02 16:22:30.869 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:22:30.869 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:22:30.872 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:22:30.873 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:22:30.881 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?' (DbType = Boolean), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [GroupSettings] ([AllowMemberEdit], [AllowMemberInvite], [AllowMemberRemove], [ConversationId], [CreatedAt], [CreatedBy])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-06-02 16:22:30.882 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:22:30.882 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 12.7708ms
2025-06-02 16:22:30.882 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:22:30.882 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 200 null application/json; charset=utf-8 13.5484ms
2025-06-02 16:33:33.445 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 55
2025-06-02 16:33:33.446 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:33:33.446 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:33:33.464 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 16:33:33.467 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:33:33.468 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:33:33.469 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:33:33.469 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:33:33.487 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 16:33:33.487 +07:00 [WRN] Client 6 not found
2025-06-02 16:33:33.487 +07:00 [WRN] Client 3 not found
2025-06-02 16:33:33.488 +07:00 [INF] User 2 subscribed to channel conversation:69
2025-06-02 16:33:33.488 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 16:33:33.489 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:33:33.489 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 42.8425ms
2025-06-02 16:33:33.489 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 16:33:33.489 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 43.845ms
2025-06-02 16:33:33.817 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/69 - null null
2025-06-02 16:33:33.817 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:33:33.818 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:33:33.828 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 16:33:33.833 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 16:33:33.833 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 15.3478ms
2025-06-02 16:33:33.833 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 16:33:33.834 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/69 - 200 null application/json; charset=utf-8 17.179ms
2025-06-02 16:33:33.968 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 109
2025-06-02 16:33:33.968 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:33:33.968 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:33:33.974 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 16:33:33.982 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:33:33.987 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?' (DbType = Boolean), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [GroupSettings] ([AllowMemberEdit], [AllowMemberInvite], [AllowMemberRemove], [ConversationId], [CreatedAt], [CreatedBy])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-06-02 16:33:33.988 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:33:33.988 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 20.4309ms
2025-06-02 16:33:33.989 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:33:33.989 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 200 null application/json; charset=utf-8 21.4585ms
2025-06-02 16:33:36.846 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - null null
2025-06-02 16:33:36.847 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:33:36.847 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:33:36.848 +07:00 [INF] Retrieved 0 messages from Redis for conversation 69
2025-06-02 16:33:36.854 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-02 16:33:36.886 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-02 16:33:36.886 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-06-02 16:33:36.886 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 38.3845ms
2025-06-02 16:33:36.886 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:33:36.886 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - 404 null text/plain; charset=utf-8 39.6577ms
2025-06-02 16:33:36.914 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 16:33:36.914 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:33:36.914 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:33:36.916 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:33:36.917 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:33:36.917 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 2.8714ms
2025-06-02 16:33:36.917 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:33:36.917 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 3.3164ms
2025-06-02 16:33:36.966 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:33:36.966 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:33:36.966 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:33:36.972 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:33:36.974 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:33:36.974 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.6386ms
2025-06-02 16:33:36.974 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:33:36.974 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 8.2883ms
2025-06-02 16:33:38.306 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - null null
2025-06-02 16:33:38.308 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:33:38.308 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:33:38.313 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:33:38.313 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 16:33:38.314 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:33:38.314 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 5.427ms
2025-06-02 16:33:38.314 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:33:38.314 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 8.0152ms
2025-06-02 16:33:38.314 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:33:38.315 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:33:38.319 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:33:38.322 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:33:38.323 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.237ms
2025-06-02 16:33:38.323 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:33:38.324 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 10.4336ms
2025-06-02 16:37:22.458 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 16:37:22.476 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:37:22.489 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 30.9278ms
2025-06-02 16:37:22.490 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-02 16:37:22.491 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:37:22.494 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:37:22.497 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 16:37:22.520 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 16:37:22.552 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 16:37:22.564 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 16:37:22.571 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 50.6473ms
2025-06-02 16:37:22.571 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 16:37:22.571 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 81.0817ms
2025-06-02 16:37:22.604 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 16:37:22.605 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:37:22.605 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:37:22.605 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 16:37:22.755 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 16:37:22.755 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:37:22.756 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:37:22.756 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:37:22.758 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 16:37:22.778 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 16:37:22.778 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:37:22.783 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 23.9769ms
2025-06-02 16:37:22.783 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:37:22.783 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 27.9976ms
2025-06-02 16:37:22.907 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 16:37:22.912 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-02 16:37:22.912 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-02 16:37:22.913 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-02 16:37:22.914 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:54
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:55
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:56
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:57
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:58
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:59
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:60
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:61
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:62
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:63
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:64
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:65
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:67
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:68
2025-06-02 16:37:22.915 +07:00 [INF] User 3 subscribed to channel conversation:69
2025-06-02 16:37:22.996 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 16:37:22.996 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:37:22.996 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.5665ms
2025-06-02 16:37:22.998 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 16:37:22.998 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:37:22.998 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:37:22.998 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 16:37:23.001 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:37:23.040 +07:00 [INF] Executed DbCommand (36ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 16:37:23.104 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:37:23.108 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 107.5524ms
2025-06-02 16:37:23.109 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 16:37:23.109 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 111.0649ms
2025-06-02 16:38:00.194 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 16:38:00.194 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:00.194 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - 204 null null 0.3459ms
2025-06-02 16:38:00.199 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 16:38:00.199 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:00.199 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:00.199 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:38:00.199 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:38:00.206 +07:00 [INF] Retrieved 0 messages from Redis for conversation 69
2025-06-02 16:38:00.234 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-02 16:38:00.247 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-02 16:38:00.248 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-06-02 16:38:00.248 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 48.949ms
2025-06-02 16:38:00.248 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:38:00.249 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - 404 null text/plain; charset=utf-8 49.9504ms
2025-06-02 16:38:00.357 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 16:38:00.357 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:00.358 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - 204 null null 1.3209ms
2025-06-02 16:38:00.360 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 16:38:00.360 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:00.360 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:00.360 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:38:00.360 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:38:00.397 +07:00 [INF] Executed DbCommand (35ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:38:00.402 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:38:00.402 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 41.4598ms
2025-06-02 16:38:00.402 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:38:00.402 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 42.2827ms
2025-06-02 16:38:00.415 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:38:00.415 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:00.415 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - 204 null null 0.4227ms
2025-06-02 16:38:00.417 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:38:00.418 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:00.418 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:00.418 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:38:00.418 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:38:00.429 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:38:00.431 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:38:00.431 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 13.5213ms
2025-06-02 16:38:00.431 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:38:00.431 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 14.1102ms
2025-06-02 16:38:06.175 +07:00 [INF] Handling message from user 3: hello
2025-06-02 16:38:06.193 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 16:38:06.203 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 16:38:06.213 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 16:38:06.214 +07:00 [INF] Message saved to DB with ID: 449
2025-06-02 16:38:06.215 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 16:38:06.226 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 16:38:06.228 +07:00 [INF] Transaction committed for message: 449
2025-06-02 16:38:06.232 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 16:38:06.237 +07:00 [INF] Saved message 449 to Redis
2025-06-02 16:38:06.239 +07:00 [INF] Added message 449 to conversation 69
2025-06-02 16:38:06.243 +07:00 [INF] Published message to channel conversation:69
2025-06-02 16:38:34.823 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:38:34.823 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 16:38:34.824 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:34.824 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - 204 null null 0.3782ms
2025-06-02 16:38:34.825 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:34.825 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - 204 null null 1.7943ms
2025-06-02 16:38:34.826 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:38:34.826 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:34.831 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:34.832 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:38:34.833 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:38:34.838 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 16:38:34.839 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:34.839 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:38:34.839 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:38:34.840 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:38:34.866 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:38:34.868 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:38:34.869 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 35.4367ms
2025-06-02 16:38:34.869 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:38:34.869 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 42.9302ms
2025-06-02 16:38:34.881 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 16:38:34.882 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:38:34.883 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 41.8593ms
2025-06-02 16:38:34.883 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:38:34.883 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 44.8029ms
2025-06-02 16:39:51.577 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 16:39:51.577 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:39:51.579 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:39:51.579 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:39:51.579 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 16:39:51.597 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 16:39:51.597 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:39:51.598 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 18.2278ms
2025-06-02 16:39:51.598 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:39:51.599 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 22.1344ms
2025-06-02 16:42:46.517 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 16:42:46.518 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:46.518 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.4716ms
2025-06-02 16:42:46.519 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-02 16:42:46.519 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:46.521 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:46.521 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 16:42:46.521 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 16:42:46.536 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 16:42:46.538 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 16:42:46.539 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 17.839ms
2025-06-02 16:42:46.539 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 16:42:46.539 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 20.5447ms
2025-06-02 16:42:46.565 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 16:42:46.565 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:46.566 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:46.567 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 16:42:46.657 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 16:42:46.657 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:46.657 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:46.657 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:42:46.657 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 16:42:46.670 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 16:42:46.670 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:42:46.670 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 13.0323ms
2025-06-02 16:42:46.671 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:42:46.671 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 13.5362ms
2025-06-02 16:42:46.756 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-02 16:42:46.757 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-02 16:42:46.758 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-02 16:42:46.758 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-02 16:42:46.758 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-02 16:42:46.758 +07:00 [INF] User 3 subscribed to channel conversation:54
2025-06-02 16:42:46.758 +07:00 [INF] User 3 subscribed to channel conversation:55
2025-06-02 16:42:46.758 +07:00 [INF] User 3 subscribed to channel conversation:56
2025-06-02 16:42:46.758 +07:00 [INF] User 3 subscribed to channel conversation:57
2025-06-02 16:42:46.758 +07:00 [INF] User 3 subscribed to channel conversation:58
2025-06-02 16:42:46.758 +07:00 [INF] User 3 subscribed to channel conversation:59
2025-06-02 16:42:46.758 +07:00 [INF] User 3 subscribed to channel conversation:60
2025-06-02 16:42:46.758 +07:00 [INF] User 3 subscribed to channel conversation:61
2025-06-02 16:42:46.758 +07:00 [INF] User 3 subscribed to channel conversation:62
2025-06-02 16:42:46.759 +07:00 [INF] User 3 subscribed to channel conversation:63
2025-06-02 16:42:46.759 +07:00 [INF] User 3 subscribed to channel conversation:64
2025-06-02 16:42:46.759 +07:00 [INF] User 3 subscribed to channel conversation:65
2025-06-02 16:42:46.759 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 16:42:46.759 +07:00 [INF] User 3 subscribed to channel conversation:67
2025-06-02 16:42:46.759 +07:00 [INF] User 3 subscribed to channel conversation:68
2025-06-02 16:42:46.759 +07:00 [INF] User 3 subscribed to channel conversation:69
2025-06-02 16:42:46.768 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 16:42:46.771 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 16:42:46.783 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 16:42:46.784 +07:00 [ERR] Connection id "0HND1MMLU4SKL", Request id "0HND1MMLU4SKL:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 16:42:46.789 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 324184.1384ms
2025-06-02 16:42:46.822 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 16:42:46.822 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:46.822 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.249ms
2025-06-02 16:42:46.823 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 16:42:46.823 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:46.823 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:46.824 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 16:42:46.824 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:42:46.843 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 16:42:46.882 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:42:46.886 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 61.6568ms
2025-06-02 16:42:46.886 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 16:42:46.886 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 63.0309ms
2025-06-02 16:42:49.351 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 16:42:49.352 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:49.352 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - 204 null null 0.5378ms
2025-06-02 16:42:49.354 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 16:42:49.354 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:49.354 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:49.355 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:42:49.355 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:42:49.362 +07:00 [INF] Retrieved 1 messages from Redis for conversation 69
2025-06-02 16:42:49.362 +07:00 [INF] Retrieved 1 messages from Redis for conversation 69 and user 3
2025-06-02 16:42:49.363 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:42:49.365 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 10.1907ms
2025-06-02 16:42:49.365 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:42:49.365 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - 200 null application/json; charset=utf-8 11.2215ms
2025-06-02 16:42:49.376 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 16:42:49.376 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:49.376 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - 204 null null 0.3558ms
2025-06-02 16:42:49.378 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 16:42:49.378 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:49.378 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:49.378 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:42:49.378 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:42:49.385 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:42:49.387 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:42:49.387 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.4219ms
2025-06-02 16:42:49.388 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:42:49.388 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 9.978ms
2025-06-02 16:42:49.396 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:42:49.396 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:49.396 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - 204 null null 0.2028ms
2025-06-02 16:42:49.397 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:42:49.397 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:49.397 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:49.397 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:42:49.398 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:42:49.401 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:42:49.402 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:42:49.403 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.1175ms
2025-06-02 16:42:49.403 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:42:49.403 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 6.0601ms
2025-06-02 16:42:50.711 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 16:42:50.711 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:50.711 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - 204 null null 0.5135ms
2025-06-02 16:42:50.711 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:42:50.712 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:50.712 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:50.712 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:42:50.712 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:42:50.712 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 16:42:50.713 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:50.713 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:50.713 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:42:50.713 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:42:50.716 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:42:50.718 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 16:42:50.718 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:42:50.718 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 5.1157ms
2025-06-02 16:42:50.718 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:42:50.718 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:42:50.718 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 5.9034ms
2025-06-02 16:42:50.719 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.1663ms
2025-06-02 16:42:50.719 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:42:50.720 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 8.1552ms
2025-06-02 16:42:51.834 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 16:42:51.835 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:51.835 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:42:51.835 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 16:42:54.889 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:42:54.889 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:42:54.889 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:42:54.891 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - null null
2025-06-02 16:42:54.891 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:42:54.891 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:42:54.893 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:42:54.894 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:42:54.895 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.634ms
2025-06-02 16:42:54.895 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:42:54.895 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 5.9794ms
2025-06-02 16:42:54.899 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 16:42:54.899 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:42:54.899 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 8.5919ms
2025-06-02 16:42:54.899 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:42:54.900 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 8.9217ms
2025-06-02 16:46:35.271 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:46:35.271 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:46:35.273 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - null null
2025-06-02 16:46:35.274 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:46:35.274 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:46:35.277 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:46:35.279 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 1.8696ms
2025-06-02 16:46:35.280 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:46:35.280 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.MissingMethodException: Attempted to invoke a deleted method implementation. This can happen when a method is deleted or its name or signature is changed while the application is running.
   at server.Services.ConversationService.ConversationSV..ctor(ApplicationDbContext context, IChatStorage chatStorage, IUserSV userSV, IParticipant participant, IRedisService redisService, webSocket webSocket)
   at ResolveService(ILEmitResolverBuilderRuntimeContext, ServiceProviderEngineScope)
   at ResolveService(ILEmitResolverBuilderRuntimeContext, ServiceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at lambda_method983(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 16:46:35.290 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:46:35.291 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:46:35.294 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - 500 null text/plain; charset=utf-8 21.55ms
2025-06-02 16:46:35.300 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 25.3697ms
2025-06-02 16:46:35.300 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:46:35.300 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 29.0954ms
2025-06-02 16:46:35.353 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 111
2025-06-02 16:46:35.354 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:46:35.356 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:46:35.356 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 0.2336ms
2025-06-02 16:46:35.356 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:46:35.356 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.MissingMethodException: Attempted to invoke a deleted method implementation. This can happen when a method is deleted or its name or signature is changed while the application is running.
   at server.Services.ConversationService.ConversationSV..ctor(ApplicationDbContext context, IChatStorage chatStorage, IUserSV userSV, IParticipant participant, IRedisService redisService, webSocket webSocket)
   at ResolveService(ILEmitResolverBuilderRuntimeContext, ServiceProviderEngineScope)
   at ResolveService(ILEmitResolverBuilderRuntimeContext, ServiceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at lambda_method991(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 16:46:35.358 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 500 null text/plain; charset=utf-8 5.4512ms
2025-06-02 16:46:53.540 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:46:53.541 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - null null
2025-06-02 16:46:53.542 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:46:53.542 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:46:53.544 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 1.9066ms
2025-06-02 16:46:53.544 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:46:53.548 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:46:53.548 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:46:53.547 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.MissingMethodException: Attempted to invoke a deleted method implementation. This can happen when a method is deleted or its name or signature is changed while the application is running.
   at server.Services.ConversationService.ConversationSV..ctor(ApplicationDbContext context, IChatStorage chatStorage, IUserSV userSV, IParticipant participant, IRedisService redisService, webSocket webSocket)
   at ResolveService(ILEmitResolverBuilderRuntimeContext, ServiceProviderEngineScope)
   at ResolveService(ILEmitResolverBuilderRuntimeContext, ServiceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at lambda_method983(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 16:46:53.567 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:46:53.569 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - 500 null text/plain; charset=utf-8 27.1015ms
2025-06-02 16:46:53.573 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:46:53.574 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 26.2264ms
2025-06-02 16:46:53.574 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:46:53.575 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 35.0136ms
2025-06-02 16:46:53.602 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 111
2025-06-02 16:46:53.603 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:46:53.603 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:46:53.604 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 0.3798ms
2025-06-02 16:46:53.604 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 16:46:53.604 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.MissingMethodException: Attempted to invoke a deleted method implementation. This can happen when a method is deleted or its name or signature is changed while the application is running.
   at server.Services.ConversationService.ConversationSV..ctor(ApplicationDbContext context, IChatStorage chatStorage, IUserSV userSV, IParticipant participant, IRedisService redisService, webSocket webSocket)
   at ResolveService(ILEmitResolverBuilderRuntimeContext, ServiceProviderEngineScope)
   at ResolveService(ILEmitResolverBuilderRuntimeContext, ServiceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at lambda_method991(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 16:46:53.607 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 500 null text/plain; charset=utf-8 4.7425ms
2025-06-02 16:47:12.875 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 16:47:12.875 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:47:12.875 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.1745ms
2025-06-02 16:47:12.877 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-02 16:47:12.877 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:47:12.877 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:47:12.877 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 16:47:12.882 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 16:47:12.895 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 16:47:12.899 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 16:47:12.904 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 22.0707ms
2025-06-02 16:47:12.904 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 16:47:12.904 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 27.5746ms
2025-06-02 16:47:12.927 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 16:47:12.928 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:47:12.928 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:47:12.928 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 16:47:13.034 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 16:47:13.034 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:47:13.034 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:47:13.034 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:47:13.038 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 16:47:13.048 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 16:47:13.048 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:47:13.051 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 13.1036ms
2025-06-02 16:47:13.051 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:47:13.051 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 17.5194ms
2025-06-02 16:47:13.127 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:54
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:55
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:56
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:57
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:58
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:59
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:60
2025-06-02 16:47:13.128 +07:00 [INF] User 3 subscribed to channel conversation:61
2025-06-02 16:47:13.129 +07:00 [INF] User 3 subscribed to channel conversation:62
2025-06-02 16:47:13.129 +07:00 [INF] User 3 subscribed to channel conversation:63
2025-06-02 16:47:13.129 +07:00 [INF] User 3 subscribed to channel conversation:64
2025-06-02 16:47:13.129 +07:00 [INF] User 3 subscribed to channel conversation:65
2025-06-02 16:47:13.129 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 16:47:13.129 +07:00 [INF] User 3 subscribed to channel conversation:67
2025-06-02 16:47:13.129 +07:00 [INF] User 3 subscribed to channel conversation:68
2025-06-02 16:47:13.129 +07:00 [INF] User 3 subscribed to channel conversation:69
2025-06-02 16:47:13.193 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 16:47:13.194 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:47:13.194 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.6638ms
2025-06-02 16:47:13.197 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 16:47:13.197 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:47:13.197 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:47:13.197 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 16:47:13.200 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:47:13.201 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 0.3719ms
2025-06-02 16:47:13.201 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 16:47:13.201 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.MissingMethodException: Attempted to invoke a deleted method implementation. This can happen when a method is deleted or its name or signature is changed while the application is running.
   at server.Services.ConversationService.ConversationSV..ctor(ApplicationDbContext context, IChatStorage chatStorage, IUserSV userSV, IParticipant participant, IRedisService redisService, webSocket webSocket)
   at ResolveService(ILEmitResolverBuilderRuntimeContext, ServiceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at lambda_method1015(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 16:47:13.204 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 500 null text/plain; charset=utf-8 7.0412ms
2025-06-02 16:48:25.627 +07:00 [INF] Application is shutting down...
2025-06-02 16:55:53.571 +07:00 [INF] Executed DbCommand (42ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-02 16:55:53.731 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-02 16:55:53.817 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-02 16:55:53.826 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-02 16:55:53.826 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-02 16:55:53.826 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-02 16:55:53.826 +07:00 [INF] Hosting environment: Development
2025-06-02 16:55:53.826 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-02 16:55:55.272 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 16:55:55.297 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:55:55.321 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:55:55.321 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-02 16:55:55.346 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 16:55:55.738 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 16:55:55.739 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:55:55.740 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:55:55.741 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 16:55:58.042 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 16:55:58.045 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 16:55:59.135 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 16:55:59.135 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:55:59.135 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:55:59.135 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 16:56:21.720 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 16:56:21.721 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:21.734 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 11.8474ms
2025-06-02 16:56:21.748 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-02 16:56:21.750 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:21.753 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:21.753 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 16:56:21.815 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 16:56:22.080 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 16:56:22.276 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 16:56:22.373 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 552.8546ms
2025-06-02 16:56:22.376 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 16:56:22.386 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 637.6688ms
2025-06-02 16:56:22.439 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 16:56:22.444 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:22.444 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:22.444 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 16:56:22.489 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 16:56:22.490 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:22.500 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:22.501 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:56:22.511 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 16:56:22.626 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 16:56:22.627 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:22.627 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 1.0549ms
2025-06-02 16:56:22.631 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 16:56:22.631 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:22.632 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:22.632 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 16:56:22.639 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:56:22.661 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 16:56:22.682 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-02 16:56:22.684 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-02 16:56:22.687 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-02 16:56:22.689 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-02 16:56:22.690 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-02 16:56:22.693 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-02 16:56:22.695 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-02 16:56:22.696 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-02 16:56:22.697 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-02 16:56:22.698 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-02 16:56:22.699 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-02 16:56:22.699 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-02 16:56:22.700 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-02 16:56:22.702 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-02 16:56:22.703 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-02 16:56:22.704 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-02 16:56:22.705 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-02 16:56:22.705 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-02 16:56:22.706 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-02 16:56:22.707 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-02 16:56:22.708 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-02 16:56:22.709 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-02 16:56:22.711 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-02 16:56:22.712 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-02 16:56:22.712 +07:00 [INF] User 3 subscribed to channel conversation:54
2025-06-02 16:56:22.713 +07:00 [INF] User 3 subscribed to channel conversation:55
2025-06-02 16:56:22.713 +07:00 [INF] User 3 subscribed to channel conversation:56
2025-06-02 16:56:22.714 +07:00 [INF] User 3 subscribed to channel conversation:57
2025-06-02 16:56:22.716 +07:00 [INF] User 3 subscribed to channel conversation:58
2025-06-02 16:56:22.716 +07:00 [INF] User 3 subscribed to channel conversation:59
2025-06-02 16:56:22.718 +07:00 [INF] User 3 subscribed to channel conversation:60
2025-06-02 16:56:22.718 +07:00 [INF] User 3 subscribed to channel conversation:61
2025-06-02 16:56:22.719 +07:00 [INF] User 3 subscribed to channel conversation:62
2025-06-02 16:56:22.720 +07:00 [INF] User 3 subscribed to channel conversation:63
2025-06-02 16:56:22.720 +07:00 [INF] User 3 subscribed to channel conversation:64
2025-06-02 16:56:22.721 +07:00 [INF] User 3 subscribed to channel conversation:65
2025-06-02 16:56:22.721 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 16:56:22.722 +07:00 [INF] User 3 subscribed to channel conversation:67
2025-06-02 16:56:22.723 +07:00 [INF] User 3 subscribed to channel conversation:68
2025-06-02 16:56:22.723 +07:00 [INF] User 3 subscribed to channel conversation:69
2025-06-02 16:56:22.739 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 16:56:22.742 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:56:22.760 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 248.9774ms
2025-06-02 16:56:22.760 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:56:22.761 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 271.7531ms
2025-06-02 16:56:22.795 +07:00 [INF] Executed DbCommand (43ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 16:56:23.008 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:56:23.038 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 398.2706ms
2025-06-02 16:56:23.038 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 16:56:23.038 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 407.5301ms
2025-06-02 16:56:25.251 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 16:56:25.252 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:25.252 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - 204 null null 0.904ms
2025-06-02 16:56:25.254 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 16:56:25.255 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:25.255 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:25.255 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:56:25.595 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:56:25.902 +07:00 [INF] Retrieved 1 messages from Redis for conversation 69
2025-06-02 16:56:25.906 +07:00 [INF] Retrieved 1 messages from Redis for conversation 69 and user 3
2025-06-02 16:56:25.906 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:56:25.923 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 327.9203ms
2025-06-02 16:56:25.924 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:56:25.928 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - 200 null application/json; charset=utf-8 672.9333ms
2025-06-02 16:56:25.934 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 16:56:25.934 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:25.934 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - 204 null null 0.5533ms
2025-06-02 16:56:25.936 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 16:56:25.936 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:25.940 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:25.941 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:56:25.953 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:56:26.389 +07:00 [INF] Executed DbCommand (192ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:56:26.827 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:56:26.958 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 1004.871ms
2025-06-02 16:56:26.958 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:56:26.958 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 1022.2843ms
2025-06-02 16:56:26.982 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:56:26.982 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:26.982 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - 204 null null 0.4968ms
2025-06-02 16:56:26.986 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:56:26.986 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:26.987 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:26.987 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:56:27.021 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:56:27.068 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:56:27.087 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:56:27.098 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 76.7022ms
2025-06-02 16:56:27.100 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:56:27.101 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 114.5094ms
2025-06-02 16:56:29.342 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - null null
2025-06-02 16:56:29.343 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:56:29.343 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:56:29.354 +07:00 [INF] Retrieved 1 messages from Redis for conversation 69
2025-06-02 16:56:29.354 +07:00 [INF] Retrieved 1 messages from Redis for conversation 69 and user 2
2025-06-02 16:56:29.354 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:56:29.354 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 10.8427ms
2025-06-02 16:56:29.354 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:56:29.449 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - 200 null application/json; charset=utf-8 107.5429ms
2025-06-02 16:56:29.488 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 16:56:29.505 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:56:29.505 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:56:29.539 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:56:29.547 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:56:29.548 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 42.1011ms
2025-06-02 16:56:29.548 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:56:29.548 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 59.549ms
2025-06-02 16:56:29.624 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:56:29.693 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:56:29.694 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:56:29.773 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:56:29.919 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:56:29.919 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 225.4237ms
2025-06-02 16:56:29.919 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:56:29.919 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 295.3367ms
2025-06-02 16:56:34.073 +07:00 [INF] Handling message from user 2: ok
2025-06-02 16:56:34.110 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 16:56:34.341 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 16:56:34.387 +07:00 [INF] Executed DbCommand (41ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 16:56:34.422 +07:00 [INF] Message saved to DB with ID: 450
2025-06-02 16:56:34.429 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 16:56:34.443 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 16:56:34.462 +07:00 [INF] Transaction committed for message: 450
2025-06-02 16:56:34.471 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 16:56:34.485 +07:00 [INF] Saved message 450 to Redis
2025-06-02 16:56:34.488 +07:00 [INF] Added message 450 to conversation 69
2025-06-02 16:56:34.503 +07:00 [INF] Published message to channel conversation:69
2025-06-02 16:56:38.967 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - null null
2025-06-02 16:56:38.968 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:56:38.968 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:56:38.973 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69
2025-06-02 16:56:38.977 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69 and user 2
2025-06-02 16:56:38.979 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:56:38.981 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 12.2555ms
2025-06-02 16:56:38.981 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:56:38.981 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - 200 null application/json; charset=utf-8 13.582ms
2025-06-02 16:56:39.064 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 16:56:39.065 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:56:39.065 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:56:39.072 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:56:39.075 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:56:39.075 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.2659ms
2025-06-02 16:56:39.077 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:56:39.077 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 12.7843ms
2025-06-02 16:56:39.112 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:56:39.112 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:56:39.112 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:56:39.120 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:56:39.123 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:56:39.123 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 10.7075ms
2025-06-02 16:56:39.123 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:56:39.124 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 11.8469ms
2025-06-02 16:56:42.000 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 16:56:42.001 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 16:56:42.048 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 16:56:42.050 +07:00 [ERR] Connection id "0HND1NELC21HM", Request id "0HND1NELC21HM:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 16:56:42.056 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - 101 null null 44014.7672ms
2025-06-02 16:56:54.018 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 16:56:54.018 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:54.018 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - 204 null null 0.4495ms
2025-06-02 16:56:54.020 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 16:56:54.020 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:54.020 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:54.021 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:56:54.021 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:56:54.024 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69
2025-06-02 16:56:54.024 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69 and user 3
2025-06-02 16:56:54.025 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:56:54.027 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 6.3663ms
2025-06-02 16:56:54.027 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:56:54.028 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - 200 null application/json; charset=utf-8 8.0971ms
2025-06-02 16:56:54.036 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 16:56:54.036 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:54.036 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - 204 null null 0.4831ms
2025-06-02 16:56:54.038 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 16:56:54.038 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:54.038 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:54.038 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:56:54.038 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:56:54.055 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:56:54.060 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:56:54.061 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 21.9482ms
2025-06-02 16:56:54.061 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:56:54.061 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 22.9289ms
2025-06-02 16:56:54.072 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:56:54.073 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:54.073 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - 204 null null 0.3547ms
2025-06-02 16:56:54.077 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:56:54.077 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:54.081 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:54.082 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:56:54.082 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:56:54.089 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:56:54.098 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:56:54.099 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 16.3885ms
2025-06-02 16:56:54.099 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:56:54.099 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 22.6141ms
2025-06-02 16:56:55.723 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 16:56:55.724 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:55.724 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:56:55.724 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:55.724 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:55.724 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:56:55.724 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:56:55.727 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - 204 null null 3.496ms
2025-06-02 16:56:55.729 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 16:56:55.730 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:55.730 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:56:55.730 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:56:55.748 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:56:55.784 +07:00 [INF] Executed DbCommand (57ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:56:55.788 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:56:55.789 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 64.0817ms
2025-06-02 16:56:55.789 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:56:55.789 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 64.9211ms
2025-06-02 16:56:55.824 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 16:56:55.829 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:56:55.840 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 91.7432ms
2025-06-02 16:56:55.840 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:56:55.841 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 111.0826ms
2025-06-02 16:57:01.367 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 16:57:01.368 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:01.368 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - 204 null null 0.3782ms
2025-06-02 16:57:01.370 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 16:57:01.370 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:01.370 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:01.370 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:57:01.370 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:57:01.372 +07:00 [INF] Retrieved 0 messages from Redis for conversation 68
2025-06-02 16:57:01.413 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-02 16:57:01.455 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-02 16:57:01.456 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-06-02 16:57:01.457 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 86.7223ms
2025-06-02 16:57:01.457 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:57:01.458 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - 404 null text/plain; charset=utf-8 87.9725ms
2025-06-02 16:57:01.470 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 16:57:01.470 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:01.470 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - 204 null null 0.2376ms
2025-06-02 16:57:01.472 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 16:57:01.473 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:01.473 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:01.473 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:57:01.473 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:57:01.483 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:57:01.786 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:57:01.786 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 312.995ms
2025-06-02 16:57:01.786 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:57:01.787 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 314.678ms
2025-06-02 16:57:01.799 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 16:57:01.799 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:01.799 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - 204 null null 0.5582ms
2025-06-02 16:57:01.802 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 16:57:01.802 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:01.803 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:01.804 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:57:01.805 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:57:01.833 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:57:01.839 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:57:01.840 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 34.7415ms
2025-06-02 16:57:01.840 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:57:01.840 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 37.7645ms
2025-06-02 16:57:04.329 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/68 - null null
2025-06-02 16:57:04.329 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:04.329 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 16:57:04.329 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:04.329 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:04.329 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/68 - 204 null null 0.2626ms
2025-06-02 16:57:04.329 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:57:04.331 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:57:04.331 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/68 - null null
2025-06-02 16:57:04.331 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:04.333 +07:00 [INF] CORS policy execution successful.
2025-06-02 16:57:04.333 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:57:04.333 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:57:04.353 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 16:57:04.354 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:57:04.354 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 20.9234ms
2025-06-02 16:57:04.354 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:57:04.354 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/68 - 200 null application/json; charset=utf-8 23.0439ms
2025-06-02 16:57:04.356 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:57:04.365 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:57:04.366 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 35.1658ms
2025-06-02 16:57:04.366 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:57:04.366 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 37.4796ms
2025-06-02 16:58:31.496 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 16:58:31.503 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 16:58:31.504 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 16:58:31.526 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 16:58:31.537 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 16:58:31.537 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 33.4077ms
2025-06-02 16:58:31.538 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 16:58:31.538 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 41.9919ms
2025-06-02 16:58:32.670 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 16:58:32.673 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 16:58:32.823 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 16:58:32.826 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:58:32.826 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 16:58:32.845 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 16:58:32.852 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:58:32.852 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 26.4658ms
2025-06-02 16:58:32.853 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 16:58:32.853 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 29.6474ms
2025-06-02 16:58:32.908 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 16:58:32.911 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 16:58:32.911 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 16:58:32.912 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 16:58:32.912 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 16:58:32.912 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 16:58:32.912 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 16:58:32.912 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 16:58:32.912 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 16:58:32.912 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 16:58:32.912 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 16:58:32.915 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 16:58:32.915 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 16:58:32.915 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 16:58:32.915 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 16:58:32.916 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 16:58:32.916 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 16:58:32.916 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 16:58:32.916 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 16:58:32.916 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 16:58:32.916 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 16:58:32.916 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 16:58:32.916 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 16:58:32.916 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 16:58:32.917 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 16:58:32.917 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 16:58:32.917 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 16:58:32.918 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 16:58:32.918 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 16:58:32.918 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 16:58:32.918 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 16:58:32.918 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:54
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:55
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:56
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:57
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:58
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:59
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:60
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:61
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:62
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:63
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:64
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:65
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:66
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:67
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:68
2025-06-02 16:58:32.919 +07:00 [INF] User 2 subscribed to channel conversation:69
2025-06-02 16:58:33.439 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 16:58:33.441 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 16:58:33.441 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:58:33.485 +07:00 [INF] Executed DbCommand (29ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 16:58:33.607 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:58:33.670 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 228.7058ms
2025-06-02 16:58:33.670 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 16:58:33.670 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 230.6042ms
2025-06-02 16:58:35.453 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - null null
2025-06-02 16:58:35.456 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:58:35.456 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:58:35.457 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69
2025-06-02 16:58:35.458 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69 and user 2
2025-06-02 16:58:35.458 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:58:35.458 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.411ms
2025-06-02 16:58:35.458 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:58:35.458 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - 200 null application/json; charset=utf-8 5.2031ms
2025-06-02 16:58:35.499 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 16:58:35.499 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:58:35.500 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:58:35.509 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:58:35.515 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:58:35.516 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 15.538ms
2025-06-02 16:58:35.517 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:58:35.518 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 18.7306ms
2025-06-02 16:58:35.596 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:58:35.597 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:58:35.597 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:58:35.604 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:58:35.611 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:58:35.613 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 16.0445ms
2025-06-02 16:58:35.613 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:58:35.613 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 16.9833ms
2025-06-02 16:58:36.425 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 16:58:36.425 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:58:36.425 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:58:36.432 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - null null
2025-06-02 16:58:36.433 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:58:36.433 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:58:36.459 +07:00 [INF] Executed DbCommand (32ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:58:36.470 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:58:36.470 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 44.9552ms
2025-06-02 16:58:36.470 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:58:36.470 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 45.6948ms
2025-06-02 16:58:36.471 +07:00 [INF] Executed DbCommand (34ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 16:58:36.471 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:58:36.471 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 37.8825ms
2025-06-02 16:58:36.471 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:58:36.471 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 38.9317ms
2025-06-02 16:58:41.842 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/68/2 - null null
2025-06-02 16:58:41.842 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:58:41.843 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 16:58:41.844 +07:00 [INF] Retrieved 0 messages from Redis for conversation 68
2025-06-02 16:58:41.853 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-02 16:58:41.875 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-02 16:58:41.876 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-06-02 16:58:41.877 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 34.1401ms
2025-06-02 16:58:41.877 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 16:58:41.877 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/68/2 - 404 null text/plain; charset=utf-8 35.1186ms
2025-06-02 16:58:41.937 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 16:58:41.937 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:58:41.937 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 16:58:41.945 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 16:58:41.947 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 16:58:41.947 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.8169ms
2025-06-02 16:58:41.947 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 16:58:41.947 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 10.8654ms
2025-06-02 16:58:41.989 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 16:58:41.990 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:58:41.990 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:58:41.996 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:58:41.998 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:58:41.998 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.065ms
2025-06-02 16:58:41.999 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:58:41.999 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 9.3492ms
2025-06-02 16:58:43.060 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 16:58:43.060 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:58:43.060 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 16:58:43.065 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - null null
2025-06-02 16:58:43.065 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:58:43.065 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 16:58:43.074 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 16:58:43.075 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 16:58:43.075 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 10.2963ms
2025-06-02 16:58:43.075 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 16:58:43.075 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - 200 null application/json; charset=utf-8 10.8287ms
2025-06-02 16:58:43.082 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 16:58:43.104 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 16:58:43.105 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 44.8149ms
2025-06-02 16:58:43.105 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 16:58:43.105 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 45.4355ms
2025-06-02 17:00:44.294 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 17:00:44.294 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:44.295 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3732ms
2025-06-02 17:00:44.296 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-02 17:00:44.296 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:44.296 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:44.296 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:00:44.297 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 17:00:44.310 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 17:00:44.311 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 17:00:44.311 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 14.4002ms
2025-06-02 17:00:44.311 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:00:44.312 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 15.6275ms
2025-06-02 17:00:44.336 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 17:00:44.337 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:44.337 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:44.337 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 17:00:44.433 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 17:00:44.434 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:44.434 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:44.434 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:00:44.434 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:00:44.445 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:00:44.446 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:00:44.446 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 12.0383ms
2025-06-02 17:00:44.446 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:00:44.446 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 12.6247ms
2025-06-02 17:00:44.542 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:00:44.543 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-02 17:00:44.543 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-02 17:00:44.543 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-02 17:00:44.543 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-02 17:00:44.543 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-02 17:00:44.544 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-02 17:00:44.544 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-02 17:00:44.544 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-02 17:00:44.544 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-02 17:00:44.544 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-02 17:00:44.544 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-02 17:00:44.544 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-02 17:00:44.544 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-02 17:00:44.551 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-02 17:00:44.551 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-02 17:00:44.551 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-02 17:00:44.551 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-02 17:00:44.551 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-02 17:00:44.551 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-02 17:00:44.551 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-02 17:00:44.551 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-02 17:00:44.551 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-02 17:00:44.551 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:54
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:55
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:56
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:57
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:58
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:59
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:60
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:61
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:62
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:63
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:64
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:65
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:67
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:68
2025-06-02 17:00:44.552 +07:00 [INF] User 3 subscribed to channel conversation:69
2025-06-02 17:00:44.619 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 17:00:44.619 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:44.619 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.4169ms
2025-06-02 17:00:44.621 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 17:00:44.621 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:44.621 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:44.621 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:00:44.622 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:00:44.642 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 17:00:44.732 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:00:44.735 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 113.5487ms
2025-06-02 17:00:44.735 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:00:44.735 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 114.2737ms
2025-06-02 17:00:46.741 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/68/2 - null null
2025-06-02 17:00:46.741 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:00:46.741 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:00:46.743 +07:00 [INF] Retrieved 0 messages from Redis for conversation 68
2025-06-02 17:00:46.751 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-02 17:00:46.765 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-02 17:00:46.765 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-06-02 17:00:46.766 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 24.4637ms
2025-06-02 17:00:46.766 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:00:46.766 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/68/2 - 404 null text/plain; charset=utf-8 25.5628ms
2025-06-02 17:00:46.817 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:00:46.817 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:00:46.820 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:00:46.828 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:00:46.832 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:00:46.832 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 12.6334ms
2025-06-02 17:00:46.833 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:00:46.833 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 16.0736ms
2025-06-02 17:00:47.003 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:00:47.004 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:00:47.004 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:00:47.009 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:00:47.013 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:00:47.014 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.9818ms
2025-06-02 17:00:47.014 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:00:47.014 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 10.6773ms
2025-06-02 17:00:48.364 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:00:48.366 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:00:48.366 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - null null
2025-06-02 17:00:48.367 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:00:48.367 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:00:48.367 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:00:48.379 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:00:48.379 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:00:48.380 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:00:48.380 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 12.884ms
2025-06-02 17:00:48.380 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:00:48.380 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - 200 null application/json; charset=utf-8 13.681ms
2025-06-02 17:00:48.381 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:00:48.381 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 14.6278ms
2025-06-02 17:00:48.381 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:00:48.381 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 17.7134ms
2025-06-02 17:00:52.029 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 17:00:52.029 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:52.029 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - 204 null null 0.4355ms
2025-06-02 17:00:52.030 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 17:00:52.030 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:52.030 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:52.030 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:00:52.031 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:00:52.032 +07:00 [INF] Retrieved 0 messages from Redis for conversation 68
2025-06-02 17:00:52.042 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-02 17:00:52.053 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-02 17:00:52.053 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-06-02 17:00:52.053 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 22.8146ms
2025-06-02 17:00:52.053 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:00:52.053 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - 404 null text/plain; charset=utf-8 23.3035ms
2025-06-02 17:00:52.064 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:00:52.064 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:52.064 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - 204 null null 0.2428ms
2025-06-02 17:00:52.066 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:00:52.066 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:52.067 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:52.067 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:00:52.067 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:00:52.073 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:00:52.076 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:00:52.077 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.5236ms
2025-06-02 17:00:52.077 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:00:52.077 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 11.0136ms
2025-06-02 17:00:52.089 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:00:52.089 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:52.089 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - 204 null null 0.2353ms
2025-06-02 17:00:52.090 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:00:52.091 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:52.091 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:52.091 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:00:52.091 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:00:52.096 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:00:52.098 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:00:52.098 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.4434ms
2025-06-02 17:00:52.098 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:00:52.099 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 8.2311ms
2025-06-02 17:00:53.445 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:00:53.445 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/68 - null null
2025-06-02 17:00:53.445 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:53.445 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/68 - 204 null null 0.2009ms
2025-06-02 17:00:53.445 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:53.446 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:53.446 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/68 - null null
2025-06-02 17:00:53.446 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:00:53.446 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:53.446 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:00:53.446 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:00:53.447 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:00:53.447 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:00:53.452 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:00:53.452 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:00:53.452 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:00:53.452 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 5.4559ms
2025-06-02 17:00:53.452 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:00:53.452 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/68 - 200 null application/json; charset=utf-8 6.0434ms
2025-06-02 17:00:53.454 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:00:53.455 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.1399ms
2025-06-02 17:00:53.455 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:00:53.455 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 10.002ms
2025-06-02 17:01:08.058 +07:00 [INF] Handling message from user 2: h
2025-06-02 17:01:08.066 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 17:01:08.089 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:01:08.112 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 17:01:08.114 +07:00 [INF] Message saved to DB with ID: 451
2025-06-02 17:01:08.117 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:01:08.129 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 17:01:08.132 +07:00 [INF] Transaction committed for message: 451
2025-06-02 17:01:08.138 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:01:08.141 +07:00 [INF] Saved message 451 to Redis
2025-06-02 17:01:08.144 +07:00 [INF] Added message 451 to conversation 68
2025-06-02 17:01:08.148 +07:00 [INF] Published message to channel conversation:68
2025-06-02 17:01:32.928 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:01:32.928 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:01:32.928 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:01:32.936 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - null null
2025-06-02 17:01:32.936 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:01:32.936 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:01:32.943 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:01:32.945 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:01:32.945 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:01:32.945 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 9.1493ms
2025-06-02 17:01:32.946 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:01:32.946 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - 200 null application/json; charset=utf-8 9.7944ms
2025-06-02 17:01:32.947 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:01:32.948 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 19.3967ms
2025-06-02 17:01:32.948 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:01:32.948 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 19.9743ms
2025-06-02 17:01:40.724 +07:00 [INF] Request starting HTTP/1.1 PUT http://192.168.1.2:5053/api/GroupSetting/update - application/json 116
2025-06-02 17:01:40.726 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.UpdateGroupSetting (Message_app)'
2025-06-02 17:01:40.755 +07:00 [INF] Route matched with {action = "UpdateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:01:40.793 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-02 17:01:40.793 +07:00 [INF] Executed action server.Controllers.GroupSettingController.UpdateGroupSetting (Message_app) in 38.5002ms
2025-06-02 17:01:40.793 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.UpdateGroupSetting (Message_app)'
2025-06-02 17:01:40.794 +07:00 [INF] Request finished HTTP/1.1 PUT http://192.168.1.2:5053/api/GroupSetting/update - 500 null text/plain; charset=utf-8 69.3108ms
2025-06-02 17:01:45.368 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:01:45.368 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:01:45.368 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/68 - null null
2025-06-02 17:01:45.368 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - 204 null null 0.28ms
2025-06-02 17:01:45.369 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:01:45.369 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/68 - 204 null null 0.2105ms
2025-06-02 17:01:45.371 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:01:45.371 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/68 - null null
2025-06-02 17:01:45.371 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:01:45.371 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:01:45.371 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:01:45.371 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:01:45.371 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:01:45.371 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:01:45.371 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:01:45.371 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:01:45.381 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:01:45.383 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:01:45.384 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:01:45.384 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 12.7313ms
2025-06-02 17:01:45.384 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:01:45.384 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:01:45.384 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/68 - 200 null application/json; charset=utf-8 13.4176ms
2025-06-02 17:01:45.384 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 13.0587ms
2025-06-02 17:01:45.384 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:01:45.384 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 13.618ms
2025-06-02 17:02:00.591 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - null null
2025-06-02 17:02:00.592 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:02:00.592 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:02:00.608 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:02:00.609 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:02:00.610 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 17.7723ms
2025-06-02 17:02:00.610 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:02:00.610 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - 200 null application/json; charset=utf-8 19.4819ms
2025-06-02 17:02:01.572 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:02:01.572 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:02:01.572 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:02:01.580 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:02:01.581 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:02:01.581 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.1397ms
2025-06-02 17:02:01.581 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:02:01.581 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 9.7907ms
2025-06-02 17:02:04.978 +07:00 [INF] Request starting HTTP/1.1 PUT http://192.168.1.2:5053/api/GroupSetting/update - application/json 116
2025-06-02 17:02:04.979 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.UpdateGroupSetting (Message_app)'
2025-06-02 17:02:04.979 +07:00 [INF] Route matched with {action = "UpdateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:02:04.981 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-02 17:02:04.981 +07:00 [INF] Executed action server.Controllers.GroupSettingController.UpdateGroupSetting (Message_app) in 2.0321ms
2025-06-02 17:02:04.981 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.UpdateGroupSetting (Message_app)'
2025-06-02 17:02:04.981 +07:00 [INF] Request finished HTTP/1.1 PUT http://192.168.1.2:5053/api/GroupSetting/update - 500 null text/plain; charset=utf-8 2.4287ms
2025-06-02 17:28:09.411 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 17:28:09.411 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 17:28:09.411 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 17:28:09.411 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1930276.512ms
2025-06-02 17:28:09.411 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1934140.864ms
2025-06-02 17:28:09.411 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1933673.417ms
2025-06-02 17:28:09.412 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 17:28:09.416 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 17:28:09.415 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 17:28:09.417 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 17:28:09.433 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 17:28:09.433 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 17:28:09.434 +07:00 [ERR] Connection id "0HND1NELC21HP", Request id "0HND1NELC21HP:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 17:28:09.438 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1906998.5687ms
2025-06-02 17:28:09.434 +07:00 [ERR] Connection id "0HND1NELC21IK", Request id "0HND1NELC21IK:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 17:28:09.439 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1645102.5213ms
2025-06-02 17:28:33.779 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 17:28:33.779 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:33.780 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 1.057ms
2025-06-02 17:28:33.781 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-02 17:28:33.782 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:33.782 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:33.783 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:28:33.786 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 17:28:33.891 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 17:28:33.896 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 17:28:33.897 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 109.9566ms
2025-06-02 17:28:33.897 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:28:33.897 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 115.9737ms
2025-06-02 17:28:33.912 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 17:28:33.912 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:33.912 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:33.913 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 17:28:34.054 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 17:28:34.054 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:34.054 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:34.054 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:28:34.054 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:28:34.066 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:28:34.067 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:28:34.067 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 12.7651ms
2025-06-02 17:28:34.067 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:28:34.067 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 13.3367ms
2025-06-02 17:28:34.178 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:28:34.179 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-02 17:28:34.180 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:54
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:55
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:56
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:57
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:58
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:59
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:60
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:61
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:62
2025-06-02 17:28:34.181 +07:00 [INF] User 3 subscribed to channel conversation:63
2025-06-02 17:28:34.182 +07:00 [INF] User 3 subscribed to channel conversation:64
2025-06-02 17:28:34.182 +07:00 [INF] User 3 subscribed to channel conversation:65
2025-06-02 17:28:34.182 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 17:28:34.182 +07:00 [INF] User 3 subscribed to channel conversation:67
2025-06-02 17:28:34.182 +07:00 [INF] User 3 subscribed to channel conversation:68
2025-06-02 17:28:34.182 +07:00 [INF] User 3 subscribed to channel conversation:69
2025-06-02 17:28:34.285 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 17:28:34.285 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:34.285 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2404ms
2025-06-02 17:28:34.287 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 17:28:34.287 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:34.287 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:34.288 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:28:34.288 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:28:34.307 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 17:28:34.367 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:28:34.371 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 82.9684ms
2025-06-02 17:28:34.371 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:28:34.371 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 83.8853ms
2025-06-02 17:28:36.321 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 17:28:36.321 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:36.322 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - 204 null null 0.2706ms
2025-06-02 17:28:36.323 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 17:28:36.323 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:36.323 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:36.323 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:28:36.324 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:28:36.328 +07:00 [INF] Retrieved 1 messages from Redis for conversation 68
2025-06-02 17:28:36.328 +07:00 [INF] Retrieved 1 messages from Redis for conversation 68 and user 3
2025-06-02 17:28:36.328 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:28:36.328 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.3246ms
2025-06-02 17:28:36.328 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:28:36.328 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - 200 null application/json; charset=utf-8 5.4891ms
2025-06-02 17:28:36.335 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:28:36.336 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:36.336 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - 204 null null 1.2474ms
2025-06-02 17:28:36.337 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:28:36.337 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:36.337 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:36.338 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:28:36.338 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:28:36.356 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:28:36.360 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:28:36.361 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 22.4374ms
2025-06-02 17:28:36.361 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:28:36.361 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 23.6219ms
2025-06-02 17:28:36.372 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:28:36.372 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:36.372 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - 204 null null 0.2482ms
2025-06-02 17:28:36.373 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:28:36.374 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:36.374 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:36.374 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:28:36.374 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:28:36.385 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:28:36.393 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:28:36.393 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 19.4055ms
2025-06-02 17:28:36.393 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:28:36.393 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 19.9717ms
2025-06-02 17:28:37.977 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:28:37.977 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:37.977 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/68 - null null
2025-06-02 17:28:37.977 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:37.977 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:37.977 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:28:37.978 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/68 - 204 null null 0.803ms
2025-06-02 17:28:37.978 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:28:37.980 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/68 - null null
2025-06-02 17:28:37.980 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:37.980 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:37.980 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:28:37.980 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:28:37.997 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:28:38.004 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:28:38.004 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 25.8158ms
2025-06-02 17:28:38.004 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:28:38.004 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 27.06ms
2025-06-02 17:28:38.015 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:28:38.015 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:28:38.016 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 35.6594ms
2025-06-02 17:28:38.016 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:28:38.016 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/68 - 200 null application/json; charset=utf-8 36.2581ms
2025-06-02 17:28:46.177 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 17:28:46.178 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:46.178 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:46.178 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:28:46.178 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:28:46.196 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:28:46.196 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:28:46.197 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 18.7212ms
2025-06-02 17:28:46.197 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:28:46.197 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 19.3337ms
2025-06-02 17:28:50.873 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 17:28:50.873 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:50.874 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - 204 null null 0.3668ms
2025-06-02 17:28:50.879 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 17:28:50.879 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:50.880 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:50.880 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:28:50.880 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:28:50.905 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69
2025-06-02 17:28:50.906 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69 and user 3
2025-06-02 17:28:50.906 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:28:50.906 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 25.6533ms
2025-06-02 17:28:50.906 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:28:50.906 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - 200 null application/json; charset=utf-8 26.9038ms
2025-06-02 17:28:50.916 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 17:28:50.917 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:50.917 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - 204 null null 0.1965ms
2025-06-02 17:28:50.920 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 17:28:50.920 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:50.920 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:50.920 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:28:50.920 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:28:50.935 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:28:50.950 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:28:50.950 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 30.1363ms
2025-06-02 17:28:50.950 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:28:50.951 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 30.9868ms
2025-06-02 17:28:50.995 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:28:50.995 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:50.995 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - 204 null null 0.1995ms
2025-06-02 17:28:51.001 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:28:51.002 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:51.002 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:51.002 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:28:51.002 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:28:51.022 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:28:51.024 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:28:51.024 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 21.9913ms
2025-06-02 17:28:51.024 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:28:51.024 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 22.6082ms
2025-06-02 17:28:52.307 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:28:52.308 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:52.308 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:52.308 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:28:52.308 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:28:52.308 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 17:28:52.308 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:52.308 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - 204 null null 0.3768ms
2025-06-02 17:28:52.311 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 17:28:52.311 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:52.311 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:52.311 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:28:52.312 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:28:52.318 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:28:52.318 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:28:52.321 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:28:52.321 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 9.3442ms
2025-06-02 17:28:52.321 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:28:52.321 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 10.587ms
2025-06-02 17:28:52.324 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:28:52.324 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 15.9397ms
2025-06-02 17:28:52.324 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:28:52.324 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 16.9744ms
2025-06-02 17:28:54.479 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 17:28:54.479 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:54.479 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:28:54.480 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:28:54.480 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:28:54.502 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:28:54.503 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:28:54.503 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 23.2626ms
2025-06-02 17:28:54.503 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:28:54.507 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 27.9861ms
2025-06-02 17:29:01.553 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 17:29:01.554 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 17:29:01.575 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 17:29:01.576 +07:00 [ERR] Connection id "0HND1NELC21I6", Request id "0HND1NELC21I6:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 17:29:01.583 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - 101 null null 1828912.829ms
2025-06-02 17:29:44.942 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 17:29:44.946 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:29:44.946 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 17:29:44.971 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 17:29:44.977 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 17:29:44.978 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 31.5645ms
2025-06-02 17:29:44.978 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:29:44.978 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 35.8543ms
2025-06-02 17:29:45.737 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 17:29:45.737 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 17:29:46.161 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 17:29:46.161 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:29:46.161 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:29:46.176 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:29:46.178 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 17:29:46.178 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 17:29:46.178 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 17:29:46.178 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 17:29:46.179 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 17:29:46.179 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 17:29:46.179 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 17:29:46.179 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:29:46.179 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 17:29:46.179 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 17:29:46.179 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 17:29:46.179 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 17:29:46.179 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 17:29:46.180 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 17:29:46.180 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 17:29:46.180 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 17:29:46.180 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 17:29:46.180 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 17:29:46.180 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 17:29:46.181 +07:00 [INF] User 2 subscribed to channel conversation:54
2025-06-02 17:29:46.182 +07:00 [INF] User 2 subscribed to channel conversation:55
2025-06-02 17:29:46.182 +07:00 [INF] User 2 subscribed to channel conversation:56
2025-06-02 17:29:46.182 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:29:46.182 +07:00 [INF] User 2 subscribed to channel conversation:57
2025-06-02 17:29:46.182 +07:00 [INF] User 2 subscribed to channel conversation:58
2025-06-02 17:29:46.182 +07:00 [INF] User 2 subscribed to channel conversation:59
2025-06-02 17:29:46.183 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 21.4994ms
2025-06-02 17:29:46.183 +07:00 [INF] User 2 subscribed to channel conversation:60
2025-06-02 17:29:46.183 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:29:46.183 +07:00 [INF] User 2 subscribed to channel conversation:61
2025-06-02 17:29:46.183 +07:00 [INF] User 2 subscribed to channel conversation:62
2025-06-02 17:29:46.183 +07:00 [INF] User 2 subscribed to channel conversation:63
2025-06-02 17:29:46.183 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 21.9327ms
2025-06-02 17:29:46.183 +07:00 [INF] User 2 subscribed to channel conversation:64
2025-06-02 17:29:46.183 +07:00 [INF] User 2 subscribed to channel conversation:65
2025-06-02 17:29:46.183 +07:00 [INF] User 2 subscribed to channel conversation:66
2025-06-02 17:29:46.183 +07:00 [INF] User 2 subscribed to channel conversation:67
2025-06-02 17:29:46.188 +07:00 [INF] User 2 subscribed to channel conversation:68
2025-06-02 17:29:46.188 +07:00 [INF] User 2 subscribed to channel conversation:69
2025-06-02 17:29:46.345 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 17:29:46.345 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:29:46.345 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:29:46.364 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 17:29:46.457 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:29:46.631 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 284.8781ms
2025-06-02 17:29:46.632 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:29:46.632 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 286.5933ms
2025-06-02 17:29:51.055 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - null null
2025-06-02 17:29:51.055 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:29:51.055 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:29:51.058 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69
2025-06-02 17:29:51.058 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69 and user 2
2025-06-02 17:29:51.059 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:29:51.059 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 3.4274ms
2025-06-02 17:29:51.059 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:29:51.059 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - 200 null application/json; charset=utf-8 3.8525ms
2025-06-02 17:29:51.131 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 17:29:51.131 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:29:51.131 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:29:51.141 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:29:51.152 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:29:51.153 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 21.7523ms
2025-06-02 17:29:51.153 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:29:51.153 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 22.3978ms
2025-06-02 17:29:51.195 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:29:51.196 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:29:51.196 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:29:51.202 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:29:51.205 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:29:51.205 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.1302ms
2025-06-02 17:29:51.205 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:29:51.205 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 10.1887ms
2025-06-02 17:29:52.506 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:29:52.506 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:29:52.506 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:29:52.508 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - null null
2025-06-02 17:29:52.508 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:29:52.508 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:29:52.515 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:29:52.518 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:29:52.519 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:29:52.519 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 10.309ms
2025-06-02 17:29:52.519 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:29:52.519 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 10.9495ms
2025-06-02 17:29:52.521 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:29:52.521 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 14.9364ms
2025-06-02 17:29:52.521 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:29:52.521 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 15.3722ms
2025-06-02 17:29:58.788 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 17:29:58.789 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:29:58.789 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:29:58.799 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:29:58.803 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:29:58.803 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 14.3359ms
2025-06-02 17:29:58.803 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:29:58.803 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 14.6671ms
2025-06-02 17:31:03.987 +07:00 [INF] Request starting HTTP/1.1 PUT http://192.168.1.2:5053/api/GroupSetting/update - application/json 117
2025-06-02 17:31:03.987 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.UpdateGroupSetting (Message_app)'
2025-06-02 17:31:03.987 +07:00 [INF] Route matched with {action = "UpdateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:31:04.124 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__dto_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[AllowMemberEdit], [g].[AllowMemberInvite], [g].[AllowMemberRemove], [g].[ConversationId], [g].[CreatedAt], [g].[CreatedBy]
FROM [GroupSettings] AS [g]
WHERE [g].[Id] = @__dto_Id_0
2025-06-02 17:31:04.177 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 17:31:04.306 +07:00 [INF] Executed DbCommand (34ms) [Parameters=[@p6='?' (DbType = Int32), @p0='?' (DbType = Boolean), @p1='?' (DbType = Boolean), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [GroupSettings] SET [AllowMemberEdit] = @p0, [AllowMemberInvite] = @p1, [AllowMemberRemove] = @p2, [ConversationId] = @p3, [CreatedAt] = @p4, [CreatedBy] = @p5
OUTPUT 1
WHERE [Id] = @p6;
2025-06-02 17:31:04.316 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:31:04.342 +07:00 [INF] Executed action server.Controllers.GroupSettingController.UpdateGroupSetting (Message_app) in 355.4158ms
2025-06-02 17:31:04.343 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.UpdateGroupSetting (Message_app)'
2025-06-02 17:31:04.343 +07:00 [INF] Request finished HTTP/1.1 PUT http://192.168.1.2:5053/api/GroupSetting/update - 200 null application/json; charset=utf-8 356.8934ms
2025-06-02 17:31:36.571 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:31:36.572 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:31:36.572 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:31:36.577 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - null null
2025-06-02 17:31:36.577 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:31:36.577 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:31:36.591 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:31:36.592 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:31:36.592 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 14.4989ms
2025-06-02 17:31:36.592 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:31:36.592 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 15.3566ms
2025-06-02 17:31:36.593 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:31:36.598 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:31:36.599 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 26.9997ms
2025-06-02 17:31:36.599 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:31:36.599 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 27.4993ms
2025-06-02 17:31:51.996 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 17:31:51.996 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:51.996 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3814ms
2025-06-02 17:31:51.997 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-02 17:31:51.998 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:51.998 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:51.998 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:31:51.998 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 17:31:52.017 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 17:31:52.017 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 17:31:52.018 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 18.9789ms
2025-06-02 17:31:52.018 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:31:52.018 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 20.4979ms
2025-06-02 17:31:52.029 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 17:31:52.030 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:52.032 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:52.032 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 17:31:52.139 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 17:31:52.139 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:52.139 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:52.139 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:31:52.139 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:31:52.149 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:31:52.149 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-02 17:31:52.149 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:54
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:55
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:56
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:57
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:58
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:59
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:60
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:61
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:62
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:63
2025-06-02 17:31:52.150 +07:00 [INF] User 3 subscribed to channel conversation:64
2025-06-02 17:31:52.151 +07:00 [INF] User 3 subscribed to channel conversation:65
2025-06-02 17:31:52.151 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 17:31:52.151 +07:00 [INF] User 3 subscribed to channel conversation:67
2025-06-02 17:31:52.151 +07:00 [INF] User 3 subscribed to channel conversation:68
2025-06-02 17:31:52.151 +07:00 [INF] User 3 subscribed to channel conversation:69
2025-06-02 17:31:52.154 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:31:52.155 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:31:52.155 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 16.0791ms
2025-06-02 17:31:52.155 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:31:52.155 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 16.7522ms
2025-06-02 17:31:52.267 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 17:31:52.267 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:52.267 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.4579ms
2025-06-02 17:31:52.269 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 17:31:52.269 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:52.269 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:52.269 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:31:52.269 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:31:52.285 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 17:31:52.423 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:31:52.427 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 157.7665ms
2025-06-02 17:31:52.427 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:31:52.427 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 158.3598ms
2025-06-02 17:31:53.947 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 17:31:53.947 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:53.948 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - 204 null null 0.686ms
2025-06-02 17:31:53.949 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 17:31:53.951 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:53.951 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:53.951 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:31:53.951 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:31:53.958 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69
2025-06-02 17:31:53.959 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69 and user 3
2025-06-02 17:31:53.959 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:31:53.960 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 8.4885ms
2025-06-02 17:31:53.960 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:31:53.960 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - 200 null application/json; charset=utf-8 10.8442ms
2025-06-02 17:31:53.977 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 17:31:53.977 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:53.977 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - 204 null null 0.4043ms
2025-06-02 17:31:53.980 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 17:31:53.980 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:53.980 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:53.982 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:31:53.982 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:31:54.010 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:31:54.016 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:31:54.016 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 34.2644ms
2025-06-02 17:31:54.016 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:31:54.016 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 36.9091ms
2025-06-02 17:31:54.029 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:31:54.030 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:54.030 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - 204 null null 0.4293ms
2025-06-02 17:31:54.032 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:31:54.032 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:54.032 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:54.032 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:31:54.032 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:31:54.039 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:31:54.043 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:31:54.043 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 10.9389ms
2025-06-02 17:31:54.043 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:31:54.043 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 11.3857ms
2025-06-02 17:31:55.708 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 17:31:55.708 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:31:55.708 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:55.708 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:55.708 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - 204 null null 0.1534ms
2025-06-02 17:31:55.708 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:55.708 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:31:55.708 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:31:55.709 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 17:31:55.709 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:55.709 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:31:55.709 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:31:55.710 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:31:55.721 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:31:55.722 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:31:55.722 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 12.1919ms
2025-06-02 17:31:55.722 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:31:55.722 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 12.9698ms
2025-06-02 17:31:55.722 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:31:55.730 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:31:55.730 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 22.0578ms
2025-06-02 17:31:55.730 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:31:55.732 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 24.3528ms
2025-06-02 17:32:10.418 +07:00 [INF] Request starting HTTP/1.1 PUT http://192.168.1.2:5053/api/GroupSetting/update - application/json 116
2025-06-02 17:32:10.419 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.UpdateGroupSetting (Message_app)'
2025-06-02 17:32:10.419 +07:00 [INF] Route matched with {action = "UpdateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:32:10.428 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__dto_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[AllowMemberEdit], [g].[AllowMemberInvite], [g].[AllowMemberRemove], [g].[ConversationId], [g].[CreatedAt], [g].[CreatedBy]
FROM [GroupSettings] AS [g]
WHERE [g].[Id] = @__dto_Id_0
2025-06-02 17:32:10.443 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 17:32:10.469 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@p6='?' (DbType = Int32), @p0='?' (DbType = Boolean), @p1='?' (DbType = Boolean), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [GroupSettings] SET [AllowMemberEdit] = @p0, [AllowMemberInvite] = @p1, [AllowMemberRemove] = @p2, [ConversationId] = @p3, [CreatedAt] = @p4, [CreatedBy] = @p5
OUTPUT 1
WHERE [Id] = @p6;
2025-06-02 17:32:10.469 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:32:10.472 +07:00 [INF] Executed action server.Controllers.GroupSettingController.UpdateGroupSetting (Message_app) in 52.2947ms
2025-06-02 17:32:10.472 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.UpdateGroupSetting (Message_app)'
2025-06-02 17:32:10.472 +07:00 [INF] Request finished HTTP/1.1 PUT http://192.168.1.2:5053/api/GroupSetting/update - 200 null application/json; charset=utf-8 53.8963ms
2025-06-02 17:32:23.036 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:32:23.036 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:32:23.037 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - 204 null null 1.6574ms
2025-06-02 17:32:23.038 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:32:23.038 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:32:23.038 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:32:23.038 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:32:23.038 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:32:23.041 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 17:32:23.041 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:32:23.042 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - 204 null null 0.6498ms
2025-06-02 17:32:23.043 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 17:32:23.043 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:32:23.044 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:32:23.044 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:32:23.044 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:32:23.046 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:32:23.051 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:32:23.052 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:32:23.052 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 8.4131ms
2025-06-02 17:32:23.052 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:32:23.052 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 8.9862ms
2025-06-02 17:32:23.053 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:32:23.053 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 14.2619ms
2025-06-02 17:32:23.053 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:32:23.053 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 14.7444ms
2025-06-02 17:32:33.677 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/update_conversation_name/69 - null null
2025-06-02 17:32:33.677 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:32:33.677 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/update_conversation_name/69 - 204 null null 0.6357ms
2025-06-02 17:32:33.679 +07:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5053/api/Conversation/update_conversation_name/69 - application/json 13
2025-06-02 17:32:33.679 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:32:33.679 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:32:33.679 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.UpdateConversationName (Message_app)'
2025-06-02 17:32:33.708 +07:00 [INF] Route matched with {action = "UpdateConversationName", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateConversationName(Int32, System.String) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:32:33.736 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:32:33.752 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:32:33.791 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 17:32:33.825 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 17:32:33.851 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:32:33.851 +07:00 [INF] Executed action server.Controllers.ConversationController.UpdateConversationName (Message_app) in 143.4746ms
2025-06-02 17:32:33.851 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.UpdateConversationName (Message_app)'
2025-06-02 17:32:33.855 +07:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5053/api/Conversation/update_conversation_name/69 - 200 null application/json; charset=utf-8 176.6368ms
2025-06-02 17:41:02.458 +07:00 [INF] Executed DbCommand (40ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-02 17:41:02.598 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-02 17:41:02.652 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-02 17:41:02.662 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-02 17:41:02.662 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-02 17:41:02.663 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-02 17:41:02.663 +07:00 [INF] Hosting environment: Development
2025-06-02 17:41:02.663 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-02 17:41:02.743 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 17:41:02.768 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:41:02.787 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:41:02.788 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-02 17:41:02.814 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 17:41:04.812 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 17:41:04.816 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 17:41:07.057 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 17:41:07.058 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:41:07.058 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:41:07.059 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 17:50:28.726 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 17:50:28.726 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:28.731 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 3.9243ms
2025-06-02 17:50:28.736 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-02 17:50:28.737 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:28.741 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:28.742 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:50:28.794 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 17:50:29.110 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 17:50:29.306 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 17:50:29.434 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 632.9861ms
2025-06-02 17:50:29.435 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:50:29.441 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 704.5712ms
2025-06-02 17:50:29.447 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 17:50:29.448 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:29.449 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:29.449 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 17:50:29.542 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 17:50:29.543 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:29.545 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:29.546 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:50:29.555 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:50:29.656 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 17:50:29.657 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:29.657 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.5265ms
2025-06-02 17:50:29.660 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 17:50:29.661 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:29.663 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:29.664 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:50:29.670 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:50:29.687 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:50:29.711 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-02 17:50:29.714 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-02 17:50:29.715 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-02 17:50:29.719 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-02 17:50:29.721 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-02 17:50:29.722 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-02 17:50:29.723 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-02 17:50:29.723 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-02 17:50:29.724 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-02 17:50:29.726 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-02 17:50:29.729 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-02 17:50:29.729 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-02 17:50:29.730 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-02 17:50:29.731 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-02 17:50:29.731 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-02 17:50:29.733 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-02 17:50:29.734 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-02 17:50:29.735 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-02 17:50:29.736 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-02 17:50:29.736 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-02 17:50:29.738 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-02 17:50:29.739 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-02 17:50:29.741 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-02 17:50:29.742 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-02 17:50:29.743 +07:00 [INF] User 3 subscribed to channel conversation:54
2025-06-02 17:50:29.744 +07:00 [INF] User 3 subscribed to channel conversation:55
2025-06-02 17:50:29.747 +07:00 [INF] User 3 subscribed to channel conversation:56
2025-06-02 17:50:29.750 +07:00 [INF] User 3 subscribed to channel conversation:57
2025-06-02 17:50:29.754 +07:00 [INF] User 3 subscribed to channel conversation:58
2025-06-02 17:50:29.755 +07:00 [INF] User 3 subscribed to channel conversation:59
2025-06-02 17:50:29.755 +07:00 [INF] User 3 subscribed to channel conversation:60
2025-06-02 17:50:29.757 +07:00 [INF] User 3 subscribed to channel conversation:61
2025-06-02 17:50:29.758 +07:00 [INF] User 3 subscribed to channel conversation:62
2025-06-02 17:50:29.759 +07:00 [INF] User 3 subscribed to channel conversation:63
2025-06-02 17:50:29.768 +07:00 [INF] User 3 subscribed to channel conversation:64
2025-06-02 17:50:29.769 +07:00 [INF] User 3 subscribed to channel conversation:65
2025-06-02 17:50:29.769 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 17:50:29.770 +07:00 [INF] User 3 subscribed to channel conversation:67
2025-06-02 17:50:29.771 +07:00 [INF] User 3 subscribed to channel conversation:68
2025-06-02 17:50:29.772 +07:00 [INF] User 3 subscribed to channel conversation:69
2025-06-02 17:50:29.785 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:50:29.790 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:50:29.814 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 258.993ms
2025-06-02 17:50:29.815 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:50:29.815 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 272.4982ms
2025-06-02 17:50:29.823 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 17:50:29.927 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:50:29.954 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 283.4423ms
2025-06-02 17:50:29.954 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:50:29.955 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 294.6359ms
2025-06-02 17:50:37.323 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - null null
2025-06-02 17:50:37.324 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:50:37.328 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:50:37.393 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69
2025-06-02 17:50:37.398 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69 and user 2
2025-06-02 17:50:37.398 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:50:37.414 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 85.9321ms
2025-06-02 17:50:37.414 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:50:37.414 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - 200 null application/json; charset=utf-8 90.8737ms
2025-06-02 17:50:37.455 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 17:50:37.457 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:50:37.463 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:50:37.538 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:50:37.648 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:50:37.663 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 199.8053ms
2025-06-02 17:50:37.664 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:50:37.665 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 210.0197ms
2025-06-02 17:50:37.777 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:50:37.778 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:50:37.786 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:50:37.816 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:50:37.828 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:50:37.837 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 50.2473ms
2025-06-02 17:50:37.838 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:50:37.839 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 60.8643ms
2025-06-02 17:50:41.278 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/68/2 - null null
2025-06-02 17:50:41.280 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:50:41.280 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:50:41.287 +07:00 [INF] Retrieved 1 messages from Redis for conversation 68
2025-06-02 17:50:41.288 +07:00 [INF] Retrieved 1 messages from Redis for conversation 68 and user 2
2025-06-02 17:50:41.288 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:50:41.288 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 7.7532ms
2025-06-02 17:50:41.289 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:50:41.289 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/68/2 - 200 null application/json; charset=utf-8 10.3897ms
2025-06-02 17:50:41.311 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:50:41.313 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:50:41.314 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:50:41.347 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:50:41.354 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:50:41.355 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 38.0046ms
2025-06-02 17:50:41.355 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:50:41.355 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 44.1601ms
2025-06-02 17:50:41.386 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:50:41.388 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:50:41.389 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:50:41.398 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:50:41.412 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:50:41.426 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 36.4833ms
2025-06-02 17:50:41.426 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:50:41.426 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 39.8011ms
2025-06-02 17:50:43.450 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:50:43.450 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:50:43.451 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:50:43.454 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - null null
2025-06-02 17:50:43.454 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:50:43.461 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:50:43.470 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:50:43.473 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:50:43.474 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 22.9855ms
2025-06-02 17:50:43.474 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:50:43.474 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 23.7627ms
2025-06-02 17:50:43.491 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:50:43.507 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:50:43.524 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 61.3881ms
2025-06-02 17:50:43.524 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:50:43.524 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - 200 null application/json; charset=utf-8 70.3564ms
2025-06-02 17:50:46.961 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 17:50:46.964 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:50:46.964 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:50:47.001 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:50:47.009 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:50:47.010 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 45.6711ms
2025-06-02 17:50:47.010 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:50:47.010 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 48.5757ms
2025-06-02 17:50:51.685 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 17:50:51.685 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:51.685 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - 204 null null 0.4513ms
2025-06-02 17:50:51.687 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 17:50:51.687 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:51.687 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:51.687 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:50:51.687 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:50:51.691 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69
2025-06-02 17:50:51.691 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69 and user 3
2025-06-02 17:50:51.691 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:50:51.691 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 3.6358ms
2025-06-02 17:50:51.691 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:50:51.691 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - 200 null application/json; charset=utf-8 4.4551ms
2025-06-02 17:50:51.698 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 17:50:51.698 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:51.699 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - 204 null null 0.3356ms
2025-06-02 17:50:51.700 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 17:50:51.700 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:51.700 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:51.700 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:50:51.701 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:50:51.711 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:50:51.719 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:50:51.719 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 18.5554ms
2025-06-02 17:50:51.719 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:50:51.719 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 19.2626ms
2025-06-02 17:50:51.726 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:50:51.726 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:51.726 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - 204 null null 0.2883ms
2025-06-02 17:50:51.728 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:50:51.729 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:51.729 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:51.729 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:50:51.729 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:50:51.734 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:50:51.736 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:50:51.737 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.5204ms
2025-06-02 17:50:51.737 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:50:51.737 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 8.7887ms
2025-06-02 17:50:53.252 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 17:50:53.253 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:53.253 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - 204 null null 1.1495ms
2025-06-02 17:50:53.253 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:50:53.253 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:53.254 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:53.254 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:50:53.254 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:50:53.255 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 17:50:53.256 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:53.258 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:53.258 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:50:53.258 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:50:53.263 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:50:53.268 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:50:53.269 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 14.5245ms
2025-06-02 17:50:53.269 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:50:53.269 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 15.6257ms
2025-06-02 17:50:53.284 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:50:53.285 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:50:53.286 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 27.8136ms
2025-06-02 17:50:53.286 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:50:53.286 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 30.8937ms
2025-06-02 17:50:55.161 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 17:50:55.161 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:55.161 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:50:55.162 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:50:55.162 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:50:55.172 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:50:55.173 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:50:55.173 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.3135ms
2025-06-02 17:50:55.173 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:50:55.175 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 12.205ms
2025-06-02 17:51:05.179 +07:00 [INF] Request starting HTTP/1.1 DELETE http://192.168.1.2:5053/api/Participant/remove_member/231 - null null
2025-06-02 17:51:05.179 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.RemoveMember (Message_app)'
2025-06-02 17:51:05.185 +07:00 [INF] Route matched with {action = "RemoveMember", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RemoveMember(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:51:05.219 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__participantId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[id] = @__participantId_0
2025-06-02 17:51:05.377 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
DELETE FROM [Participants]
OUTPUT 1
WHERE [id] = @p0;
2025-06-02 17:51:05.408 +07:00 [INF] Published message to channel conversation:68
2025-06-02 17:51:05.421 +07:00 [INF] Unsubscribed user 3 from channel conversation:68
2025-06-02 17:51:05.427 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 17:51:05.428 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:51:05.432 +07:00 [INF] Executed action server.Controllers.ParticipantController.RemoveMember (Message_app) in 247.4315ms
2025-06-02 17:51:05.433 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.RemoveMember (Message_app)'
2025-06-02 17:51:05.433 +07:00 [INF] Request finished HTTP/1.1 DELETE http://192.168.1.2:5053/api/Participant/remove_member/231 - 200 null application/json; charset=utf-8 253.6127ms
2025-06-02 17:51:05.556 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:51:05.556 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:51:05.556 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:51:05.565 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:51:05.569 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:51:05.570 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 13.4037ms
2025-06-02 17:51:05.570 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:51:05.570 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 14.3807ms
2025-06-02 17:51:31.171 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 17:51:31.172 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:31.172 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - 204 null null 0.4828ms
2025-06-02 17:51:31.175 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 17:51:31.175 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:31.175 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:31.175 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:51:31.175 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:51:31.181 +07:00 [INF] Retrieved 1 messages from Redis for conversation 68
2025-06-02 17:51:31.181 +07:00 [INF] Retrieved 1 messages from Redis for conversation 68 and user 3
2025-06-02 17:51:31.181 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:51:31.182 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 6.4893ms
2025-06-02 17:51:31.182 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:51:31.182 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - 200 null application/json; charset=utf-8 7.3083ms
2025-06-02 17:51:31.189 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:51:31.189 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:31.189 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - 204 null null 0.372ms
2025-06-02 17:51:31.192 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:51:31.192 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:31.192 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:31.192 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:51:31.193 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:51:31.212 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:51:31.221 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:51:31.221 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 28.3734ms
2025-06-02 17:51:31.221 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:51:31.221 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 29.5004ms
2025-06-02 17:51:31.233 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:51:31.233 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:31.233 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - 204 null null 0.5281ms
2025-06-02 17:51:31.236 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:51:31.236 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:31.236 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:31.236 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:51:31.236 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:51:31.243 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:51:31.249 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:51:31.250 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 13.1366ms
2025-06-02 17:51:31.250 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:51:31.250 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 13.9946ms
2025-06-02 17:51:34.307 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - null null
2025-06-02 17:51:34.307 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:51:34.307 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:51:34.310 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69
2025-06-02 17:51:34.310 +07:00 [INF] Retrieved 2 messages from Redis for conversation 69 and user 2
2025-06-02 17:51:34.310 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:51:34.310 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.8861ms
2025-06-02 17:51:34.310 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:51:34.311 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - 200 null application/json; charset=utf-8 3.536ms
2025-06-02 17:51:34.346 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 17:51:34.347 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:51:34.348 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:51:34.364 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:51:34.369 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:51:34.369 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 21.2205ms
2025-06-02 17:51:34.369 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:51:34.370 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 23.0978ms
2025-06-02 17:51:34.432 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:51:34.432 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:51:34.432 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:51:34.444 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:51:34.448 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:51:34.448 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 16.2624ms
2025-06-02 17:51:34.449 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:51:34.449 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 17.2396ms
2025-06-02 17:51:36.887 +07:00 [INF] Handling message from user 2: ok
2025-06-02 17:51:36.928 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 17:51:37.061 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:51:37.101 +07:00 [INF] Executed DbCommand (39ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 17:51:37.120 +07:00 [INF] Message saved to DB with ID: 452
2025-06-02 17:51:37.124 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:51:37.145 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 17:51:37.159 +07:00 [INF] Transaction committed for message: 452
2025-06-02 17:51:37.174 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:51:37.188 +07:00 [INF] Saved message 452 to Redis
2025-06-02 17:51:37.193 +07:00 [INF] Added message 452 to conversation 69
2025-06-02 17:51:37.194 +07:00 [INF] Published message to channel conversation:69
2025-06-02 17:51:41.991 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/68/2 - null null
2025-06-02 17:51:41.992 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:51:41.992 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:51:41.996 +07:00 [INF] Retrieved 1 messages from Redis for conversation 68
2025-06-02 17:51:41.996 +07:00 [INF] Retrieved 1 messages from Redis for conversation 68 and user 2
2025-06-02 17:51:41.996 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:51:41.996 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 3.9529ms
2025-06-02 17:51:41.996 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:51:41.997 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/68/2 - 200 null application/json; charset=utf-8 5.0207ms
2025-06-02 17:51:42.020 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:51:42.021 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:51:42.022 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:51:42.041 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:51:42.043 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:51:42.044 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 21.2694ms
2025-06-02 17:51:42.044 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:51:42.044 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 23.9962ms
2025-06-02 17:51:42.076 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:51:42.077 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:51:42.077 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:51:42.083 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:51:42.089 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:51:42.089 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 12.1842ms
2025-06-02 17:51:42.089 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:51:42.089 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 12.8709ms
2025-06-02 17:51:44.813 +07:00 [INF] Handling message from user 2: gg
2025-06-02 17:51:44.822 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 17:51:44.829 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:51:44.837 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 17:51:44.837 +07:00 [INF] Message saved to DB with ID: 453
2025-06-02 17:51:44.838 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:51:44.844 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 17:51:44.846 +07:00 [INF] Transaction committed for message: 453
2025-06-02 17:51:44.852 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:51:44.853 +07:00 [INF] Saved message 453 to Redis
2025-06-02 17:51:44.854 +07:00 [INF] Added message 453 to conversation 68
2025-06-02 17:51:44.854 +07:00 [INF] Published message to channel conversation:68
2025-06-02 17:51:50.733 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 17:51:50.733 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:50.733 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - 204 null null 0.421ms
2025-06-02 17:51:50.734 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 17:51:50.734 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:50.734 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:50.735 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:51:50.735 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:51:50.737 +07:00 [INF] Retrieved 2 messages from Redis for conversation 68
2025-06-02 17:51:50.737 +07:00 [INF] Retrieved 2 messages from Redis for conversation 68 and user 3
2025-06-02 17:51:50.737 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:51:50.737 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.1649ms
2025-06-02 17:51:50.737 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:51:50.737 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - 200 null application/json; charset=utf-8 3.0718ms
2025-06-02 17:51:50.742 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:51:50.742 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:50.742 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - 204 null null 0.3034ms
2025-06-02 17:51:50.743 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:51:50.744 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:50.744 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:50.744 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:51:50.744 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:51:50.761 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:51:50.766 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:51:50.766 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 22.4202ms
2025-06-02 17:51:50.766 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:51:50.767 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 23.1885ms
2025-06-02 17:51:50.776 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:51:50.776 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:50.776 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - 204 null null 0.2053ms
2025-06-02 17:51:50.777 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:51:50.777 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:50.777 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:51:50.778 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:51:50.778 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:51:50.783 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:51:50.785 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:51:50.786 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.0573ms
2025-06-02 17:51:50.786 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:51:50.786 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 8.7466ms
2025-06-02 17:52:07.693 +07:00 [INF] Application is shutting down...
2025-06-02 17:52:13.303 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 17:52:13.304 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 17:52:13.315 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 17:52:13.316 +07:00 [ERR] Connection id "0HND1O7S8OOUJ", Request id "0HND1O7S8OOUJ:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 17:52:13.319 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - 101 null null 668506.9302ms
2025-06-02 17:52:20.743 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 17:52:20.743 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 678003.0568ms
2025-06-02 17:52:20.744 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 17:52:20.744 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 673687.3821ms
2025-06-02 17:52:20.747 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 17:52:20.747 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 17:52:20.749 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 17:52:20.749 +07:00 [ERR] Connection id "0HND1O7S8OOUM", Request id "0HND1O7S8OOUM:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 17:52:20.751 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 111303.6092ms
2025-06-02 17:52:28.178 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-02 17:52:28.328 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-02 17:52:28.393 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-02 17:52:28.401 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-02 17:52:28.402 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-02 17:52:28.402 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-02 17:52:28.402 +07:00 [INF] Hosting environment: Development
2025-06-02 17:52:28.402 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-02 17:53:54.574 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 17:53:54.659 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:53:54.680 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 113.4513ms
2025-06-02 17:53:54.688 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-02 17:53:54.690 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:53:54.745 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:53:54.747 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-02 17:53:54.817 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:53:54.866 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 17:53:55.344 +07:00 [INF] Executed DbCommand (114ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 17:53:55.546 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 17:53:55.645 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 773.1803ms
2025-06-02 17:53:55.645 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:53:55.654 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 966.4314ms
2025-06-02 17:53:55.658 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 17:53:55.671 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:53:55.672 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:53:55.674 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 17:53:55.777 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 17:53:55.778 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:53:55.780 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:53:55.783 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:53:55.793 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:53:55.962 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 17:53:55.963 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:53:55.964 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 1.4826ms
2025-06-02 17:53:55.966 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 17:53:55.967 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:53:55.967 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:53:55.967 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:53:55.983 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:53:56.011 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:53:56.041 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-02 17:53:56.042 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-02 17:53:56.045 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-02 17:53:56.046 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-02 17:53:56.047 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-02 17:53:56.049 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-02 17:53:56.051 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-02 17:53:56.052 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-02 17:53:56.054 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-02 17:53:56.055 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-02 17:53:56.055 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-02 17:53:56.056 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-02 17:53:56.057 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-02 17:53:56.057 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:53:56.058 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-02 17:53:56.059 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-02 17:53:56.060 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:53:56.061 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-02 17:53:56.062 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-02 17:53:56.064 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-02 17:53:56.065 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-02 17:53:56.067 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-02 17:53:56.070 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-02 17:53:56.071 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-02 17:53:56.073 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-02 17:53:56.073 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-02 17:53:56.074 +07:00 [INF] User 3 subscribed to channel conversation:54
2025-06-02 17:53:56.075 +07:00 [INF] User 3 subscribed to channel conversation:55
2025-06-02 17:53:56.075 +07:00 [INF] User 3 subscribed to channel conversation:56
2025-06-02 17:53:56.077 +07:00 [INF] User 3 subscribed to channel conversation:57
2025-06-02 17:53:56.080 +07:00 [INF] User 3 subscribed to channel conversation:58
2025-06-02 17:53:56.081 +07:00 [INF] User 3 subscribed to channel conversation:59
2025-06-02 17:53:56.082 +07:00 [INF] User 3 subscribed to channel conversation:60
2025-06-02 17:53:56.084 +07:00 [INF] User 3 subscribed to channel conversation:61
2025-06-02 17:53:56.086 +07:00 [INF] User 3 subscribed to channel conversation:62
2025-06-02 17:53:56.088 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 294.0461ms
2025-06-02 17:53:56.088 +07:00 [INF] User 3 subscribed to channel conversation:63
2025-06-02 17:53:56.088 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:53:56.088 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 310.9938ms
2025-06-02 17:53:56.089 +07:00 [INF] User 3 subscribed to channel conversation:64
2025-06-02 17:53:56.089 +07:00 [INF] User 3 subscribed to channel conversation:65
2025-06-02 17:53:56.090 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 17:53:56.090 +07:00 [INF] User 3 subscribed to channel conversation:67
2025-06-02 17:53:56.091 +07:00 [INF] User 3 subscribed to channel conversation:69
2025-06-02 17:53:56.140 +07:00 [INF] Executed DbCommand (45ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 17:53:56.271 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:53:56.295 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 312.1237ms
2025-06-02 17:53:56.296 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:53:56.296 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 329.9869ms
2025-06-02 17:56:18.327 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 17:56:18.376 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:56:18.386 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 17:56:18.568 +07:00 [INF] Executed DbCommand (90ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 17:56:18.607 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 17:56:18.611 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 223.7555ms
2025-06-02 17:56:18.611 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 17:56:18.613 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 289.0696ms
2025-06-02 17:56:19.242 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 17:56:19.248 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 17:56:19.788 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 17:56:19.793 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:56:19.794 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:56:19.864 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:56:19.874 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:56:19.874 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 80.2102ms
2025-06-02 17:56:19.874 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:56:19.875 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 87.402ms
2025-06-02 17:56:19.911 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:56:19.916 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 17:56:19.917 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 17:56:19.928 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 17:56:19.929 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 17:56:19.929 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 17:56:19.930 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 17:56:19.930 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 17:56:19.930 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 17:56:19.931 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 17:56:19.931 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 17:56:19.932 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 17:56:19.932 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 17:56:19.932 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 17:56:19.932 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 17:56:19.932 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 17:56:19.933 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 17:56:19.933 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 17:56:19.934 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 17:56:19.934 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 17:56:19.934 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 17:56:19.934 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 17:56:19.934 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 17:56:19.934 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 17:56:19.935 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 17:56:19.939 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 17:56:19.940 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 17:56:19.941 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 17:56:19.941 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 17:56:19.941 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 17:56:19.943 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 17:56:19.944 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 17:56:19.944 +07:00 [INF] User 2 subscribed to channel conversation:54
2025-06-02 17:56:19.944 +07:00 [INF] User 2 subscribed to channel conversation:55
2025-06-02 17:56:19.944 +07:00 [INF] User 2 subscribed to channel conversation:56
2025-06-02 17:56:19.944 +07:00 [INF] User 2 subscribed to channel conversation:57
2025-06-02 17:56:19.944 +07:00 [INF] User 2 subscribed to channel conversation:58
2025-06-02 17:56:19.944 +07:00 [INF] User 2 subscribed to channel conversation:59
2025-06-02 17:56:19.944 +07:00 [INF] User 2 subscribed to channel conversation:60
2025-06-02 17:56:19.945 +07:00 [INF] User 2 subscribed to channel conversation:61
2025-06-02 17:56:19.945 +07:00 [INF] User 2 subscribed to channel conversation:62
2025-06-02 17:56:19.945 +07:00 [INF] User 2 subscribed to channel conversation:63
2025-06-02 17:56:19.945 +07:00 [INF] User 2 subscribed to channel conversation:64
2025-06-02 17:56:19.945 +07:00 [INF] User 2 subscribed to channel conversation:65
2025-06-02 17:56:19.945 +07:00 [INF] User 2 subscribed to channel conversation:66
2025-06-02 17:56:19.945 +07:00 [INF] User 2 subscribed to channel conversation:67
2025-06-02 17:56:19.946 +07:00 [INF] User 2 subscribed to channel conversation:68
2025-06-02 17:56:19.946 +07:00 [INF] User 2 subscribed to channel conversation:69
2025-06-02 17:56:20.192 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 17:56:20.194 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:56:20.194 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:56:20.239 +07:00 [INF] Executed DbCommand (41ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 17:56:20.338 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:56:20.469 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 274.4516ms
2025-06-02 17:56:20.469 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 17:56:20.470 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 277.4782ms
2025-06-02 17:56:26.633 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/68/2 - null null
2025-06-02 17:56:26.635 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:56:26.656 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:56:26.763 +07:00 [INF] Retrieved 2 messages from Redis for conversation 68
2025-06-02 17:56:26.768 +07:00 [INF] Retrieved 2 messages from Redis for conversation 68 and user 2
2025-06-02 17:56:26.769 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:56:26.776 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 119.1973ms
2025-06-02 17:56:26.776 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:56:26.776 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/68/2 - 200 null application/json; charset=utf-8 142.7374ms
2025-06-02 17:56:26.857 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:56:26.857 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:56:26.860 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:56:26.998 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:56:27.100 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:56:27.108 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 247.5378ms
2025-06-02 17:56:27.108 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:56:27.108 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 251.4379ms
2025-06-02 17:56:27.150 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:56:27.150 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:56:27.158 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:56:27.178 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:56:27.182 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:56:27.189 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 30.219ms
2025-06-02 17:56:27.189 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:56:27.189 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 39.4567ms
2025-06-02 17:56:31.131 +07:00 [INF] Handling message from user 2: hehe
2025-06-02 17:56:31.177 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 17:56:31.440 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:56:31.470 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 17:56:31.505 +07:00 [INF] Message saved to DB with ID: 454
2025-06-02 17:56:31.509 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:56:31.517 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 17:56:31.535 +07:00 [INF] Transaction committed for message: 454
2025-06-02 17:56:31.549 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:56:31.571 +07:00 [INF] Saved message 454 to Redis
2025-06-02 17:56:31.575 +07:00 [INF] Added message 454 to conversation 68
2025-06-02 17:56:31.587 +07:00 [INF] Published message to channel conversation:68
2025-06-02 17:56:35.411 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:56:35.427 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:56:35.427 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:56:35.433 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:56:35.436 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:56:35.437 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.2472ms
2025-06-02 17:56:35.437 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:56:35.438 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 25.8669ms
2025-06-02 17:56:35.450 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - null null
2025-06-02 17:56:35.450 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:56:35.467 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:56:35.529 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:56:35.530 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:56:35.536 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 69.1845ms
2025-06-02 17:56:35.537 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:56:35.537 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - 200 null application/json; charset=utf-8 87.0882ms
2025-06-02 17:56:37.358 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 17:56:37.359 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:56:37.359 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:56:37.361 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:56:37.366 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:56:37.366 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 7.6487ms
2025-06-02 17:56:37.367 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:56:37.367 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 8.6833ms
2025-06-02 17:56:39.689 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Participant/add_member/68/3 - null 0
2025-06-02 17:56:39.689 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.AddMember (Message_app)'
2025-06-02 17:56:39.698 +07:00 [INF] Route matched with {action = "AddMember", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddMember(Int32, Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:56:39.750 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Conversations] AS [c]
        WHERE [c].[id] = @__conversation_id_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-06-02 17:56:39.766 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__user_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] = @__user_id_0
2025-06-02 17:56:39.779 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32), @__user_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[user_id] = @__user_id_1) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-06-02 17:56:39.800 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Participants] ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 17:56:39.804 +07:00 [INF] User 3 subscribed to channel conversation:68
2025-06-02 17:56:39.808 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 17:56:39.824 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType19`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:56:39.827 +07:00 [INF] Executed action server.Controllers.ParticipantController.AddMember (Message_app) in 126.4506ms
2025-06-02 17:56:39.827 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.AddMember (Message_app)'
2025-06-02 17:56:39.828 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Participant/add_member/68/3 - 200 null application/json; charset=utf-8 139.2578ms
2025-06-02 17:56:40.001 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:56:40.002 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:56:40.002 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:56:40.005 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:56:40.007 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:56:40.008 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.754ms
2025-06-02 17:56:40.008 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:56:40.008 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 6.5224ms
2025-06-02 17:56:40.061 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversationDto/3/68 - null null
2025-06-02 17:56:40.062 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:56:40.062 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversationDto/3/68 - 204 null null 1.013ms
2025-06-02 17:56:40.064 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/3/68 - null null
2025-06-02 17:56:40.064 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:56:40.065 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:56:40.065 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 17:56:40.071 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:56:40.104 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 17:56:40.118 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 17:56:40.118 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 46.546ms
2025-06-02 17:56:40.118 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 17:56:40.119 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/3/68 - 200 null application/json; charset=utf-8 54.2471ms
2025-06-02 17:56:49.182 +07:00 [INF] Handling message from user 2: ok
2025-06-02 17:56:49.190 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 17:56:49.201 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:56:49.208 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 17:56:49.208 +07:00 [INF] Message saved to DB with ID: 455
2025-06-02 17:56:49.210 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:56:49.215 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 17:56:49.216 +07:00 [INF] Transaction committed for message: 455
2025-06-02 17:56:49.222 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:56:49.230 +07:00 [INF] Saved message 455 to Redis
2025-06-02 17:56:49.231 +07:00 [INF] Added message 455 to conversation 68
2025-06-02 17:56:49.232 +07:00 [INF] Published message to channel conversation:68
2025-06-02 17:56:52.109 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 17:56:52.109 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:56:52.118 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - 204 null null 8.3956ms
2025-06-02 17:56:52.121 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 17:56:52.123 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:56:52.125 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:56:52.125 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:56:52.125 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:56:52.133 +07:00 [INF] Retrieved 4 messages from Redis for conversation 68
2025-06-02 17:56:52.133 +07:00 [INF] Retrieved 4 messages from Redis for conversation 68 and user 3
2025-06-02 17:56:52.133 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:56:52.133 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 7.6939ms
2025-06-02 17:56:52.134 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:56:52.134 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - 200 null application/json; charset=utf-8 13.4571ms
2025-06-02 17:56:52.157 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:56:52.157 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:56:52.158 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - 204 null null 0.5534ms
2025-06-02 17:56:52.160 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:56:52.160 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:56:52.160 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:56:52.160 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:56:52.160 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:56:52.167 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:56:52.170 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:56:52.170 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.6998ms
2025-06-02 17:56:52.170 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:56:52.170 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 10.7485ms
2025-06-02 17:56:52.180 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:56:52.180 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:56:52.180 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - 204 null null 0.3521ms
2025-06-02 17:56:52.182 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:56:52.182 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:56:52.182 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:56:52.182 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:56:52.182 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:56:52.187 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:56:52.191 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:56:52.191 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.0092ms
2025-06-02 17:56:52.192 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:56:52.192 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 10.4631ms
2025-06-02 17:56:58.424 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - null null
2025-06-02 17:56:58.426 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:56:58.426 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:56:58.426 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:56:58.427 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:56:58.427 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:56:58.434 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:56:58.437 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:56:58.437 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 10.7139ms
2025-06-02 17:56:58.437 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:56:58.437 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 11.4757ms
2025-06-02 17:56:58.442 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:56:58.442 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:56:58.442 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 15.2539ms
2025-06-02 17:56:58.442 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:56:58.443 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/68 - 200 null application/json; charset=utf-8 19.2928ms
2025-06-02 17:57:00.794 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 17:57:00.795 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:57:00.795 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:57:00.815 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:57:00.817 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:57:00.817 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 22.0984ms
2025-06-02 17:57:00.817 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:57:00.817 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 22.7318ms
2025-06-02 17:57:05.965 +07:00 [INF] Request starting HTTP/1.1 DELETE http://192.168.1.2:5053/api/Participant/remove_member/236 - null null
2025-06-02 17:57:05.965 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.RemoveMember (Message_app)'
2025-06-02 17:57:05.970 +07:00 [INF] Route matched with {action = "RemoveMember", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RemoveMember(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:57:06.009 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__participantId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[id] = @__participantId_0
2025-06-02 17:57:06.042 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
DELETE FROM [Participants]
OUTPUT 1
WHERE [id] = @p0;
2025-06-02 17:57:06.051 +07:00 [INF] Published message to channel conversation:68
2025-06-02 17:57:06.073 +07:00 [INF] Unsubscribed user 3 from channel conversation:68
2025-06-02 17:57:06.077 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 17:57:06.078 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:57:06.081 +07:00 [INF] Executed action server.Controllers.ParticipantController.RemoveMember (Message_app) in 110.1572ms
2025-06-02 17:57:06.081 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.RemoveMember (Message_app)'
2025-06-02 17:57:06.081 +07:00 [INF] Request finished HTTP/1.1 DELETE http://192.168.1.2:5053/api/Participant/remove_member/236 - 200 null application/json; charset=utf-8 116.4897ms
2025-06-02 17:57:06.221 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:57:06.223 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:57:06.223 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:57:06.228 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:57:06.234 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:57:06.236 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 12.7945ms
2025-06-02 17:57:06.239 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:57:06.240 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 18.8571ms
2025-06-02 17:57:22.353 +07:00 [INF] Handling message from user 2: âttta
2025-06-02 17:57:22.359 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 17:57:22.391 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:57:22.399 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 17:57:22.399 +07:00 [INF] Message saved to DB with ID: 456
2025-06-02 17:57:22.400 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:57:22.406 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 17:57:22.411 +07:00 [INF] Transaction committed for message: 456
2025-06-02 17:57:22.416 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:57:22.418 +07:00 [INF] Saved message 456 to Redis
2025-06-02 17:57:22.419 +07:00 [INF] Added message 456 to conversation 68
2025-06-02 17:57:22.423 +07:00 [INF] Published message to channel conversation:68
2025-06-02 17:57:25.750 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 17:57:25.750 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:57:25.750 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - 204 null null 0.4378ms
2025-06-02 17:57:25.754 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 17:57:25.755 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:57:25.755 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:57:25.756 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:57:25.756 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:57:25.854 +07:00 [INF] Retrieved 5 messages from Redis for conversation 68
2025-06-02 17:57:25.855 +07:00 [INF] Retrieved 5 messages from Redis for conversation 68 and user 3
2025-06-02 17:57:25.855 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:57:25.855 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 98.7516ms
2025-06-02 17:57:25.855 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:57:25.855 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - 200 null application/json; charset=utf-8 100.8464ms
2025-06-02 17:57:25.866 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:57:25.866 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:57:25.867 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - 204 null null 0.4446ms
2025-06-02 17:57:25.873 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 17:57:25.874 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:57:25.874 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:57:25.874 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:57:25.880 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:57:25.889 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:57:25.893 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:57:25.897 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 16.4596ms
2025-06-02 17:57:25.897 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:57:25.897 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 23.696ms
2025-06-02 17:57:25.910 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:57:25.910 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:57:25.910 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - 204 null null 0.4633ms
2025-06-02 17:57:25.913 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 17:57:25.913 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:57:25.913 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:57:25.914 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:57:25.914 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:57:25.921 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:57:25.925 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:57:25.925 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 11.0019ms
2025-06-02 17:57:25.925 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:57:25.925 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 12.207ms
2025-06-02 17:57:34.081 +07:00 [INF] Handling message from user 2: đ
2025-06-02 17:57:34.084 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 17:57:34.085 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:57:34.095 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 17:57:34.096 +07:00 [INF] Message saved to DB with ID: 457
2025-06-02 17:57:34.099 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 17:57:34.106 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 17:57:34.109 +07:00 [INF] Transaction committed for message: 457
2025-06-02 17:57:34.114 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 17:57:34.137 +07:00 [INF] Saved message 457 to Redis
2025-06-02 17:57:34.141 +07:00 [INF] Added message 457 to conversation 68
2025-06-02 17:57:34.144 +07:00 [INF] Published message to channel conversation:68
2025-06-02 17:59:05.013 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - null null
2025-06-02 17:59:05.014 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:59:05.014 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:59:05.015 +07:00 [INF] Retrieved 3 messages from Redis for conversation 69
2025-06-02 17:59:05.016 +07:00 [INF] Retrieved 3 messages from Redis for conversation 69 and user 2
2025-06-02 17:59:05.016 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:59:05.016 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.6811ms
2025-06-02 17:59:05.016 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:59:05.016 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/69/2 - 200 null application/json; charset=utf-8 3.2742ms
2025-06-02 17:59:05.042 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 17:59:05.042 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:59:05.042 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:59:05.060 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:59:05.070 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:59:05.071 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 28.9608ms
2025-06-02 17:59:05.071 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:59:05.071 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 29.9625ms
2025-06-02 17:59:05.114 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:59:05.114 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:59:05.114 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:59:05.120 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:59:05.123 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:59:05.125 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 10.4533ms
2025-06-02 17:59:05.125 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:59:05.125 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 11.4457ms
2025-06-02 17:59:07.008 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - null null
2025-06-02 17:59:07.009 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:59:07.009 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:59:07.012 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:59:07.012 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:59:07.012 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:59:07.015 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:59:07.016 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:59:07.016 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 6.9824ms
2025-06-02 17:59:07.016 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:59:07.016 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 7.658ms
2025-06-02 17:59:07.016 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:59:07.019 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:59:07.020 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.285ms
2025-06-02 17:59:07.020 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:59:07.020 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 8.1881ms
2025-06-02 17:59:08.319 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 17:59:08.320 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:59:08.321 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:59:08.346 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:59:08.353 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:59:08.354 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 32.8238ms
2025-06-02 17:59:08.354 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:59:08.356 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 36.464ms
2025-06-02 17:59:15.050 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 17:59:15.051 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:15.051 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - 204 null null 1.1462ms
2025-06-02 17:59:15.059 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 17:59:15.059 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:15.063 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:15.064 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:59:15.064 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 17:59:15.069 +07:00 [INF] Retrieved 3 messages from Redis for conversation 69
2025-06-02 17:59:15.070 +07:00 [INF] Retrieved 3 messages from Redis for conversation 69 and user 3
2025-06-02 17:59:15.070 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:59:15.070 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 6.1975ms
2025-06-02 17:59:15.070 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 17:59:15.070 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - 200 null application/json; charset=utf-8 11.4733ms
2025-06-02 17:59:15.082 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 17:59:15.082 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:15.082 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - 204 null null 0.4151ms
2025-06-02 17:59:15.084 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 17:59:15.084 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:15.084 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:15.085 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:59:15.085 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 17:59:15.090 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 17:59:15.093 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 17:59:15.094 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.7633ms
2025-06-02 17:59:15.094 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 17:59:15.094 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 10.195ms
2025-06-02 17:59:15.105 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:59:15.105 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:15.105 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - 204 null null 0.3398ms
2025-06-02 17:59:15.106 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:59:15.107 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:15.107 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:15.107 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:59:15.107 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:59:15.111 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:59:15.114 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:59:15.114 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.98ms
2025-06-02 17:59:15.114 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:59:15.114 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 8.0877ms
2025-06-02 17:59:16.909 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 17:59:16.910 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:16.910 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:59:16.910 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/69 - 204 null null 0.3785ms
2025-06-02 17:59:16.910 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:16.910 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:16.910 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:59:16.911 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:59:16.911 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - null null
2025-06-02 17:59:16.912 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:16.912 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:16.912 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:59:16.912 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 17:59:16.915 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:59:16.916 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 17:59:16.916 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 17:59:16.917 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 4.9785ms
2025-06-02 17:59:16.917 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 17:59:16.917 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/69 - 200 null application/json; charset=utf-8 5.7077ms
2025-06-02 17:59:16.921 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:59:16.922 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 11.09ms
2025-06-02 17:59:16.922 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:59:16.922 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 12.7243ms
2025-06-02 17:59:18.903 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 17:59:18.903 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:18.904 +07:00 [INF] CORS policy execution successful.
2025-06-02 17:59:18.904 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:59:18.904 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 17:59:18.912 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 17:59:18.913 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:59:18.913 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 8.9402ms
2025-06-02 17:59:18.913 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 17:59:18.913 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 9.8181ms
2025-06-02 17:59:32.199 +07:00 [INF] Request starting HTTP/1.1 DELETE http://192.168.1.2:5053/api/Participant/remove_member/234 - null null
2025-06-02 17:59:32.200 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.RemoveMember (Message_app)'
2025-06-02 17:59:32.200 +07:00 [INF] Route matched with {action = "RemoveMember", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RemoveMember(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:59:32.207 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__participantId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[id] = @__participantId_0
2025-06-02 17:59:32.219 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
DELETE FROM [Participants]
OUTPUT 1
WHERE [id] = @p0;
2025-06-02 17:59:32.223 +07:00 [INF] Published message to channel conversation:69
2025-06-02 17:59:32.223 +07:00 [INF] Unsubscribed user 3 from channel conversation:69
2025-06-02 17:59:32.233 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 17:59:32.233 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:59:32.233 +07:00 [INF] Executed action server.Controllers.ParticipantController.RemoveMember (Message_app) in 33.0369ms
2025-06-02 17:59:32.233 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.RemoveMember (Message_app)'
2025-06-02 17:59:32.234 +07:00 [INF] Request finished HTTP/1.1 DELETE http://192.168.1.2:5053/api/Participant/remove_member/234 - 200 null application/json; charset=utf-8 34.3127ms
2025-06-02 17:59:32.417 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - null null
2025-06-02 17:59:32.418 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:59:32.418 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 17:59:32.424 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 17:59:32.427 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 17:59:32.428 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.5449ms
2025-06-02 17:59:32.430 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 17:59:32.430 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 12.5441ms
2025-06-02 18:05:06.104 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 18:05:06.105 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:06.105 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/69/3 - 204 null null 0.3372ms
2025-06-02 18:05:06.106 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - null null
2025-06-02 18:05:06.106 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:06.106 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:06.107 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 18:05:06.109 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 18:05:06.133 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__conversationId_0='?' (DbType = Int64), @__user_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE CAST([p].[conversation_id] AS bigint) = @__conversationId_0 AND [p].[user_id] = @__user_id_1
2025-06-02 18:05:06.133 +07:00 [WRN] Participant not found for conversation 69 and user 3
2025-06-02 18:05:06.135 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-02 18:05:06.136 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 26.8741ms
2025-06-02 18:05:06.137 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 18:05:06.137 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/69/3 - 500 null text/plain; charset=utf-8 30.3535ms
2025-06-02 18:05:06.154 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 18:05:06.154 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:06.154 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/69 - 204 null null 0.3261ms
2025-06-02 18:05:06.155 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - null null
2025-06-02 18:05:06.156 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:06.157 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:06.157 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 18:05:06.160 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 18:05:06.166 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 18:05:06.168 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 18:05:06.174 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 14.3396ms
2025-06-02 18:05:06.174 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 18:05:06.174 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/69 - 200 null application/json; charset=utf-8 18.6952ms
2025-06-02 18:05:06.181 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 18:05:06.181 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:06.181 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/69 - 204 null null 0.1535ms
2025-06-02 18:05:06.182 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - null null
2025-06-02 18:05:06.183 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:06.183 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:06.183 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:05:06.186 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:05:06.190 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 18:05:06.192 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:05:06.193 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.8083ms
2025-06-02 18:05:06.193 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:05:06.193 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/69 - 200 null application/json; charset=utf-8 10.7724ms
2025-06-02 18:05:11.532 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 18:05:11.532 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:11.532 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - 204 null null 0.3858ms
2025-06-02 18:05:11.534 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 18:05:11.534 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:11.535 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:11.536 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 18:05:11.536 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 18:05:11.544 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversationId_0='?' (DbType = Int64), @__user_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE CAST([p].[conversation_id] AS bigint) = @__conversationId_0 AND [p].[user_id] = @__user_id_1
2025-06-02 18:05:11.544 +07:00 [WRN] Participant not found for conversation 68 and user 3
2025-06-02 18:05:11.545 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-02 18:05:11.545 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 9.2748ms
2025-06-02 18:05:11.545 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 18:05:11.545 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - 500 null text/plain; charset=utf-8 11.5477ms
2025-06-02 18:05:11.555 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 18:05:11.555 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:11.556 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - 204 null null 0.2375ms
2025-06-02 18:05:11.557 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 18:05:11.557 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:11.558 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:11.558 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 18:05:11.559 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 18:05:11.568 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 18:05:11.570 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 18:05:11.570 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 11.7056ms
2025-06-02 18:05:11.570 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 18:05:11.570 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 13.6346ms
2025-06-02 18:05:11.578 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 18:05:11.578 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:11.578 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - 204 null null 0.1935ms
2025-06-02 18:05:11.580 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 18:05:11.580 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:11.581 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:11.581 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:05:11.581 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:05:11.587 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 18:05:11.589 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:05:11.589 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.8564ms
2025-06-02 18:05:11.589 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:05:11.589 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 9.5692ms
2025-06-02 18:05:20.888 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 18:05:20.888 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:20.888 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/68/3 - 204 null null 0.1708ms
2025-06-02 18:05:20.889 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - null null
2025-06-02 18:05:20.889 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:20.889 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:20.889 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 18:05:20.889 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 18:05:20.898 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversationId_0='?' (DbType = Int64), @__user_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE CAST([p].[conversation_id] AS bigint) = @__conversationId_0 AND [p].[user_id] = @__user_id_1
2025-06-02 18:05:20.898 +07:00 [WRN] Participant not found for conversation 68 and user 3
2025-06-02 18:05:20.898 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-06-02 18:05:20.898 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 8.8627ms
2025-06-02 18:05:20.898 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 18:05:20.898 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/68/3 - 500 null text/plain; charset=utf-8 9.1853ms
2025-06-02 18:05:20.907 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 18:05:20.907 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:20.907 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/68 - 204 null null 0.1706ms
2025-06-02 18:05:20.908 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 18:05:20.908 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:20.909 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:20.909 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 18:05:20.909 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 18:05:20.914 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 18:05:20.915 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 18:05:20.915 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.4986ms
2025-06-02 18:05:20.915 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 18:05:20.915 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 7.0019ms
2025-06-02 18:05:20.922 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 18:05:20.922 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:20.922 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/68 - 204 null null 0.1704ms
2025-06-02 18:05:20.923 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 18:05:20.923 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:20.923 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:20.924 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:05:20.924 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:05:20.927 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 18:05:20.928 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:05:20.928 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.3911ms
2025-06-02 18:05:20.928 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:05:20.928 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 4.9743ms
2025-06-02 18:05:22.891 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/68 - null null
2025-06-02 18:05:22.891 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:22.891 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/GroupSetting/get/68 - 204 null null 0.1603ms
2025-06-02 18:05:22.892 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - null null
2025-06-02 18:05:22.892 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:22.892 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:22.892 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/68 - null null
2025-06-02 18:05:22.893 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:05:22.893 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:22.893 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:05:22.893 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:22.893 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 18:05:22.894 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 18:05:22.895 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:05:22.896 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 2.9485ms
2025-06-02 18:05:22.896 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:05:22.896 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 3.6097ms
2025-06-02 18:05:22.896 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 18:05:22.902 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 18:05:22.903 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 18:05:22.905 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 8.5092ms
2025-06-02 18:05:22.905 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 18:05:22.905 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/GroupSetting/get/68 - 200 null application/json; charset=utf-8 12.3255ms
2025-06-02 18:05:27.031 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 18:05:27.031 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:27.031 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:05:27.031 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:05:27.034 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 18:05:27.043 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 18:05:27.044 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:05:27.047 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 12.1951ms
2025-06-02 18:05:27.047 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:05:27.047 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 16.1636ms
2025-06-02 18:07:43.354 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 18:07:43.354 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:07:43.355 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2686ms
2025-06-02 18:07:43.356 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-02 18:07:43.356 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:07:43.356 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:07:43.356 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 18:07:43.365 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 18:07:43.391 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 18:07:43.393 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 18:07:43.400 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 34.6891ms
2025-06-02 18:07:43.400 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 18:07:43.401 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 45.0029ms
2025-06-02 18:07:43.463 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 18:07:43.463 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:07:43.463 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:07:43.463 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 18:07:43.526 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 18:07:43.527 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:07:43.528 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:07:43.528 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:07:43.529 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 18:07:43.536 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 18:07:43.537 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:07:43.537 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 8.8147ms
2025-06-02 18:07:43.538 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:07:43.538 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 11.2433ms
2025-06-02 18:07:43.676 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 18:07:43.676 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-02 18:07:43.676 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-02 18:07:43.676 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-02 18:07:43.676 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-02 18:07:43.676 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-02 18:07:43.676 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-02 18:07:43.676 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-02 18:07:43.676 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:54
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:55
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:56
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:57
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:58
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:59
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:60
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:61
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:62
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:63
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:64
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:65
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 18:07:43.677 +07:00 [INF] User 3 subscribed to channel conversation:67
2025-06-02 18:07:43.739 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 18:07:43.739 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:07:43.739 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2367ms
2025-06-02 18:07:43.741 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 18:07:43.741 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:07:43.741 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:07:43.741 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 18:07:43.745 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 18:07:43.763 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 18:07:43.822 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 18:07:43.827 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 82ms
2025-06-02 18:07:43.828 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 18:07:43.828 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 86.9897ms
2025-06-02 18:07:57.204 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/67/2 - null null
2025-06-02 18:07:57.205 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 18:07:57.205 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 18:07:57.213 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversationId_0='?' (DbType = Int64), @__user_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE CAST([p].[conversation_id] AS bigint) = @__conversationId_0 AND [p].[user_id] = @__user_id_1
2025-06-02 18:07:57.215 +07:00 [INF] Retrieved 0 messages from Redis for conversation 67
2025-06-02 18:07:57.242 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-02 18:07:57.275 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-02 18:07:57.279 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-06-02 18:07:57.279 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 74.0965ms
2025-06-02 18:07:57.279 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 18:07:57.279 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/67/2 - 404 null text/plain; charset=utf-8 75.0013ms
2025-06-02 18:07:57.335 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/67 - null null
2025-06-02 18:07:57.336 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 18:07:57.336 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 18:07:57.348 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 18:07:57.353 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 18:07:57.353 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 16.9663ms
2025-06-02 18:07:57.353 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 18:07:57.353 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/67 - 200 null application/json; charset=utf-8 18.5002ms
2025-06-02 18:07:57.437 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/67 - null null
2025-06-02 18:07:57.438 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:07:57.438 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:07:57.441 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 18:07:57.443 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:07:57.443 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.0271ms
2025-06-02 18:07:57.443 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:07:57.443 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/67 - 200 null application/json; charset=utf-8 6.1079ms
2025-06-02 18:07:59.325 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/67 - null null
2025-06-02 18:07:59.325 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:07:59.325 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:07:59.331 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 18:07:59.334 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:07:59.335 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.957ms
2025-06-02 18:07:59.336 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:07:59.336 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/67 - 200 null application/json; charset=utf-8 10.873ms
2025-06-02 18:07:59.338 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/67 - null null
2025-06-02 18:07:59.344 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 18:07:59.345 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 18:07:59.368 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 18:07:59.369 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 18:07:59.369 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 24.0841ms
2025-06-02 18:07:59.369 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 18:07:59.369 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/67 - 200 null application/json; charset=utf-8 32.1665ms
2025-06-02 18:08:09.793 +07:00 [INF] Handling message from user 2: hello
2025-06-02 18:08:09.805 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 18:08:09.810 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 18:08:09.817 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 18:08:09.818 +07:00 [INF] Message saved to DB with ID: 458
2025-06-02 18:08:09.820 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 18:08:09.829 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 18:08:09.831 +07:00 [INF] Transaction committed for message: 458
2025-06-02 18:08:09.839 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 18:08:09.843 +07:00 [INF] Saved message 458 to Redis
2025-06-02 18:08:09.844 +07:00 [INF] Added message 458 to conversation 67
2025-06-02 18:08:09.850 +07:00 [INF] Published message to channel conversation:67
2025-06-02 18:08:47.435 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 18:08:47.435 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:08:47.435 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3567ms
2025-06-02 18:08:47.437 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-02 18:08:47.437 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:08:47.438 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:08:47.438 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 18:08:47.438 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 18:08:47.453 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 18:08:47.454 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 18:08:47.454 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 15.8762ms
2025-06-02 18:08:47.454 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 18:08:47.454 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 17.5617ms
2025-06-02 18:08:47.476 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 18:08:47.476 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:08:47.477 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:08:47.477 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 18:08:47.573 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 18:08:47.573 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:08:47.573 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:08:47.573 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:08:47.573 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 18:08:47.587 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 18:08:47.588 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:08:47.588 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 14.2248ms
2025-06-02 18:08:47.588 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:08:47.588 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 15.1608ms
2025-06-02 18:08:47.653 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 18:08:47.654 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-02 18:08:47.654 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-02 18:08:47.654 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-02 18:08:47.654 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-02 18:08:47.654 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-02 18:08:47.654 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-02 18:08:47.654 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-02 18:08:47.654 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-02 18:08:47.654 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-02 18:08:47.654 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-02 18:08:47.654 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-02 18:08:47.654 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-02 18:08:47.654 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:54
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:55
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:56
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:57
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:58
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:59
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:60
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:61
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:62
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:63
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:64
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:65
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 18:08:47.655 +07:00 [INF] User 3 subscribed to channel conversation:67
2025-06-02 18:08:47.710 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 18:08:47.710 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:08:47.710 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2738ms
2025-06-02 18:08:47.711 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 18:08:47.711 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:08:47.711 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:08:47.711 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 18:08:47.711 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 18:08:47.725 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 18:08:47.766 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 18:08:47.785 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 73.7548ms
2025-06-02 18:08:47.785 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 18:08:47.786 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 74.4131ms
2025-06-02 18:08:53.158 +07:00 [INF] Handling message from user 2: ok
2025-06-02 18:08:53.165 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 18:08:53.166 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 18:08:53.174 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 18:08:53.177 +07:00 [INF] Message saved to DB with ID: 459
2025-06-02 18:08:53.178 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 18:08:53.185 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 18:08:53.186 +07:00 [INF] Transaction committed for message: 459
2025-06-02 18:08:53.192 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 18:08:53.193 +07:00 [INF] Saved message 459 to Redis
2025-06-02 18:08:53.194 +07:00 [INF] Added message 459 to conversation 67
2025-06-02 18:08:53.195 +07:00 [INF] Published message to channel conversation:67
2025-06-02 18:09:35.318 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 18:09:35.318 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:09:35.318 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.505ms
2025-06-02 18:09:35.320 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-02 18:09:35.320 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:09:35.320 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:09:35.320 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 18:09:35.320 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 18:09:35.330 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 18:09:35.331 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 18:09:35.331 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 10.6869ms
2025-06-02 18:09:35.331 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 18:09:35.331 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 11.42ms
2025-06-02 18:09:35.357 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 18:09:35.357 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:09:35.358 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:09:35.358 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 18:09:35.444 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 18:09:35.444 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:09:35.444 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:09:35.444 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:09:35.444 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 18:09:35.451 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 18:09:35.452 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:09:35.452 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 7.7919ms
2025-06-02 18:09:35.452 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:09:35.452 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 8.5597ms
2025-06-02 18:09:35.522 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 18:09:35.523 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 18:09:35.523 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-02 18:09:35.523 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-02 18:09:35.523 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-02 18:09:35.523 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-02 18:09:35.523 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-02 18:09:35.524 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-02 18:09:35.524 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-02 18:09:35.524 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-02 18:09:35.524 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-02 18:09:35.524 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-02 18:09:35.524 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-02 18:09:35.524 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-02 18:09:35.524 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:54
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:55
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:56
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:57
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:58
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:59
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:60
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:61
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:62
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:63
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:64
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:65
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 18:09:35.525 +07:00 [INF] User 3 subscribed to channel conversation:67
2025-06-02 18:09:35.525 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 18:09:35.553 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 18:09:35.559 +07:00 [ERR] Connection id "0HND1OF28PLRR", Request id "0HND1OF28PLRR:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 18:09:35.563 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 48087.6938ms
2025-06-02 18:09:35.579 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 18:09:35.579 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:09:35.579 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2379ms
2025-06-02 18:09:35.582 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 18:09:35.582 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:09:35.582 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:09:35.582 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 18:09:35.582 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 18:09:35.598 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 18:09:35.634 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 18:09:35.637 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 54.3915ms
2025-06-02 18:09:35.637 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 18:09:35.637 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 55.5639ms
2025-06-02 18:09:40.018 +07:00 [INF] Handling message from user 2: hehe
2025-06-02 18:09:40.022 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 18:09:40.026 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 18:09:40.032 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 18:09:40.032 +07:00 [INF] Message saved to DB with ID: 460
2025-06-02 18:09:40.033 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 18:09:40.037 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 18:09:40.038 +07:00 [INF] Transaction committed for message: 460
2025-06-02 18:09:40.044 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 18:09:40.048 +07:00 [INF] Saved message 460 to Redis
2025-06-02 18:09:40.049 +07:00 [INF] Added message 460 to conversation 67
2025-06-02 18:09:40.053 +07:00 [INF] Published message to channel conversation:67
2025-06-02 18:09:40.583 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 18:09:40.584 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:09:40.584 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:09:40.584 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 18:11:03.672 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/67 - null null
2025-06-02 18:11:03.672 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:11:03.672 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:11:03.674 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/67 - null null
2025-06-02 18:11:03.674 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 18:11:03.674 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 18:11:03.680 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 18:11:03.685 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:11:03.685 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 12.9884ms
2025-06-02 18:11:03.685 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:11:03.686 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/67 - 200 null application/json; charset=utf-8 13.4851ms
2025-06-02 18:11:03.699 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 18:11:03.700 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 18:11:03.700 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 25.3523ms
2025-06-02 18:11:03.700 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 18:11:03.700 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/67 - 200 null application/json; charset=utf-8 26.2384ms
2025-06-02 18:11:07.632 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 18:11:07.633 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:11:07.633 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 18:11:07.644 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 18:11:07.647 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:11:07.648 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 14.9194ms
2025-06-02 18:11:07.648 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:11:07.648 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 15.3966ms
2025-06-02 18:11:11.176 +07:00 [INF] Request starting HTTP/1.1 DELETE http://192.168.1.2:5053/api/Participant/remove_member/228 - null null
2025-06-02 18:11:11.176 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.RemoveMember (Message_app)'
2025-06-02 18:11:11.180 +07:00 [INF] Route matched with {action = "RemoveMember", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RemoveMember(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:11:11.192 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__participantId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[id] = @__participantId_0
2025-06-02 18:11:11.204 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
DELETE FROM [Participants]
OUTPUT 1
WHERE [id] = @p0;
2025-06-02 18:11:11.205 +07:00 [INF] Published message to channel conversation:67
2025-06-02 18:11:11.205 +07:00 [INF] Unsubscribed user 3 from channel conversation:67
2025-06-02 18:11:11.205 +07:00 [INF] Unsubscribed user 3 from channel conversation:67
2025-06-02 18:11:11.205 +07:00 [INF] Unsubscribed user 3 from channel conversation:67
2025-06-02 18:11:11.206 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 18:11:11.206 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:11:11.207 +07:00 [INF] Executed action server.Controllers.ParticipantController.RemoveMember (Message_app) in 27.1208ms
2025-06-02 18:11:11.208 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.RemoveMember (Message_app)'
2025-06-02 18:11:11.208 +07:00 [INF] Request finished HTTP/1.1 DELETE http://192.168.1.2:5053/api/Participant/remove_member/228 - 200 null application/json; charset=utf-8 31.9138ms
2025-06-02 18:11:11.417 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/67 - null null
2025-06-02 18:11:11.417 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:11:11.417 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:11:11.420 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 18:11:11.421 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:11:11.421 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.0196ms
2025-06-02 18:11:11.421 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:11:11.421 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/67 - 200 null application/json; charset=utf-8 4.3089ms
2025-06-02 18:12:26.657 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 18:12:26.657 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:12:26.657 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3003ms
2025-06-02 18:12:26.658 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-02 18:12:26.658 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:12:26.658 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:12:26.658 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 18:12:26.658 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 18:12:26.665 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 18:12:26.666 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 18:12:26.666 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 7.6032ms
2025-06-02 18:12:26.666 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 18:12:26.666 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 8.0846ms
2025-06-02 18:12:26.674 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 18:12:26.674 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:12:26.674 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:12:26.674 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 18:12:26.684 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:54
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:55
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:56
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:57
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:58
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:59
2025-06-02 18:12:26.685 +07:00 [INF] User 3 subscribed to channel conversation:60
2025-06-02 18:12:26.686 +07:00 [INF] User 3 subscribed to channel conversation:61
2025-06-02 18:12:26.686 +07:00 [INF] User 3 subscribed to channel conversation:62
2025-06-02 18:12:26.686 +07:00 [INF] User 3 subscribed to channel conversation:63
2025-06-02 18:12:26.686 +07:00 [INF] User 3 subscribed to channel conversation:64
2025-06-02 18:12:26.686 +07:00 [INF] User 3 subscribed to channel conversation:65
2025-06-02 18:12:26.686 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 18:12:26.770 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-02 18:12:26.770 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:12:26.770 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:12:26.770 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:12:26.770 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 18:12:26.778 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 18:12:26.778 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:12:26.779 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 8.4094ms
2025-06-02 18:12:26.779 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:12:26.779 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 8.7271ms
2025-06-02 18:12:26.893 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 18:12:26.893 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:12:26.893 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1815ms
2025-06-02 18:12:26.894 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-02 18:12:26.894 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:12:26.894 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:12:26.894 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 18:12:26.894 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 18:12:26.912 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 18:12:27.005 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 18:12:27.008 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 113.5686ms
2025-06-02 18:12:27.008 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 18:12:27.008 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 113.8909ms
2025-06-02 18:12:33.368 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/66/2 - null null
2025-06-02 18:12:33.369 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 18:12:33.369 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 18:12:33.376 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversationId_0='?' (DbType = Int64), @__user_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE CAST([p].[conversation_id] AS bigint) = @__conversationId_0 AND [p].[user_id] = @__user_id_1
2025-06-02 18:12:33.377 +07:00 [INF] Retrieved 0 messages from Redis for conversation 66
2025-06-02 18:12:33.383 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-02 18:12:33.390 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-02 18:12:33.390 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-06-02 18:12:33.390 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 21.5966ms
2025-06-02 18:12:33.390 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 18:12:33.390 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/66/2 - 404 null text/plain; charset=utf-8 21.865ms
2025-06-02 18:12:33.514 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/66 - null null
2025-06-02 18:12:33.514 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 18:12:33.514 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 18:12:33.520 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 18:12:33.521 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 18:12:33.521 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.9329ms
2025-06-02 18:12:33.521 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 18:12:33.521 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/66 - 200 null application/json; charset=utf-8 7.7702ms
2025-06-02 18:12:33.604 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - null null
2025-06-02 18:12:33.604 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:12:33.604 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:12:33.608 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 18:12:33.609 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:12:33.609 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.0311ms
2025-06-02 18:12:33.609 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:12:33.610 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - 200 null application/json; charset=utf-8 5.5038ms
2025-06-02 18:12:35.407 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - null null
2025-06-02 18:12:35.407 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:12:35.407 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:12:35.409 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 18:12:35.410 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:12:35.410 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.36ms
2025-06-02 18:12:35.410 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:12:35.410 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - 200 null application/json; charset=utf-8 3.7027ms
2025-06-02 18:12:35.410 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/66 - null null
2025-06-02 18:12:35.411 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 18:12:35.411 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 18:12:35.427 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 18:12:35.428 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 18:12:35.429 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 18.2149ms
2025-06-02 18:12:35.429 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 18:12:35.429 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/66 - 200 null application/json; charset=utf-8 18.766ms
2025-06-02 18:12:39.499 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 18:12:39.499 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:12:39.499 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 18:12:39.511 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 18:12:39.515 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:12:39.516 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 16.5502ms
2025-06-02 18:12:39.516 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:12:39.516 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 17.4772ms
2025-06-02 18:12:42.965 +07:00 [INF] Request starting HTTP/1.1 DELETE http://192.168.1.2:5053/api/Participant/remove_member/224 - null null
2025-06-02 18:12:42.966 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.RemoveMember (Message_app)'
2025-06-02 18:12:42.966 +07:00 [INF] Route matched with {action = "RemoveMember", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RemoveMember(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:12:42.969 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__participantId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[id] = @__participantId_0
2025-06-02 18:12:42.974 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
DELETE FROM [Participants]
OUTPUT 1
WHERE [id] = @p0;
2025-06-02 18:12:42.976 +07:00 [INF] Published message to channel conversation:66
2025-06-02 18:12:42.976 +07:00 [INF] Unsubscribed user 3 from channel conversation:66
2025-06-02 18:12:42.976 +07:00 [INF] Unsubscribed user 3 from channel conversation:66
2025-06-02 18:12:42.977 +07:00 [INF] Unsubscribed user 3 from channel conversation:66
2025-06-02 18:12:42.977 +07:00 [INF] Unsubscribed user 3 from channel conversation:66
2025-06-02 18:12:42.978 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 18:12:42.978 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:12:42.980 +07:00 [INF] Executed action server.Controllers.ParticipantController.RemoveMember (Message_app) in 13.585ms
2025-06-02 18:12:42.980 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.RemoveMember (Message_app)'
2025-06-02 18:12:42.981 +07:00 [INF] Request finished HTTP/1.1 DELETE http://192.168.1.2:5053/api/Participant/remove_member/224 - 200 null application/json; charset=utf-8 15.7446ms
2025-06-02 18:12:43.162 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - null null
2025-06-02 18:12:43.162 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:12:43.162 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:12:43.164 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 18:12:43.166 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:12:43.166 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.3997ms
2025-06-02 18:12:43.167 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:12:43.167 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - 200 null application/json; charset=utf-8 5.0346ms
2025-06-02 18:12:47.695 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - null null
2025-06-02 18:12:47.695 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:12:47.695 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:12:47.698 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 18:12:47.701 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:12:47.701 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.4227ms
2025-06-02 18:12:47.701 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:12:47.701 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - 200 null application/json; charset=utf-8 6.899ms
2025-06-02 18:12:47.709 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/66 - null null
2025-06-02 18:12:47.710 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 18:12:47.710 +07:00 [INF] Route matched with {action = "GetGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetGroupSetting(Int32) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 18:12:47.715 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[ConversationId], [g].[AllowMemberInvite], [g].[AllowMemberEdit], [g].[CreatedBy], [g].[CreatedAt], [g].[AllowMemberRemove]
FROM [GroupSettings] AS [g]
WHERE [g].[ConversationId] = @__conversationId_0
2025-06-02 18:12:47.715 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[server.DTO.GroupSettingDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 18:12:47.715 +07:00 [INF] Executed action server.Controllers.GroupSettingController.GetGroupSetting (Message_app) in 4.2731ms
2025-06-02 18:12:47.715 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.GetGroupSetting (Message_app)'
2025-06-02 18:12:47.715 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/get/66 - 200 null application/json; charset=utf-8 6.1033ms
2025-06-02 18:12:49.173 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 18:12:49.173 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:12:49.173 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 18:12:49.175 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 18:12:49.176 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:12:49.176 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 2.3714ms
2025-06-02 18:12:49.176 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 18:12:49.176 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 2.9766ms
2025-06-02 18:12:51.655 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Participant/add_member/66/3 - null 0
2025-06-02 18:12:51.655 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.AddMember (Message_app)'
2025-06-02 18:12:51.657 +07:00 [INF] Route matched with {action = "AddMember", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddMember(Int32, Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:12:51.660 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Conversations] AS [c]
        WHERE [c].[id] = @__conversation_id_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-06-02 18:12:51.665 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__user_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] = @__user_id_0
2025-06-02 18:12:51.670 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32), @__user_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[user_id] = @__user_id_1) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-06-02 18:12:51.677 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Participants] ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 18:12:51.677 +07:00 [INF] User 3 subscribed to channel conversation:66
2025-06-02 18:12:51.678 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 18:12:51.681 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType19`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 18:12:51.683 +07:00 [INF] Executed action server.Controllers.ParticipantController.AddMember (Message_app) in 25.8573ms
2025-06-02 18:12:51.683 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.AddMember (Message_app)'
2025-06-02 18:12:51.683 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Participant/add_member/66/3 - 200 null application/json; charset=utf-8 28.2823ms
2025-06-02 18:12:51.769 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversationDto/3/66 - null null
2025-06-02 18:12:51.769 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:12:51.769 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversationDto/3/66 - 204 null null 0.2278ms
2025-06-02 18:12:51.771 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/3/66 - null null
2025-06-02 18:12:51.771 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:12:51.771 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:12:51.771 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 18:12:51.773 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 18:12:51.783 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 18:12:51.792 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 18:12:51.792 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 19.0467ms
2025-06-02 18:12:51.792 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 18:12:51.792 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/3/66 - 200 null application/json; charset=utf-8 21.5946ms
2025-06-02 18:12:51.870 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - null null
2025-06-02 18:12:51.870 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:12:51.870 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 18:12:51.871 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 18:12:51.872 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 18:12:51.872 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 2.0964ms
2025-06-02 18:12:51.872 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 18:12:51.872 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/66 - 200 null application/json; charset=utf-8 2.4239ms
2025-06-02 18:13:01.328 +07:00 [INF] Handling message from user 2: hrhr
2025-06-02 18:13:01.333 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 18:13:01.334 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 18:13:01.338 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 18:13:01.339 +07:00 [INF] Message saved to DB with ID: 461
2025-06-02 18:13:01.339 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 18:13:01.344 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 18:13:01.345 +07:00 [INF] Transaction committed for message: 461
2025-06-02 18:13:01.349 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 18:13:01.352 +07:00 [INF] Saved message 461 to Redis
2025-06-02 18:13:01.353 +07:00 [INF] Added message 461 to conversation 66
2025-06-02 18:13:01.353 +07:00 [INF] Published message to channel conversation:66
2025-06-02 18:52:23.477 +07:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-02 18:52:23.621 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-02 18:52:23.699 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-02 18:52:23.715 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-02 18:52:23.715 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-02 18:52:23.716 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-02 18:52:23.716 +07:00 [INF] Hosting environment: Development
2025-06-02 18:52:23.716 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-02 18:52:23.788 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 18:52:23.788 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 18:52:23.818 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:52:23.818 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:52:23.836 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:52:23.836 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:52:23.836 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-02 18:52:23.864 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 18:52:23.864 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 18:52:23.896 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 18:52:23.897 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:52:23.898 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:52:23.899 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 18:52:23.910 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 18:52:23.911 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:52:23.911 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:52:23.911 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 18:52:27.228 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-02 18:52:27.231 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:52:27.231 +07:00 [INF] CORS policy execution successful.
2025-06-02 18:52:27.232 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 18:52:30.109 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 18:52:30.109 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 18:52:30.109 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 18:52:30.109 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 18:52:30.109 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 18:52:30.112 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 6325.4641ms
2025-06-02 18:52:30.112 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 6215.2368ms
2025-06-02 18:52:30.112 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 6201.0594ms
2025-06-02 18:52:30.112 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 6325.4644ms
2025-06-02 18:52:30.112 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 2883.3286ms
2025-06-02 18:52:37.489 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 18:52:37.490 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 19:06:21.576 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 19:06:21.606 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 19:06:21.807 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 19:06:21.829 +07:00 [ERR] Connection id "0HND1PFO3UD0L", Request id "0HND1PFO3UD0L:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 19:06:21.845 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - 101 null null 824354.9258ms
2025-06-02 19:07:12.188 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 19:07:12.363 +07:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '6/2/2025 11:26:18 AM', Current time (UTC): '6/2/2025 12:07:12 PM'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-06-02 19:07:12.366 +07:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '6/2/2025 11:26:18 AM', Current time (UTC): '6/2/2025 12:07:12 PM'.
2025-06-02 19:07:12.367 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:07:12.472 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 19:07:13.065 +07:00 [INF] Executed DbCommand (92ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 19:07:13.313 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 19:07:13.441 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 963.304ms
2025-06-02 19:07:13.442 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:07:13.449 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 1261.156ms
2025-06-02 19:07:14.272 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 19:07:14.278 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 19:07:14.649 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 19:07:14.654 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 19:07:14.675 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 19:07:14.682 +07:00 [WRN] Authorization header is missing or invalid.
2025-06-02 19:07:14.687 +07:00 [INF] Authorization failed for the request at filter 'server.Filters.AuthorizationJWT'.
2025-06-02 19:07:14.691 +07:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-06-02 19:07:14.735 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 59.8354ms
2025-06-02 19:07:14.735 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 19:07:14.735 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 401 null application/problem+json; charset=utf-8 86.5091ms
2025-06-02 19:07:14.848 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 19:07:14.886 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 19:07:14.890 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 19:07:14.892 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 19:07:14.894 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 19:07:14.897 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 19:07:14.900 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 19:07:14.904 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 19:07:14.907 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 19:07:14.908 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 19:07:14.909 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 19:07:14.909 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 19:07:14.910 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 19:07:14.911 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 19:07:14.911 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 19:07:14.912 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 19:07:14.913 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 19:07:14.914 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 19:07:14.914 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 19:07:14.915 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 19:07:14.915 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 19:07:14.916 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 19:07:14.918 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 19:07:14.919 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 19:07:14.921 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 19:07:14.922 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 19:07:14.925 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 19:07:14.925 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 19:07:14.926 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 19:07:14.926 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 19:07:14.927 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 19:07:14.927 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 19:07:14.928 +07:00 [INF] User 2 subscribed to channel conversation:54
2025-06-02 19:07:14.929 +07:00 [INF] User 2 subscribed to channel conversation:55
2025-06-02 19:07:14.929 +07:00 [INF] User 2 subscribed to channel conversation:56
2025-06-02 19:07:14.930 +07:00 [INF] User 2 subscribed to channel conversation:57
2025-06-02 19:07:14.930 +07:00 [INF] User 2 subscribed to channel conversation:58
2025-06-02 19:07:14.930 +07:00 [INF] User 2 subscribed to channel conversation:59
2025-06-02 19:07:14.931 +07:00 [INF] User 2 subscribed to channel conversation:60
2025-06-02 19:07:14.931 +07:00 [INF] User 2 subscribed to channel conversation:61
2025-06-02 19:07:14.932 +07:00 [INF] User 2 subscribed to channel conversation:62
2025-06-02 19:07:14.933 +07:00 [INF] User 2 subscribed to channel conversation:63
2025-06-02 19:07:14.934 +07:00 [INF] User 2 subscribed to channel conversation:64
2025-06-02 19:07:14.935 +07:00 [INF] User 2 subscribed to channel conversation:65
2025-06-02 19:07:14.937 +07:00 [INF] User 2 subscribed to channel conversation:66
2025-06-02 19:07:14.939 +07:00 [INF] User 2 subscribed to channel conversation:67
2025-06-02 19:07:14.940 +07:00 [INF] User 2 subscribed to channel conversation:68
2025-06-02 19:07:14.940 +07:00 [INF] User 2 subscribed to channel conversation:69
2025-06-02 19:07:15.035 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 19:07:15.073 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 19:07:15.085 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 19:07:15.089 +07:00 [ERR] Unexpected error during token validation: Value cannot be null. (Parameter 's')
2025-06-02 19:07:15.089 +07:00 [INF] Authorization failed for the request at filter 'server.Filters.AuthorizationJWT'.
2025-06-02 19:07:15.090 +07:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-06-02 19:07:15.092 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 6.7567ms
2025-06-02 19:07:15.093 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 19:07:15.093 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 500 null application/problem+json; charset=utf-8 58.2678ms
2025-06-02 19:08:13.283 +07:00 [INF] Application is shutting down...
2025-06-02 19:08:40.794 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:3
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:4
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:19
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:1
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:25
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:26
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:27
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:28
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:29
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:32
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:33
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:34
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:35
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:36
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:37
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:38
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:39
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:41
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:40
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:42
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:44
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:43
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:45
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:46
2025-06-02 19:08:40.795 +07:00 [INF] User 2 already subscribed to channel conversation:47
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:48
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:49
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:50
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:51
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:52
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:53
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:54
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:55
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:56
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:57
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:58
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:59
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:60
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:61
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:62
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:63
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:64
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:65
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:66
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:67
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:68
2025-06-02 19:08:40.796 +07:00 [INF] User 2 already subscribed to channel conversation:69
2025-06-02 19:08:43.308 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 19:08:43.308 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - 101 null null 89036.5984ms
