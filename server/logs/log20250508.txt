2025-05-08 07:32:03.531 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 07:32:03.531 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 07:32:03.531 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 07:32:03.573 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 07:32:03.575 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 07:32:03.575 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 07:32:03.595 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 07:32:03.603 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 07:32:03.603 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 07:32:03.603 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 07:32:03.531 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 07:32:08.702 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 07:32:05.303 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 07:32:05.340 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 07:32:05.331 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 07:32:05.303 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 07:32:05.337 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 07:32:05.303 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 07:32:05.333 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 07:32:08.702 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 07:32:05.303 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 07:32:05.332 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 07:32:08.936 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 07:32:08.936 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 07:32:08.940 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 07:32:08.942 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 07:32:08.961 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 07:32:08.984 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 07:32:08.997 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 07:32:09.008 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 07:32:09.017 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 07:32:09.025 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 07:32:09.036 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 07:32:09.059 +07:00 [ERR] Connection id "0HNCDG00VBD4M", Request id "0HNCDG00VBD4M:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 07:32:09.060 +07:00 [ERR] Connection id "0HNCDG00VBD3U", Request id "0HNCDG00VBD3U:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 07:32:09.059 +07:00 [ERR] Connection id "0HNCDG00VBD4K", Request id "0HNCDG00VBD4K:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 07:32:09.059 +07:00 [ERR] Connection id "0HNCDG00VBD46", Request id "0HNCDG00VBD46:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 07:32:09.059 +07:00 [ERR] Connection id "0HNCDG00VBD4D", Request id "0HNCDG00VBD4D:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 07:32:09.059 +07:00 [ERR] Connection id "0HNCDG00VBD3V", Request id "0HNCDG00VBD3V:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 07:32:09.059 +07:00 [ERR] Connection id "0HNCDG00VBD44", Request id "0HNCDG00VBD44:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 07:32:09.059 +07:00 [ERR] Connection id "0HNCDG00VBD4B", Request id "0HNCDG00VBD4B:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 07:32:09.066 +07:00 [ERR] Connection id "0HNCDG00VBD4I", Request id "0HNCDG00VBD4I:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 07:32:09.059 +07:00 [ERR] Connection id "0HNCDG00VBD40", Request id "0HNCDG00VBD40:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 07:32:09.097 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 27745868.1018ms
2025-05-08 07:32:09.060 +07:00 [ERR] Connection id "0HNCDG00VBD4G", Request id "0HNCDG00VBD4G:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 07:32:09.107 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 30820621.0085ms
2025-05-08 07:32:09.155 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 27765737.967ms
2025-05-08 07:32:09.530 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 30250664.1615ms
2025-05-08 07:32:09.568 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 28239739.5459ms
2025-05-08 07:32:09.608 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 30817693.8231ms
2025-05-08 07:32:09.623 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 30264710.7033ms
2025-05-08 07:32:09.640 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 28249871.7565ms
2025-05-08 07:32:09.702 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 30817764.8404ms
2025-05-08 07:32:09.681 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 27848089.7683ms
2025-05-08 07:32:09.737 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 27868044.7847ms
2025-05-08 07:57:50.983 +07:00 [INF] Application is shutting down...
2025-05-08 07:58:01.294 +07:00 [INF] Executed DbCommand (51ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-08 07:58:01.427 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-08 07:58:01.482 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-08 07:58:01.491 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-08 07:58:01.491 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-08 07:58:01.491 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-08 07:58:01.491 +07:00 [INF] Hosting environment: Development
2025-05-08 07:58:01.491 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-08 07:59:15.813 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/16 - null null
2025-05-08 07:59:15.915 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-08 07:59:15.974 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/16 - 404 0 null 163.7224ms
2025-05-08 07:59:15.979 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:5053/api/Conversation/get_conversationDto/16, Response status code: 404
2025-05-08 07:59:26.894 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/17 - null null
2025-05-08 07:59:26.907 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/17 - 404 0 null 13.6084ms
2025-05-08 07:59:26.907 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:5053/api/Conversation/get_conversationDto/17, Response status code: 404
2025-05-08 07:59:30.948 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/18 - null null
2025-05-08 07:59:30.953 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/18 - 404 0 null 4.6372ms
2025-05-08 07:59:30.953 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:5053/api/Conversation/get_conversationDto/18, Response status code: 404
2025-05-08 08:00:02.900 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/2/18 - null null
2025-05-08 08:00:02.903 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-05-08 08:00:02.941 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:00:03.287 +07:00 [INF] Executed DbCommand (49ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-08 08:00:03.499 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-08 08:00:03.527 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 578.8173ms
2025-05-08 08:00:03.528 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-05-08 08:00:03.535 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/2/18 - 200 null application/json; charset=utf-8 634.6224ms
2025-05-08 08:00:04.739 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/favicon.ico - null null
2025-05-08 08:00:04.740 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/favicon.ico - 404 0 null 0.9075ms
2025-05-08 08:00:04.740 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:5053/favicon.ico, Response status code: 404
2025-05-08 08:00:27.287 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 08:00:27.288 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:00:27.296 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:00:27.345 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:00:27.346 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 50.5855ms
2025-05-08 08:00:27.347 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:00:27.347 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 59.6807ms
2025-05-08 08:29:48.403 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 08:29:48.447 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:29:48.478 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 81.6659ms
2025-05-08 08:29:48.493 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-08 08:29:48.495 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:29:48.502 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:29:48.512 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:29:48.569 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 08:29:49.226 +07:00 [INF] Executed DbCommand (85ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 08:29:49.515 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 08:29:49.576 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 1004.8797ms
2025-05-08 08:29:49.577 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:29:49.578 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 1084.7516ms
2025-05-08 08:29:49.728 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-08 08:29:49.732 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:29:49.739 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:29:49.739 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:29:49.746 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 08:29:49.833 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 08:29:49.833 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:29:49.833 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.4257ms
2025-05-08 08:29:49.834 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 08:29:49.834 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:29:49.835 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:29:49.835 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:29:49.836 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:29:49.840 +07:00 [INF] Executed DbCommand (33ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 08:29:49.843 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:29:49.848 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:29:49.849 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 13.0352ms
2025-05-08 08:29:49.849 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:29:49.849 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 15.1335ms
2025-05-08 08:29:49.869 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-08 08:29:49.873 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:29:49.874 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:29:49.874 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 08:29:49.923 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 172.8294ms
2025-05-08 08:29:49.923 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:29:49.924 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 195.8615ms
2025-05-08 08:29:50.176 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 08:30:21.461 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 08:30:21.462 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:21.463 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 1.8777ms
2025-05-08 08:30:21.464 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-08 08:30:21.464 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:21.465 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:21.465 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:30:21.466 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 08:30:21.485 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 08:30:21.486 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 08:30:21.487 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 20.8614ms
2025-05-08 08:30:21.487 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:30:21.487 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 22.9285ms
2025-05-08 08:30:21.632 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-08 08:30:21.633 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:21.634 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:21.635 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:30:21.635 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 08:30:21.645 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 08:30:21.646 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:30:21.647 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.8739ms
2025-05-08 08:30:21.647 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:30:21.647 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 14.9389ms
2025-05-08 08:30:21.723 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-08 08:30:21.723 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:21.723 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.4064ms
2025-05-08 08:30:21.725 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-08 08:30:21.725 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:21.726 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:21.726 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:30:21.726 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:30:21.729 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:30:21.730 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.6425ms
2025-05-08 08:30:21.730 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:30:21.730 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 4.7445ms
2025-05-08 08:30:21.829 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-08 08:30:21.829 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:21.830 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:21.831 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 08:30:21.936 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 08:30:21.980 +07:00 [INF] Executed DbCommand (32ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 08:30:39.227 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/3 - null null
2025-05-08 08:30:39.227 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:39.227 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/3 - 204 null null 0.5686ms
2025-05-08 08:30:39.229 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/3 - null null
2025-05-08 08:30:39.229 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:39.229 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:39.230 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:30:39.233 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 08:30:39.300 +07:00 [INF] Retrieved 50 messages from Redis for conversation 1
2025-05-08 08:30:39.302 +07:00 [INF] Retrieved 50 messages from Redis for conversation 1 and user 3
2025-05-08 08:30:39.303 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:30:39.308 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 74.2781ms
2025-05-08 08:30:39.308 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:30:39.308 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/3 - 200 null application/json; charset=utf-8 78.8037ms
2025-05-08 08:30:39.324 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-08 08:30:39.324 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:39.324 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 0.265ms
2025-05-08 08:30:39.326 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-08 08:30:39.326 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:39.326 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:39.326 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:30:39.328 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:30:39.380 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 08:30:39.418 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 08:30:39.420 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 91.7734ms
2025-05-08 08:30:39.420 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:30:39.421 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 95.0198ms
2025-05-08 08:30:39.427 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-08 08:30:39.428 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:39.428 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 0.2553ms
2025-05-08 08:30:39.429 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-08 08:30:39.429 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:39.429 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:30:39.430 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:30:39.432 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 08:30:39.447 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 08:30:39.448 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:30:39.450 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 18.1629ms
2025-05-08 08:30:39.450 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:30:39.450 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 21.2708ms
2025-05-08 08:30:58.448 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 08:30:58.449 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 36619.7397ms
2025-05-08 08:31:13.610 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 08:31:13.611 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:13.611 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.5349ms
2025-05-08 08:31:13.612 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-08 08:31:13.612 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:13.613 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:13.613 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:31:13.613 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 08:31:13.626 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 08:31:13.627 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 08:31:13.628 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 14.1524ms
2025-05-08 08:31:13.628 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:31:13.628 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 15.5615ms
2025-05-08 08:31:13.764 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-08 08:31:13.765 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:13.765 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:13.765 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:31:13.765 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 08:31:13.775 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 08:31:13.775 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:31:13.776 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.3448ms
2025-05-08 08:31:13.776 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:31:13.776 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 11.4042ms
2025-05-08 08:31:13.842 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 08:31:13.842 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:13.843 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.3169ms
2025-05-08 08:31:13.844 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 08:31:13.844 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:13.844 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:13.844 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:31:13.844 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:31:13.845 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:31:13.846 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.2288ms
2025-05-08 08:31:13.846 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:31:13.846 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 1.9552ms
2025-05-08 08:31:13.957 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-08 08:31:13.958 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:13.958 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:13.958 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 08:31:14.102 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 08:31:30.299 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 08:31:30.299 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:30.299 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.9454ms
2025-05-08 08:31:30.302 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-08 08:31:30.302 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:30.302 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:30.302 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:31:30.302 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 08:31:30.306 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 08:31:30.308 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 08:31:30.309 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 6.4801ms
2025-05-08 08:31:30.309 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:31:30.309 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 8.2921ms
2025-05-08 08:31:30.406 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-08 08:31:30.406 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:30.406 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:30.407 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:31:30.407 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 08:31:30.411 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 08:31:30.411 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:31:30.411 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 4.085ms
2025-05-08 08:31:30.411 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:31:30.412 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 5.6746ms
2025-05-08 08:31:30.448 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-08 08:31:30.448 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:30.448 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2911ms
2025-05-08 08:31:30.450 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-08 08:31:30.450 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:30.450 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:30.450 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:31:30.450 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:31:30.451 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:31:30.451 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 0.9191ms
2025-05-08 08:31:30.451 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:31:30.451 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 1.3802ms
2025-05-08 08:31:30.464 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-08 08:31:30.464 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:30.464 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:30.464 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 08:31:30.546 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 08:31:30.556 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 08:31:41.132 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/3/2 - null null
2025-05-08 08:31:41.132 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:41.133 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/3/2 - 204 null null 0.7075ms
2025-05-08 08:31:41.135 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/3/2 - null null
2025-05-08 08:31:41.135 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:41.135 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:41.135 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-08 08:31:41.145 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:31:41.248 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-08 08:31:41.252 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-08 08:31:41.412 +07:00 [INF] Executed DbCommand (98ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-08 08:31:41.413 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-08 08:31:41.413 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 268.3737ms
2025-05-08 08:31:41.413 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-08 08:31:41.413 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/3/2 - 200 null application/json; charset=utf-8 278.8428ms
2025-05-08 08:31:41.533 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/3 - null null
2025-05-08 08:31:41.533 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:41.533 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/3 - 204 null null 0.2702ms
2025-05-08 08:31:41.535 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/3 - null null
2025-05-08 08:31:41.535 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:41.536 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:41.536 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:31:41.536 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 08:31:41.539 +07:00 [INF] Retrieved 1 messages from Redis for conversation 18
2025-05-08 08:31:41.539 +07:00 [INF] Retrieved 1 messages from Redis for conversation 18 and user 3
2025-05-08 08:31:41.540 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:31:41.540 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 3.4111ms
2025-05-08 08:31:41.540 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:31:41.540 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/3 - 200 null application/json; charset=utf-8 5.2994ms
2025-05-08 08:31:41.548 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 08:31:41.549 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:41.549 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 0.3806ms
2025-05-08 08:31:41.550 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 08:31:41.551 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:41.551 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:41.551 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:31:41.552 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:31:41.570 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 08:31:41.571 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 08:31:41.571 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 19.6233ms
2025-05-08 08:31:41.571 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:31:41.572 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 21.6935ms
2025-05-08 08:31:41.579 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 08:31:41.579 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:41.580 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 0.2316ms
2025-05-08 08:31:41.581 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 08:31:41.581 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:41.582 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:31:41.582 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:31:41.582 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 08:31:41.588 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 08:31:41.589 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:31:41.590 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.3432ms
2025-05-08 08:31:41.590 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:31:41.590 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 9.5783ms
2025-05-08 08:32:02.305 +07:00 [INF] Handling message from user 3: klsdfd
2025-05-08 08:32:02.340 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 08:32:02.633 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 08:32:02.678 +07:00 [INF] Executed DbCommand (39ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 08:32:02.729 +07:00 [INF] Message saved to DB with ID: 157
2025-05-08 08:32:02.736 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 08:32:02.756 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 08:32:02.781 +07:00 [INF] Transaction committed for message: 157
2025-05-08 08:32:02.799 +07:00 [INF] Saved message 157 to Redis
2025-05-08 08:32:02.806 +07:00 [INF] Added message 157 to conversation 18
2025-05-08 08:32:02.832 +07:00 [INF] Published message to channel conversation:18
2025-05-08 08:32:02.922 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversationDto/2/18 - null null
2025-05-08 08:32:02.922 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:02.922 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversationDto/2/18 - 204 null null 0.6809ms
2025-05-08 08:32:02.924 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/2/18 - null null
2025-05-08 08:32:02.925 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:02.926 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:02.926 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-05-08 08:32:02.926 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:32:02.928 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-08 08:32:02.929 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 2.2751ms
2025-05-08 08:32:02.930 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-05-08 08:32:02.930 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/2/18 - 200 null application/json; charset=utf-8 5.7014ms
2025-05-08 08:32:15.363 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-08 08:32:15.363 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:15.363 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - 204 null null 0.3202ms
2025-05-08 08:32:15.365 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-08 08:32:15.365 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:15.366 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:15.366 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-08 08:32:15.366 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:32:15.376 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-08 08:32:15.378 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-08 08:32:15.427 +07:00 [INF] Executed DbCommand (47ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-08 08:32:15.427 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-08 08:32:15.428 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 61.2047ms
2025-05-08 08:32:15.428 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-08 08:32:15.428 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 62.874ms
2025-05-08 08:32:15.564 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-08 08:32:15.564 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:15.566 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - 204 null null 0.9143ms
2025-05-08 08:32:15.569 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-08 08:32:15.570 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:15.570 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:15.571 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:32:15.571 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 08:32:15.588 +07:00 [INF] Retrieved 2 messages from Redis for conversation 18
2025-05-08 08:32:15.589 +07:00 [INF] Retrieved 2 messages from Redis for conversation 18 and user 2
2025-05-08 08:32:15.589 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:32:15.589 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 17.9818ms
2025-05-08 08:32:15.595 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:32:15.595 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - 200 null application/json; charset=utf-8 26.2989ms
2025-05-08 08:32:15.614 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 08:32:15.615 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:15.615 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 1.0775ms
2025-05-08 08:32:15.617 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 08:32:15.617 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:15.617 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:15.617 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:32:15.617 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:32:15.624 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 08:32:15.624 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 08:32:15.624 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.2613ms
2025-05-08 08:32:15.625 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:32:15.625 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 7.9253ms
2025-05-08 08:32:15.634 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 08:32:15.634 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:15.634 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 0.2498ms
2025-05-08 08:32:15.635 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 08:32:15.635 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:15.635 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:15.635 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:32:15.636 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 08:32:15.641 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 08:32:15.642 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:32:15.643 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.1556ms
2025-05-08 08:32:15.643 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:32:15.643 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 7.9336ms
2025-05-08 08:32:20.987 +07:00 [INF] Handling message from user 3: mn
2025-05-08 08:32:20.992 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 08:32:21.005 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 08:32:21.007 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 08:32:21.008 +07:00 [INF] Message saved to DB with ID: 158
2025-05-08 08:32:21.016 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 08:32:21.017 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 08:32:21.018 +07:00 [INF] Transaction committed for message: 158
2025-05-08 08:32:21.021 +07:00 [INF] Saved message 158 to Redis
2025-05-08 08:32:21.022 +07:00 [INF] Added message 158 to conversation 18
2025-05-08 08:32:21.024 +07:00 [INF] Published message to channel conversation:18
2025-05-08 08:32:21.105 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversationDto/2/18 - null null
2025-05-08 08:32:21.106 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:21.106 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversationDto/2/18 - 204 null null 0.7735ms
2025-05-08 08:32:21.110 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/2/18 - null null
2025-05-08 08:32:21.110 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:21.110 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:32:21.110 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-05-08 08:32:21.110 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:32:21.112 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-08 08:32:21.112 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 1.7897ms
2025-05-08 08:32:21.112 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-05-08 08:32:21.113 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversationDto/2/18 - 200 null application/json; charset=utf-8 2.6646ms
2025-05-08 08:32:55.426 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 08:32:55.426 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 101468.7643ms
2025-05-08 08:32:55.427 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 08:32:55.427 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 84963.5451ms
2025-05-08 08:33:11.177 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 08:33:11.177 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:11.177 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3259ms
2025-05-08 08:33:11.178 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 53
2025-05-08 08:33:11.179 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:11.179 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:11.179 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:33:11.179 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 08:33:11.192 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 08:33:11.195 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 08:33:11.195 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 16.3658ms
2025-05-08 08:33:11.196 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:33:11.196 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 17.2546ms
2025-05-08 08:33:11.315 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/5 - null null
2025-05-08 08:33:11.315 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:11.316 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:11.316 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:33:11.316 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 08:33:11.327 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 08:33:11.328 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:33:11.328 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 12.0932ms
2025-05-08 08:33:11.328 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:33:11.328 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/5 - 200 null application/json; charset=utf-8 13.0406ms
2025-05-08 08:33:11.385 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-08 08:33:11.385 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:11.385 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 0.2957ms
2025-05-08 08:33:11.386 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-08 08:33:11.386 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:11.386 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:11.386 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:33:11.386 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:33:11.420 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-08 08:33:11.423 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:33:11.424 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 37.1768ms
2025-05-08 08:33:11.424 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:33:11.424 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 37.8626ms
2025-05-08 08:33:11.531 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-08 08:33:11.531 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:11.531 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:11.531 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 08:33:11.614 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 08:33:11.636 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 08:33:11.640 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 08:33:13.463 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/4/5 - null null
2025-05-08 08:33:13.463 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:13.463 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/4/5 - 204 null null 0.3283ms
2025-05-08 08:33:13.464 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/4/5 - null null
2025-05-08 08:33:13.464 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:13.464 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:13.464 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:33:13.464 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 08:33:13.484 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4
2025-05-08 08:33:13.484 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-08 08:33:13.484 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:33:13.485 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 20.5079ms
2025-05-08 08:33:13.485 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:33:13.485 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 21.1055ms
2025-05-08 08:33:13.502 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-08 08:33:13.503 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:13.503 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/4 - 204 null null 0.3573ms
2025-05-08 08:33:13.504 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-08 08:33:13.505 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:13.505 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:13.505 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:33:13.505 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:33:13.512 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 08:33:13.512 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 08:33:13.513 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.8345ms
2025-05-08 08:33:13.513 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:33:13.513 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 8.8455ms
2025-05-08 08:33:13.522 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/4 - null null
2025-05-08 08:33:13.522 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:13.522 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/4 - 204 null null 0.2296ms
2025-05-08 08:33:13.523 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/4 - null null
2025-05-08 08:33:13.524 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:13.524 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:33:13.524 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:33:13.524 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 08:33:13.529 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 08:33:13.529 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:33:13.529 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.3759ms
2025-05-08 08:33:13.529 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:33:13.532 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 9.1113ms
2025-05-08 08:33:22.232 +07:00 [INF] Handling message from user 5: kj
2025-05-08 08:33:22.240 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 08:33:22.272 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 08:33:22.278 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 08:33:22.279 +07:00 [INF] Message saved to DB with ID: 159
2025-05-08 08:33:22.281 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 08:33:22.286 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 08:33:22.288 +07:00 [INF] Transaction committed for message: 159
2025-05-08 08:33:22.291 +07:00 [INF] Saved message 159 to Redis
2025-05-08 08:33:22.292 +07:00 [INF] Added message 159 to conversation 4
2025-05-08 08:33:22.295 +07:00 [INF] Published message to channel conversation:4
2025-05-08 08:33:42.376 +07:00 [INF] Handling message from user 5: jk
2025-05-08 08:33:42.383 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 08:33:42.387 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 08:33:42.389 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 08:33:42.405 +07:00 [INF] Message saved to DB with ID: 160
2025-05-08 08:33:42.406 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 08:33:42.412 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 08:33:42.417 +07:00 [INF] Transaction committed for message: 160
2025-05-08 08:33:42.424 +07:00 [INF] Saved message 160 to Redis
2025-05-08 08:33:42.425 +07:00 [INF] Added message 160 to conversation 4
2025-05-08 08:33:42.426 +07:00 [INF] Published message to channel conversation:4
2025-05-08 08:35:58.149 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 08:35:58.149 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:35:58.149 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3682ms
2025-05-08 08:35:58.150 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-08 08:35:58.151 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:35:58.151 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:35:58.151 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:35:58.151 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 08:35:58.163 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 08:35:58.164 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 08:35:58.164 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 13.1301ms
2025-05-08 08:35:58.164 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:35:58.165 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 14.1495ms
2025-05-08 08:35:58.288 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-08 08:35:58.288 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:35:58.288 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:35:58.288 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:35:58.288 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 08:35:58.297 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 08:35:58.298 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:35:58.298 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.3338ms
2025-05-08 08:35:58.298 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:35:58.299 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 10.9767ms
2025-05-08 08:35:58.367 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 08:35:58.367 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:35:58.368 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.2425ms
2025-05-08 08:35:58.369 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 08:35:58.369 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:35:58.369 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:35:58.369 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:35:58.369 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:35:58.371 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:35:58.371 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.7358ms
2025-05-08 08:35:58.371 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:35:58.371 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 2.4899ms
2025-05-08 08:35:58.472 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-08 08:35:58.472 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:35:58.472 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:35:58.472 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 08:35:58.586 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 08:36:12.428 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 08:36:12.428 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:12.428 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.1645ms
2025-05-08 08:36:12.429 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 53
2025-05-08 08:36:12.429 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:12.429 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:12.429 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:36:12.430 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 08:36:12.441 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 08:36:12.442 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 08:36:12.442 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 11.9622ms
2025-05-08 08:36:12.442 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:36:12.442 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 13.1807ms
2025-05-08 08:36:12.554 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/5 - null null
2025-05-08 08:36:12.554 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:12.554 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:12.555 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:36:12.555 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 08:36:12.562 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 08:36:12.565 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:36:12.565 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.4117ms
2025-05-08 08:36:12.565 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:36:12.566 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/5 - 200 null application/json; charset=utf-8 11.3285ms
2025-05-08 08:36:12.620 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-08 08:36:12.620 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:12.620 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 0.2095ms
2025-05-08 08:36:12.622 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-08 08:36:12.622 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:12.622 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:12.622 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:36:12.622 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:36:12.623 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:36:12.623 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.3259ms
2025-05-08 08:36:12.623 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:36:12.623 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 1.8686ms
2025-05-08 08:36:12.722 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-08 08:36:12.723 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:12.723 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:12.723 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 08:36:12.845 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 08:36:12.858 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 08:36:12.860 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 08:36:15.006 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/4/5 - null null
2025-05-08 08:36:15.006 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:15.006 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/4/5 - 204 null null 0.2276ms
2025-05-08 08:36:15.007 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/4/5 - null null
2025-05-08 08:36:15.008 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:15.008 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:15.008 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:36:15.008 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 08:36:15.027 +07:00 [INF] Retrieved 52 messages from Redis for conversation 4
2025-05-08 08:36:15.027 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-08 08:36:15.028 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:36:15.028 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 20.359ms
2025-05-08 08:36:15.028 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:36:15.029 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 21.1049ms
2025-05-08 08:36:15.046 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-08 08:36:15.047 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:15.047 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/4 - 204 null null 0.1673ms
2025-05-08 08:36:15.049 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-08 08:36:15.050 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:15.050 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:15.050 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:36:15.050 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:36:15.058 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 08:36:15.059 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 08:36:15.059 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.2922ms
2025-05-08 08:36:15.059 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:36:15.060 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 10.0843ms
2025-05-08 08:36:15.068 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/4 - null null
2025-05-08 08:36:15.068 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:15.068 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/4 - 204 null null 0.3402ms
2025-05-08 08:36:15.070 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/4 - null null
2025-05-08 08:36:15.070 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:15.070 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:15.070 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:36:15.070 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 08:36:15.075 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 08:36:15.076 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:36:15.076 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.7171ms
2025-05-08 08:36:15.076 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:36:15.076 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 6.3502ms
2025-05-08 08:36:42.978 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 08:36:42.979 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:42.979 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.7806ms
2025-05-08 08:36:42.980 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-08 08:36:42.980 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:42.980 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:42.980 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:36:42.980 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 08:36:42.983 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 08:36:42.984 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 08:36:42.984 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 3.761ms
2025-05-08 08:36:42.984 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:36:42.984 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 4.4889ms
2025-05-08 08:36:43.078 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-08 08:36:43.079 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:43.079 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:43.079 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:36:43.079 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 08:36:43.081 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 08:36:43.081 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:36:43.082 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 2.6704ms
2025-05-08 08:36:43.082 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:36:43.082 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 3.2077ms
2025-05-08 08:36:43.113 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 08:36:43.113 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:43.113 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.1925ms
2025-05-08 08:36:43.114 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 08:36:43.115 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:43.115 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:43.116 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:36:43.116 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:36:43.134 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-08 08:36:43.135 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:36:43.135 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 19.4331ms
2025-05-08 08:36:43.135 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:36:43.136 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 21.1365ms
2025-05-08 08:36:43.171 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-08 08:36:43.172 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:43.172 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:36:43.172 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 08:36:43.266 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 08:36:43.271 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 08:36:43.272 +07:00 [INF] Saved message 154 to Redis
2025-05-08 08:36:43.273 +07:00 [INF] Added message 154 to conversation 3
2025-05-08 08:36:43.274 +07:00 [INF] Saved message 117 to Redis
2025-05-08 08:36:43.274 +07:00 [INF] Added message 117 to conversation 3
2025-05-08 08:36:43.275 +07:00 [INF] Saved message 115 to Redis
2025-05-08 08:36:43.276 +07:00 [INF] Added message 115 to conversation 3
2025-05-08 08:36:43.277 +07:00 [INF] Saved message 88 to Redis
2025-05-08 08:36:43.277 +07:00 [INF] Added message 88 to conversation 3
2025-05-08 08:36:43.278 +07:00 [INF] Saved message 70 to Redis
2025-05-08 08:36:43.280 +07:00 [INF] Added message 70 to conversation 3
2025-05-08 08:36:43.281 +07:00 [INF] Saved message 65 to Redis
2025-05-08 08:36:43.282 +07:00 [INF] Added message 65 to conversation 3
2025-05-08 08:36:43.286 +07:00 [INF] Saved message 48 to Redis
2025-05-08 08:36:43.286 +07:00 [INF] Added message 48 to conversation 3
2025-05-08 08:36:43.289 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 08:36:43.291 +07:00 [INF] Saved message 160 to Redis
2025-05-08 08:36:43.292 +07:00 [INF] Added message 160 to conversation 4
2025-05-08 08:36:43.293 +07:00 [INF] Saved message 159 to Redis
2025-05-08 08:36:43.293 +07:00 [INF] Added message 159 to conversation 4
2025-05-08 08:36:43.294 +07:00 [INF] Saved message 135 to Redis
2025-05-08 08:36:43.295 +07:00 [INF] Added message 135 to conversation 4
2025-05-08 08:36:43.296 +07:00 [INF] Saved message 133 to Redis
2025-05-08 08:36:43.297 +07:00 [INF] Added message 133 to conversation 4
2025-05-08 08:36:43.298 +07:00 [INF] Saved message 132 to Redis
2025-05-08 08:36:43.300 +07:00 [INF] Added message 132 to conversation 4
2025-05-08 08:36:43.302 +07:00 [INF] Saved message 131 to Redis
2025-05-08 08:36:43.302 +07:00 [INF] Added message 131 to conversation 4
2025-05-08 08:36:43.303 +07:00 [INF] Saved message 130 to Redis
2025-05-08 08:36:43.303 +07:00 [INF] Added message 130 to conversation 4
2025-05-08 08:36:43.304 +07:00 [INF] Saved message 129 to Redis
2025-05-08 08:36:43.305 +07:00 [INF] Added message 129 to conversation 4
2025-05-08 08:36:43.305 +07:00 [INF] Saved message 128 to Redis
2025-05-08 08:36:43.306 +07:00 [INF] Added message 128 to conversation 4
2025-05-08 08:36:43.306 +07:00 [INF] Saved message 127 to Redis
2025-05-08 08:36:43.307 +07:00 [INF] Added message 127 to conversation 4
2025-05-08 08:36:43.308 +07:00 [INF] Saved message 126 to Redis
2025-05-08 08:36:43.308 +07:00 [INF] Added message 126 to conversation 4
2025-05-08 08:36:43.309 +07:00 [INF] Saved message 125 to Redis
2025-05-08 08:36:43.309 +07:00 [INF] Added message 125 to conversation 4
2025-05-08 08:36:43.310 +07:00 [INF] Saved message 124 to Redis
2025-05-08 08:36:43.310 +07:00 [INF] Added message 124 to conversation 4
2025-05-08 08:36:43.313 +07:00 [INF] Saved message 123 to Redis
2025-05-08 08:36:43.313 +07:00 [INF] Added message 123 to conversation 4
2025-05-08 08:36:43.314 +07:00 [INF] Saved message 122 to Redis
2025-05-08 08:36:43.315 +07:00 [INF] Added message 122 to conversation 4
2025-05-08 08:36:43.317 +07:00 [INF] Saved message 121 to Redis
2025-05-08 08:36:43.317 +07:00 [INF] Added message 121 to conversation 4
2025-05-08 08:36:43.318 +07:00 [INF] Saved message 120 to Redis
2025-05-08 08:36:43.319 +07:00 [INF] Added message 120 to conversation 4
2025-05-08 08:36:43.320 +07:00 [INF] Saved message 119 to Redis
2025-05-08 08:36:43.320 +07:00 [INF] Added message 119 to conversation 4
2025-05-08 08:36:43.321 +07:00 [INF] Saved message 118 to Redis
2025-05-08 08:36:43.321 +07:00 [INF] Added message 118 to conversation 4
2025-05-08 08:36:43.322 +07:00 [INF] Saved message 111 to Redis
2025-05-08 08:36:43.322 +07:00 [INF] Added message 111 to conversation 4
2025-05-08 08:36:43.322 +07:00 [INF] Saved message 97 to Redis
2025-05-08 08:36:43.323 +07:00 [INF] Added message 97 to conversation 4
2025-05-08 08:36:43.323 +07:00 [INF] Saved message 96 to Redis
2025-05-08 08:36:43.323 +07:00 [INF] Added message 96 to conversation 4
2025-05-08 08:36:43.324 +07:00 [INF] Saved message 89 to Redis
2025-05-08 08:36:43.325 +07:00 [INF] Added message 89 to conversation 4
2025-05-08 08:36:43.326 +07:00 [INF] Saved message 69 to Redis
2025-05-08 08:36:43.326 +07:00 [INF] Added message 69 to conversation 4
2025-05-08 08:36:43.328 +07:00 [INF] Saved message 67 to Redis
2025-05-08 08:36:43.328 +07:00 [INF] Added message 67 to conversation 4
2025-05-08 08:36:43.329 +07:00 [INF] Saved message 66 to Redis
2025-05-08 08:36:43.329 +07:00 [INF] Added message 66 to conversation 4
2025-05-08 08:36:43.330 +07:00 [INF] Saved message 63 to Redis
2025-05-08 08:36:43.331 +07:00 [INF] Added message 63 to conversation 4
2025-05-08 08:36:43.333 +07:00 [INF] Saved message 58 to Redis
2025-05-08 08:36:43.335 +07:00 [INF] Added message 58 to conversation 4
2025-05-08 08:36:43.337 +07:00 [INF] Saved message 56 to Redis
2025-05-08 08:36:43.338 +07:00 [INF] Added message 56 to conversation 4
2025-05-08 08:36:43.338 +07:00 [INF] Saved message 53 to Redis
2025-05-08 08:36:43.339 +07:00 [INF] Added message 53 to conversation 4
2025-05-08 08:36:43.339 +07:00 [INF] Saved message 52 to Redis
2025-05-08 08:36:43.340 +07:00 [INF] Added message 52 to conversation 4
2025-05-08 08:36:43.340 +07:00 [INF] Saved message 50 to Redis
2025-05-08 08:36:43.341 +07:00 [INF] Added message 50 to conversation 4
2025-05-08 08:36:43.341 +07:00 [INF] Saved message 47 to Redis
2025-05-08 08:36:43.342 +07:00 [INF] Added message 47 to conversation 4
2025-05-08 08:36:43.343 +07:00 [INF] Saved message 46 to Redis
2025-05-08 08:36:43.344 +07:00 [INF] Added message 46 to conversation 4
2025-05-08 08:36:43.345 +07:00 [INF] Saved message 45 to Redis
2025-05-08 08:36:43.345 +07:00 [INF] Added message 45 to conversation 4
2025-05-08 08:36:43.345 +07:00 [INF] Saved message 44 to Redis
2025-05-08 08:36:43.346 +07:00 [INF] Added message 44 to conversation 4
2025-05-08 08:36:43.346 +07:00 [INF] Saved message 43 to Redis
2025-05-08 08:36:43.346 +07:00 [INF] Added message 43 to conversation 4
2025-05-08 08:36:43.347 +07:00 [INF] Saved message 42 to Redis
2025-05-08 08:36:43.348 +07:00 [INF] Added message 42 to conversation 4
2025-05-08 08:36:43.350 +07:00 [INF] Saved message 41 to Redis
2025-05-08 08:36:43.350 +07:00 [INF] Added message 41 to conversation 4
2025-05-08 08:36:43.352 +07:00 [INF] Saved message 40 to Redis
2025-05-08 08:36:43.352 +07:00 [INF] Added message 40 to conversation 4
2025-05-08 08:36:43.353 +07:00 [INF] Saved message 39 to Redis
2025-05-08 08:36:43.353 +07:00 [INF] Added message 39 to conversation 4
2025-05-08 08:36:43.354 +07:00 [INF] Saved message 38 to Redis
2025-05-08 08:36:43.354 +07:00 [INF] Added message 38 to conversation 4
2025-05-08 08:36:43.355 +07:00 [INF] Saved message 37 to Redis
2025-05-08 08:36:43.355 +07:00 [INF] Added message 37 to conversation 4
2025-05-08 08:36:43.356 +07:00 [INF] Saved message 36 to Redis
2025-05-08 08:36:43.356 +07:00 [INF] Added message 36 to conversation 4
2025-05-08 08:36:43.357 +07:00 [INF] Saved message 35 to Redis
2025-05-08 08:36:43.358 +07:00 [INF] Added message 35 to conversation 4
2025-05-08 08:36:43.359 +07:00 [INF] Saved message 34 to Redis
2025-05-08 08:36:43.359 +07:00 [INF] Added message 34 to conversation 4
2025-05-08 08:36:43.361 +07:00 [INF] Saved message 33 to Redis
2025-05-08 08:36:43.361 +07:00 [INF] Added message 33 to conversation 4
2025-05-08 08:36:43.363 +07:00 [INF] Saved message 32 to Redis
2025-05-08 08:36:43.363 +07:00 [INF] Added message 32 to conversation 4
2025-05-08 08:36:43.364 +07:00 [INF] Saved message 31 to Redis
2025-05-08 08:36:43.365 +07:00 [INF] Added message 31 to conversation 4
2025-05-08 08:36:43.366 +07:00 [INF] Saved message 30 to Redis
2025-05-08 08:36:43.366 +07:00 [INF] Added message 30 to conversation 4
2025-05-08 08:36:43.368 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 08:36:43.370 +07:00 [INF] Saved message 158 to Redis
2025-05-08 08:36:43.371 +07:00 [INF] Added message 158 to conversation 18
2025-05-08 08:36:43.372 +07:00 [INF] Saved message 157 to Redis
2025-05-08 08:36:43.372 +07:00 [INF] Added message 157 to conversation 18
2025-05-08 08:36:43.374 +07:00 [INF] Saved message 156 to Redis
2025-05-08 08:36:43.374 +07:00 [INF] Added message 156 to conversation 18
2025-05-08 08:37:04.151 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 08:37:04.151 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:04.152 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2606ms
2025-05-08 08:37:04.153 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 53
2025-05-08 08:37:04.153 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:04.153 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:04.153 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:37:04.153 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 08:37:04.159 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 08:37:04.160 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 08:37:04.162 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 7.3135ms
2025-05-08 08:37:04.162 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:37:04.162 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 9.8128ms
2025-05-08 08:37:04.262 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/5 - null null
2025-05-08 08:37:04.262 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:04.262 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:04.262 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:37:04.262 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 08:37:04.269 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 08:37:04.270 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:37:04.270 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 7.2835ms
2025-05-08 08:37:04.270 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:37:04.270 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/5 - 200 null application/json; charset=utf-8 7.7613ms
2025-05-08 08:37:04.304 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-08 08:37:04.304 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:04.304 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 0.2314ms
2025-05-08 08:37:04.306 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-08 08:37:04.306 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:04.306 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:04.306 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:37:04.306 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:37:04.322 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-08 08:37:04.325 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:37:04.325 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 19.3073ms
2025-05-08 08:37:04.325 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:37:04.326 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 19.964ms
2025-05-08 08:37:04.372 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-08 08:37:04.372 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:04.373 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:04.373 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 08:37:04.444 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 08:37:04.450 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 08:37:04.453 +07:00 [INF] Saved message 114 to Redis
2025-05-08 08:37:04.454 +07:00 [INF] Added message 114 to conversation 1
2025-05-08 08:37:04.455 +07:00 [INF] Saved message 113 to Redis
2025-05-08 08:37:04.456 +07:00 [INF] Added message 113 to conversation 1
2025-05-08 08:37:04.457 +07:00 [INF] Saved message 112 to Redis
2025-05-08 08:37:04.457 +07:00 [INF] Added message 112 to conversation 1
2025-05-08 08:37:04.458 +07:00 [INF] Saved message 110 to Redis
2025-05-08 08:37:04.458 +07:00 [INF] Added message 110 to conversation 1
2025-05-08 08:37:04.459 +07:00 [INF] Saved message 109 to Redis
2025-05-08 08:37:04.459 +07:00 [INF] Added message 109 to conversation 1
2025-05-08 08:37:04.460 +07:00 [INF] Saved message 108 to Redis
2025-05-08 08:37:04.461 +07:00 [INF] Added message 108 to conversation 1
2025-05-08 08:37:04.462 +07:00 [INF] Saved message 107 to Redis
2025-05-08 08:37:04.462 +07:00 [INF] Added message 107 to conversation 1
2025-05-08 08:37:04.464 +07:00 [INF] Saved message 106 to Redis
2025-05-08 08:37:04.464 +07:00 [INF] Added message 106 to conversation 1
2025-05-08 08:37:04.466 +07:00 [INF] Saved message 105 to Redis
2025-05-08 08:37:04.467 +07:00 [INF] Added message 105 to conversation 1
2025-05-08 08:37:04.469 +07:00 [INF] Saved message 104 to Redis
2025-05-08 08:37:04.471 +07:00 [INF] Added message 104 to conversation 1
2025-05-08 08:37:04.472 +07:00 [INF] Saved message 103 to Redis
2025-05-08 08:37:04.473 +07:00 [INF] Added message 103 to conversation 1
2025-05-08 08:37:04.473 +07:00 [INF] Saved message 102 to Redis
2025-05-08 08:37:04.473 +07:00 [INF] Added message 102 to conversation 1
2025-05-08 08:37:04.474 +07:00 [INF] Saved message 101 to Redis
2025-05-08 08:37:04.474 +07:00 [INF] Added message 101 to conversation 1
2025-05-08 08:37:04.475 +07:00 [INF] Saved message 100 to Redis
2025-05-08 08:37:04.476 +07:00 [INF] Added message 100 to conversation 1
2025-05-08 08:37:04.477 +07:00 [INF] Saved message 99 to Redis
2025-05-08 08:37:04.478 +07:00 [INF] Added message 99 to conversation 1
2025-05-08 08:37:04.479 +07:00 [INF] Saved message 98 to Redis
2025-05-08 08:37:04.480 +07:00 [INF] Added message 98 to conversation 1
2025-05-08 08:37:04.482 +07:00 [INF] Saved message 95 to Redis
2025-05-08 08:37:04.483 +07:00 [INF] Added message 95 to conversation 1
2025-05-08 08:37:04.485 +07:00 [INF] Saved message 94 to Redis
2025-05-08 08:37:04.485 +07:00 [INF] Added message 94 to conversation 1
2025-05-08 08:37:04.487 +07:00 [INF] Saved message 93 to Redis
2025-05-08 08:37:04.487 +07:00 [INF] Added message 93 to conversation 1
2025-05-08 08:37:04.489 +07:00 [INF] Saved message 92 to Redis
2025-05-08 08:37:04.489 +07:00 [INF] Added message 92 to conversation 1
2025-05-08 08:37:04.491 +07:00 [INF] Saved message 91 to Redis
2025-05-08 08:37:04.491 +07:00 [INF] Added message 91 to conversation 1
2025-05-08 08:37:04.493 +07:00 [INF] Saved message 90 to Redis
2025-05-08 08:37:04.493 +07:00 [INF] Added message 90 to conversation 1
2025-05-08 08:37:04.495 +07:00 [INF] Saved message 87 to Redis
2025-05-08 08:37:04.495 +07:00 [INF] Added message 87 to conversation 1
2025-05-08 08:37:04.496 +07:00 [INF] Saved message 86 to Redis
2025-05-08 08:37:04.496 +07:00 [INF] Added message 86 to conversation 1
2025-05-08 08:37:04.497 +07:00 [INF] Saved message 85 to Redis
2025-05-08 08:37:04.497 +07:00 [INF] Added message 85 to conversation 1
2025-05-08 08:37:04.498 +07:00 [INF] Saved message 84 to Redis
2025-05-08 08:37:04.499 +07:00 [INF] Added message 84 to conversation 1
2025-05-08 08:37:04.502 +07:00 [INF] Saved message 83 to Redis
2025-05-08 08:37:04.503 +07:00 [INF] Added message 83 to conversation 1
2025-05-08 08:37:04.504 +07:00 [INF] Saved message 82 to Redis
2025-05-08 08:37:04.504 +07:00 [INF] Added message 82 to conversation 1
2025-05-08 08:37:04.504 +07:00 [INF] Saved message 81 to Redis
2025-05-08 08:37:04.505 +07:00 [INF] Added message 81 to conversation 1
2025-05-08 08:37:04.505 +07:00 [INF] Saved message 80 to Redis
2025-05-08 08:37:04.506 +07:00 [INF] Added message 80 to conversation 1
2025-05-08 08:37:04.506 +07:00 [INF] Saved message 79 to Redis
2025-05-08 08:37:04.506 +07:00 [INF] Added message 79 to conversation 1
2025-05-08 08:37:04.507 +07:00 [INF] Saved message 78 to Redis
2025-05-08 08:37:04.507 +07:00 [INF] Added message 78 to conversation 1
2025-05-08 08:37:04.508 +07:00 [INF] Saved message 77 to Redis
2025-05-08 08:37:04.509 +07:00 [INF] Added message 77 to conversation 1
2025-05-08 08:37:04.509 +07:00 [INF] Saved message 76 to Redis
2025-05-08 08:37:04.509 +07:00 [INF] Added message 76 to conversation 1
2025-05-08 08:37:04.510 +07:00 [INF] Saved message 75 to Redis
2025-05-08 08:37:04.510 +07:00 [INF] Added message 75 to conversation 1
2025-05-08 08:37:04.511 +07:00 [INF] Saved message 74 to Redis
2025-05-08 08:37:04.511 +07:00 [INF] Added message 74 to conversation 1
2025-05-08 08:37:04.512 +07:00 [INF] Saved message 73 to Redis
2025-05-08 08:37:04.512 +07:00 [INF] Added message 73 to conversation 1
2025-05-08 08:37:04.513 +07:00 [INF] Saved message 72 to Redis
2025-05-08 08:37:04.513 +07:00 [INF] Added message 72 to conversation 1
2025-05-08 08:37:04.514 +07:00 [INF] Saved message 71 to Redis
2025-05-08 08:37:04.515 +07:00 [INF] Added message 71 to conversation 1
2025-05-08 08:37:04.516 +07:00 [INF] Saved message 68 to Redis
2025-05-08 08:37:04.517 +07:00 [INF] Added message 68 to conversation 1
2025-05-08 08:37:04.519 +07:00 [INF] Saved message 64 to Redis
2025-05-08 08:37:04.519 +07:00 [INF] Added message 64 to conversation 1
2025-05-08 08:37:04.520 +07:00 [INF] Saved message 62 to Redis
2025-05-08 08:37:04.520 +07:00 [INF] Added message 62 to conversation 1
2025-05-08 08:37:04.521 +07:00 [INF] Saved message 61 to Redis
2025-05-08 08:37:04.521 +07:00 [INF] Added message 61 to conversation 1
2025-05-08 08:37:04.522 +07:00 [INF] Saved message 60 to Redis
2025-05-08 08:37:04.522 +07:00 [INF] Added message 60 to conversation 1
2025-05-08 08:37:04.523 +07:00 [INF] Saved message 59 to Redis
2025-05-08 08:37:04.523 +07:00 [INF] Added message 59 to conversation 1
2025-05-08 08:37:04.523 +07:00 [INF] Saved message 57 to Redis
2025-05-08 08:37:04.524 +07:00 [INF] Added message 57 to conversation 1
2025-05-08 08:37:04.524 +07:00 [INF] Saved message 55 to Redis
2025-05-08 08:37:04.525 +07:00 [INF] Added message 55 to conversation 1
2025-05-08 08:37:04.526 +07:00 [INF] Saved message 54 to Redis
2025-05-08 08:37:04.526 +07:00 [INF] Added message 54 to conversation 1
2025-05-08 08:37:04.527 +07:00 [INF] Saved message 51 to Redis
2025-05-08 08:37:04.527 +07:00 [INF] Added message 51 to conversation 1
2025-05-08 08:37:04.528 +07:00 [INF] Saved message 49 to Redis
2025-05-08 08:37:04.528 +07:00 [INF] Added message 49 to conversation 1
2025-05-08 08:37:04.530 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 08:37:04.532 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 08:37:07.017 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/4/5 - null null
2025-05-08 08:37:07.017 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:07.017 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/4/5 - 204 null null 0.2184ms
2025-05-08 08:37:07.018 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/4/5 - null null
2025-05-08 08:37:07.018 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:07.019 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:07.019 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:37:07.019 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 08:37:07.058 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4
2025-05-08 08:37:07.058 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-08 08:37:07.059 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:37:07.059 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 40.0369ms
2025-05-08 08:37:07.059 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:37:07.059 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 40.6613ms
2025-05-08 08:37:07.082 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-08 08:37:07.082 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:07.083 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/4 - 204 null null 0.2061ms
2025-05-08 08:37:07.084 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-08 08:37:07.084 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:07.084 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:07.084 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:37:07.084 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:37:07.090 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 08:37:07.091 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 08:37:07.091 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.17ms
2025-05-08 08:37:07.091 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:37:07.091 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 6.7543ms
2025-05-08 08:37:07.096 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/4 - null null
2025-05-08 08:37:07.096 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:07.097 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/4 - 204 null null 0.2154ms
2025-05-08 08:37:07.098 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/4 - null null
2025-05-08 08:37:07.098 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:07.098 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:07.098 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:37:07.098 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 08:37:07.103 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 08:37:07.105 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:37:07.105 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.4185ms
2025-05-08 08:37:07.105 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:37:07.105 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 7.0338ms
2025-05-08 08:37:10.475 +07:00 [INF] Handling message from user 5: m,n
2025-05-08 08:37:10.480 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 08:37:10.492 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 08:37:10.498 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 08:37:10.501 +07:00 [INF] Message saved to DB with ID: 161
2025-05-08 08:37:10.502 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 08:37:10.508 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 08:37:10.509 +07:00 [INF] Transaction committed for message: 161
2025-05-08 08:37:10.511 +07:00 [INF] Saved message 161 to Redis
2025-05-08 08:37:10.511 +07:00 [INF] Added message 161 to conversation 4
2025-05-08 08:37:10.512 +07:00 [INF] Published message to channel conversation:4
2025-05-08 08:37:16.419 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/4/2 - null null
2025-05-08 08:37:16.419 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:16.420 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/4/2 - 204 null null 0.2172ms
2025-05-08 08:37:16.421 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/4/2 - null null
2025-05-08 08:37:16.421 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:16.421 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:16.421 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:37:16.422 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 08:37:16.456 +07:00 [INF] Retrieved 51 messages from Redis for conversation 4
2025-05-08 08:37:16.456 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-08 08:37:16.456 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:37:16.457 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 35.2535ms
2025-05-08 08:37:16.457 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 08:37:16.457 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 35.9814ms
2025-05-08 08:37:16.483 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-08 08:37:16.483 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:16.483 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/4 - 204 null null 0.3462ms
2025-05-08 08:37:16.486 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-08 08:37:16.486 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:16.486 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:16.487 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:37:16.487 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:37:16.507 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 08:37:16.508 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 08:37:16.508 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 21.2481ms
2025-05-08 08:37:16.508 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 08:37:16.508 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 22.3992ms
2025-05-08 08:37:16.518 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/4 - null null
2025-05-08 08:37:16.518 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:16.518 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/4 - 204 null null 0.3772ms
2025-05-08 08:37:16.520 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/4 - null null
2025-05-08 08:37:16.520 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:16.520 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:37:16.521 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:37:16.521 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 08:37:16.525 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 08:37:16.526 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:37:16.526 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.5464ms
2025-05-08 08:37:16.526 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 08:37:16.526 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 6.1317ms
2025-05-08 08:39:03.855 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 08:39:03.855 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 08:39:03.855 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 140683.76ms
2025-05-08 08:39:03.855 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 185383.4082ms
2025-05-08 08:39:03.855 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 08:39:03.855 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 553986.6776ms
2025-05-08 08:39:18.717 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 08:39:18.718 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:39:18.718 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3523ms
2025-05-08 08:39:18.719 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-08 08:39:18.720 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:39:18.720 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:39:18.720 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:39:18.720 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 08:39:18.732 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 08:39:18.733 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 08:39:18.733 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 13.0606ms
2025-05-08 08:39:18.733 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 08:39:18.733 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 13.6771ms
2025-05-08 08:39:18.855 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-08 08:39:18.855 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:39:18.855 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:39:18.855 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:39:18.855 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 08:39:18.864 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 08:39:18.865 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 08:39:18.865 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.688ms
2025-05-08 08:39:18.865 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 08:39:18.865 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 10.2998ms
2025-05-08 08:39:18.922 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 08:39:18.922 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:39:18.922 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.218ms
2025-05-08 08:39:18.924 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 08:39:18.924 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:39:18.924 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:39:18.924 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:39:18.924 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 08:39:18.925 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 08:39:18.925 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.0207ms
2025-05-08 08:39:18.925 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 08:39:18.925 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 1.7364ms
2025-05-08 08:39:19.034 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-08 08:39:19.034 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:39:19.034 +07:00 [INF] CORS policy execution successful.
2025-05-08 08:39:19.034 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 08:39:19.161 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 09:34:00.621 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 09:34:00.621 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 09:34:00.621 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 09:34:00.621 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 09:42:21.811 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 09:42:21.811 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 09:42:21.811 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 09:42:22.293 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 09:42:21.810 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-08 09:42:22.301 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 09:42:22.390 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 09:42:22.489 +07:00 [ERR] Connection id "0HNCDPE70R9F8", Request id "0HNCDPE70R9F8:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 09:42:23.060 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-08 09:42:23.126 +07:00 [ERR] Connection id "0HNCDPE70R9FE", Request id "0HNCDPE70R9FE:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 09:42:23.141 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 4151593.0352ms
2025-05-08 09:42:23.064 +07:00 [ERR] Connection id "0HNCDPE70R9FC", Request id "0HNCDPE70R9FC:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 09:42:23.061 +07:00 [ERR] Connection id "0HNCDPE70R9FF", Request id "0HNCDPE70R9FF:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-08 09:42:23.227 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 3918854.8758ms
2025-05-08 09:42:23.236 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 3970513.2103ms
2025-05-08 09:42:23.332 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 3784298.0788ms
2025-05-08 10:36:56.833 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 10:36:56.847 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:36:56.854 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 20.3657ms
2025-05-08 10:36:56.856 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-08 10:36:56.859 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:36:56.863 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:36:56.868 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:36:56.877 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 10:36:57.132 +07:00 [INF] Executed DbCommand (89ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 10:36:57.157 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 10:36:57.163 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 285.3174ms
2025-05-08 10:36:57.163 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:36:57.163 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 307.7191ms
2025-05-08 10:36:57.354 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-08 10:36:57.358 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:36:57.359 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:36:57.359 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:36:57.360 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 10:36:57.448 +07:00 [INF] Executed DbCommand (68ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 10:36:57.449 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:36:57.451 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 90.9546ms
2025-05-08 10:36:57.451 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:36:57.451 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 96.8389ms
2025-05-08 10:36:57.462 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 10:36:57.462 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:36:57.463 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 1.8995ms
2025-05-08 10:36:57.464 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 10:36:57.464 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:36:57.465 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:36:57.465 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:36:57.466 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:36:57.527 +07:00 [INF] Executed DbCommand (47ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-08 10:36:57.542 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:36:57.543 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 76.5074ms
2025-05-08 10:36:57.543 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:36:57.543 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 78.8923ms
2025-05-08 10:36:57.558 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-08 10:36:57.559 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:36:57.559 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:36:57.559 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 10:36:57.694 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 10:36:57.740 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:36:57.746 +07:00 [INF] Saved message 154 to Redis
2025-05-08 10:36:57.747 +07:00 [INF] Added message 154 to conversation 3
2025-05-08 10:36:57.748 +07:00 [INF] Saved message 117 to Redis
2025-05-08 10:36:57.749 +07:00 [INF] Added message 117 to conversation 3
2025-05-08 10:36:57.750 +07:00 [INF] Saved message 115 to Redis
2025-05-08 10:36:57.750 +07:00 [INF] Added message 115 to conversation 3
2025-05-08 10:36:57.751 +07:00 [INF] Saved message 88 to Redis
2025-05-08 10:36:57.751 +07:00 [INF] Added message 88 to conversation 3
2025-05-08 10:36:57.752 +07:00 [INF] Saved message 70 to Redis
2025-05-08 10:36:57.753 +07:00 [INF] Added message 70 to conversation 3
2025-05-08 10:36:57.755 +07:00 [INF] Saved message 65 to Redis
2025-05-08 10:36:57.755 +07:00 [INF] Added message 65 to conversation 3
2025-05-08 10:36:57.756 +07:00 [INF] Saved message 48 to Redis
2025-05-08 10:36:57.756 +07:00 [INF] Added message 48 to conversation 3
2025-05-08 10:36:57.763 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:36:57.766 +07:00 [INF] Saved message 161 to Redis
2025-05-08 10:36:57.766 +07:00 [INF] Added message 161 to conversation 4
2025-05-08 10:36:57.766 +07:00 [INF] Saved message 160 to Redis
2025-05-08 10:36:57.767 +07:00 [INF] Added message 160 to conversation 4
2025-05-08 10:36:57.767 +07:00 [INF] Saved message 159 to Redis
2025-05-08 10:36:57.768 +07:00 [INF] Added message 159 to conversation 4
2025-05-08 10:36:57.768 +07:00 [INF] Saved message 135 to Redis
2025-05-08 10:36:57.770 +07:00 [INF] Added message 135 to conversation 4
2025-05-08 10:36:57.771 +07:00 [INF] Saved message 133 to Redis
2025-05-08 10:36:57.771 +07:00 [INF] Added message 133 to conversation 4
2025-05-08 10:36:57.772 +07:00 [INF] Saved message 132 to Redis
2025-05-08 10:36:57.772 +07:00 [INF] Added message 132 to conversation 4
2025-05-08 10:36:57.773 +07:00 [INF] Saved message 131 to Redis
2025-05-08 10:36:57.774 +07:00 [INF] Added message 131 to conversation 4
2025-05-08 10:36:57.775 +07:00 [INF] Saved message 130 to Redis
2025-05-08 10:36:57.775 +07:00 [INF] Added message 130 to conversation 4
2025-05-08 10:36:57.776 +07:00 [INF] Saved message 129 to Redis
2025-05-08 10:36:57.776 +07:00 [INF] Added message 129 to conversation 4
2025-05-08 10:36:57.777 +07:00 [INF] Saved message 128 to Redis
2025-05-08 10:36:57.778 +07:00 [INF] Added message 128 to conversation 4
2025-05-08 10:36:57.794 +07:00 [INF] Saved message 127 to Redis
2025-05-08 10:36:57.795 +07:00 [INF] Added message 127 to conversation 4
2025-05-08 10:36:57.796 +07:00 [INF] Saved message 126 to Redis
2025-05-08 10:36:57.797 +07:00 [INF] Added message 126 to conversation 4
2025-05-08 10:36:57.797 +07:00 [INF] Saved message 125 to Redis
2025-05-08 10:36:57.797 +07:00 [INF] Added message 125 to conversation 4
2025-05-08 10:36:57.798 +07:00 [INF] Saved message 124 to Redis
2025-05-08 10:36:57.798 +07:00 [INF] Added message 124 to conversation 4
2025-05-08 10:36:57.799 +07:00 [INF] Saved message 123 to Redis
2025-05-08 10:36:57.799 +07:00 [INF] Added message 123 to conversation 4
2025-05-08 10:36:57.800 +07:00 [INF] Saved message 122 to Redis
2025-05-08 10:36:57.800 +07:00 [INF] Added message 122 to conversation 4
2025-05-08 10:36:57.801 +07:00 [INF] Saved message 121 to Redis
2025-05-08 10:36:57.801 +07:00 [INF] Added message 121 to conversation 4
2025-05-08 10:36:57.804 +07:00 [INF] Saved message 120 to Redis
2025-05-08 10:36:57.804 +07:00 [INF] Added message 120 to conversation 4
2025-05-08 10:36:57.805 +07:00 [INF] Saved message 119 to Redis
2025-05-08 10:36:57.806 +07:00 [INF] Added message 119 to conversation 4
2025-05-08 10:36:57.807 +07:00 [INF] Saved message 118 to Redis
2025-05-08 10:36:57.807 +07:00 [INF] Added message 118 to conversation 4
2025-05-08 10:36:57.808 +07:00 [INF] Saved message 111 to Redis
2025-05-08 10:36:57.809 +07:00 [INF] Added message 111 to conversation 4
2025-05-08 10:36:57.810 +07:00 [INF] Saved message 97 to Redis
2025-05-08 10:36:57.810 +07:00 [INF] Added message 97 to conversation 4
2025-05-08 10:36:57.811 +07:00 [INF] Saved message 96 to Redis
2025-05-08 10:36:57.811 +07:00 [INF] Added message 96 to conversation 4
2025-05-08 10:36:57.812 +07:00 [INF] Saved message 89 to Redis
2025-05-08 10:36:57.813 +07:00 [INF] Added message 89 to conversation 4
2025-05-08 10:36:57.813 +07:00 [INF] Saved message 69 to Redis
2025-05-08 10:36:57.813 +07:00 [INF] Added message 69 to conversation 4
2025-05-08 10:36:57.814 +07:00 [INF] Saved message 67 to Redis
2025-05-08 10:36:57.815 +07:00 [INF] Added message 67 to conversation 4
2025-05-08 10:36:57.820 +07:00 [INF] Saved message 66 to Redis
2025-05-08 10:36:57.820 +07:00 [INF] Added message 66 to conversation 4
2025-05-08 10:36:57.821 +07:00 [INF] Saved message 63 to Redis
2025-05-08 10:36:57.822 +07:00 [INF] Added message 63 to conversation 4
2025-05-08 10:36:57.823 +07:00 [INF] Saved message 58 to Redis
2025-05-08 10:36:57.824 +07:00 [INF] Added message 58 to conversation 4
2025-05-08 10:36:57.825 +07:00 [INF] Saved message 56 to Redis
2025-05-08 10:36:57.825 +07:00 [INF] Added message 56 to conversation 4
2025-05-08 10:36:57.826 +07:00 [INF] Saved message 53 to Redis
2025-05-08 10:36:57.826 +07:00 [INF] Added message 53 to conversation 4
2025-05-08 10:36:57.827 +07:00 [INF] Saved message 52 to Redis
2025-05-08 10:36:57.828 +07:00 [INF] Added message 52 to conversation 4
2025-05-08 10:36:57.829 +07:00 [INF] Saved message 50 to Redis
2025-05-08 10:36:57.829 +07:00 [INF] Added message 50 to conversation 4
2025-05-08 10:36:57.830 +07:00 [INF] Saved message 47 to Redis
2025-05-08 10:36:57.900 +07:00 [INF] Added message 47 to conversation 4
2025-05-08 10:36:57.907 +07:00 [INF] Saved message 46 to Redis
2025-05-08 10:36:57.910 +07:00 [INF] Added message 46 to conversation 4
2025-05-08 10:36:57.913 +07:00 [INF] Saved message 45 to Redis
2025-05-08 10:36:57.914 +07:00 [INF] Added message 45 to conversation 4
2025-05-08 10:36:57.915 +07:00 [INF] Saved message 44 to Redis
2025-05-08 10:36:57.915 +07:00 [INF] Added message 44 to conversation 4
2025-05-08 10:36:57.916 +07:00 [INF] Saved message 43 to Redis
2025-05-08 10:36:57.916 +07:00 [INF] Added message 43 to conversation 4
2025-05-08 10:36:57.927 +07:00 [INF] Saved message 42 to Redis
2025-05-08 10:36:57.927 +07:00 [INF] Added message 42 to conversation 4
2025-05-08 10:36:57.928 +07:00 [INF] Saved message 41 to Redis
2025-05-08 10:36:57.928 +07:00 [INF] Added message 41 to conversation 4
2025-05-08 10:36:57.929 +07:00 [INF] Saved message 40 to Redis
2025-05-08 10:36:57.929 +07:00 [INF] Added message 40 to conversation 4
2025-05-08 10:36:57.930 +07:00 [INF] Saved message 39 to Redis
2025-05-08 10:36:57.930 +07:00 [INF] Added message 39 to conversation 4
2025-05-08 10:36:57.931 +07:00 [INF] Saved message 38 to Redis
2025-05-08 10:36:57.931 +07:00 [INF] Added message 38 to conversation 4
2025-05-08 10:36:57.932 +07:00 [INF] Saved message 37 to Redis
2025-05-08 10:36:57.933 +07:00 [INF] Added message 37 to conversation 4
2025-05-08 10:36:57.934 +07:00 [INF] Saved message 36 to Redis
2025-05-08 10:36:57.934 +07:00 [INF] Added message 36 to conversation 4
2025-05-08 10:36:57.935 +07:00 [INF] Saved message 35 to Redis
2025-05-08 10:36:57.935 +07:00 [INF] Added message 35 to conversation 4
2025-05-08 10:36:57.937 +07:00 [INF] Saved message 34 to Redis
2025-05-08 10:36:57.938 +07:00 [INF] Added message 34 to conversation 4
2025-05-08 10:36:57.938 +07:00 [INF] Saved message 33 to Redis
2025-05-08 10:36:57.938 +07:00 [INF] Added message 33 to conversation 4
2025-05-08 10:36:57.939 +07:00 [INF] Saved message 32 to Redis
2025-05-08 10:36:57.939 +07:00 [INF] Added message 32 to conversation 4
2025-05-08 10:36:57.940 +07:00 [INF] Saved message 31 to Redis
2025-05-08 10:36:57.940 +07:00 [INF] Added message 31 to conversation 4
2025-05-08 10:36:57.943 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:36:57.945 +07:00 [INF] Saved message 158 to Redis
2025-05-08 10:36:57.945 +07:00 [INF] Added message 158 to conversation 18
2025-05-08 10:36:57.946 +07:00 [INF] Saved message 157 to Redis
2025-05-08 10:36:57.947 +07:00 [INF] Added message 157 to conversation 18
2025-05-08 10:36:57.947 +07:00 [INF] Saved message 156 to Redis
2025-05-08 10:36:57.948 +07:00 [INF] Added message 156 to conversation 18
2025-05-08 10:37:22.629 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 10:37:22.630 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:22.630 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.6219ms
2025-05-08 10:37:22.631 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-08 10:37:22.632 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:22.633 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:22.633 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:37:22.640 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 10:37:22.650 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 10:37:22.666 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 10:37:22.666 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 25.6429ms
2025-05-08 10:37:22.666 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:37:22.666 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 34.4848ms
2025-05-08 10:37:22.818 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-08 10:37:22.818 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:22.818 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:22.818 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:37:22.818 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 10:37:22.835 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 10:37:22.835 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:37:22.839 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 21.0075ms
2025-05-08 10:37:22.839 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:37:22.840 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 21.9065ms
2025-05-08 10:37:22.938 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 10:37:22.938 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:22.939 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.2309ms
2025-05-08 10:37:22.940 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 10:37:22.940 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:22.940 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:22.940 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:37:22.940 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:37:22.944 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:37:22.945 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 4.3031ms
2025-05-08 10:37:22.945 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:37:22.945 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.7823ms
2025-05-08 10:37:23.013 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-08 10:37:23.013 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:23.013 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:23.013 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 10:37:23.119 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 10:37:41.649 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 10:37:41.649 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:41.649 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3402ms
2025-05-08 10:37:41.650 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-08 10:37:41.650 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:41.650 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:41.651 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:37:41.651 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 10:37:41.666 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 10:37:41.667 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 10:37:41.667 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 16.101ms
2025-05-08 10:37:41.667 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:37:41.667 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 17.062ms
2025-05-08 10:37:41.787 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-08 10:37:41.787 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:41.787 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:41.787 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:37:41.787 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 10:37:41.798 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 10:37:41.798 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:37:41.799 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.2677ms
2025-05-08 10:37:41.799 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:37:41.799 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 11.8057ms
2025-05-08 10:37:41.832 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-08 10:37:41.833 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:41.833 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.4983ms
2025-05-08 10:37:41.834 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-08 10:37:41.835 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:41.835 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:41.835 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:37:41.835 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:37:41.861 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-08 10:37:41.862 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:37:41.862 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 26.7356ms
2025-05-08 10:37:41.862 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:37:41.862 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 27.9973ms
2025-05-08 10:37:41.901 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-08 10:37:41.901 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:41.901 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:37:41.901 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 10:37:41.915 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 10:37:41.932 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:37:41.934 +07:00 [INF] Saved message 114 to Redis
2025-05-08 10:37:41.934 +07:00 [INF] Added message 114 to conversation 1
2025-05-08 10:37:41.934 +07:00 [INF] Saved message 113 to Redis
2025-05-08 10:37:41.935 +07:00 [INF] Added message 113 to conversation 1
2025-05-08 10:37:41.935 +07:00 [INF] Saved message 112 to Redis
2025-05-08 10:37:41.936 +07:00 [INF] Added message 112 to conversation 1
2025-05-08 10:37:41.936 +07:00 [INF] Saved message 110 to Redis
2025-05-08 10:37:41.937 +07:00 [INF] Added message 110 to conversation 1
2025-05-08 10:37:41.938 +07:00 [INF] Saved message 109 to Redis
2025-05-08 10:37:41.938 +07:00 [INF] Added message 109 to conversation 1
2025-05-08 10:37:41.940 +07:00 [INF] Saved message 108 to Redis
2025-05-08 10:37:41.940 +07:00 [INF] Added message 108 to conversation 1
2025-05-08 10:37:41.941 +07:00 [INF] Saved message 107 to Redis
2025-05-08 10:37:41.941 +07:00 [INF] Added message 107 to conversation 1
2025-05-08 10:37:41.942 +07:00 [INF] Saved message 106 to Redis
2025-05-08 10:37:41.942 +07:00 [INF] Added message 106 to conversation 1
2025-05-08 10:37:41.942 +07:00 [INF] Saved message 105 to Redis
2025-05-08 10:37:41.943 +07:00 [INF] Added message 105 to conversation 1
2025-05-08 10:37:41.943 +07:00 [INF] Saved message 104 to Redis
2025-05-08 10:37:41.943 +07:00 [INF] Added message 104 to conversation 1
2025-05-08 10:37:41.944 +07:00 [INF] Saved message 103 to Redis
2025-05-08 10:37:41.944 +07:00 [INF] Added message 103 to conversation 1
2025-05-08 10:37:41.945 +07:00 [INF] Saved message 102 to Redis
2025-05-08 10:37:41.945 +07:00 [INF] Added message 102 to conversation 1
2025-05-08 10:37:41.946 +07:00 [INF] Saved message 101 to Redis
2025-05-08 10:37:41.946 +07:00 [INF] Added message 101 to conversation 1
2025-05-08 10:37:41.947 +07:00 [INF] Saved message 100 to Redis
2025-05-08 10:37:41.947 +07:00 [INF] Added message 100 to conversation 1
2025-05-08 10:37:41.948 +07:00 [INF] Saved message 99 to Redis
2025-05-08 10:37:41.948 +07:00 [INF] Added message 99 to conversation 1
2025-05-08 10:37:41.948 +07:00 [INF] Saved message 98 to Redis
2025-05-08 10:37:41.949 +07:00 [INF] Added message 98 to conversation 1
2025-05-08 10:37:41.949 +07:00 [INF] Saved message 95 to Redis
2025-05-08 10:37:41.949 +07:00 [INF] Added message 95 to conversation 1
2025-05-08 10:37:41.950 +07:00 [INF] Saved message 94 to Redis
2025-05-08 10:37:41.950 +07:00 [INF] Added message 94 to conversation 1
2025-05-08 10:37:41.951 +07:00 [INF] Saved message 93 to Redis
2025-05-08 10:37:41.951 +07:00 [INF] Added message 93 to conversation 1
2025-05-08 10:37:41.951 +07:00 [INF] Saved message 92 to Redis
2025-05-08 10:37:41.951 +07:00 [INF] Added message 92 to conversation 1
2025-05-08 10:37:41.952 +07:00 [INF] Saved message 91 to Redis
2025-05-08 10:37:41.952 +07:00 [INF] Added message 91 to conversation 1
2025-05-08 10:37:41.954 +07:00 [INF] Saved message 90 to Redis
2025-05-08 10:37:41.955 +07:00 [INF] Added message 90 to conversation 1
2025-05-08 10:37:41.955 +07:00 [INF] Saved message 87 to Redis
2025-05-08 10:37:41.956 +07:00 [INF] Added message 87 to conversation 1
2025-05-08 10:37:41.956 +07:00 [INF] Saved message 86 to Redis
2025-05-08 10:37:41.956 +07:00 [INF] Added message 86 to conversation 1
2025-05-08 10:37:41.957 +07:00 [INF] Saved message 85 to Redis
2025-05-08 10:37:41.957 +07:00 [INF] Added message 85 to conversation 1
2025-05-08 10:37:41.958 +07:00 [INF] Saved message 84 to Redis
2025-05-08 10:37:41.958 +07:00 [INF] Added message 84 to conversation 1
2025-05-08 10:37:41.959 +07:00 [INF] Saved message 83 to Redis
2025-05-08 10:37:41.959 +07:00 [INF] Added message 83 to conversation 1
2025-05-08 10:37:41.960 +07:00 [INF] Saved message 82 to Redis
2025-05-08 10:37:41.960 +07:00 [INF] Added message 82 to conversation 1
2025-05-08 10:37:41.960 +07:00 [INF] Saved message 81 to Redis
2025-05-08 10:37:41.961 +07:00 [INF] Added message 81 to conversation 1
2025-05-08 10:37:41.961 +07:00 [INF] Saved message 80 to Redis
2025-05-08 10:37:41.961 +07:00 [INF] Added message 80 to conversation 1
2025-05-08 10:37:41.962 +07:00 [INF] Saved message 79 to Redis
2025-05-08 10:37:41.962 +07:00 [INF] Added message 79 to conversation 1
2025-05-08 10:37:41.963 +07:00 [INF] Saved message 78 to Redis
2025-05-08 10:37:41.963 +07:00 [INF] Added message 78 to conversation 1
2025-05-08 10:37:41.963 +07:00 [INF] Saved message 77 to Redis
2025-05-08 10:37:41.964 +07:00 [INF] Added message 77 to conversation 1
2025-05-08 10:37:41.964 +07:00 [INF] Saved message 76 to Redis
2025-05-08 10:37:41.964 +07:00 [INF] Added message 76 to conversation 1
2025-05-08 10:37:41.965 +07:00 [INF] Saved message 75 to Redis
2025-05-08 10:37:41.965 +07:00 [INF] Added message 75 to conversation 1
2025-05-08 10:37:41.965 +07:00 [INF] Saved message 74 to Redis
2025-05-08 10:37:41.966 +07:00 [INF] Added message 74 to conversation 1
2025-05-08 10:37:41.966 +07:00 [INF] Saved message 73 to Redis
2025-05-08 10:37:41.966 +07:00 [INF] Added message 73 to conversation 1
2025-05-08 10:37:41.967 +07:00 [INF] Saved message 72 to Redis
2025-05-08 10:37:41.967 +07:00 [INF] Added message 72 to conversation 1
2025-05-08 10:37:41.968 +07:00 [INF] Saved message 71 to Redis
2025-05-08 10:37:41.968 +07:00 [INF] Added message 71 to conversation 1
2025-05-08 10:37:41.968 +07:00 [INF] Saved message 68 to Redis
2025-05-08 10:37:41.968 +07:00 [INF] Added message 68 to conversation 1
2025-05-08 10:37:41.969 +07:00 [INF] Saved message 64 to Redis
2025-05-08 10:37:41.969 +07:00 [INF] Added message 64 to conversation 1
2025-05-08 10:37:41.970 +07:00 [INF] Saved message 62 to Redis
2025-05-08 10:37:41.971 +07:00 [INF] Added message 62 to conversation 1
2025-05-08 10:37:41.972 +07:00 [INF] Saved message 61 to Redis
2025-05-08 10:37:41.972 +07:00 [INF] Added message 61 to conversation 1
2025-05-08 10:37:41.973 +07:00 [INF] Saved message 60 to Redis
2025-05-08 10:37:41.973 +07:00 [INF] Added message 60 to conversation 1
2025-05-08 10:37:41.974 +07:00 [INF] Saved message 59 to Redis
2025-05-08 10:37:41.974 +07:00 [INF] Added message 59 to conversation 1
2025-05-08 10:37:41.974 +07:00 [INF] Saved message 57 to Redis
2025-05-08 10:37:41.974 +07:00 [INF] Added message 57 to conversation 1
2025-05-08 10:37:41.975 +07:00 [INF] Saved message 55 to Redis
2025-05-08 10:37:41.975 +07:00 [INF] Added message 55 to conversation 1
2025-05-08 10:37:41.976 +07:00 [INF] Saved message 54 to Redis
2025-05-08 10:37:41.976 +07:00 [INF] Added message 54 to conversation 1
2025-05-08 10:37:41.976 +07:00 [INF] Saved message 51 to Redis
2025-05-08 10:37:41.976 +07:00 [INF] Added message 51 to conversation 1
2025-05-08 10:37:41.977 +07:00 [INF] Saved message 49 to Redis
2025-05-08 10:37:41.977 +07:00 [INF] Added message 49 to conversation 1
2025-05-08 10:37:41.993 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:37:41.994 +07:00 [INF] Saved message 142 to Redis
2025-05-08 10:37:41.995 +07:00 [INF] Added message 142 to conversation 2
2025-05-08 10:37:41.996 +07:00 [INF] Saved message 4 to Redis
2025-05-08 10:37:41.996 +07:00 [INF] Added message 4 to conversation 2
2025-05-08 10:37:42.001 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:38:26.616 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-08 10:38:26.617 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:26.617 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - 204 null null 0.7257ms
2025-05-08 10:38:26.619 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-08 10:38:26.619 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:26.620 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:26.620 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:38:26.634 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 10:38:26.641 +07:00 [INF] Retrieved 3 messages from Redis for conversation 18
2025-05-08 10:38:26.643 +07:00 [INF] Retrieved 3 messages from Redis for conversation 18 and user 2
2025-05-08 10:38:26.643 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:38:26.643 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 9.3094ms
2025-05-08 10:38:26.643 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:38:26.644 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - 200 null application/json; charset=utf-8 24.4561ms
2025-05-08 10:38:26.651 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:38:26.651 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:26.651 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 0.1617ms
2025-05-08 10:38:26.653 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:38:26.653 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:26.654 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:26.654 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:38:26.654 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:38:26.677 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 10:38:26.681 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 10:38:26.682 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 28.3671ms
2025-05-08 10:38:26.682 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:38:26.682 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 29.7618ms
2025-05-08 10:38:26.688 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:38:26.689 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:26.690 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 1.6256ms
2025-05-08 10:38:26.691 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:38:26.692 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:26.692 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:26.692 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:38:26.692 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 10:38:26.698 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 10:38:26.699 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:38:26.700 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.6926ms
2025-05-08 10:38:26.700 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:38:26.700 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 8.4002ms
2025-05-08 10:38:29.650 +07:00 [INF] Handling message from user 2: asdas
2025-05-08 10:38:29.676 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 10:38:29.702 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:38:29.768 +07:00 [INF] Executed DbCommand (66ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 10:38:29.770 +07:00 [INF] Message saved to DB with ID: 162
2025-05-08 10:38:29.774 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:38:29.796 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 10:38:29.797 +07:00 [INF] Transaction committed for message: 162
2025-05-08 10:38:29.799 +07:00 [INF] Saved message 162 to Redis
2025-05-08 10:38:29.799 +07:00 [INF] Added message 162 to conversation 18
2025-05-08 10:38:29.800 +07:00 [INF] Published message to channel conversation:18
2025-05-08 10:38:36.528 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 10:38:36.528 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 54626.974ms
2025-05-08 10:38:36.532 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 10:38:36.532 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 73519.4722ms
2025-05-08 10:38:50.142 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 10:38:50.142 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:50.142 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.1811ms
2025-05-08 10:38:50.144 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-08 10:38:50.144 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:50.144 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:50.144 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:38:50.144 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 10:38:50.204 +07:00 [INF] Executed DbCommand (59ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 10:38:50.206 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 10:38:50.207 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 63.6015ms
2025-05-08 10:38:50.208 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:38:50.208 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 64.0967ms
2025-05-08 10:38:50.358 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-08 10:38:50.358 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:50.358 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:50.358 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:38:50.358 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 10:38:50.370 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 10:38:50.370 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:38:50.370 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.8427ms
2025-05-08 10:38:50.370 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:38:50.370 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 12.3575ms
2025-05-08 10:38:50.435 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-08 10:38:50.435 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:50.436 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3261ms
2025-05-08 10:38:50.437 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-08 10:38:50.437 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:50.437 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:50.437 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:38:50.437 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:38:50.438 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:38:50.439 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.1402ms
2025-05-08 10:38:50.439 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:38:50.440 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 2.578ms
2025-05-08 10:38:50.591 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-08 10:38:50.591 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:50.591 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:50.591 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 10:38:50.696 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 10:38:50.702 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:38:56.979 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/3 - null null
2025-05-08 10:38:56.979 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:56.979 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/3 - 204 null null 0.1612ms
2025-05-08 10:38:56.981 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/3 - null null
2025-05-08 10:38:56.981 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:56.981 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:56.981 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:38:56.981 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 10:38:56.984 +07:00 [INF] Retrieved 4 messages from Redis for conversation 18
2025-05-08 10:38:56.984 +07:00 [INF] Retrieved 4 messages from Redis for conversation 18 and user 3
2025-05-08 10:38:56.984 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:38:56.984 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.7511ms
2025-05-08 10:38:56.984 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:38:56.984 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/3 - 200 null application/json; charset=utf-8 3.4347ms
2025-05-08 10:38:56.993 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:38:56.993 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:56.993 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 0.3417ms
2025-05-08 10:38:56.999 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:38:56.999 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:56.999 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:56.999 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:38:56.999 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:38:57.009 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 10:38:57.009 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 10:38:57.009 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.2773ms
2025-05-08 10:38:57.009 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:38:57.010 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 10.704ms
2025-05-08 10:38:57.017 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:38:57.018 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:57.018 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 0.2724ms
2025-05-08 10:38:57.018 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:38:57.019 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:57.019 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:38:57.019 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:38:57.019 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 10:38:57.024 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 10:38:57.024 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:38:57.025 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.9676ms
2025-05-08 10:38:57.025 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:38:57.025 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 6.2923ms
2025-05-08 10:39:20.676 +07:00 [INF] Handling message from user 3: mnm,
2025-05-08 10:39:20.679 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 10:39:20.682 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:39:20.703 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 10:39:20.703 +07:00 [INF] Message saved to DB with ID: 163
2025-05-08 10:39:20.704 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:39:20.720 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 10:39:20.729 +07:00 [INF] Transaction committed for message: 163
2025-05-08 10:39:20.732 +07:00 [INF] Saved message 163 to Redis
2025-05-08 10:39:20.732 +07:00 [INF] Added message 163 to conversation 18
2025-05-08 10:39:20.732 +07:00 [INF] Published message to channel conversation:18
2025-05-08 10:39:26.959 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-08 10:39:26.959 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:26.960 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - 204 null null 0.5674ms
2025-05-08 10:39:26.961 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-08 10:39:26.961 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:26.962 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:26.962 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:39:26.962 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 10:39:26.965 +07:00 [INF] Retrieved 5 messages from Redis for conversation 18
2025-05-08 10:39:26.966 +07:00 [INF] Retrieved 5 messages from Redis for conversation 18 and user 2
2025-05-08 10:39:26.966 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:39:26.966 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 3.9615ms
2025-05-08 10:39:26.966 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:39:26.966 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - 200 null application/json; charset=utf-8 4.8147ms
2025-05-08 10:39:26.972 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:39:26.972 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:26.973 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 0.651ms
2025-05-08 10:39:26.977 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:39:26.977 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:26.977 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:26.977 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:39:26.977 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:39:26.979 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 10:39:26.980 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 10:39:26.980 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 2.8345ms
2025-05-08 10:39:26.980 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:39:26.980 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 3.439ms
2025-05-08 10:39:26.986 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:39:26.986 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:26.986 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 0.3192ms
2025-05-08 10:39:26.987 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:39:26.987 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:26.987 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:26.987 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:39:26.988 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 10:39:26.993 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 10:39:26.993 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:39:26.994 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.5818ms
2025-05-08 10:39:26.994 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:39:26.994 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 6.8409ms
2025-05-08 10:39:40.217 +07:00 [INF] Handling message from user 3: nmkll
2025-05-08 10:39:40.220 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 10:39:40.225 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:39:40.228 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 10:39:40.235 +07:00 [INF] Message saved to DB with ID: 164
2025-05-08 10:39:40.236 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:39:40.238 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 10:39:40.244 +07:00 [INF] Transaction committed for message: 164
2025-05-08 10:39:40.248 +07:00 [INF] Saved message 164 to Redis
2025-05-08 10:39:40.248 +07:00 [INF] Added message 164 to conversation 18
2025-05-08 10:39:40.248 +07:00 [INF] Published message to channel conversation:18
2025-05-08 10:39:44.500 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-08 10:39:44.500 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:44.539 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - 204 null null 0.2308ms
2025-05-08 10:39:44.541 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-08 10:39:44.541 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:44.541 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:44.541 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:39:44.541 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 10:39:44.545 +07:00 [INF] Retrieved 6 messages from Redis for conversation 18
2025-05-08 10:39:44.545 +07:00 [INF] Retrieved 6 messages from Redis for conversation 18 and user 2
2025-05-08 10:39:44.545 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:39:44.546 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.5519ms
2025-05-08 10:39:44.546 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:39:44.546 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - 200 null application/json; charset=utf-8 5.4443ms
2025-05-08 10:39:44.561 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:39:44.562 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:44.562 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 0.2369ms
2025-05-08 10:39:44.563 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:39:44.564 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:44.564 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:44.570 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:39:44.570 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:39:44.573 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 10:39:44.574 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 10:39:44.575 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 4.3649ms
2025-05-08 10:39:44.575 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:39:44.575 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 11.6704ms
2025-05-08 10:39:44.582 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:39:44.582 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:44.582 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 0.1646ms
2025-05-08 10:39:44.583 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:39:44.583 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:44.583 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:39:44.584 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:39:44.584 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 10:39:44.586 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 10:39:44.586 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:39:44.586 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 2.2302ms
2025-05-08 10:39:44.586 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:39:44.586 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 2.9639ms
2025-05-08 10:39:47.876 +07:00 [INF] Handling message from user 2: lkmlk
2025-05-08 10:39:47.886 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 10:39:47.889 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:39:47.896 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 10:39:47.896 +07:00 [INF] Message saved to DB with ID: 165
2025-05-08 10:39:47.900 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:39:47.911 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 10:39:47.914 +07:00 [INF] Transaction committed for message: 165
2025-05-08 10:39:47.915 +07:00 [INF] Saved message 165 to Redis
2025-05-08 10:39:47.916 +07:00 [INF] Added message 165 to conversation 18
2025-05-08 10:39:47.916 +07:00 [INF] Published message to channel conversation:18
2025-05-08 10:39:53.200 +07:00 [INF] Handling message from user 2: n,n
2025-05-08 10:39:53.221 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 10:39:53.222 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:39:53.244 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 10:39:53.244 +07:00 [INF] Message saved to DB with ID: 166
2025-05-08 10:39:53.246 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:39:53.253 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 10:39:53.254 +07:00 [INF] Transaction committed for message: 166
2025-05-08 10:39:53.255 +07:00 [INF] Saved message 166 to Redis
2025-05-08 10:39:53.255 +07:00 [INF] Added message 166 to conversation 18
2025-05-08 10:39:53.255 +07:00 [INF] Published message to channel conversation:18
2025-05-08 10:40:18.681 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/3 - null null
2025-05-08 10:40:18.681 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:18.681 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/3 - 204 null null 0.1737ms
2025-05-08 10:40:18.682 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/3 - null null
2025-05-08 10:40:18.682 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:18.682 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:18.682 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:40:18.682 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 10:40:18.686 +07:00 [INF] Retrieved 8 messages from Redis for conversation 18
2025-05-08 10:40:18.686 +07:00 [INF] Retrieved 8 messages from Redis for conversation 18 and user 3
2025-05-08 10:40:18.686 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:40:18.687 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.171ms
2025-05-08 10:40:18.687 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:40:18.687 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/3 - 200 null application/json; charset=utf-8 4.5362ms
2025-05-08 10:40:18.697 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:40:18.697 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:18.698 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 0.4305ms
2025-05-08 10:40:18.699 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:40:18.699 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:18.699 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:18.699 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:40:18.699 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:40:18.718 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 10:40:18.719 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 10:40:18.719 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 19.9777ms
2025-05-08 10:40:18.719 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:40:18.719 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 20.6648ms
2025-05-08 10:40:18.726 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:40:18.726 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:18.726 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 0.4665ms
2025-05-08 10:40:18.728 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:40:18.728 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:18.728 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:18.728 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:40:18.728 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 10:40:18.734 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 10:40:18.734 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:40:18.734 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.8564ms
2025-05-08 10:40:18.734 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:40:18.734 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 6.6083ms
2025-05-08 10:40:30.370 +07:00 [INF] Handling message from user 3: safaf
2025-05-08 10:40:30.378 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 10:40:30.382 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:40:30.398 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 10:40:30.399 +07:00 [INF] Message saved to DB with ID: 167
2025-05-08 10:40:30.399 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:40:30.406 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 10:40:30.410 +07:00 [INF] Transaction committed for message: 167
2025-05-08 10:40:30.412 +07:00 [INF] Saved message 167 to Redis
2025-05-08 10:40:30.414 +07:00 [INF] Added message 167 to conversation 18
2025-05-08 10:40:30.415 +07:00 [INF] Published message to channel conversation:18
2025-05-08 10:40:35.162 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-08 10:40:35.162 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:35.162 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - 204 null null 0.1522ms
2025-05-08 10:40:35.163 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-08 10:40:35.163 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:35.163 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:35.164 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:40:35.164 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 10:40:35.168 +07:00 [INF] Retrieved 9 messages from Redis for conversation 18
2025-05-08 10:40:35.169 +07:00 [INF] Retrieved 9 messages from Redis for conversation 18 and user 2
2025-05-08 10:40:35.169 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:40:35.169 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 5.1184ms
2025-05-08 10:40:35.169 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:40:35.169 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - 200 null application/json; charset=utf-8 5.6533ms
2025-05-08 10:40:35.179 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:40:35.179 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:35.179 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 0.2231ms
2025-05-08 10:40:35.181 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:40:35.181 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:35.181 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:35.181 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:40:35.181 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:40:35.188 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 10:40:35.189 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 10:40:35.189 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.4658ms
2025-05-08 10:40:35.189 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:40:35.190 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 8.7629ms
2025-05-08 10:40:35.196 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:40:35.196 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:35.196 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 0.2354ms
2025-05-08 10:40:35.198 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:40:35.198 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:35.198 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:40:35.198 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:40:35.198 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 10:40:35.202 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 10:40:35.202 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:40:35.202 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.5649ms
2025-05-08 10:40:35.202 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:40:35.203 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 4.9335ms
2025-05-08 10:40:39.035 +07:00 [INF] Handling message from user 2: asdda
2025-05-08 10:40:39.037 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 10:40:39.038 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:40:39.039 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 10:40:39.039 +07:00 [INF] Message saved to DB with ID: 168
2025-05-08 10:40:39.039 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:40:39.040 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 10:40:39.045 +07:00 [INF] Transaction committed for message: 168
2025-05-08 10:40:39.046 +07:00 [INF] Saved message 168 to Redis
2025-05-08 10:40:39.048 +07:00 [INF] Added message 168 to conversation 18
2025-05-08 10:40:39.048 +07:00 [INF] Published message to channel conversation:18
2025-05-08 10:40:44.002 +07:00 [INF] Handling message from user 3: asdasd
2025-05-08 10:40:44.004 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 10:40:44.005 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:40:44.006 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 10:40:44.006 +07:00 [INF] Message saved to DB with ID: 169
2025-05-08 10:40:44.006 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:40:44.014 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 10:40:44.017 +07:00 [INF] Transaction committed for message: 169
2025-05-08 10:40:44.021 +07:00 [INF] Saved message 169 to Redis
2025-05-08 10:40:44.022 +07:00 [INF] Added message 169 to conversation 18
2025-05-08 10:40:44.022 +07:00 [INF] Published message to channel conversation:18
2025-05-08 10:41:26.446 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 10:41:26.446 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 155855.0769ms
2025-05-08 10:41:30.719 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 10:41:30.719 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 273161.1242ms
2025-05-08 10:41:52.239 +07:00 [INF] Application is shutting down...
2025-05-08 10:42:13.907 +07:00 [INF] Executed DbCommand (43ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-08 10:42:14.043 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-08 10:42:14.157 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-08 10:42:14.166 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-08 10:42:14.166 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-08 10:42:14.166 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-08 10:42:14.166 +07:00 [INF] Hosting environment: Development
2025-05-08 10:42:14.166 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-08 10:44:50.626 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 10:44:50.655 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:44:50.663 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 38.4965ms
2025-05-08 10:44:50.670 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-08 10:44:50.672 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:44:50.695 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:44:50.696 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-08 10:44:50.729 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:44:50.759 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 10:44:50.921 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 10:44:51.004 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 10:44:51.045 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 283.6787ms
2025-05-08 10:44:51.045 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:44:51.049 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 379.3139ms
2025-05-08 10:44:51.215 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-08 10:44:51.221 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:44:51.223 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:44:51.224 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:44:51.230 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 10:44:51.308 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 10:44:51.308 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:44:51.308 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.7153ms
2025-05-08 10:44:51.310 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 10:44:51.311 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:44:51.311 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:44:51.312 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:44:51.316 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:44:51.356 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 10:44:51.358 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:44:51.367 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 136.5936ms
2025-05-08 10:44:51.367 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:44:51.368 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 152.1457ms
2025-05-08 10:44:51.403 +07:00 [INF] Executed DbCommand (33ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-08 10:44:51.417 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:44:51.419 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 102.4006ms
2025-05-08 10:44:51.419 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:44:51.419 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 109.1162ms
2025-05-08 10:44:51.446 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-08 10:44:51.449 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:44:51.449 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:44:51.450 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 10:44:51.588 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 10:44:51.613 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:44:51.622 +07:00 [INF] Saved message 154 to Redis
2025-05-08 10:44:51.623 +07:00 [INF] Added message 154 to conversation 3
2025-05-08 10:44:51.625 +07:00 [INF] Saved message 117 to Redis
2025-05-08 10:44:51.625 +07:00 [INF] Added message 117 to conversation 3
2025-05-08 10:44:51.626 +07:00 [INF] Saved message 115 to Redis
2025-05-08 10:44:51.626 +07:00 [INF] Added message 115 to conversation 3
2025-05-08 10:44:51.627 +07:00 [INF] Saved message 88 to Redis
2025-05-08 10:44:51.627 +07:00 [INF] Added message 88 to conversation 3
2025-05-08 10:44:51.628 +07:00 [INF] Saved message 70 to Redis
2025-05-08 10:44:51.628 +07:00 [INF] Added message 70 to conversation 3
2025-05-08 10:44:51.629 +07:00 [INF] Saved message 65 to Redis
2025-05-08 10:44:51.630 +07:00 [INF] Added message 65 to conversation 3
2025-05-08 10:44:51.631 +07:00 [INF] Saved message 48 to Redis
2025-05-08 10:44:51.631 +07:00 [INF] Added message 48 to conversation 3
2025-05-08 10:44:51.645 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:44:51.648 +07:00 [INF] Saved message 161 to Redis
2025-05-08 10:44:51.650 +07:00 [INF] Added message 161 to conversation 4
2025-05-08 10:44:51.652 +07:00 [INF] Saved message 160 to Redis
2025-05-08 10:44:51.653 +07:00 [INF] Added message 160 to conversation 4
2025-05-08 10:44:51.656 +07:00 [INF] Saved message 159 to Redis
2025-05-08 10:44:51.656 +07:00 [INF] Added message 159 to conversation 4
2025-05-08 10:44:51.657 +07:00 [INF] Saved message 135 to Redis
2025-05-08 10:44:51.657 +07:00 [INF] Added message 135 to conversation 4
2025-05-08 10:44:51.658 +07:00 [INF] Saved message 133 to Redis
2025-05-08 10:44:51.658 +07:00 [INF] Added message 133 to conversation 4
2025-05-08 10:44:51.659 +07:00 [INF] Saved message 132 to Redis
2025-05-08 10:44:51.659 +07:00 [INF] Added message 132 to conversation 4
2025-05-08 10:44:51.660 +07:00 [INF] Saved message 131 to Redis
2025-05-08 10:44:51.661 +07:00 [INF] Added message 131 to conversation 4
2025-05-08 10:44:51.661 +07:00 [INF] Saved message 130 to Redis
2025-05-08 10:44:51.662 +07:00 [INF] Added message 130 to conversation 4
2025-05-08 10:44:51.663 +07:00 [INF] Saved message 129 to Redis
2025-05-08 10:44:51.663 +07:00 [INF] Added message 129 to conversation 4
2025-05-08 10:44:51.664 +07:00 [INF] Saved message 128 to Redis
2025-05-08 10:44:51.664 +07:00 [INF] Added message 128 to conversation 4
2025-05-08 10:44:51.671 +07:00 [INF] Saved message 127 to Redis
2025-05-08 10:44:51.672 +07:00 [INF] Added message 127 to conversation 4
2025-05-08 10:44:51.674 +07:00 [INF] Saved message 126 to Redis
2025-05-08 10:44:51.674 +07:00 [INF] Added message 126 to conversation 4
2025-05-08 10:44:51.675 +07:00 [INF] Saved message 125 to Redis
2025-05-08 10:44:51.675 +07:00 [INF] Added message 125 to conversation 4
2025-05-08 10:44:51.675 +07:00 [INF] Saved message 124 to Redis
2025-05-08 10:44:51.676 +07:00 [INF] Added message 124 to conversation 4
2025-05-08 10:44:51.676 +07:00 [INF] Saved message 123 to Redis
2025-05-08 10:44:51.677 +07:00 [INF] Added message 123 to conversation 4
2025-05-08 10:44:51.677 +07:00 [INF] Saved message 122 to Redis
2025-05-08 10:44:51.678 +07:00 [INF] Added message 122 to conversation 4
2025-05-08 10:44:51.678 +07:00 [INF] Saved message 121 to Redis
2025-05-08 10:44:51.678 +07:00 [INF] Added message 121 to conversation 4
2025-05-08 10:44:51.679 +07:00 [INF] Saved message 120 to Redis
2025-05-08 10:44:51.679 +07:00 [INF] Added message 120 to conversation 4
2025-05-08 10:44:51.681 +07:00 [INF] Saved message 119 to Redis
2025-05-08 10:44:51.681 +07:00 [INF] Added message 119 to conversation 4
2025-05-08 10:44:51.682 +07:00 [INF] Saved message 118 to Redis
2025-05-08 10:44:51.684 +07:00 [INF] Added message 118 to conversation 4
2025-05-08 10:44:51.685 +07:00 [INF] Saved message 111 to Redis
2025-05-08 10:44:51.685 +07:00 [INF] Added message 111 to conversation 4
2025-05-08 10:44:51.686 +07:00 [INF] Saved message 97 to Redis
2025-05-08 10:44:51.686 +07:00 [INF] Added message 97 to conversation 4
2025-05-08 10:44:51.687 +07:00 [INF] Saved message 96 to Redis
2025-05-08 10:44:51.687 +07:00 [INF] Added message 96 to conversation 4
2025-05-08 10:44:51.688 +07:00 [INF] Saved message 89 to Redis
2025-05-08 10:44:51.688 +07:00 [INF] Added message 89 to conversation 4
2025-05-08 10:44:51.690 +07:00 [INF] Saved message 69 to Redis
2025-05-08 10:44:51.690 +07:00 [INF] Added message 69 to conversation 4
2025-05-08 10:44:51.691 +07:00 [INF] Saved message 67 to Redis
2025-05-08 10:44:51.691 +07:00 [INF] Added message 67 to conversation 4
2025-05-08 10:44:51.692 +07:00 [INF] Saved message 66 to Redis
2025-05-08 10:44:51.692 +07:00 [INF] Added message 66 to conversation 4
2025-05-08 10:44:51.693 +07:00 [INF] Saved message 63 to Redis
2025-05-08 10:44:51.693 +07:00 [INF] Added message 63 to conversation 4
2025-05-08 10:44:51.693 +07:00 [INF] Saved message 58 to Redis
2025-05-08 10:44:51.694 +07:00 [INF] Added message 58 to conversation 4
2025-05-08 10:44:51.694 +07:00 [INF] Saved message 56 to Redis
2025-05-08 10:44:51.694 +07:00 [INF] Added message 56 to conversation 4
2025-05-08 10:44:51.696 +07:00 [INF] Saved message 53 to Redis
2025-05-08 10:44:51.696 +07:00 [INF] Added message 53 to conversation 4
2025-05-08 10:44:51.697 +07:00 [INF] Saved message 52 to Redis
2025-05-08 10:44:51.697 +07:00 [INF] Added message 52 to conversation 4
2025-05-08 10:44:51.698 +07:00 [INF] Saved message 50 to Redis
2025-05-08 10:44:51.699 +07:00 [INF] Added message 50 to conversation 4
2025-05-08 10:44:51.700 +07:00 [INF] Saved message 47 to Redis
2025-05-08 10:44:51.701 +07:00 [INF] Added message 47 to conversation 4
2025-05-08 10:44:51.702 +07:00 [INF] Saved message 46 to Redis
2025-05-08 10:44:51.702 +07:00 [INF] Added message 46 to conversation 4
2025-05-08 10:44:51.703 +07:00 [INF] Saved message 45 to Redis
2025-05-08 10:44:51.704 +07:00 [INF] Added message 45 to conversation 4
2025-05-08 10:44:51.705 +07:00 [INF] Saved message 44 to Redis
2025-05-08 10:44:51.705 +07:00 [INF] Added message 44 to conversation 4
2025-05-08 10:44:51.706 +07:00 [INF] Saved message 43 to Redis
2025-05-08 10:44:51.706 +07:00 [INF] Added message 43 to conversation 4
2025-05-08 10:44:51.707 +07:00 [INF] Saved message 42 to Redis
2025-05-08 10:44:51.707 +07:00 [INF] Added message 42 to conversation 4
2025-05-08 10:44:51.708 +07:00 [INF] Saved message 41 to Redis
2025-05-08 10:44:51.708 +07:00 [INF] Added message 41 to conversation 4
2025-05-08 10:44:51.709 +07:00 [INF] Saved message 40 to Redis
2025-05-08 10:44:51.709 +07:00 [INF] Added message 40 to conversation 4
2025-05-08 10:44:51.710 +07:00 [INF] Saved message 39 to Redis
2025-05-08 10:44:51.710 +07:00 [INF] Added message 39 to conversation 4
2025-05-08 10:44:51.711 +07:00 [INF] Saved message 38 to Redis
2025-05-08 10:44:51.711 +07:00 [INF] Added message 38 to conversation 4
2025-05-08 10:44:51.712 +07:00 [INF] Saved message 37 to Redis
2025-05-08 10:44:51.712 +07:00 [INF] Added message 37 to conversation 4
2025-05-08 10:44:51.713 +07:00 [INF] Saved message 36 to Redis
2025-05-08 10:44:51.713 +07:00 [INF] Added message 36 to conversation 4
2025-05-08 10:44:51.715 +07:00 [INF] Saved message 35 to Redis
2025-05-08 10:44:51.715 +07:00 [INF] Added message 35 to conversation 4
2025-05-08 10:44:51.716 +07:00 [INF] Saved message 34 to Redis
2025-05-08 10:44:51.717 +07:00 [INF] Added message 34 to conversation 4
2025-05-08 10:44:51.718 +07:00 [INF] Saved message 33 to Redis
2025-05-08 10:44:51.718 +07:00 [INF] Added message 33 to conversation 4
2025-05-08 10:44:51.719 +07:00 [INF] Saved message 32 to Redis
2025-05-08 10:44:51.719 +07:00 [INF] Added message 32 to conversation 4
2025-05-08 10:44:51.721 +07:00 [INF] Saved message 31 to Redis
2025-05-08 10:44:51.721 +07:00 [INF] Added message 31 to conversation 4
2025-05-08 10:44:51.728 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:44:51.730 +07:00 [INF] Saved message 169 to Redis
2025-05-08 10:44:51.730 +07:00 [INF] Added message 169 to conversation 18
2025-05-08 10:44:51.732 +07:00 [INF] Saved message 168 to Redis
2025-05-08 10:44:51.733 +07:00 [INF] Added message 168 to conversation 18
2025-05-08 10:44:51.735 +07:00 [INF] Saved message 167 to Redis
2025-05-08 10:44:51.735 +07:00 [INF] Added message 167 to conversation 18
2025-05-08 10:44:51.736 +07:00 [INF] Saved message 166 to Redis
2025-05-08 10:44:51.736 +07:00 [INF] Added message 166 to conversation 18
2025-05-08 10:44:51.737 +07:00 [INF] Saved message 165 to Redis
2025-05-08 10:44:51.737 +07:00 [INF] Added message 165 to conversation 18
2025-05-08 10:44:51.738 +07:00 [INF] Saved message 164 to Redis
2025-05-08 10:44:51.738 +07:00 [INF] Added message 164 to conversation 18
2025-05-08 10:44:51.739 +07:00 [INF] Saved message 163 to Redis
2025-05-08 10:44:51.740 +07:00 [INF] Added message 163 to conversation 18
2025-05-08 10:44:51.741 +07:00 [INF] Saved message 162 to Redis
2025-05-08 10:44:51.741 +07:00 [INF] Added message 162 to conversation 18
2025-05-08 10:44:51.742 +07:00 [INF] Saved message 158 to Redis
2025-05-08 10:44:51.743 +07:00 [INF] Added message 158 to conversation 18
2025-05-08 10:44:51.744 +07:00 [INF] Saved message 157 to Redis
2025-05-08 10:44:51.744 +07:00 [INF] Added message 157 to conversation 18
2025-05-08 10:44:51.745 +07:00 [INF] Saved message 156 to Redis
2025-05-08 10:44:51.745 +07:00 [INF] Added message 156 to conversation 18
2025-05-08 10:47:45.393 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 10:47:45.393 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:47:45.394 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.8807ms
2025-05-08 10:47:45.395 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-08 10:47:45.396 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:47:45.397 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:47:45.398 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:47:45.398 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 10:47:45.425 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 10:47:45.427 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 10:47:45.428 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 29.8879ms
2025-05-08 10:47:45.428 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:47:45.429 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 33.2934ms
2025-05-08 10:47:45.603 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-08 10:47:45.606 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:47:45.618 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:47:45.618 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:47:45.618 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 10:47:45.648 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 10:47:45.649 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:47:45.649 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 30.9027ms
2025-05-08 10:47:45.649 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:47:45.650 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 47.4237ms
2025-05-08 10:47:45.689 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 10:47:45.689 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:47:45.689 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.4178ms
2025-05-08 10:47:45.690 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 10:47:45.691 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:47:45.693 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:47:45.693 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:47:45.693 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:47:45.702 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:47:45.704 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 10.5027ms
2025-05-08 10:47:45.705 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:47:45.705 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 14.3948ms
2025-05-08 10:47:45.761 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-08 10:47:45.761 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:47:45.762 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:47:45.762 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 10:47:45.860 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 10:48:33.116 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 10:48:33.116 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:33.116 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3624ms
2025-05-08 10:48:33.117 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-08 10:48:33.117 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:33.118 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:33.118 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:48:33.118 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 10:48:33.125 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 10:48:33.126 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 10:48:33.127 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 8.7968ms
2025-05-08 10:48:33.127 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:48:33.127 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 9.5021ms
2025-05-08 10:48:33.236 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-08 10:48:33.236 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:33.236 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:33.236 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:48:33.236 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 10:48:33.241 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 10:48:33.241 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:48:33.242 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 5.4692ms
2025-05-08 10:48:33.242 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:48:33.242 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 6.6217ms
2025-05-08 10:48:33.334 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-08 10:48:33.334 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:33.334 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.5991ms
2025-05-08 10:48:33.339 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-08 10:48:33.339 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:33.339 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:33.340 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:48:33.340 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:48:33.381 +07:00 [INF] Executed DbCommand (36ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-08 10:48:33.383 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:48:33.384 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 44.0429ms
2025-05-08 10:48:33.384 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:48:33.384 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 45.1557ms
2025-05-08 10:48:33.398 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-08 10:48:33.398 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:33.399 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:33.399 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 10:48:33.503 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 10:48:33.513 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:48:33.514 +07:00 [INF] Saved message 114 to Redis
2025-05-08 10:48:33.515 +07:00 [INF] Added message 114 to conversation 1
2025-05-08 10:48:33.515 +07:00 [INF] Saved message 113 to Redis
2025-05-08 10:48:33.516 +07:00 [INF] Added message 113 to conversation 1
2025-05-08 10:48:33.516 +07:00 [INF] Saved message 112 to Redis
2025-05-08 10:48:33.516 +07:00 [INF] Added message 112 to conversation 1
2025-05-08 10:48:33.517 +07:00 [INF] Saved message 110 to Redis
2025-05-08 10:48:33.517 +07:00 [INF] Added message 110 to conversation 1
2025-05-08 10:48:33.518 +07:00 [INF] Saved message 109 to Redis
2025-05-08 10:48:33.518 +07:00 [INF] Added message 109 to conversation 1
2025-05-08 10:48:33.519 +07:00 [INF] Saved message 108 to Redis
2025-05-08 10:48:33.519 +07:00 [INF] Added message 108 to conversation 1
2025-05-08 10:48:33.520 +07:00 [INF] Saved message 107 to Redis
2025-05-08 10:48:33.521 +07:00 [INF] Added message 107 to conversation 1
2025-05-08 10:48:33.521 +07:00 [INF] Saved message 106 to Redis
2025-05-08 10:48:33.522 +07:00 [INF] Added message 106 to conversation 1
2025-05-08 10:48:33.522 +07:00 [INF] Saved message 105 to Redis
2025-05-08 10:48:33.522 +07:00 [INF] Added message 105 to conversation 1
2025-05-08 10:48:33.523 +07:00 [INF] Saved message 104 to Redis
2025-05-08 10:48:33.523 +07:00 [INF] Added message 104 to conversation 1
2025-05-08 10:48:33.524 +07:00 [INF] Saved message 103 to Redis
2025-05-08 10:48:33.524 +07:00 [INF] Added message 103 to conversation 1
2025-05-08 10:48:33.525 +07:00 [INF] Saved message 102 to Redis
2025-05-08 10:48:33.525 +07:00 [INF] Added message 102 to conversation 1
2025-05-08 10:48:33.526 +07:00 [INF] Saved message 101 to Redis
2025-05-08 10:48:33.526 +07:00 [INF] Added message 101 to conversation 1
2025-05-08 10:48:33.526 +07:00 [INF] Saved message 100 to Redis
2025-05-08 10:48:33.527 +07:00 [INF] Added message 100 to conversation 1
2025-05-08 10:48:33.527 +07:00 [INF] Saved message 99 to Redis
2025-05-08 10:48:33.527 +07:00 [INF] Added message 99 to conversation 1
2025-05-08 10:48:33.528 +07:00 [INF] Saved message 98 to Redis
2025-05-08 10:48:33.528 +07:00 [INF] Added message 98 to conversation 1
2025-05-08 10:48:33.529 +07:00 [INF] Saved message 95 to Redis
2025-05-08 10:48:33.529 +07:00 [INF] Added message 95 to conversation 1
2025-05-08 10:48:33.529 +07:00 [INF] Saved message 94 to Redis
2025-05-08 10:48:33.529 +07:00 [INF] Added message 94 to conversation 1
2025-05-08 10:48:33.530 +07:00 [INF] Saved message 93 to Redis
2025-05-08 10:48:33.530 +07:00 [INF] Added message 93 to conversation 1
2025-05-08 10:48:33.531 +07:00 [INF] Saved message 92 to Redis
2025-05-08 10:48:33.531 +07:00 [INF] Added message 92 to conversation 1
2025-05-08 10:48:33.531 +07:00 [INF] Saved message 91 to Redis
2025-05-08 10:48:33.531 +07:00 [INF] Added message 91 to conversation 1
2025-05-08 10:48:33.532 +07:00 [INF] Saved message 90 to Redis
2025-05-08 10:48:33.532 +07:00 [INF] Added message 90 to conversation 1
2025-05-08 10:48:33.533 +07:00 [INF] Saved message 87 to Redis
2025-05-08 10:48:33.533 +07:00 [INF] Added message 87 to conversation 1
2025-05-08 10:48:33.533 +07:00 [INF] Saved message 86 to Redis
2025-05-08 10:48:33.533 +07:00 [INF] Added message 86 to conversation 1
2025-05-08 10:48:33.534 +07:00 [INF] Saved message 85 to Redis
2025-05-08 10:48:33.534 +07:00 [INF] Added message 85 to conversation 1
2025-05-08 10:48:33.535 +07:00 [INF] Saved message 84 to Redis
2025-05-08 10:48:33.535 +07:00 [INF] Added message 84 to conversation 1
2025-05-08 10:48:33.535 +07:00 [INF] Saved message 83 to Redis
2025-05-08 10:48:33.535 +07:00 [INF] Added message 83 to conversation 1
2025-05-08 10:48:33.536 +07:00 [INF] Saved message 82 to Redis
2025-05-08 10:48:33.536 +07:00 [INF] Added message 82 to conversation 1
2025-05-08 10:48:33.536 +07:00 [INF] Saved message 81 to Redis
2025-05-08 10:48:33.537 +07:00 [INF] Added message 81 to conversation 1
2025-05-08 10:48:33.538 +07:00 [INF] Saved message 80 to Redis
2025-05-08 10:48:33.538 +07:00 [INF] Added message 80 to conversation 1
2025-05-08 10:48:33.539 +07:00 [INF] Saved message 79 to Redis
2025-05-08 10:48:33.539 +07:00 [INF] Added message 79 to conversation 1
2025-05-08 10:48:33.539 +07:00 [INF] Saved message 78 to Redis
2025-05-08 10:48:33.540 +07:00 [INF] Added message 78 to conversation 1
2025-05-08 10:48:33.540 +07:00 [INF] Saved message 77 to Redis
2025-05-08 10:48:33.540 +07:00 [INF] Added message 77 to conversation 1
2025-05-08 10:48:33.541 +07:00 [INF] Saved message 76 to Redis
2025-05-08 10:48:33.541 +07:00 [INF] Added message 76 to conversation 1
2025-05-08 10:48:33.542 +07:00 [INF] Saved message 75 to Redis
2025-05-08 10:48:33.542 +07:00 [INF] Added message 75 to conversation 1
2025-05-08 10:48:33.542 +07:00 [INF] Saved message 74 to Redis
2025-05-08 10:48:33.543 +07:00 [INF] Added message 74 to conversation 1
2025-05-08 10:48:33.543 +07:00 [INF] Saved message 73 to Redis
2025-05-08 10:48:33.543 +07:00 [INF] Added message 73 to conversation 1
2025-05-08 10:48:33.544 +07:00 [INF] Saved message 72 to Redis
2025-05-08 10:48:33.544 +07:00 [INF] Added message 72 to conversation 1
2025-05-08 10:48:33.544 +07:00 [INF] Saved message 71 to Redis
2025-05-08 10:48:33.545 +07:00 [INF] Added message 71 to conversation 1
2025-05-08 10:48:33.545 +07:00 [INF] Saved message 68 to Redis
2025-05-08 10:48:33.545 +07:00 [INF] Added message 68 to conversation 1
2025-05-08 10:48:33.546 +07:00 [INF] Saved message 64 to Redis
2025-05-08 10:48:33.546 +07:00 [INF] Added message 64 to conversation 1
2025-05-08 10:48:33.546 +07:00 [INF] Saved message 62 to Redis
2025-05-08 10:48:33.547 +07:00 [INF] Added message 62 to conversation 1
2025-05-08 10:48:33.547 +07:00 [INF] Saved message 61 to Redis
2025-05-08 10:48:33.547 +07:00 [INF] Added message 61 to conversation 1
2025-05-08 10:48:33.548 +07:00 [INF] Saved message 60 to Redis
2025-05-08 10:48:33.548 +07:00 [INF] Added message 60 to conversation 1
2025-05-08 10:48:33.548 +07:00 [INF] Saved message 59 to Redis
2025-05-08 10:48:33.548 +07:00 [INF] Added message 59 to conversation 1
2025-05-08 10:48:33.549 +07:00 [INF] Saved message 57 to Redis
2025-05-08 10:48:33.549 +07:00 [INF] Added message 57 to conversation 1
2025-05-08 10:48:33.550 +07:00 [INF] Saved message 55 to Redis
2025-05-08 10:48:33.550 +07:00 [INF] Added message 55 to conversation 1
2025-05-08 10:48:33.550 +07:00 [INF] Saved message 54 to Redis
2025-05-08 10:48:33.551 +07:00 [INF] Added message 54 to conversation 1
2025-05-08 10:48:33.551 +07:00 [INF] Saved message 51 to Redis
2025-05-08 10:48:33.551 +07:00 [INF] Added message 51 to conversation 1
2025-05-08 10:48:33.552 +07:00 [INF] Saved message 49 to Redis
2025-05-08 10:48:33.552 +07:00 [INF] Added message 49 to conversation 1
2025-05-08 10:48:33.555 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:48:33.556 +07:00 [INF] Saved message 142 to Redis
2025-05-08 10:48:33.556 +07:00 [INF] Added message 142 to conversation 2
2025-05-08 10:48:33.557 +07:00 [INF] Saved message 4 to Redis
2025-05-08 10:48:33.557 +07:00 [INF] Added message 4 to conversation 2
2025-05-08 10:48:33.559 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:48:44.274 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/3 - null null
2025-05-08 10:48:44.274 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:44.274 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/3 - 204 null null 0.2466ms
2025-05-08 10:48:44.275 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/3 - null null
2025-05-08 10:48:44.276 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:44.276 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:44.276 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:48:44.281 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 10:48:44.316 +07:00 [INF] Retrieved 11 messages from Redis for conversation 18
2025-05-08 10:48:44.318 +07:00 [INF] Retrieved 11 messages from Redis for conversation 18 and user 3
2025-05-08 10:48:44.319 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:48:44.326 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 45.1961ms
2025-05-08 10:48:44.326 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:48:44.326 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/3 - 200 null application/json; charset=utf-8 50.9688ms
2025-05-08 10:48:44.337 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:48:44.337 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:44.337 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 0.3895ms
2025-05-08 10:48:44.340 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:48:44.340 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:44.340 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:44.341 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:48:44.344 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:48:44.397 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 10:48:44.433 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 10:48:44.435 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 90.5662ms
2025-05-08 10:48:44.435 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:48:44.435 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 95.064ms
2025-05-08 10:48:44.444 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:48:44.444 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:44.444 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 0.3503ms
2025-05-08 10:48:44.445 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:48:44.445 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:44.445 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:48:44.446 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:48:44.449 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 10:48:44.463 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 10:48:44.464 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:48:44.467 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 17.9622ms
2025-05-08 10:48:44.467 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:48:44.467 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 21.9458ms
2025-05-08 10:48:47.951 +07:00 [INF] Handling message from user 3: sdfsf
2025-05-08 10:48:47.978 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 10:48:48.111 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:48:48.124 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 10:48:48.145 +07:00 [INF] Message saved to DB with ID: 170
2025-05-08 10:48:48.148 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:48:48.154 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 10:48:48.164 +07:00 [INF] Transaction committed for message: 170
2025-05-08 10:48:48.172 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 10:49:02.119 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-08 10:49:02.119 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:49:02.120 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - 204 null null 0.4936ms
2025-05-08 10:49:02.121 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-08 10:49:02.121 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:49:02.123 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:49:02.123 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:49:02.124 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 10:49:02.129 +07:00 [INF] Retrieved 11 messages from Redis for conversation 18
2025-05-08 10:49:02.129 +07:00 [INF] Retrieved 11 messages from Redis for conversation 18 and user 2
2025-05-08 10:49:02.129 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:49:02.129 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 5.7756ms
2025-05-08 10:49:02.130 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:49:02.131 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - 200 null application/json; charset=utf-8 9.1648ms
2025-05-08 10:49:02.139 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:49:02.140 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:49:02.140 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 0.9061ms
2025-05-08 10:49:02.141 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:49:02.142 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:49:02.142 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:49:02.142 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:49:02.142 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:49:02.144 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 10:49:02.145 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 10:49:02.145 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 3.1912ms
2025-05-08 10:49:02.145 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:49:02.145 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 3.7358ms
2025-05-08 10:49:02.151 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:49:02.151 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:49:02.151 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 0.2177ms
2025-05-08 10:49:02.153 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:49:02.153 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:49:02.154 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:49:02.154 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:49:02.154 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 10:49:02.158 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 10:49:02.158 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:49:02.159 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.5613ms
2025-05-08 10:49:02.159 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:49:02.159 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 6.138ms
2025-05-08 10:49:34.950 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 10:49:34.950 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 109189.6901ms
2025-05-08 10:49:38.312 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 10:49:38.312 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 286865.7774ms
2025-05-08 10:55:57.574 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 10:55:57.574 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:55:57.575 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.5762ms
2025-05-08 10:55:57.577 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-08 10:55:57.577 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:55:57.577 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:55:57.577 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:55:57.578 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 10:55:57.643 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 10:55:57.646 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 10:55:57.647 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 68.7355ms
2025-05-08 10:55:57.647 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:55:57.647 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 70.3893ms
2025-05-08 10:55:57.801 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-08 10:55:57.801 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:55:57.801 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:55:57.802 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:55:57.802 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 10:55:57.819 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 10:55:57.820 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:55:57.820 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 18.317ms
2025-05-08 10:55:57.820 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:55:57.820 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 19.8788ms
2025-05-08 10:55:57.884 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 10:55:57.884 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:55:57.884 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.6916ms
2025-05-08 10:55:57.886 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-08 10:55:57.887 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:55:57.887 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:55:57.887 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:55:57.887 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:55:57.889 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:55:57.891 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.6881ms
2025-05-08 10:55:57.891 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:55:57.891 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.7029ms
2025-05-08 10:55:57.959 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-08 10:55:57.959 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:55:57.959 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:55:57.960 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 10:55:58.103 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 10:56:14.176 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-08 10:56:14.176 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:14.177 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.4815ms
2025-05-08 10:56:14.178 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-08 10:56:14.178 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:14.178 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:14.179 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:56:14.179 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-08 10:56:14.185 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-08 10:56:14.187 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-08 10:56:14.187 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 8.2177ms
2025-05-08 10:56:14.188 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-08 10:56:14.188 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 9.7704ms
2025-05-08 10:56:14.349 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-08 10:56:14.350 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:14.351 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:14.351 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:56:14.351 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-08 10:56:14.354 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-08 10:56:14.355 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:56:14.355 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 3.673ms
2025-05-08 10:56:14.355 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-08 10:56:14.355 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 5.432ms
2025-05-08 10:56:14.439 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-08 10:56:14.439 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:14.439 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3419ms
2025-05-08 10:56:14.441 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-08 10:56:14.441 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:14.441 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:14.442 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:56:14.442 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:56:14.444 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:56:14.444 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.073ms
2025-05-08 10:56:14.444 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-08 10:56:14.444 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 3.4971ms
2025-05-08 10:56:14.518 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-08 10:56:14.519 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:14.519 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:14.519 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-08 10:56:14.675 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 10:56:14.689 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-08 10:56:17.647 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/3 - null null
2025-05-08 10:56:17.648 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:17.648 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/3 - 204 null null 0.3407ms
2025-05-08 10:56:17.652 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/3 - null null
2025-05-08 10:56:17.652 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:17.653 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:17.653 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:56:17.653 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-08 10:56:17.687 +07:00 [INF] Retrieved 11 messages from Redis for conversation 18
2025-05-08 10:56:17.687 +07:00 [INF] Retrieved 11 messages from Redis for conversation 18 and user 3
2025-05-08 10:56:17.687 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-08 10:56:17.688 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 34.3285ms
2025-05-08 10:56:17.688 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-08 10:56:17.688 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/3 - 200 null application/json; charset=utf-8 35.6925ms
2025-05-08 10:56:17.707 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:56:17.708 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:17.708 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 0.2669ms
2025-05-08 10:56:17.724 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-08 10:56:17.724 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:17.724 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:17.724 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:56:17.724 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-08 10:56:17.763 +07:00 [INF] Executed DbCommand (37ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-08 10:56:17.764 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-08 10:56:17.764 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 39.9537ms
2025-05-08 10:56:17.764 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-08 10:56:17.767 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 43.3188ms
2025-05-08 10:56:17.774 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:56:17.774 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:17.775 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 0.3748ms
2025-05-08 10:56:17.776 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-08 10:56:17.777 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:17.778 +07:00 [INF] CORS policy execution successful.
2025-05-08 10:56:17.778 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:56:17.778 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-08 10:56:17.791 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-08 10:56:17.792 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-08 10:56:17.793 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 14.3628ms
2025-05-08 10:56:17.793 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-08 10:56:17.793 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 16.6343ms
2025-05-08 10:56:21.427 +07:00 [INF] Handling message from user 3: asdjk
2025-05-08 10:56:21.448 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-08 10:56:21.465 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:56:21.482 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-08 10:56:21.486 +07:00 [INF] Message saved to DB with ID: 171
2025-05-08 10:56:21.486 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-08 10:56:21.492 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-08 10:56:21.494 +07:00 [INF] Transaction committed for message: 171
2025-05-08 10:56:21.509 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-08 10:56:46.330 +07:00 [INF] Application is shutting down...
2025-05-08 10:57:16.351 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-08 10:57:16.351 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 78392.5868ms
