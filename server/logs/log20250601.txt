2025-06-01 16:59:34.144 +07:00 [INF] Executed DbCommand (54ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-01 16:59:34.542 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-01 16:59:34.667 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-01 16:59:34.681 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-01 16:59:34.682 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-01 16:59:34.683 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-01 16:59:34.683 +07:00 [INF] Hosting environment: Development
2025-06-01 16:59:34.683 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-01 17:03:41.795 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-01 17:03:41.869 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:41.884 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 91.514ms
2025-06-01 17:03:41.889 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-01 17:03:41.891 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:41.954 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:41.957 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-01 17:03:42.051 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 17:03:42.090 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-01 17:03:42.538 +07:00 [INF] Executed DbCommand (98ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-01 17:03:42.790 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-01 17:03:42.904 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 808.8806ms
2025-06-01 17:03:42.905 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 17:03:42.923 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 1033.3794ms
2025-06-01 17:03:42.956 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:03:43.009 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:43.015 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:43.025 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:03:43.069 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:03:43.123 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-01 17:03:43.124 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:43.130 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:43.138 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 17:03:43.071 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:03:43.161 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-01 17:03:43.164 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 208.2811ms
2025-06-01 17:03:43.320 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 17:03:43.321 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:43.321 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 1.1756ms
2025-06-01 17:03:43.325 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 17:03:43.326 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:43.329 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:43.334 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 17:03:43.360 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 17:03:43.370 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 9.3306ms
2025-06-01 17:03:43.373 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 17:03:43.374 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.DynamicServiceProviderEngine.<>c__DisplayClass2_0.<RealizeService>b__0(ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at lambda_method182(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:03:43.388 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 500 null text/plain; charset=utf-8 62.3173ms
2025-06-01 17:03:43.442 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-01 17:03:43.444 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 17:03:43.467 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 306.2233ms
2025-06-01 17:03:43.468 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 17:03:43.468 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 345.3755ms
2025-06-01 17:03:48.344 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:03:48.345 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:48.346 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:48.347 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:03:48.351 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:03:48.353 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:03:48.360 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 16.7235ms
2025-06-01 17:03:53.381 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:03:53.382 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:53.382 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:53.383 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:03:53.384 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:03:53.384 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:03:53.386 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 5.4385ms
2025-06-01 17:03:58.402 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:03:58.402 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:58.403 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:03:58.403 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:03:58.404 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:03:58.404 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:03:58.406 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 4.7393ms
2025-06-01 17:04:02.233 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.4:5053/api/Auth/login - application/json 58
2025-06-01 17:04:02.235 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 17:04:02.235 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-01 17:04:02.256 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-01 17:04:02.257 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-01 17:04:02.258 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 22.5685ms
2025-06-01 17:04:02.258 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 17:04:02.258 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.4:5053/api/Auth/login - 200 null application/json; charset=utf-8 24.6465ms
2025-06-01 17:04:03.106 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:04:03.106 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:03.106 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:03.106 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:03.108 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 2.1395ms
2025-06-01 17:04:03.429 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:04:03.430 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:03.430 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:03.430 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:03.432 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:03.433 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:03.440 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 10.7275ms
2025-06-01 17:04:03.511 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/friends/GetAllFriends/2 - null null
2025-06-01 17:04:03.513 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 17:04:03.513 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-01 17:04:03.520 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-01 17:04:03.524 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 17:04:03.526 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 13.1104ms
2025-06-01 17:04:03.526 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 17:04:03.528 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 16.4942ms
2025-06-01 17:04:03.756 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_conversations/2 - null null
2025-06-01 17:04:03.758 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 17:04:03.758 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 17:04:03.758 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 0.4483ms
2025-06-01 17:04:03.758 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 17:04:03.758 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.DynamicServiceProviderEngine.<>c__DisplayClass2_0.<RealizeService>b__0(ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at lambda_method182(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:03.760 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_conversations/2 - 500 null text/plain; charset=utf-8 3.7409ms
2025-06-01 17:04:08.444 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:04:08.445 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:08.445 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:08.445 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:08.445 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:08.446 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:08.447 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 3.033ms
2025-06-01 17:04:08.520 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:04:08.521 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:08.521 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:08.521 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:08.523 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 2.7888ms
2025-06-01 17:04:13.462 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:04:13.462 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:13.462 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:13.462 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:13.463 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:13.463 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:13.465 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 2.813ms
2025-06-01 17:04:13.585 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:04:13.586 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:13.587 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:13.587 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:13.589 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 4.0191ms
2025-06-01 17:04:18.479 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:04:18.479 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:18.480 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:18.480 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:18.481 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:18.481 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:18.485 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 5.6599ms
2025-06-01 17:04:18.628 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:04:18.629 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:18.629 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:18.629 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:18.631 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 2.3003ms
2025-06-01 17:04:23.497 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:04:23.497 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:23.497 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:23.497 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:23.497 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:23.497 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:23.498 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 1.5561ms
2025-06-01 17:04:23.658 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:04:23.659 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:23.659 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:23.659 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:23.663 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 4.8624ms
2025-06-01 17:04:28.520 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:04:28.520 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:28.520 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:28.521 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:28.521 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:28.521 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:28.522 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 1.9409ms
2025-06-01 17:04:28.691 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:04:28.691 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:28.692 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:28.693 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:28.696 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 5.0155ms
2025-06-01 17:04:33.540 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:04:33.540 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:33.540 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:33.540 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:33.540 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:33.540 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:33.542 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 1.9122ms
2025-06-01 17:04:33.732 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:04:33.732 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:33.733 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:33.733 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:33.735 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 3.054ms
2025-06-01 17:04:38.566 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:04:38.566 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:38.566 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:38.567 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:38.567 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:38.567 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:38.569 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 3.5825ms
2025-06-01 17:04:38.764 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:04:38.766 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:38.767 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:38.769 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:38.772 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 7.677ms
2025-06-01 17:04:43.694 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:04:43.694 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:43.694 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:43.695 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:43.695 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:43.695 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:43.699 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 4.4223ms
2025-06-01 17:04:43.803 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:04:43.804 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:43.805 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:43.808 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:43.818 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 14.3755ms
2025-06-01 17:04:48.759 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:04:48.760 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:48.760 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:48.760 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:48.760 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:48.761 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:48.770 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 9.9656ms
2025-06-01 17:04:48.852 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:04:48.852 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:48.853 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:48.853 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:48.856 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 4.0948ms
2025-06-01 17:04:53.800 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:04:53.800 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:53.800 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:53.800 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:53.801 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:53.802 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:53.804 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 3.5164ms
2025-06-01 17:04:53.887 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:04:53.887 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:53.887 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:53.888 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:53.891 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 4.214ms
2025-06-01 17:04:58.884 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:04:58.885 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:58.885 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:04:58.885 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:58.886 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:58.887 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:58.891 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 6.4168ms
2025-06-01 17:04:58.925 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:04:58.926 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:04:58.927 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:04:58.927 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:04:58.930 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 3.8836ms
2025-06-01 17:05:03.941 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:05:03.941 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:05:03.941 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:05:03.941 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:05:03.942 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:05:03.942 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:05:03.943 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 2.0496ms
2025-06-01 17:05:03.963 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:05:03.964 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:05:03.965 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:05:03.965 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:05:03.972 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 8.6827ms
2025-06-01 17:05:08.992 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:05:08.993 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:05:08.993 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:05:08.994 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:05:08.995 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:05:08.995 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:05:08.998 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 5.6633ms
2025-06-01 17:05:09.008 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:05:09.009 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:05:09.009 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:05:09.009 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:05:09.013 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 4.2534ms
2025-06-01 17:05:14.046 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:05:14.046 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:05:14.047 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:05:14.047 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:05:14.051 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 500 null text/plain; charset=utf-8 5.015ms
2025-06-01 17:05:14.123 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:05:14.124 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:05:14.124 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:05:14.124 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:05:14.124 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 17:05:14.124 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No service for type 'Microsoft.AspNetCore.Http.RequestDelegate' has been registered.
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at server.Services.WebSocketService.webSocket..ctor(IConnectionMultiplexer redis, IServiceProvider serviceProvider, IChatStorage chatStorage, IConversationStorage conversation, WebSocketOptions options, ILogger`1 logger) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 64
   at InvokeStub_webSocket..ctor(Object, Span`1)
   at System.Reflection.MethodBaseInvoker.InvokeWithManyArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.CreateServiceAccessor(ServiceIdentifier serviceIdentifier)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 106
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 17:05:14.131 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 500 null text/plain; charset=utf-8 7.8127ms
2025-06-01 17:05:14.281 +07:00 [INF] Application is shutting down...
2025-06-01 17:07:06.831 +07:00 [INF] Executed DbCommand (38ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-01 17:07:06.990 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-01 17:07:07.094 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-01 17:07:07.105 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-01 17:07:07.105 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-01 17:07:07.106 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-01 17:07:07.106 +07:00 [INF] Hosting environment: Development
2025-06-01 17:07:07.106 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-01 17:11:53.095 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-01 17:11:53.247 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:11:53.265 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 187.7415ms
2025-06-01 17:11:53.272 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-01 17:11:53.275 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:11:53.362 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:11:53.368 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-01 17:11:53.435 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 17:11:53.498 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-01 17:11:53.943 +07:00 [INF] Executed DbCommand (117ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-01 17:11:54.762 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-01 17:11:54.825 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 1323.1084ms
2025-06-01 17:11:54.825 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 17:11:54.832 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 1560.8572ms
2025-06-01 17:11:54.868 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 17:11:54.893 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:11:54.895 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:11:54.897 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:11:54.991 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-01 17:11:54.992 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:11:54.996 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:11:55.000 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 17:11:55.010 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-01 17:11:55.199 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 17:11:55.200 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:11:55.200 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.6918ms
2025-06-01 17:11:55.205 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 17:11:55.206 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:11:55.207 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:11:55.207 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 17:11:55.218 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 17:11:55.242 +07:00 [INF] Executed DbCommand (50ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-01 17:11:55.247 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 17:11:55.259 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 17:11:55.262 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 252.5203ms
2025-06-01 17:11:55.263 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 17:11:55.263 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 272.0128ms
2025-06-01 17:11:55.291 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-01 17:11:55.291 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-01 17:11:55.293 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-01 17:11:55.294 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-01 17:11:55.296 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-01 17:11:55.297 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-01 17:11:55.297 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-01 17:11:55.298 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-01 17:11:55.300 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-01 17:11:55.300 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-01 17:11:55.301 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-01 17:11:55.302 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-01 17:11:55.303 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-01 17:11:55.304 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-01 17:11:55.304 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-01 17:11:55.305 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-01 17:11:55.306 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-01 17:11:55.306 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-01 17:11:55.307 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-01 17:11:55.307 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-01 17:11:55.308 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-01 17:11:55.309 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-01 17:11:55.309 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-01 17:11:55.311 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-01 17:11:55.337 +07:00 [INF] Executed DbCommand (41ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-01 17:11:55.366 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 17:11:55.388 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 169.631ms
2025-06-01 17:11:55.388 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 17:11:55.388 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 183.2552ms
2025-06-01 17:12:24.003 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.4:5053/api/Auth/login - application/json 58
2025-06-01 17:12:24.021 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 17:12:24.021 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-01 17:12:24.034 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-01 17:12:24.036 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-01 17:12:24.036 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 14.9175ms
2025-06-01 17:12:24.036 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 17:12:24.036 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.4:5053/api/Auth/login - 200 null application/json; charset=utf-8 33.0538ms
2025-06-01 17:12:25.244 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 17:12:25.246 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 17:12:25.247 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/friends/GetAllFriends/2 - null null
2025-06-01 17:12:25.249 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 17:12:25.249 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-01 17:12:25.266 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-01 17:12:25.270 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 17:12:25.271 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 21.1224ms
2025-06-01 17:12:25.271 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 17:12:25.271 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 23.4844ms
2025-06-01 17:12:25.479 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 17:12:25.480 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-01 17:12:25.481 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-01 17:12:25.482 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-01 17:12:25.482 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-01 17:12:25.482 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-01 17:12:25.482 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-01 17:12:25.482 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-01 17:12:25.483 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-01 17:12:25.483 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-01 17:12:25.483 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-01 17:12:25.483 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-01 17:12:25.483 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-01 17:12:25.483 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-01 17:12:25.484 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-01 17:12:25.484 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-01 17:12:25.484 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-01 17:12:25.484 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-01 17:12:25.484 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-01 17:12:25.484 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-01 17:12:25.484 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-01 17:12:25.485 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-01 17:12:25.485 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-01 17:12:25.485 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-01 17:12:25.486 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-01 17:12:25.487 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-01 17:12:25.488 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-01 17:12:25.489 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-01 17:12:25.489 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-01 17:12:25.489 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-01 17:12:25.490 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-01 17:12:25.490 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-01 17:12:25.685 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_conversations/2 - null null
2025-06-01 17:12:25.687 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 17:12:25.687 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 17:12:25.706 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-01 17:12:25.727 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 17:12:25.801 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 114.488ms
2025-06-01 17:12:25.802 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 17:12:25.802 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 116.3953ms
2025-06-01 17:12:30.827 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Message/getMessages/19/2 - null null
2025-06-01 17:12:30.827 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 17:12:30.834 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 17:12:30.856 +07:00 [WRN] Message 402 not found in Redis
2025-06-01 17:12:30.857 +07:00 [WRN] Message 401 not found in Redis
2025-06-01 17:12:30.857 +07:00 [WRN] Message 400 not found in Redis
2025-06-01 17:12:30.858 +07:00 [WRN] Message 399 not found in Redis
2025-06-01 17:12:30.858 +07:00 [WRN] Message 398 not found in Redis
2025-06-01 17:12:30.858 +07:00 [WRN] Message 397 not found in Redis
2025-06-01 17:12:30.858 +07:00 [WRN] Message 396 not found in Redis
2025-06-01 17:12:30.859 +07:00 [WRN] Message 395 not found in Redis
2025-06-01 17:12:30.859 +07:00 [WRN] Message 394 not found in Redis
2025-06-01 17:12:30.859 +07:00 [WRN] Message 393 not found in Redis
2025-06-01 17:12:30.859 +07:00 [WRN] Message 392 not found in Redis
2025-06-01 17:12:30.860 +07:00 [WRN] Message 391 not found in Redis
2025-06-01 17:12:30.860 +07:00 [WRN] Message 390 not found in Redis
2025-06-01 17:12:30.860 +07:00 [WRN] Message 389 not found in Redis
2025-06-01 17:12:30.861 +07:00 [WRN] Message 388 not found in Redis
2025-06-01 17:12:30.861 +07:00 [WRN] Message 387 not found in Redis
2025-06-01 17:12:30.861 +07:00 [WRN] Message 386 not found in Redis
2025-06-01 17:12:30.862 +07:00 [WRN] Message 385 not found in Redis
2025-06-01 17:12:30.862 +07:00 [WRN] Message 384 not found in Redis
2025-06-01 17:12:30.862 +07:00 [WRN] Message 383 not found in Redis
2025-06-01 17:12:30.863 +07:00 [WRN] Message 382 not found in Redis
2025-06-01 17:12:30.863 +07:00 [WRN] Message 295 not found in Redis
2025-06-01 17:12:30.863 +07:00 [WRN] Message 277 not found in Redis
2025-06-01 17:12:30.863 +07:00 [WRN] Message 271 not found in Redis
2025-06-01 17:12:30.864 +07:00 [WRN] Message 266 not found in Redis
2025-06-01 17:12:30.864 +07:00 [WRN] Message 263 not found in Redis
2025-06-01 17:12:30.864 +07:00 [WRN] Message 262 not found in Redis
2025-06-01 17:12:30.864 +07:00 [WRN] Message 261 not found in Redis
2025-06-01 17:12:30.865 +07:00 [WRN] Message 260 not found in Redis
2025-06-01 17:12:30.865 +07:00 [WRN] Message 257 not found in Redis
2025-06-01 17:12:30.865 +07:00 [WRN] Message 253 not found in Redis
2025-06-01 17:12:30.866 +07:00 [WRN] Message 252 not found in Redis
2025-06-01 17:12:30.866 +07:00 [WRN] Message 251 not found in Redis
2025-06-01 17:12:30.867 +07:00 [WRN] Message 250 not found in Redis
2025-06-01 17:12:30.867 +07:00 [WRN] Message 249 not found in Redis
2025-06-01 17:12:30.867 +07:00 [WRN] Message 248 not found in Redis
2025-06-01 17:12:30.867 +07:00 [WRN] Message 247 not found in Redis
2025-06-01 17:12:30.868 +07:00 [WRN] Message 246 not found in Redis
2025-06-01 17:12:30.868 +07:00 [WRN] Message 245 not found in Redis
2025-06-01 17:12:30.868 +07:00 [WRN] Message 244 not found in Redis
2025-06-01 17:12:30.869 +07:00 [WRN] Message 243 not found in Redis
2025-06-01 17:12:30.869 +07:00 [WRN] Message 242 not found in Redis
2025-06-01 17:12:30.869 +07:00 [WRN] Message 241 not found in Redis
2025-06-01 17:12:30.869 +07:00 [WRN] Message 240 not found in Redis
2025-06-01 17:12:30.870 +07:00 [WRN] Message 239 not found in Redis
2025-06-01 17:12:30.870 +07:00 [WRN] Message 238 not found in Redis
2025-06-01 17:12:30.870 +07:00 [WRN] Message 237 not found in Redis
2025-06-01 17:12:30.871 +07:00 [WRN] Message 231 not found in Redis
2025-06-01 17:12:30.871 +07:00 [WRN] Message 230 not found in Redis
2025-06-01 17:12:30.871 +07:00 [WRN] Message 229 not found in Redis
2025-06-01 17:12:30.871 +07:00 [WRN] Message 228 not found in Redis
2025-06-01 17:12:30.872 +07:00 [WRN] Message 227 not found in Redis
2025-06-01 17:12:30.872 +07:00 [WRN] Message 226 not found in Redis
2025-06-01 17:12:30.872 +07:00 [WRN] Message 225 not found in Redis
2025-06-01 17:12:30.873 +07:00 [WRN] Message 224 not found in Redis
2025-06-01 17:12:30.873 +07:00 [WRN] Message 223 not found in Redis
2025-06-01 17:12:30.873 +07:00 [WRN] Message 222 not found in Redis
2025-06-01 17:12:30.873 +07:00 [WRN] Message 221 not found in Redis
2025-06-01 17:12:30.874 +07:00 [WRN] Message 220 not found in Redis
2025-06-01 17:12:30.874 +07:00 [WRN] Message 219 not found in Redis
2025-06-01 17:12:30.874 +07:00 [WRN] Message 218 not found in Redis
2025-06-01 17:12:30.874 +07:00 [WRN] Message 217 not found in Redis
2025-06-01 17:12:30.875 +07:00 [WRN] Message 216 not found in Redis
2025-06-01 17:12:30.875 +07:00 [WRN] Message 215 not found in Redis
2025-06-01 17:12:30.875 +07:00 [WRN] Message 214 not found in Redis
2025-06-01 17:12:30.876 +07:00 [WRN] Message 213 not found in Redis
2025-06-01 17:12:30.876 +07:00 [WRN] Message 212 not found in Redis
2025-06-01 17:12:30.876 +07:00 [WRN] Message 211 not found in Redis
2025-06-01 17:12:30.876 +07:00 [WRN] Message 210 not found in Redis
2025-06-01 17:12:30.877 +07:00 [WRN] Message 209 not found in Redis
2025-06-01 17:12:30.877 +07:00 [WRN] Message 208 not found in Redis
2025-06-01 17:12:30.878 +07:00 [WRN] Message 207 not found in Redis
2025-06-01 17:12:30.878 +07:00 [WRN] Message 206 not found in Redis
2025-06-01 17:12:30.879 +07:00 [WRN] Message 205 not found in Redis
2025-06-01 17:12:30.880 +07:00 [WRN] Message 204 not found in Redis
2025-06-01 17:12:30.880 +07:00 [WRN] Message 203 not found in Redis
2025-06-01 17:12:30.881 +07:00 [WRN] Message 202 not found in Redis
2025-06-01 17:12:30.881 +07:00 [WRN] Message 201 not found in Redis
2025-06-01 17:12:30.882 +07:00 [WRN] Message 196 not found in Redis
2025-06-01 17:12:30.882 +07:00 [WRN] Message 194 not found in Redis
2025-06-01 17:12:30.882 +07:00 [WRN] Message 193 not found in Redis
2025-06-01 17:12:30.883 +07:00 [WRN] Message 192 not found in Redis
2025-06-01 17:12:30.883 +07:00 [WRN] Message 190 not found in Redis
2025-06-01 17:12:30.883 +07:00 [WRN] Message 189 not found in Redis
2025-06-01 17:12:30.883 +07:00 [WRN] Message 183 not found in Redis
2025-06-01 17:12:30.884 +07:00 [WRN] Message 182 not found in Redis
2025-06-01 17:12:30.884 +07:00 [WRN] Message 181 not found in Redis
2025-06-01 17:12:30.884 +07:00 [INF] Retrieved 0 messages from Redis for conversation 19
2025-06-01 17:12:30.931 +07:00 [INF] Executed DbCommand (29ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-01 17:12:31.010 +07:00 [INF] Executed DbCommand (34ms) [Parameters=[@__p_2='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64), @__clearedAt_1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_2) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0 AND [m].[created_at] > @__clearedAt_1
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-01 17:12:31.052 +07:00 [INF] Saved message 402 to Redis
2025-06-01 17:12:31.054 +07:00 [INF] Added message 402 to conversation 19
2025-06-01 17:12:31.055 +07:00 [INF] Saved message 401 to Redis
2025-06-01 17:12:31.056 +07:00 [INF] Added message 401 to conversation 19
2025-06-01 17:12:31.057 +07:00 [INF] Saved message 400 to Redis
2025-06-01 17:12:31.057 +07:00 [INF] Added message 400 to conversation 19
2025-06-01 17:12:31.058 +07:00 [INF] Saved message 399 to Redis
2025-06-01 17:12:31.058 +07:00 [INF] Added message 399 to conversation 19
2025-06-01 17:12:31.059 +07:00 [INF] Saved message 398 to Redis
2025-06-01 17:12:31.059 +07:00 [INF] Added message 398 to conversation 19
2025-06-01 17:12:31.060 +07:00 [INF] Saved message 397 to Redis
2025-06-01 17:12:31.060 +07:00 [INF] Added message 397 to conversation 19
2025-06-01 17:12:31.061 +07:00 [INF] Saved message 396 to Redis
2025-06-01 17:12:31.061 +07:00 [INF] Added message 396 to conversation 19
2025-06-01 17:12:31.062 +07:00 [INF] Saved message 395 to Redis
2025-06-01 17:12:31.062 +07:00 [INF] Added message 395 to conversation 19
2025-06-01 17:12:31.063 +07:00 [INF] Saved message 394 to Redis
2025-06-01 17:12:31.063 +07:00 [INF] Added message 394 to conversation 19
2025-06-01 17:12:31.064 +07:00 [INF] Saved message 393 to Redis
2025-06-01 17:12:31.064 +07:00 [INF] Added message 393 to conversation 19
2025-06-01 17:12:31.065 +07:00 [INF] Saved message 392 to Redis
2025-06-01 17:12:31.065 +07:00 [INF] Added message 392 to conversation 19
2025-06-01 17:12:31.066 +07:00 [INF] Saved message 391 to Redis
2025-06-01 17:12:31.066 +07:00 [INF] Added message 391 to conversation 19
2025-06-01 17:12:31.067 +07:00 [INF] Saved message 390 to Redis
2025-06-01 17:12:31.067 +07:00 [INF] Added message 390 to conversation 19
2025-06-01 17:12:31.068 +07:00 [INF] Saved message 389 to Redis
2025-06-01 17:12:31.068 +07:00 [INF] Added message 389 to conversation 19
2025-06-01 17:12:31.069 +07:00 [INF] Saved message 388 to Redis
2025-06-01 17:12:31.069 +07:00 [INF] Added message 388 to conversation 19
2025-06-01 17:12:31.070 +07:00 [INF] Saved message 387 to Redis
2025-06-01 17:12:31.070 +07:00 [INF] Added message 387 to conversation 19
2025-06-01 17:12:31.071 +07:00 [INF] Saved message 386 to Redis
2025-06-01 17:12:31.071 +07:00 [INF] Added message 386 to conversation 19
2025-06-01 17:12:31.072 +07:00 [INF] Saved message 385 to Redis
2025-06-01 17:12:31.072 +07:00 [INF] Added message 385 to conversation 19
2025-06-01 17:12:31.073 +07:00 [INF] Saved message 384 to Redis
2025-06-01 17:12:31.073 +07:00 [INF] Added message 384 to conversation 19
2025-06-01 17:12:31.074 +07:00 [INF] Saved message 383 to Redis
2025-06-01 17:12:31.074 +07:00 [INF] Added message 383 to conversation 19
2025-06-01 17:12:31.075 +07:00 [INF] Saved message 382 to Redis
2025-06-01 17:12:31.075 +07:00 [INF] Added message 382 to conversation 19
2025-06-01 17:12:31.076 +07:00 [INF] Saved message 295 to Redis
2025-06-01 17:12:31.076 +07:00 [INF] Added message 295 to conversation 19
2025-06-01 17:12:31.076 +07:00 [INF] Saved message 277 to Redis
2025-06-01 17:12:31.077 +07:00 [INF] Added message 277 to conversation 19
2025-06-01 17:12:31.077 +07:00 [INF] Saved message 271 to Redis
2025-06-01 17:12:31.077 +07:00 [INF] Added message 271 to conversation 19
2025-06-01 17:12:31.078 +07:00 [INF] Saved message 266 to Redis
2025-06-01 17:12:31.079 +07:00 [INF] Added message 266 to conversation 19
2025-06-01 17:12:31.080 +07:00 [INF] Saved message 263 to Redis
2025-06-01 17:12:31.080 +07:00 [INF] Added message 263 to conversation 19
2025-06-01 17:12:31.081 +07:00 [INF] Saved message 262 to Redis
2025-06-01 17:12:31.081 +07:00 [INF] Added message 262 to conversation 19
2025-06-01 17:12:31.082 +07:00 [INF] Saved message 261 to Redis
2025-06-01 17:12:31.082 +07:00 [INF] Added message 261 to conversation 19
2025-06-01 17:12:31.083 +07:00 [INF] Saved message 260 to Redis
2025-06-01 17:12:31.083 +07:00 [INF] Added message 260 to conversation 19
2025-06-01 17:12:31.084 +07:00 [INF] Saved message 257 to Redis
2025-06-01 17:12:31.084 +07:00 [INF] Added message 257 to conversation 19
2025-06-01 17:12:31.085 +07:00 [INF] Saved message 253 to Redis
2025-06-01 17:12:31.085 +07:00 [INF] Added message 253 to conversation 19
2025-06-01 17:12:31.429 +07:00 [INF] Saved message 252 to Redis
2025-06-01 17:12:31.429 +07:00 [INF] Added message 252 to conversation 19
2025-06-01 17:12:31.430 +07:00 [INF] Saved message 251 to Redis
2025-06-01 17:12:31.430 +07:00 [INF] Added message 251 to conversation 19
2025-06-01 17:12:31.431 +07:00 [INF] Saved message 250 to Redis
2025-06-01 17:12:31.431 +07:00 [INF] Added message 250 to conversation 19
2025-06-01 17:12:31.432 +07:00 [INF] Saved message 249 to Redis
2025-06-01 17:12:31.432 +07:00 [INF] Added message 249 to conversation 19
2025-06-01 17:12:31.433 +07:00 [INF] Saved message 248 to Redis
2025-06-01 17:12:31.433 +07:00 [INF] Added message 248 to conversation 19
2025-06-01 17:12:31.435 +07:00 [INF] Saved message 247 to Redis
2025-06-01 17:12:31.435 +07:00 [INF] Added message 247 to conversation 19
2025-06-01 17:12:31.436 +07:00 [INF] Saved message 246 to Redis
2025-06-01 17:12:31.436 +07:00 [INF] Added message 246 to conversation 19
2025-06-01 17:12:31.437 +07:00 [INF] Cached 38 messages to Redis for conversation 19
2025-06-01 17:12:31.437 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 17:12:31.443 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 608.4781ms
2025-06-01 17:12:31.443 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 17:12:31.443 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Message/getMessages/19/2 - 200 null application/json; charset=utf-8 615.7738ms
2025-06-01 17:12:31.589 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 17:12:31.589 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 17:12:31.593 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 17:12:31.628 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 17:12:31.653 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 17:12:31.655 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 62.5181ms
2025-06-01 17:12:31.655 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 17:12:31.656 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 66.9088ms
2025-06-01 17:12:31.685 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Participant/get_participants/19 - null null
2025-06-01 17:12:31.686 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 17:12:31.690 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 17:12:31.712 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 17:12:31.713 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 17:12:31.715 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 24.7805ms
2025-06-01 17:12:31.715 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 17:12:31.715 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 30.2818ms
2025-06-01 17:12:34.558 +07:00 [INF] Handling message from user 2: ok
2025-06-01 17:12:34.593 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-01 17:12:34.711 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 17:12:34.752 +07:00 [INF] Executed DbCommand (38ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-01 17:12:34.768 +07:00 [INF] Message saved to DB with ID: 435
2025-06-01 17:12:34.771 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 17:12:34.787 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-01 17:12:34.800 +07:00 [INF] Transaction committed for message: 435
2025-06-01 17:12:34.809 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 17:12:34.812 +07:00 [INF] Saved message 435 to Redis
2025-06-01 17:12:34.813 +07:00 [INF] Added message 435 to conversation 19
2025-06-01 17:12:34.822 +07:00 [INF] Published message to channel conversation:19
2025-06-01 17:12:37.771 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-06-01 17:12:37.771 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:12:37.771 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.4004ms
2025-06-01 17:12:37.773 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-06-01 17:12:37.773 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:12:37.774 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:12:37.774 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 17:12:37.774 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 17:12:37.825 +07:00 [WRN] Message 245 not found in Redis
2025-06-01 17:12:37.825 +07:00 [WRN] Message 244 not found in Redis
2025-06-01 17:12:37.825 +07:00 [WRN] Message 243 not found in Redis
2025-06-01 17:12:37.825 +07:00 [WRN] Message 242 not found in Redis
2025-06-01 17:12:37.826 +07:00 [WRN] Message 241 not found in Redis
2025-06-01 17:12:37.826 +07:00 [WRN] Message 240 not found in Redis
2025-06-01 17:12:37.826 +07:00 [WRN] Message 239 not found in Redis
2025-06-01 17:12:37.827 +07:00 [WRN] Message 238 not found in Redis
2025-06-01 17:12:37.827 +07:00 [WRN] Message 237 not found in Redis
2025-06-01 17:12:37.827 +07:00 [WRN] Message 231 not found in Redis
2025-06-01 17:12:37.827 +07:00 [WRN] Message 230 not found in Redis
2025-06-01 17:12:37.827 +07:00 [WRN] Message 229 not found in Redis
2025-06-01 17:12:37.828 +07:00 [WRN] Message 228 not found in Redis
2025-06-01 17:12:37.828 +07:00 [WRN] Message 227 not found in Redis
2025-06-01 17:12:37.828 +07:00 [WRN] Message 226 not found in Redis
2025-06-01 17:12:37.829 +07:00 [WRN] Message 225 not found in Redis
2025-06-01 17:12:37.830 +07:00 [WRN] Message 224 not found in Redis
2025-06-01 17:12:37.831 +07:00 [WRN] Message 223 not found in Redis
2025-06-01 17:12:37.831 +07:00 [WRN] Message 222 not found in Redis
2025-06-01 17:12:37.832 +07:00 [WRN] Message 221 not found in Redis
2025-06-01 17:12:37.833 +07:00 [WRN] Message 220 not found in Redis
2025-06-01 17:12:37.833 +07:00 [WRN] Message 219 not found in Redis
2025-06-01 17:12:37.833 +07:00 [WRN] Message 218 not found in Redis
2025-06-01 17:12:37.834 +07:00 [WRN] Message 217 not found in Redis
2025-06-01 17:12:37.834 +07:00 [WRN] Message 216 not found in Redis
2025-06-01 17:12:37.834 +07:00 [WRN] Message 215 not found in Redis
2025-06-01 17:12:37.834 +07:00 [WRN] Message 214 not found in Redis
2025-06-01 17:12:37.835 +07:00 [WRN] Message 213 not found in Redis
2025-06-01 17:12:37.835 +07:00 [WRN] Message 212 not found in Redis
2025-06-01 17:12:37.835 +07:00 [WRN] Message 211 not found in Redis
2025-06-01 17:12:37.835 +07:00 [WRN] Message 210 not found in Redis
2025-06-01 17:12:37.835 +07:00 [WRN] Message 209 not found in Redis
2025-06-01 17:12:37.836 +07:00 [WRN] Message 208 not found in Redis
2025-06-01 17:12:37.836 +07:00 [WRN] Message 207 not found in Redis
2025-06-01 17:12:37.836 +07:00 [WRN] Message 206 not found in Redis
2025-06-01 17:12:37.836 +07:00 [WRN] Message 205 not found in Redis
2025-06-01 17:12:37.836 +07:00 [WRN] Message 204 not found in Redis
2025-06-01 17:12:37.836 +07:00 [WRN] Message 203 not found in Redis
2025-06-01 17:12:37.837 +07:00 [WRN] Message 202 not found in Redis
2025-06-01 17:12:37.837 +07:00 [WRN] Message 201 not found in Redis
2025-06-01 17:12:37.837 +07:00 [WRN] Message 196 not found in Redis
2025-06-01 17:12:37.837 +07:00 [WRN] Message 194 not found in Redis
2025-06-01 17:12:37.837 +07:00 [WRN] Message 193 not found in Redis
2025-06-01 17:12:37.837 +07:00 [WRN] Message 192 not found in Redis
2025-06-01 17:12:37.838 +07:00 [WRN] Message 190 not found in Redis
2025-06-01 17:12:37.838 +07:00 [WRN] Message 189 not found in Redis
2025-06-01 17:12:37.838 +07:00 [WRN] Message 183 not found in Redis
2025-06-01 17:12:37.838 +07:00 [WRN] Message 182 not found in Redis
2025-06-01 17:12:37.838 +07:00 [WRN] Message 181 not found in Redis
2025-06-01 17:12:37.838 +07:00 [INF] Retrieved 39 messages from Redis for conversation 19
2025-06-01 17:12:37.840 +07:00 [INF] Retrieved 39 messages from Redis for conversation 19 and user 3
2025-06-01 17:12:37.840 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 17:12:37.841 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 66.0086ms
2025-06-01 17:12:37.841 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 17:12:37.841 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 68.2147ms
2025-06-01 17:12:37.855 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 17:12:37.855 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:12:37.855 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.2076ms
2025-06-01 17:12:37.857 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 17:12:37.857 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:12:37.857 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:12:37.857 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 17:12:37.857 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 17:12:37.865 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 17:12:37.866 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 17:12:37.867 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.3365ms
2025-06-01 17:12:37.867 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 17:12:37.867 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 10.3149ms
2025-06-01 17:12:37.873 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-01 17:12:37.873 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:12:37.873 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.2533ms
2025-06-01 17:12:37.875 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-01 17:12:37.875 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:12:37.876 +07:00 [INF] CORS policy execution successful.
2025-06-01 17:12:37.876 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 17:12:37.876 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 17:12:37.883 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 17:12:37.884 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 17:12:37.884 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.6613ms
2025-06-01 17:12:37.884 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 17:12:37.884 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 9.4627ms
2025-06-01 17:13:25.828 +07:00 [INF] Handling message from user 2: hello
2025-06-01 17:13:25.836 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-01 17:13:25.839 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 17:13:25.845 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-01 17:13:25.846 +07:00 [INF] Message saved to DB with ID: 436
2025-06-01 17:13:25.847 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 17:13:25.854 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-01 17:13:25.854 +07:00 [INF] Transaction committed for message: 436
2025-06-01 17:13:25.859 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 17:13:25.860 +07:00 [INF] Saved message 436 to Redis
2025-06-01 17:13:25.860 +07:00 [INF] Added message 436 to conversation 19
2025-06-01 17:13:25.861 +07:00 [INF] Published message to channel conversation:19
2025-06-01 17:13:39.930 +07:00 [INF] Handling message from user 3: wtf?
2025-06-01 17:13:39.960 +07:00 [INF] Executed DbCommand (26ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-01 17:13:39.968 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 17:13:39.979 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-01 17:13:39.979 +07:00 [INF] Message saved to DB with ID: 437
2025-06-01 17:13:39.980 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 17:13:39.986 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-01 17:13:39.986 +07:00 [INF] Transaction committed for message: 437
2025-06-01 17:13:39.992 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 17:13:39.993 +07:00 [INF] Saved message 437 to Redis
2025-06-01 17:13:39.994 +07:00 [INF] Added message 437 to conversation 19
2025-06-01 17:13:39.994 +07:00 [INF] Published message to channel conversation:19
2025-06-01 19:45:55.309 +07:00 [INF] Application is shutting down...
2025-06-01 19:46:25.366 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 19:46:25.366 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 19:46:25.379 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 101 null null 9240133.9531ms
2025-06-01 19:46:25.379 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 9270509.3172ms
2025-06-01 19:46:34.752 +07:00 [INF] Executed DbCommand (42ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-01 19:46:34.882 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-01 19:46:34.979 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-01 19:46:34.987 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-01 19:46:34.988 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-01 19:46:34.988 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-01 19:46:34.988 +07:00 [INF] Hosting environment: Development
2025-06-01 19:46:34.988 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-01 19:46:37.785 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 19:46:37.820 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:46:37.855 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:46:37.857 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-01 19:46:37.904 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 19:46:43.965 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 19:46:43.975 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 19:48:08.745 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 19:48:08.769 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 19:48:08.882 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-01 19:48:08.908 +07:00 [ERR] Connection id "0HND119CLOHA7", Request id "0HND119CLOHA7:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-01 19:48:08.941 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 101 null null 84968.711ms
2025-06-01 19:48:10.075 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-01 19:48:10.084 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:48:10.092 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 17.1921ms
2025-06-01 19:48:10.099 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-01 19:48:10.101 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:48:10.105 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:48:10.118 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 19:48:10.214 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-01 19:48:10.795 +07:00 [INF] Executed DbCommand (115ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-01 19:48:11.049 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-01 19:48:11.152 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 933.5152ms
2025-06-01 19:48:11.152 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 19:48:11.157 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 1058.1388ms
2025-06-01 19:48:11.213 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 19:48:11.217 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:48:11.217 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:48:11.217 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 19:48:11.328 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-01 19:48:11.330 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:48:11.332 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:48:11.333 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 19:48:11.342 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-01 19:48:11.547 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 19:48:11.547 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:48:11.547 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.6776ms
2025-06-01 19:48:11.549 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 19:48:11.550 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:48:11.550 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:48:11.550 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 19:48:11.559 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 19:48:11.577 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 19:48:11.614 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-01 19:48:11.616 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-01 19:48:11.620 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-01 19:48:11.622 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-01 19:48:11.624 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-01 19:48:11.628 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-01 19:48:11.631 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-01 19:48:11.632 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-01 19:48:11.632 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-01 19:48:11.634 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-01 19:48:11.636 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-01 19:48:11.639 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-01 19:48:11.640 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-01 19:48:11.641 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 19:48:11.643 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-01 19:48:11.646 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-01 19:48:11.647 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-01 19:48:11.648 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-01 19:48:11.651 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-01 19:48:11.652 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-01 19:48:11.653 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-01 19:48:11.654 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-01 19:48:11.657 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-01 19:48:11.658 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-01 19:48:11.661 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-01 19:48:11.662 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-01 19:48:11.677 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 334.5779ms
2025-06-01 19:48:11.678 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 19:48:11.678 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 349.7212ms
2025-06-01 19:48:11.746 +07:00 [INF] Executed DbCommand (40ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-01 19:48:11.804 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 19:48:11.840 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 280.7945ms
2025-06-01 19:48:11.840 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 19:48:11.841 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 291.4691ms
2025-06-01 19:49:00.930 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.4:5053/api/Auth/login - application/json 58
2025-06-01 19:49:00.938 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 19:49:00.938 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-01 19:49:00.961 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-01 19:49:00.967 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-01 19:49:00.968 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 30.4839ms
2025-06-01 19:49:00.969 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 19:49:00.969 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.4:5053/api/Auth/login - 200 null application/json; charset=utf-8 38.6986ms
2025-06-01 19:49:02.109 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/friends/GetAllFriends/2 - null null
2025-06-01 19:49:02.112 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 19:49:02.113 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-01 19:49:02.141 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-01 19:49:02.151 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 19:49:02.152 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 39.0345ms
2025-06-01 19:49:02.152 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 19:49:02.153 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 43.8751ms
2025-06-01 19:49:02.282 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_conversations/2 - null null
2025-06-01 19:49:02.284 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 19:49:02.285 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 19:49:02.312 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-01 19:49:02.344 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 19:49:02.419 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 134.7661ms
2025-06-01 19:49:02.420 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 19:49:02.420 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 137.4332ms
2025-06-01 19:49:02.844 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 19:49:02.845 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 19:49:02.948 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 19:49:02.949 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-01 19:49:02.949 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-01 19:49:02.951 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-01 19:49:02.951 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-01 19:49:02.951 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-01 19:49:02.951 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-01 19:49:02.951 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-01 19:49:02.951 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-01 19:49:02.952 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-01 19:49:02.952 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-01 19:49:02.952 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-01 19:49:02.952 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-01 19:49:02.952 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-01 19:49:02.952 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-01 19:49:02.953 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-01 19:49:02.953 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-01 19:49:02.953 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-01 19:49:02.953 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-01 19:49:02.953 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-01 19:49:02.953 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-01 19:49:02.953 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-01 19:49:02.953 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-01 19:49:02.953 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-01 19:49:02.957 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-01 19:49:02.957 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-01 19:49:02.958 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-01 19:49:02.958 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-01 19:49:02.958 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-01 19:49:02.958 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-01 19:49:02.959 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-01 19:49:02.960 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-01 19:49:05.391 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Message/getMessages/19/2 - null null
2025-06-01 19:49:05.391 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:49:05.401 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 19:49:05.485 +07:00 [WRN] Message 245 not found in Redis
2025-06-01 19:49:05.485 +07:00 [WRN] Message 244 not found in Redis
2025-06-01 19:49:05.486 +07:00 [WRN] Message 243 not found in Redis
2025-06-01 19:49:05.486 +07:00 [WRN] Message 242 not found in Redis
2025-06-01 19:49:05.486 +07:00 [WRN] Message 241 not found in Redis
2025-06-01 19:49:05.487 +07:00 [WRN] Message 240 not found in Redis
2025-06-01 19:49:05.487 +07:00 [WRN] Message 239 not found in Redis
2025-06-01 19:49:05.487 +07:00 [WRN] Message 238 not found in Redis
2025-06-01 19:49:05.488 +07:00 [WRN] Message 237 not found in Redis
2025-06-01 19:49:05.488 +07:00 [WRN] Message 231 not found in Redis
2025-06-01 19:49:05.488 +07:00 [WRN] Message 230 not found in Redis
2025-06-01 19:49:05.489 +07:00 [WRN] Message 229 not found in Redis
2025-06-01 19:49:05.489 +07:00 [WRN] Message 228 not found in Redis
2025-06-01 19:49:05.489 +07:00 [WRN] Message 227 not found in Redis
2025-06-01 19:49:05.490 +07:00 [WRN] Message 226 not found in Redis
2025-06-01 19:49:05.491 +07:00 [WRN] Message 225 not found in Redis
2025-06-01 19:49:05.492 +07:00 [WRN] Message 224 not found in Redis
2025-06-01 19:49:05.494 +07:00 [WRN] Message 223 not found in Redis
2025-06-01 19:49:05.495 +07:00 [WRN] Message 222 not found in Redis
2025-06-01 19:49:05.496 +07:00 [WRN] Message 221 not found in Redis
2025-06-01 19:49:05.496 +07:00 [WRN] Message 220 not found in Redis
2025-06-01 19:49:05.497 +07:00 [WRN] Message 219 not found in Redis
2025-06-01 19:49:05.497 +07:00 [WRN] Message 218 not found in Redis
2025-06-01 19:49:05.498 +07:00 [WRN] Message 217 not found in Redis
2025-06-01 19:49:05.498 +07:00 [WRN] Message 216 not found in Redis
2025-06-01 19:49:05.498 +07:00 [WRN] Message 215 not found in Redis
2025-06-01 19:49:05.499 +07:00 [WRN] Message 214 not found in Redis
2025-06-01 19:49:05.499 +07:00 [WRN] Message 213 not found in Redis
2025-06-01 19:49:05.500 +07:00 [WRN] Message 212 not found in Redis
2025-06-01 19:49:05.500 +07:00 [WRN] Message 211 not found in Redis
2025-06-01 19:49:05.501 +07:00 [WRN] Message 210 not found in Redis
2025-06-01 19:49:05.501 +07:00 [WRN] Message 209 not found in Redis
2025-06-01 19:49:05.502 +07:00 [WRN] Message 208 not found in Redis
2025-06-01 19:49:05.502 +07:00 [WRN] Message 207 not found in Redis
2025-06-01 19:49:05.502 +07:00 [WRN] Message 206 not found in Redis
2025-06-01 19:49:05.503 +07:00 [WRN] Message 205 not found in Redis
2025-06-01 19:49:05.503 +07:00 [WRN] Message 204 not found in Redis
2025-06-01 19:49:05.503 +07:00 [WRN] Message 203 not found in Redis
2025-06-01 19:49:05.504 +07:00 [WRN] Message 202 not found in Redis
2025-06-01 19:49:05.504 +07:00 [WRN] Message 201 not found in Redis
2025-06-01 19:49:05.504 +07:00 [WRN] Message 196 not found in Redis
2025-06-01 19:49:05.505 +07:00 [WRN] Message 194 not found in Redis
2025-06-01 19:49:05.505 +07:00 [WRN] Message 193 not found in Redis
2025-06-01 19:49:05.506 +07:00 [WRN] Message 192 not found in Redis
2025-06-01 19:49:05.506 +07:00 [WRN] Message 190 not found in Redis
2025-06-01 19:49:05.507 +07:00 [WRN] Message 189 not found in Redis
2025-06-01 19:49:05.507 +07:00 [WRN] Message 183 not found in Redis
2025-06-01 19:49:05.508 +07:00 [WRN] Message 182 not found in Redis
2025-06-01 19:49:05.508 +07:00 [WRN] Message 181 not found in Redis
2025-06-01 19:49:05.508 +07:00 [INF] Retrieved 41 messages from Redis for conversation 19
2025-06-01 19:49:05.512 +07:00 [INF] Retrieved 41 messages from Redis for conversation 19 and user 2
2025-06-01 19:49:05.513 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 19:49:05.526 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 125.1475ms
2025-06-01 19:49:05.526 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:49:05.527 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Message/getMessages/19/2 - 200 null application/json; charset=utf-8 135.7178ms
2025-06-01 19:49:05.621 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 19:49:05.622 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:49:05.626 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 19:49:05.692 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 19:49:05.769 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 19:49:05.774 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 147.7519ms
2025-06-01 19:49:05.774 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:49:05.774 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 153.0088ms
2025-06-01 19:49:05.806 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Participant/get_participants/19 - null null
2025-06-01 19:49:05.806 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:49:05.812 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 19:49:05.829 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 19:49:05.831 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 19:49:05.835 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 22.686ms
2025-06-01 19:49:05.835 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:49:05.836 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 29.9804ms
2025-06-01 19:49:09.114 +07:00 [INF] Handling message from user 2: hhe
2025-06-01 19:49:09.166 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-01 19:49:09.456 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 19:49:09.509 +07:00 [INF] Executed DbCommand (46ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-01 19:49:09.542 +07:00 [INF] Message saved to DB with ID: 438
2025-06-01 19:49:09.551 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 19:49:09.566 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-01 19:49:09.617 +07:00 [INF] Transaction committed for message: 438
2025-06-01 19:49:09.647 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 19:49:09.681 +07:00 [INF] Saved message 438 to Redis
2025-06-01 19:49:09.686 +07:00 [INF] Added message 438 to conversation 19
2025-06-01 19:49:09.711 +07:00 [INF] Published message to channel conversation:19
2025-06-01 19:49:15.307 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.4:5053/api/Message/uploadFile - multipart/form-data; boundary=--dio-boundary-3015558018 1380823
2025-06-01 19:49:15.311 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-06-01 19:49:15.330 +07:00 [INF] Route matched with {action = "UploadFile", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UploadFile(Microsoft.AspNetCore.Http.IFormFile) on controller server.Controllers.MessageController (Message_app).
2025-06-01 19:49:26.560 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (DbType = Single), @p1='?' (Size = 50), @p2='?' (Size = 255), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Attachments] ([FileSize], [file_type], [file_url], [is_temporary], [message_id], [uploaded_at])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-06-01 19:49:26.567 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 19:49:26.574 +07:00 [INF] Executed action server.Controllers.MessageController.UploadFile (Message_app) in 11243.213ms
2025-06-01 19:49:26.574 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-06-01 19:49:26.583 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.4:5053/api/Message/uploadFile - 200 null application/json; charset=utf-8 11276.1073ms
2025-06-01 19:49:26.666 +07:00 [INF] Handling message from user 2: FILE
2025-06-01 19:49:26.678 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-01 19:49:26.689 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 19:49:26.697 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-01 19:49:26.698 +07:00 [INF] Message saved to DB with ID: 439
2025-06-01 19:49:26.731 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM [Attachments] AS [a]
WHERE [a].[id] = @__p_0
2025-06-01 19:49:26.751 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 19:49:26.767 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@p6='?' (DbType = Int32), @p0='?' (DbType = Single), @p1='?' (Size = 50), @p2='?' (Size = 255), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2), @p14='?' (DbType = Int32), @p7='?' (DbType = DateTime2), @p8='?' (Size = 4000), @p9='?' (DbType = Boolean), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (DbType = DateTime2), @p13='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Attachments] SET [FileSize] = @p0, [file_type] = @p1, [file_url] = @p2, [is_temporary] = @p3, [message_id] = @p4, [uploaded_at] = @p5
OUTPUT 1
WHERE [id] = @p6;
UPDATE [Conversations] SET [created_at] = @p7, [img_url] = @p8, [is_group] = @p9, [lastMessage] = @p10, [lastMessageSender] = @p11, [lastMessageTime] = @p12, [name] = @p13
OUTPUT 1
WHERE [id] = @p14;
2025-06-01 19:49:26.769 +07:00 [INF] Transaction committed for message: 439
2025-06-01 19:49:26.775 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 19:49:26.779 +07:00 [INF] Saved message 439 to Redis
2025-06-01 19:49:26.780 +07:00 [INF] Added message 439 to conversation 19
2025-06-01 19:49:26.786 +07:00 [INF] Published message to channel conversation:19
2025-06-01 19:49:31.433 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-06-01 19:49:31.434 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:49:31.434 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.5945ms
2025-06-01 19:49:31.436 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-06-01 19:49:31.437 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:49:31.437 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:49:31.437 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:49:31.437 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 19:49:31.472 +07:00 [WRN] Message 245 not found in Redis
2025-06-01 19:49:31.473 +07:00 [WRN] Message 244 not found in Redis
2025-06-01 19:49:31.473 +07:00 [WRN] Message 243 not found in Redis
2025-06-01 19:49:31.473 +07:00 [WRN] Message 242 not found in Redis
2025-06-01 19:49:31.473 +07:00 [WRN] Message 241 not found in Redis
2025-06-01 19:49:31.474 +07:00 [WRN] Message 240 not found in Redis
2025-06-01 19:49:31.474 +07:00 [WRN] Message 239 not found in Redis
2025-06-01 19:49:31.474 +07:00 [WRN] Message 238 not found in Redis
2025-06-01 19:49:31.474 +07:00 [WRN] Message 237 not found in Redis
2025-06-01 19:49:31.475 +07:00 [WRN] Message 231 not found in Redis
2025-06-01 19:49:31.475 +07:00 [WRN] Message 230 not found in Redis
2025-06-01 19:49:31.475 +07:00 [WRN] Message 229 not found in Redis
2025-06-01 19:49:31.475 +07:00 [WRN] Message 228 not found in Redis
2025-06-01 19:49:31.475 +07:00 [WRN] Message 227 not found in Redis
2025-06-01 19:49:31.476 +07:00 [WRN] Message 226 not found in Redis
2025-06-01 19:49:31.476 +07:00 [WRN] Message 225 not found in Redis
2025-06-01 19:49:31.476 +07:00 [WRN] Message 224 not found in Redis
2025-06-01 19:49:31.476 +07:00 [WRN] Message 223 not found in Redis
2025-06-01 19:49:31.477 +07:00 [WRN] Message 222 not found in Redis
2025-06-01 19:49:31.477 +07:00 [WRN] Message 221 not found in Redis
2025-06-01 19:49:31.477 +07:00 [WRN] Message 220 not found in Redis
2025-06-01 19:49:31.478 +07:00 [WRN] Message 219 not found in Redis
2025-06-01 19:49:31.478 +07:00 [WRN] Message 218 not found in Redis
2025-06-01 19:49:31.478 +07:00 [WRN] Message 217 not found in Redis
2025-06-01 19:49:31.478 +07:00 [WRN] Message 216 not found in Redis
2025-06-01 19:49:31.479 +07:00 [WRN] Message 215 not found in Redis
2025-06-01 19:49:31.480 +07:00 [WRN] Message 214 not found in Redis
2025-06-01 19:49:31.481 +07:00 [WRN] Message 213 not found in Redis
2025-06-01 19:49:31.481 +07:00 [WRN] Message 212 not found in Redis
2025-06-01 19:49:31.481 +07:00 [WRN] Message 211 not found in Redis
2025-06-01 19:49:31.482 +07:00 [WRN] Message 210 not found in Redis
2025-06-01 19:49:31.482 +07:00 [WRN] Message 209 not found in Redis
2025-06-01 19:49:31.482 +07:00 [WRN] Message 208 not found in Redis
2025-06-01 19:49:31.483 +07:00 [WRN] Message 207 not found in Redis
2025-06-01 19:49:31.483 +07:00 [WRN] Message 206 not found in Redis
2025-06-01 19:49:31.483 +07:00 [WRN] Message 205 not found in Redis
2025-06-01 19:49:31.484 +07:00 [WRN] Message 204 not found in Redis
2025-06-01 19:49:31.484 +07:00 [WRN] Message 203 not found in Redis
2025-06-01 19:49:31.485 +07:00 [WRN] Message 202 not found in Redis
2025-06-01 19:49:31.485 +07:00 [WRN] Message 201 not found in Redis
2025-06-01 19:49:31.485 +07:00 [WRN] Message 196 not found in Redis
2025-06-01 19:49:31.485 +07:00 [WRN] Message 194 not found in Redis
2025-06-01 19:49:31.486 +07:00 [WRN] Message 193 not found in Redis
2025-06-01 19:49:31.486 +07:00 [WRN] Message 192 not found in Redis
2025-06-01 19:49:31.486 +07:00 [WRN] Message 190 not found in Redis
2025-06-01 19:49:31.487 +07:00 [WRN] Message 189 not found in Redis
2025-06-01 19:49:31.487 +07:00 [WRN] Message 183 not found in Redis
2025-06-01 19:49:31.487 +07:00 [WRN] Message 182 not found in Redis
2025-06-01 19:49:31.488 +07:00 [WRN] Message 181 not found in Redis
2025-06-01 19:49:31.488 +07:00 [INF] Retrieved 43 messages from Redis for conversation 19
2025-06-01 19:49:31.488 +07:00 [INF] Retrieved 43 messages from Redis for conversation 19 and user 3
2025-06-01 19:49:31.488 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 19:49:31.489 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 52.2188ms
2025-06-01 19:49:31.489 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:49:31.490 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 53.2011ms
2025-06-01 19:49:31.506 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 19:49:31.506 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:49:31.506 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.3208ms
2025-06-01 19:49:31.507 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 19:49:31.508 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:49:31.508 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:49:31.508 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:49:31.508 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 19:49:31.519 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 19:49:31.520 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 19:49:31.520 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 11.6976ms
2025-06-01 19:49:31.521 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:49:31.521 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 13.3395ms
2025-06-01 19:49:31.529 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-01 19:49:31.529 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:49:31.529 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.3825ms
2025-06-01 19:49:31.532 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-01 19:49:31.532 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:49:31.534 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:49:31.534 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:49:31.534 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 19:49:31.542 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 19:49:31.543 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 19:49:31.544 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.1382ms
2025-06-01 19:49:31.544 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:49:31.544 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 12.1972ms
2025-06-01 19:50:56.483 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 19:50:56.484 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 19:50:56.487 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-01 19:50:56.488 +07:00 [ERR] Connection id "0HND119CLOHA9", Request id "0HND119CLOHA9:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-01 19:50:56.491 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 165277.8765ms
2025-06-01 19:52:33.874 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-01 19:52:33.874 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:33.875 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.9669ms
2025-06-01 19:52:33.876 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-01 19:52:33.876 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:33.876 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:33.877 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 19:52:33.877 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-01 19:52:33.909 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-01 19:52:33.912 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-01 19:52:33.913 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 35.9606ms
2025-06-01 19:52:33.913 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 19:52:33.913 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 37.6429ms
2025-06-01 19:52:33.946 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 19:52:33.946 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:33.946 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:33.946 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 19:52:34.092 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-01 19:52:34.092 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:34.092 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:34.092 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 19:52:34.092 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-01 19:52:34.105 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-01 19:52:34.105 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 19:52:34.105 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 12.938ms
2025-06-01 19:52:34.106 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 19:52:34.107 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 14.8221ms
2025-06-01 19:52:34.254 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-01 19:52:34.256 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-01 19:52:34.338 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 19:52:34.339 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:34.339 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.346ms
2025-06-01 19:52:34.340 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 19:52:34.341 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:34.341 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:34.341 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 19:52:34.341 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 19:52:34.369 +07:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-01 19:52:34.396 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 19:52:34.400 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 58.6329ms
2025-06-01 19:52:34.400 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 19:52:34.400 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 59.8039ms
2025-06-01 19:52:36.747 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-06-01 19:52:36.747 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:36.748 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.5559ms
2025-06-01 19:52:36.749 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-06-01 19:52:36.750 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:36.750 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:36.750 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:52:36.750 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 19:52:36.783 +07:00 [WRN] Message 245 not found in Redis
2025-06-01 19:52:36.783 +07:00 [WRN] Message 244 not found in Redis
2025-06-01 19:52:36.784 +07:00 [WRN] Message 243 not found in Redis
2025-06-01 19:52:36.785 +07:00 [WRN] Message 242 not found in Redis
2025-06-01 19:52:36.785 +07:00 [WRN] Message 241 not found in Redis
2025-06-01 19:52:36.786 +07:00 [WRN] Message 240 not found in Redis
2025-06-01 19:52:36.787 +07:00 [WRN] Message 239 not found in Redis
2025-06-01 19:52:36.788 +07:00 [WRN] Message 238 not found in Redis
2025-06-01 19:52:36.788 +07:00 [WRN] Message 237 not found in Redis
2025-06-01 19:52:36.788 +07:00 [WRN] Message 231 not found in Redis
2025-06-01 19:52:36.789 +07:00 [WRN] Message 230 not found in Redis
2025-06-01 19:52:36.790 +07:00 [WRN] Message 229 not found in Redis
2025-06-01 19:52:36.791 +07:00 [WRN] Message 228 not found in Redis
2025-06-01 19:52:36.791 +07:00 [WRN] Message 227 not found in Redis
2025-06-01 19:52:36.791 +07:00 [WRN] Message 226 not found in Redis
2025-06-01 19:52:36.792 +07:00 [WRN] Message 225 not found in Redis
2025-06-01 19:52:36.793 +07:00 [WRN] Message 224 not found in Redis
2025-06-01 19:52:36.793 +07:00 [WRN] Message 223 not found in Redis
2025-06-01 19:52:36.794 +07:00 [WRN] Message 222 not found in Redis
2025-06-01 19:52:36.796 +07:00 [WRN] Message 221 not found in Redis
2025-06-01 19:52:36.797 +07:00 [WRN] Message 220 not found in Redis
2025-06-01 19:52:36.798 +07:00 [WRN] Message 219 not found in Redis
2025-06-01 19:52:36.798 +07:00 [WRN] Message 218 not found in Redis
2025-06-01 19:52:36.798 +07:00 [WRN] Message 217 not found in Redis
2025-06-01 19:52:36.799 +07:00 [WRN] Message 216 not found in Redis
2025-06-01 19:52:36.799 +07:00 [WRN] Message 215 not found in Redis
2025-06-01 19:52:36.800 +07:00 [WRN] Message 214 not found in Redis
2025-06-01 19:52:36.800 +07:00 [WRN] Message 213 not found in Redis
2025-06-01 19:52:36.800 +07:00 [WRN] Message 212 not found in Redis
2025-06-01 19:52:36.801 +07:00 [WRN] Message 211 not found in Redis
2025-06-01 19:52:36.802 +07:00 [WRN] Message 210 not found in Redis
2025-06-01 19:52:36.803 +07:00 [WRN] Message 209 not found in Redis
2025-06-01 19:52:36.804 +07:00 [WRN] Message 208 not found in Redis
2025-06-01 19:52:36.805 +07:00 [WRN] Message 207 not found in Redis
2025-06-01 19:52:36.805 +07:00 [WRN] Message 206 not found in Redis
2025-06-01 19:52:36.806 +07:00 [WRN] Message 205 not found in Redis
2025-06-01 19:52:36.806 +07:00 [WRN] Message 204 not found in Redis
2025-06-01 19:52:36.806 +07:00 [WRN] Message 203 not found in Redis
2025-06-01 19:52:36.806 +07:00 [WRN] Message 202 not found in Redis
2025-06-01 19:52:36.806 +07:00 [WRN] Message 201 not found in Redis
2025-06-01 19:52:36.807 +07:00 [WRN] Message 196 not found in Redis
2025-06-01 19:52:36.807 +07:00 [WRN] Message 194 not found in Redis
2025-06-01 19:52:36.807 +07:00 [WRN] Message 193 not found in Redis
2025-06-01 19:52:36.808 +07:00 [WRN] Message 192 not found in Redis
2025-06-01 19:52:36.808 +07:00 [WRN] Message 190 not found in Redis
2025-06-01 19:52:36.808 +07:00 [WRN] Message 189 not found in Redis
2025-06-01 19:52:36.809 +07:00 [WRN] Message 183 not found in Redis
2025-06-01 19:52:36.809 +07:00 [WRN] Message 182 not found in Redis
2025-06-01 19:52:36.810 +07:00 [WRN] Message 181 not found in Redis
2025-06-01 19:52:36.810 +07:00 [INF] Retrieved 43 messages from Redis for conversation 19
2025-06-01 19:52:36.810 +07:00 [INF] Retrieved 43 messages from Redis for conversation 19 and user 3
2025-06-01 19:52:36.810 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 19:52:36.811 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 60.3785ms
2025-06-01 19:52:36.811 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:52:36.811 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 61.174ms
2025-06-01 19:52:36.825 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 19:52:36.825 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:36.825 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.4187ms
2025-06-01 19:52:36.827 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 19:52:36.827 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:36.827 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:36.827 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:52:36.827 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 19:52:36.835 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 19:52:36.836 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 19:52:36.836 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.9185ms
2025-06-01 19:52:36.836 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:52:36.837 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 9.6917ms
2025-06-01 19:52:36.843 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-01 19:52:36.843 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:36.843 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.3426ms
2025-06-01 19:52:36.847 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-01 19:52:36.847 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:36.847 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:52:36.848 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:52:36.848 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 19:52:36.855 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 19:52:36.856 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 19:52:36.856 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.6569ms
2025-06-01 19:52:36.856 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:52:36.857 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 9.4918ms
2025-06-01 19:54:30.240 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-01 19:54:30.240 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:30.242 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 1.4022ms
2025-06-01 19:54:30.245 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-01 19:54:30.245 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:30.246 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:30.246 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 19:54:30.247 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-01 19:54:30.273 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-01 19:54:30.274 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-01 19:54:30.274 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 27.3761ms
2025-06-01 19:54:30.274 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 19:54:30.275 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 29.3964ms
2025-06-01 19:54:30.297 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 19:54:30.298 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:30.298 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:30.298 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 19:54:30.394 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-01 19:54:30.395 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:30.395 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:30.395 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 19:54:30.395 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-01 19:54:30.404 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-01 19:54:30.404 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 19:54:30.405 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.6765ms
2025-06-01 19:54:30.405 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 19:54:30.405 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 10.5353ms
2025-06-01 19:54:30.486 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 19:54:30.487 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-01 19:54:30.487 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-01 19:54:30.487 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-01 19:54:30.487 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-01 19:54:30.487 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-01 19:54:30.487 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-01 19:54:30.488 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-01 19:54:30.488 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-01 19:54:30.488 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-01 19:54:30.488 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-01 19:54:30.488 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-01 19:54:30.489 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-01 19:54:30.489 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-01 19:54:30.489 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-01 19:54:30.489 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-01 19:54:30.489 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-01 19:54:30.489 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-01 19:54:30.489 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-01 19:54:30.489 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-01 19:54:30.489 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-01 19:54:30.489 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-01 19:54:30.489 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-01 19:54:30.489 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-01 19:54:30.489 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-01 19:54:30.554 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 19:54:30.555 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:30.555 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.304ms
2025-06-01 19:54:30.556 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 19:54:30.558 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:30.558 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:30.558 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 19:54:30.558 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 19:54:30.575 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-01 19:54:30.591 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 19:54:30.593 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 34.6551ms
2025-06-01 19:54:30.593 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 19:54:30.593 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 36.6835ms
2025-06-01 19:54:32.949 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-06-01 19:54:32.949 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:32.949 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.3381ms
2025-06-01 19:54:32.951 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-06-01 19:54:32.952 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:32.953 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:32.953 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:54:32.953 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 19:54:32.968 +07:00 [WRN] Message 245 not found in Redis
2025-06-01 19:54:32.970 +07:00 [WRN] Message 244 not found in Redis
2025-06-01 19:54:32.971 +07:00 [WRN] Message 243 not found in Redis
2025-06-01 19:54:32.971 +07:00 [WRN] Message 242 not found in Redis
2025-06-01 19:54:32.972 +07:00 [WRN] Message 241 not found in Redis
2025-06-01 19:54:32.972 +07:00 [WRN] Message 240 not found in Redis
2025-06-01 19:54:32.972 +07:00 [WRN] Message 239 not found in Redis
2025-06-01 19:54:32.972 +07:00 [WRN] Message 238 not found in Redis
2025-06-01 19:54:32.973 +07:00 [WRN] Message 237 not found in Redis
2025-06-01 19:54:32.973 +07:00 [WRN] Message 231 not found in Redis
2025-06-01 19:54:32.973 +07:00 [WRN] Message 230 not found in Redis
2025-06-01 19:54:32.973 +07:00 [WRN] Message 229 not found in Redis
2025-06-01 19:54:32.974 +07:00 [WRN] Message 228 not found in Redis
2025-06-01 19:54:32.975 +07:00 [WRN] Message 227 not found in Redis
2025-06-01 19:54:32.975 +07:00 [WRN] Message 226 not found in Redis
2025-06-01 19:54:32.976 +07:00 [WRN] Message 225 not found in Redis
2025-06-01 19:54:32.976 +07:00 [WRN] Message 224 not found in Redis
2025-06-01 19:54:32.976 +07:00 [WRN] Message 223 not found in Redis
2025-06-01 19:54:32.976 +07:00 [WRN] Message 222 not found in Redis
2025-06-01 19:54:32.977 +07:00 [WRN] Message 221 not found in Redis
2025-06-01 19:54:32.977 +07:00 [WRN] Message 220 not found in Redis
2025-06-01 19:54:32.977 +07:00 [WRN] Message 219 not found in Redis
2025-06-01 19:54:32.978 +07:00 [WRN] Message 218 not found in Redis
2025-06-01 19:54:32.978 +07:00 [WRN] Message 217 not found in Redis
2025-06-01 19:54:32.979 +07:00 [WRN] Message 216 not found in Redis
2025-06-01 19:54:32.980 +07:00 [WRN] Message 215 not found in Redis
2025-06-01 19:54:32.980 +07:00 [WRN] Message 214 not found in Redis
2025-06-01 19:54:32.981 +07:00 [WRN] Message 213 not found in Redis
2025-06-01 19:54:32.981 +07:00 [WRN] Message 212 not found in Redis
2025-06-01 19:54:32.981 +07:00 [WRN] Message 211 not found in Redis
2025-06-01 19:54:32.981 +07:00 [WRN] Message 210 not found in Redis
2025-06-01 19:54:32.982 +07:00 [WRN] Message 209 not found in Redis
2025-06-01 19:54:32.982 +07:00 [WRN] Message 208 not found in Redis
2025-06-01 19:54:32.983 +07:00 [WRN] Message 207 not found in Redis
2025-06-01 19:54:32.983 +07:00 [WRN] Message 206 not found in Redis
2025-06-01 19:54:32.985 +07:00 [WRN] Message 205 not found in Redis
2025-06-01 19:54:32.988 +07:00 [WRN] Message 204 not found in Redis
2025-06-01 19:54:32.989 +07:00 [WRN] Message 203 not found in Redis
2025-06-01 19:54:32.990 +07:00 [WRN] Message 202 not found in Redis
2025-06-01 19:54:32.992 +07:00 [WRN] Message 201 not found in Redis
2025-06-01 19:54:32.993 +07:00 [WRN] Message 196 not found in Redis
2025-06-01 19:54:32.993 +07:00 [WRN] Message 194 not found in Redis
2025-06-01 19:54:32.993 +07:00 [WRN] Message 193 not found in Redis
2025-06-01 19:54:32.994 +07:00 [WRN] Message 192 not found in Redis
2025-06-01 19:54:32.994 +07:00 [WRN] Message 190 not found in Redis
2025-06-01 19:54:32.994 +07:00 [WRN] Message 189 not found in Redis
2025-06-01 19:54:32.995 +07:00 [WRN] Message 183 not found in Redis
2025-06-01 19:54:32.996 +07:00 [WRN] Message 182 not found in Redis
2025-06-01 19:54:32.996 +07:00 [WRN] Message 181 not found in Redis
2025-06-01 19:54:32.997 +07:00 [INF] Retrieved 43 messages from Redis for conversation 19
2025-06-01 19:54:32.997 +07:00 [INF] Retrieved 43 messages from Redis for conversation 19 and user 3
2025-06-01 19:54:32.997 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 19:54:32.997 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 44.1882ms
2025-06-01 19:54:32.997 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:54:32.998 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 46.5691ms
2025-06-01 19:54:33.010 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 19:54:33.011 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:33.011 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.3676ms
2025-06-01 19:54:33.012 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 19:54:33.013 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:33.013 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:33.013 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:54:33.013 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 19:54:33.024 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 19:54:33.025 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 19:54:33.025 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 12.0091ms
2025-06-01 19:54:33.025 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:54:33.026 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 13.4166ms
2025-06-01 19:54:33.033 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-01 19:54:33.034 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:33.034 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.2793ms
2025-06-01 19:54:33.035 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-01 19:54:33.035 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:33.035 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:54:33.036 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:54:33.036 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 19:54:33.044 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 19:54:33.044 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 19:54:33.044 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.4172ms
2025-06-01 19:54:33.044 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:54:33.044 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 9.3765ms
2025-06-01 19:54:42.146 +07:00 [INF] Handling message from user 3: helo
2025-06-01 19:54:42.166 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-01 19:54:42.195 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 19:54:42.218 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-01 19:54:42.221 +07:00 [INF] Message saved to DB with ID: 440
2025-06-01 19:54:42.221 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 19:54:42.230 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-01 19:54:42.231 +07:00 [INF] Transaction committed for message: 440
2025-06-01 19:54:42.241 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 19:54:42.271 +07:00 [INF] Saved message 440 to Redis
2025-06-01 19:54:42.272 +07:00 [INF] Added message 440 to conversation 19
2025-06-01 19:54:42.273 +07:00 [INF] Published message to channel conversation:19
2025-06-01 19:55:27.764 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Message/getMessages/53/2 - null null
2025-06-01 19:55:27.772 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:55:27.773 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 19:55:27.852 +07:00 [INF] Retrieved 15 messages from Redis for conversation 53
2025-06-01 19:55:27.855 +07:00 [INF] Retrieved 15 messages from Redis for conversation 53 and user 2
2025-06-01 19:55:27.857 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 19:55:27.868 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 89.5018ms
2025-06-01 19:55:27.868 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:55:27.868 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 103.9849ms
2025-06-01 19:55:28.016 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-01 19:55:28.018 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:55:28.018 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 19:55:28.060 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 19:55:28.075 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 19:55:28.076 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 57.6209ms
2025-06-01 19:55:28.076 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:55:28.076 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 60.1226ms
2025-06-01 19:55:28.326 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Participant/get_participants/53 - null null
2025-06-01 19:55:28.326 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:55:28.326 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 19:55:28.385 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 19:55:28.391 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 19:55:28.392 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 65.7127ms
2025-06-01 19:55:28.392 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:55:28.392 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 66.5765ms
2025-06-01 19:55:30.683 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-06-01 19:55:30.683 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:30.684 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.5948ms
2025-06-01 19:55:30.686 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-06-01 19:55:30.697 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:30.697 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:30.698 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:55:30.698 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 19:55:30.746 +07:00 [INF] Retrieved 15 messages from Redis for conversation 53
2025-06-01 19:55:30.746 +07:00 [INF] Retrieved 15 messages from Redis for conversation 53 and user 3
2025-06-01 19:55:30.746 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 19:55:30.747 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 49.23ms
2025-06-01 19:55:30.748 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:55:30.748 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 61.5265ms
2025-06-01 19:55:30.768 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-01 19:55:30.768 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:30.769 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.3773ms
2025-06-01 19:55:30.771 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-01 19:55:30.772 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:30.772 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:30.772 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:55:30.772 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 19:55:30.787 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 19:55:30.798 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 19:55:30.799 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 26.5495ms
2025-06-01 19:55:30.799 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:55:30.799 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 27.3612ms
2025-06-01 19:55:30.810 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-01 19:55:30.810 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:30.810 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.3334ms
2025-06-01 19:55:30.817 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-01 19:55:30.818 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:30.818 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:30.821 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:55:30.821 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 19:55:30.830 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 19:55:30.840 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 19:55:30.846 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 24.867ms
2025-06-01 19:55:30.846 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:55:30.846 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 32.2371ms
2025-06-01 19:55:45.240 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-06-01 19:55:45.241 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:45.241 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.5253ms
2025-06-01 19:55:45.245 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-06-01 19:55:45.245 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:45.246 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:45.246 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:55:45.252 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 19:55:45.277 +07:00 [INF] Retrieved 15 messages from Redis for conversation 53
2025-06-01 19:55:45.278 +07:00 [INF] Retrieved 15 messages from Redis for conversation 53 and user 3
2025-06-01 19:55:45.278 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 19:55:45.279 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 27.0508ms
2025-06-01 19:55:45.283 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 19:55:45.283 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 38.2879ms
2025-06-01 19:55:45.296 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-01 19:55:45.297 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:45.297 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.3766ms
2025-06-01 19:55:45.308 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-01 19:55:45.308 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:45.309 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:45.309 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:55:45.309 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 19:55:45.336 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 19:55:45.349 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 19:55:45.350 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 41.0214ms
2025-06-01 19:55:45.350 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 19:55:45.351 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 42.5478ms
2025-06-01 19:55:45.364 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-01 19:55:45.364 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:45.364 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2842ms
2025-06-01 19:55:45.366 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-01 19:55:45.366 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:45.367 +07:00 [INF] CORS policy execution successful.
2025-06-01 19:55:45.367 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:55:45.367 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 19:55:45.377 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 19:55:45.382 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 19:55:45.383 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 15.7435ms
2025-06-01 19:55:45.383 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 19:55:45.383 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 16.8602ms
2025-06-01 20:00:03.826 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 20:00:03.831 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 20:00:03.831 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 20:00:03.829 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 20:00:03.852 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-01 20:00:03.852 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-01 20:00:03.855 +07:00 [ERR] Connection id "0HND119CLOHAL", Request id "0HND119CLOHAL:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-01 20:00:03.855 +07:00 [ERR] Connection id "0HND119CLOHAM", Request id "0HND119CLOHAM:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-01 20:00:03.858 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 449912.5984ms
2025-06-01 20:00:03.859 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 333561.1795ms
2025-06-01 20:00:58.303 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-01 20:00:58.304 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:00:58.305 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 1.655ms
2025-06-01 20:00:58.306 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-01 20:00:58.307 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:00:58.308 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:00:58.308 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 20:00:58.311 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-01 20:00:58.585 +07:00 [INF] Executed DbCommand (41ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-01 20:00:58.598 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-01 20:00:58.600 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 288.8338ms
2025-06-01 20:00:58.600 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 20:00:58.601 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 294.4169ms
2025-06-01 20:00:58.637 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 20:00:58.640 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:00:58.640 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:00:58.640 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 20:00:58.760 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-01 20:00:58.760 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:00:58.761 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:00:58.761 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 20:00:58.761 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-01 20:00:58.793 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-01 20:00:58.793 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 20:00:58.793 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 32.3215ms
2025-06-01 20:00:58.793 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 20:00:58.793 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 33.5536ms
2025-06-01 20:00:58.894 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 20:00:58.896 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-01 20:00:58.896 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-01 20:00:58.897 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-01 20:00:58.980 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 20:00:58.980 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:00:58.980 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3419ms
2025-06-01 20:00:58.984 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 20:00:58.984 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:00:58.985 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:00:58.985 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 20:00:58.985 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 20:00:59.023 +07:00 [INF] Executed DbCommand (36ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-01 20:00:59.041 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 20:00:59.043 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 58.193ms
2025-06-01 20:00:59.043 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 20:00:59.044 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 59.165ms
2025-06-01 20:01:06.493 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-06-01 20:01:06.493 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:01:06.493 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.1729ms
2025-06-01 20:01:06.495 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-06-01 20:01:06.495 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:01:06.495 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:01:06.496 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 20:01:06.496 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 20:01:06.506 +07:00 [WRN] Message 245 not found in Redis
2025-06-01 20:01:06.506 +07:00 [WRN] Message 244 not found in Redis
2025-06-01 20:01:06.506 +07:00 [WRN] Message 243 not found in Redis
2025-06-01 20:01:06.507 +07:00 [WRN] Message 242 not found in Redis
2025-06-01 20:01:06.507 +07:00 [WRN] Message 241 not found in Redis
2025-06-01 20:01:06.507 +07:00 [WRN] Message 240 not found in Redis
2025-06-01 20:01:06.507 +07:00 [WRN] Message 239 not found in Redis
2025-06-01 20:01:06.507 +07:00 [WRN] Message 238 not found in Redis
2025-06-01 20:01:06.508 +07:00 [WRN] Message 237 not found in Redis
2025-06-01 20:01:06.508 +07:00 [WRN] Message 231 not found in Redis
2025-06-01 20:01:06.509 +07:00 [WRN] Message 230 not found in Redis
2025-06-01 20:01:06.509 +07:00 [WRN] Message 229 not found in Redis
2025-06-01 20:01:06.510 +07:00 [WRN] Message 228 not found in Redis
2025-06-01 20:01:06.510 +07:00 [WRN] Message 227 not found in Redis
2025-06-01 20:01:06.510 +07:00 [WRN] Message 226 not found in Redis
2025-06-01 20:01:06.511 +07:00 [WRN] Message 225 not found in Redis
2025-06-01 20:01:06.512 +07:00 [WRN] Message 224 not found in Redis
2025-06-01 20:01:06.513 +07:00 [WRN] Message 223 not found in Redis
2025-06-01 20:01:06.514 +07:00 [WRN] Message 222 not found in Redis
2025-06-01 20:01:06.514 +07:00 [WRN] Message 221 not found in Redis
2025-06-01 20:01:06.515 +07:00 [WRN] Message 220 not found in Redis
2025-06-01 20:01:06.515 +07:00 [WRN] Message 219 not found in Redis
2025-06-01 20:01:06.516 +07:00 [WRN] Message 218 not found in Redis
2025-06-01 20:01:06.516 +07:00 [WRN] Message 217 not found in Redis
2025-06-01 20:01:06.516 +07:00 [WRN] Message 216 not found in Redis
2025-06-01 20:01:06.516 +07:00 [WRN] Message 215 not found in Redis
2025-06-01 20:01:06.517 +07:00 [WRN] Message 214 not found in Redis
2025-06-01 20:01:06.517 +07:00 [WRN] Message 213 not found in Redis
2025-06-01 20:01:06.517 +07:00 [WRN] Message 212 not found in Redis
2025-06-01 20:01:06.517 +07:00 [WRN] Message 211 not found in Redis
2025-06-01 20:01:06.518 +07:00 [WRN] Message 210 not found in Redis
2025-06-01 20:01:06.518 +07:00 [WRN] Message 209 not found in Redis
2025-06-01 20:01:06.518 +07:00 [WRN] Message 208 not found in Redis
2025-06-01 20:01:06.518 +07:00 [WRN] Message 207 not found in Redis
2025-06-01 20:01:06.518 +07:00 [WRN] Message 206 not found in Redis
2025-06-01 20:01:06.518 +07:00 [WRN] Message 205 not found in Redis
2025-06-01 20:01:06.518 +07:00 [WRN] Message 204 not found in Redis
2025-06-01 20:01:06.519 +07:00 [WRN] Message 203 not found in Redis
2025-06-01 20:01:06.519 +07:00 [WRN] Message 202 not found in Redis
2025-06-01 20:01:06.519 +07:00 [WRN] Message 201 not found in Redis
2025-06-01 20:01:06.520 +07:00 [WRN] Message 196 not found in Redis
2025-06-01 20:01:06.520 +07:00 [WRN] Message 194 not found in Redis
2025-06-01 20:01:06.520 +07:00 [WRN] Message 193 not found in Redis
2025-06-01 20:01:06.521 +07:00 [WRN] Message 192 not found in Redis
2025-06-01 20:01:06.521 +07:00 [WRN] Message 190 not found in Redis
2025-06-01 20:01:06.521 +07:00 [WRN] Message 189 not found in Redis
2025-06-01 20:01:06.521 +07:00 [WRN] Message 183 not found in Redis
2025-06-01 20:01:06.521 +07:00 [WRN] Message 182 not found in Redis
2025-06-01 20:01:06.521 +07:00 [WRN] Message 181 not found in Redis
2025-06-01 20:01:06.522 +07:00 [INF] Retrieved 44 messages from Redis for conversation 19
2025-06-01 20:01:06.522 +07:00 [INF] Retrieved 44 messages from Redis for conversation 19 and user 3
2025-06-01 20:01:06.523 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 20:01:06.524 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 28.2381ms
2025-06-01 20:01:06.524 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 20:01:06.524 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 29.6701ms
2025-06-01 20:01:06.542 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 20:01:06.542 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:01:06.542 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.2081ms
2025-06-01 20:01:06.543 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 20:01:06.543 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:01:06.543 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:01:06.543 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 20:01:06.543 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 20:01:06.552 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 20:01:06.553 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 20:01:06.554 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.5248ms
2025-06-01 20:01:06.554 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 20:01:06.554 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 11.0486ms
2025-06-01 20:01:06.561 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-01 20:01:06.561 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:01:06.561 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.1581ms
2025-06-01 20:01:06.563 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-01 20:01:06.563 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:01:06.563 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:01:06.563 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 20:01:06.564 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 20:01:06.569 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 20:01:06.570 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 20:01:06.571 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.2099ms
2025-06-01 20:01:06.571 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 20:01:06.571 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 7.8524ms
2025-06-01 20:01:10.538 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Message/getMessages/19/2 - null null
2025-06-01 20:01:10.538 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 20:01:10.538 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 20:01:10.559 +07:00 [WRN] Message 245 not found in Redis
2025-06-01 20:01:10.560 +07:00 [WRN] Message 244 not found in Redis
2025-06-01 20:01:10.562 +07:00 [WRN] Message 243 not found in Redis
2025-06-01 20:01:10.563 +07:00 [WRN] Message 242 not found in Redis
2025-06-01 20:01:10.563 +07:00 [WRN] Message 241 not found in Redis
2025-06-01 20:01:10.564 +07:00 [WRN] Message 240 not found in Redis
2025-06-01 20:01:10.564 +07:00 [WRN] Message 239 not found in Redis
2025-06-01 20:01:10.565 +07:00 [WRN] Message 238 not found in Redis
2025-06-01 20:01:10.565 +07:00 [WRN] Message 237 not found in Redis
2025-06-01 20:01:10.566 +07:00 [WRN] Message 231 not found in Redis
2025-06-01 20:01:10.566 +07:00 [WRN] Message 230 not found in Redis
2025-06-01 20:01:10.567 +07:00 [WRN] Message 229 not found in Redis
2025-06-01 20:01:10.567 +07:00 [WRN] Message 228 not found in Redis
2025-06-01 20:01:10.568 +07:00 [WRN] Message 227 not found in Redis
2025-06-01 20:01:10.568 +07:00 [WRN] Message 226 not found in Redis
2025-06-01 20:01:10.569 +07:00 [WRN] Message 225 not found in Redis
2025-06-01 20:01:10.569 +07:00 [WRN] Message 224 not found in Redis
2025-06-01 20:01:10.570 +07:00 [WRN] Message 223 not found in Redis
2025-06-01 20:01:10.570 +07:00 [WRN] Message 222 not found in Redis
2025-06-01 20:01:10.570 +07:00 [WRN] Message 221 not found in Redis
2025-06-01 20:01:10.571 +07:00 [WRN] Message 220 not found in Redis
2025-06-01 20:01:10.571 +07:00 [WRN] Message 219 not found in Redis
2025-06-01 20:01:10.572 +07:00 [WRN] Message 218 not found in Redis
2025-06-01 20:01:10.572 +07:00 [WRN] Message 217 not found in Redis
2025-06-01 20:01:10.572 +07:00 [WRN] Message 216 not found in Redis
2025-06-01 20:01:10.572 +07:00 [WRN] Message 215 not found in Redis
2025-06-01 20:01:10.573 +07:00 [WRN] Message 214 not found in Redis
2025-06-01 20:01:10.573 +07:00 [WRN] Message 213 not found in Redis
2025-06-01 20:01:10.573 +07:00 [WRN] Message 212 not found in Redis
2025-06-01 20:01:10.574 +07:00 [WRN] Message 211 not found in Redis
2025-06-01 20:01:10.574 +07:00 [WRN] Message 210 not found in Redis
2025-06-01 20:01:10.574 +07:00 [WRN] Message 209 not found in Redis
2025-06-01 20:01:10.574 +07:00 [WRN] Message 208 not found in Redis
2025-06-01 20:01:10.575 +07:00 [WRN] Message 207 not found in Redis
2025-06-01 20:01:10.575 +07:00 [WRN] Message 206 not found in Redis
2025-06-01 20:01:10.575 +07:00 [WRN] Message 205 not found in Redis
2025-06-01 20:01:10.575 +07:00 [WRN] Message 204 not found in Redis
2025-06-01 20:01:10.575 +07:00 [WRN] Message 203 not found in Redis
2025-06-01 20:01:10.576 +07:00 [WRN] Message 202 not found in Redis
2025-06-01 20:01:10.576 +07:00 [WRN] Message 201 not found in Redis
2025-06-01 20:01:10.576 +07:00 [WRN] Message 196 not found in Redis
2025-06-01 20:01:10.576 +07:00 [WRN] Message 194 not found in Redis
2025-06-01 20:01:10.577 +07:00 [WRN] Message 193 not found in Redis
2025-06-01 20:01:10.577 +07:00 [WRN] Message 192 not found in Redis
2025-06-01 20:01:10.577 +07:00 [WRN] Message 190 not found in Redis
2025-06-01 20:01:10.577 +07:00 [WRN] Message 189 not found in Redis
2025-06-01 20:01:10.577 +07:00 [WRN] Message 183 not found in Redis
2025-06-01 20:01:10.578 +07:00 [WRN] Message 182 not found in Redis
2025-06-01 20:01:10.578 +07:00 [WRN] Message 181 not found in Redis
2025-06-01 20:01:10.578 +07:00 [INF] Retrieved 44 messages from Redis for conversation 19
2025-06-01 20:01:10.578 +07:00 [INF] Retrieved 44 messages from Redis for conversation 19 and user 2
2025-06-01 20:01:10.578 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 20:01:10.579 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 40.765ms
2025-06-01 20:01:10.579 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 20:01:10.579 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Message/getMessages/19/2 - 200 null application/json; charset=utf-8 41.1594ms
2025-06-01 20:01:10.757 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 20:01:10.757 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 20:01:10.757 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 20:01:10.764 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 20:01:10.765 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 20:01:10.765 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.4504ms
2025-06-01 20:01:10.765 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 20:01:10.765 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 7.7871ms
2025-06-01 20:01:10.792 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Participant/get_participants/19 - null null
2025-06-01 20:01:10.792 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 20:01:10.793 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 20:01:10.797 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 20:01:10.798 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 20:01:10.799 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.4628ms
2025-06-01 20:01:10.800 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 20:01:10.800 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 7.6021ms
2025-06-01 20:02:51.914 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-01 20:02:51.914 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:51.914 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2031ms
2025-06-01 20:02:51.915 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-06-01 20:02:51.915 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:51.915 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:51.915 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 20:02:51.915 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-01 20:02:51.930 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-01 20:02:51.931 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-01 20:02:51.931 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 15.2418ms
2025-06-01 20:02:51.931 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 20:02:51.931 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 16.0593ms
2025-06-01 20:02:51.948 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-06-01 20:02:51.948 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:51.948 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:51.948 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 20:02:52.051 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-06-01 20:02:52.051 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:52.051 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:52.051 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 20:02:52.052 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-01 20:02:52.059 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-01 20:02:52.060 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 20:02:52.060 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 8.394ms
2025-06-01 20:02:52.060 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 20:02:52.060 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 8.853ms
2025-06-01 20:02:52.071 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-01 20:02:52.071 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-01 20:02:52.194 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 20:02:52.194 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:52.195 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1848ms
2025-06-01 20:02:52.196 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 20:02:52.196 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:52.196 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:52.196 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 20:02:52.196 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 20:02:52.215 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-01 20:02:52.228 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 20:02:52.230 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 33.6222ms
2025-06-01 20:02:52.230 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 20:02:52.230 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 34.2331ms
2025-06-01 20:02:53.913 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-06-01 20:02:53.913 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:53.913 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.2523ms
2025-06-01 20:02:53.914 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-06-01 20:02:53.914 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:53.914 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:53.914 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 20:02:53.914 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 20:02:53.924 +07:00 [WRN] Message 245 not found in Redis
2025-06-01 20:02:53.924 +07:00 [WRN] Message 244 not found in Redis
2025-06-01 20:02:53.924 +07:00 [WRN] Message 243 not found in Redis
2025-06-01 20:02:53.924 +07:00 [WRN] Message 242 not found in Redis
2025-06-01 20:02:53.925 +07:00 [WRN] Message 241 not found in Redis
2025-06-01 20:02:53.925 +07:00 [WRN] Message 240 not found in Redis
2025-06-01 20:02:53.925 +07:00 [WRN] Message 239 not found in Redis
2025-06-01 20:02:53.925 +07:00 [WRN] Message 238 not found in Redis
2025-06-01 20:02:53.925 +07:00 [WRN] Message 237 not found in Redis
2025-06-01 20:02:53.926 +07:00 [WRN] Message 231 not found in Redis
2025-06-01 20:02:53.926 +07:00 [WRN] Message 230 not found in Redis
2025-06-01 20:02:53.926 +07:00 [WRN] Message 229 not found in Redis
2025-06-01 20:02:53.926 +07:00 [WRN] Message 228 not found in Redis
2025-06-01 20:02:53.926 +07:00 [WRN] Message 227 not found in Redis
2025-06-01 20:02:53.926 +07:00 [WRN] Message 226 not found in Redis
2025-06-01 20:02:53.927 +07:00 [WRN] Message 225 not found in Redis
2025-06-01 20:02:53.927 +07:00 [WRN] Message 224 not found in Redis
2025-06-01 20:02:53.927 +07:00 [WRN] Message 223 not found in Redis
2025-06-01 20:02:53.927 +07:00 [WRN] Message 222 not found in Redis
2025-06-01 20:02:53.927 +07:00 [WRN] Message 221 not found in Redis
2025-06-01 20:02:53.927 +07:00 [WRN] Message 220 not found in Redis
2025-06-01 20:02:53.928 +07:00 [WRN] Message 219 not found in Redis
2025-06-01 20:02:53.928 +07:00 [WRN] Message 218 not found in Redis
2025-06-01 20:02:53.928 +07:00 [WRN] Message 217 not found in Redis
2025-06-01 20:02:53.928 +07:00 [WRN] Message 216 not found in Redis
2025-06-01 20:02:53.928 +07:00 [WRN] Message 215 not found in Redis
2025-06-01 20:02:53.929 +07:00 [WRN] Message 214 not found in Redis
2025-06-01 20:02:53.929 +07:00 [WRN] Message 213 not found in Redis
2025-06-01 20:02:53.929 +07:00 [WRN] Message 212 not found in Redis
2025-06-01 20:02:53.929 +07:00 [WRN] Message 211 not found in Redis
2025-06-01 20:02:53.930 +07:00 [WRN] Message 210 not found in Redis
2025-06-01 20:02:53.930 +07:00 [WRN] Message 209 not found in Redis
2025-06-01 20:02:53.930 +07:00 [WRN] Message 208 not found in Redis
2025-06-01 20:02:53.930 +07:00 [WRN] Message 207 not found in Redis
2025-06-01 20:02:53.930 +07:00 [WRN] Message 206 not found in Redis
2025-06-01 20:02:53.930 +07:00 [WRN] Message 205 not found in Redis
2025-06-01 20:02:53.930 +07:00 [WRN] Message 204 not found in Redis
2025-06-01 20:02:53.931 +07:00 [WRN] Message 203 not found in Redis
2025-06-01 20:02:53.931 +07:00 [WRN] Message 202 not found in Redis
2025-06-01 20:02:53.931 +07:00 [WRN] Message 201 not found in Redis
2025-06-01 20:02:53.932 +07:00 [WRN] Message 196 not found in Redis
2025-06-01 20:02:53.932 +07:00 [WRN] Message 194 not found in Redis
2025-06-01 20:02:53.932 +07:00 [WRN] Message 193 not found in Redis
2025-06-01 20:02:53.932 +07:00 [WRN] Message 192 not found in Redis
2025-06-01 20:02:53.933 +07:00 [WRN] Message 190 not found in Redis
2025-06-01 20:02:53.933 +07:00 [WRN] Message 189 not found in Redis
2025-06-01 20:02:53.933 +07:00 [WRN] Message 183 not found in Redis
2025-06-01 20:02:53.933 +07:00 [WRN] Message 182 not found in Redis
2025-06-01 20:02:53.934 +07:00 [WRN] Message 181 not found in Redis
2025-06-01 20:02:53.934 +07:00 [INF] Retrieved 44 messages from Redis for conversation 19
2025-06-01 20:02:53.934 +07:00 [INF] Retrieved 44 messages from Redis for conversation 19 and user 3
2025-06-01 20:02:53.934 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 20:02:53.934 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 19.8862ms
2025-06-01 20:02:53.934 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 20:02:53.934 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 20.2384ms
2025-06-01 20:02:53.946 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 20:02:53.946 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:53.946 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.1788ms
2025-06-01 20:02:53.947 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 20:02:53.947 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:53.947 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:53.947 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 20:02:53.947 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 20:02:53.953 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 20:02:53.953 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 20:02:53.954 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.1187ms
2025-06-01 20:02:53.954 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 20:02:53.954 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 6.433ms
2025-06-01 20:02:53.960 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-01 20:02:53.960 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:53.961 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.3058ms
2025-06-01 20:02:53.962 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-01 20:02:53.962 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:53.962 +07:00 [INF] CORS policy execution successful.
2025-06-01 20:02:53.962 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 20:02:53.962 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 20:02:53.966 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 20:02:53.966 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 20:02:53.966 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.9819ms
2025-06-01 20:02:53.966 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 20:02:53.966 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 4.6454ms
2025-06-01 20:07:19.744 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 20:07:19.744 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 20:07:19.753 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 20:07:19.753 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 20:07:19.798 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-01 20:07:19.798 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-01 20:07:19.802 +07:00 [ERR] Connection id "0HND119CLOHAT", Request id "0HND119CLOHAT:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-01 20:07:19.802 +07:00 [ERR] Connection id "0HND119CLOHB3", Request id "0HND119CLOHB3:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-01 20:07:19.823 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 381181.6581ms
2025-06-01 20:07:19.823 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 267871.5014ms
2025-06-01 20:08:26.027 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 20:08:26.044 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 20:08:26.156 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-01 20:08:26.163 +07:00 [ERR] Connection id "0HND119CLOHAE", Request id "0HND119CLOHAE:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-01 20:08:26.183 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 101 null null 1163337.6194ms
2025-06-01 20:08:53.939 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.4:5053/api/Auth/login - application/json 60
2025-06-01 20:08:53.957 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 20:08:53.962 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-01 20:08:54.399 +07:00 [INF] Executed DbCommand (101ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-01 20:08:54.410 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-01 20:08:54.411 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 449.6702ms
2025-06-01 20:08:54.412 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 20:08:54.412 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.4:5053/api/Auth/login - 200 null application/json; charset=utf-8 473.163ms
2025-06-01 20:08:54.885 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=3 - null null
2025-06-01 20:08:54.886 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 20:08:55.169 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/friends/GetAllFriends/3 - null null
2025-06-01 20:08:55.169 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 20:08:55.169 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-01 20:08:55.217 +07:00 [INF] Executed DbCommand (39ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 20:08:55.223 +07:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-01 20:08:55.223 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 20:08:55.223 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-06-01 20:08:55.224 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-06-01 20:08:55.224 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-06-01 20:08:55.224 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-06-01 20:08:55.224 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-06-01 20:08:55.224 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-06-01 20:08:55.224 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-06-01 20:08:55.224 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-06-01 20:08:55.224 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-06-01 20:08:55.225 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 55.0779ms
2025-06-01 20:08:55.225 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 20:08:55.225 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 56.0052ms
2025-06-01 20:08:55.225 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-06-01 20:08:55.225 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-06-01 20:08:55.225 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-06-01 20:08:55.225 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-06-01 20:08:55.225 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-06-01 20:08:55.225 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-06-01 20:08:55.226 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-06-01 20:08:55.226 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-06-01 20:08:55.226 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-06-01 20:08:55.226 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-06-01 20:08:55.226 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-06-01 20:08:55.226 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-06-01 20:08:55.226 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-06-01 20:08:55.226 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-06-01 20:08:55.226 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-06-01 20:08:55.446 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_conversations/3 - null null
2025-06-01 20:08:55.455 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 20:08:55.455 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 20:08:55.513 +07:00 [INF] Executed DbCommand (49ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-01 20:08:55.534 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 20:08:55.538 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 83.2255ms
2025-06-01 20:08:55.539 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 20:08:55.539 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 92.7119ms
2025-06-01 20:09:08.190 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.4:5053/api/Auth/login - application/json 58
2025-06-01 20:09:08.191 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 20:09:08.191 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-01 20:09:08.231 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-01 20:09:08.232 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-01 20:09:08.232 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 40.9992ms
2025-06-01 20:09:08.232 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-01 20:09:08.232 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.4:5053/api/Auth/login - 200 null application/json; charset=utf-8 41.3674ms
2025-06-01 20:09:09.420 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - null null
2025-06-01 20:09:09.421 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 20:09:09.421 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/friends/GetAllFriends/2 - null null
2025-06-01 20:09:09.421 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 20:09:09.421 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-01 20:09:09.430 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-01 20:09:09.432 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 20:09:09.433 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 12.3756ms
2025-06-01 20:09:09.433 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-01 20:09:09.433 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 12.8355ms
2025-06-01 20:09:09.636 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-01 20:09:09.637 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-01 20:09:09.664 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_conversations/2 - null null
2025-06-01 20:09:09.664 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 20:09:09.664 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 20:09:09.678 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-01 20:09:09.695 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 20:09:09.727 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 63.337ms
2025-06-01 20:09:09.727 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-01 20:09:09.727 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 63.7967ms
2025-06-01 20:09:12.161 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Message/getMessages/19/2 - null null
2025-06-01 20:09:12.165 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 20:09:12.165 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 20:09:12.189 +07:00 [WRN] Message 245 not found in Redis
2025-06-01 20:09:12.189 +07:00 [WRN] Message 244 not found in Redis
2025-06-01 20:09:12.189 +07:00 [WRN] Message 243 not found in Redis
2025-06-01 20:09:12.190 +07:00 [WRN] Message 242 not found in Redis
2025-06-01 20:09:12.191 +07:00 [WRN] Message 241 not found in Redis
2025-06-01 20:09:12.191 +07:00 [WRN] Message 240 not found in Redis
2025-06-01 20:09:12.192 +07:00 [WRN] Message 239 not found in Redis
2025-06-01 20:09:12.192 +07:00 [WRN] Message 238 not found in Redis
2025-06-01 20:09:12.192 +07:00 [WRN] Message 237 not found in Redis
2025-06-01 20:09:12.193 +07:00 [WRN] Message 231 not found in Redis
2025-06-01 20:09:12.193 +07:00 [WRN] Message 230 not found in Redis
2025-06-01 20:09:12.193 +07:00 [WRN] Message 229 not found in Redis
2025-06-01 20:09:12.194 +07:00 [WRN] Message 228 not found in Redis
2025-06-01 20:09:12.194 +07:00 [WRN] Message 227 not found in Redis
2025-06-01 20:09:12.194 +07:00 [WRN] Message 226 not found in Redis
2025-06-01 20:09:12.194 +07:00 [WRN] Message 225 not found in Redis
2025-06-01 20:09:12.195 +07:00 [WRN] Message 224 not found in Redis
2025-06-01 20:09:12.195 +07:00 [WRN] Message 223 not found in Redis
2025-06-01 20:09:12.196 +07:00 [WRN] Message 222 not found in Redis
2025-06-01 20:09:12.196 +07:00 [WRN] Message 221 not found in Redis
2025-06-01 20:09:12.197 +07:00 [WRN] Message 220 not found in Redis
2025-06-01 20:09:12.197 +07:00 [WRN] Message 219 not found in Redis
2025-06-01 20:09:12.197 +07:00 [WRN] Message 218 not found in Redis
2025-06-01 20:09:12.197 +07:00 [WRN] Message 217 not found in Redis
2025-06-01 20:09:12.198 +07:00 [WRN] Message 216 not found in Redis
2025-06-01 20:09:12.198 +07:00 [WRN] Message 215 not found in Redis
2025-06-01 20:09:12.198 +07:00 [WRN] Message 214 not found in Redis
2025-06-01 20:09:12.198 +07:00 [WRN] Message 213 not found in Redis
2025-06-01 20:09:12.198 +07:00 [WRN] Message 212 not found in Redis
2025-06-01 20:09:12.198 +07:00 [WRN] Message 211 not found in Redis
2025-06-01 20:09:12.198 +07:00 [WRN] Message 210 not found in Redis
2025-06-01 20:09:12.199 +07:00 [WRN] Message 209 not found in Redis
2025-06-01 20:09:12.199 +07:00 [WRN] Message 208 not found in Redis
2025-06-01 20:09:12.199 +07:00 [WRN] Message 207 not found in Redis
2025-06-01 20:09:12.199 +07:00 [WRN] Message 206 not found in Redis
2025-06-01 20:09:12.199 +07:00 [WRN] Message 205 not found in Redis
2025-06-01 20:09:12.200 +07:00 [WRN] Message 204 not found in Redis
2025-06-01 20:09:12.200 +07:00 [WRN] Message 203 not found in Redis
2025-06-01 20:09:12.200 +07:00 [WRN] Message 202 not found in Redis
2025-06-01 20:09:12.200 +07:00 [WRN] Message 201 not found in Redis
2025-06-01 20:09:12.200 +07:00 [WRN] Message 196 not found in Redis
2025-06-01 20:09:12.201 +07:00 [WRN] Message 194 not found in Redis
2025-06-01 20:09:12.201 +07:00 [WRN] Message 193 not found in Redis
2025-06-01 20:09:12.201 +07:00 [WRN] Message 192 not found in Redis
2025-06-01 20:09:12.201 +07:00 [WRN] Message 190 not found in Redis
2025-06-01 20:09:12.201 +07:00 [WRN] Message 189 not found in Redis
2025-06-01 20:09:12.201 +07:00 [WRN] Message 183 not found in Redis
2025-06-01 20:09:12.202 +07:00 [WRN] Message 182 not found in Redis
2025-06-01 20:09:12.202 +07:00 [WRN] Message 181 not found in Redis
2025-06-01 20:09:12.202 +07:00 [INF] Retrieved 44 messages from Redis for conversation 19
2025-06-01 20:09:12.203 +07:00 [INF] Retrieved 44 messages from Redis for conversation 19 and user 2
2025-06-01 20:09:12.204 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 20:09:12.206 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 40.5246ms
2025-06-01 20:09:12.206 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 20:09:12.206 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Message/getMessages/19/2 - 200 null application/json; charset=utf-8 44.7882ms
2025-06-01 20:09:12.279 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 20:09:12.279 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 20:09:12.279 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 20:09:12.292 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 20:09:12.296 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 20:09:12.297 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 17.524ms
2025-06-01 20:09:12.297 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 20:09:12.297 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 17.9732ms
2025-06-01 20:09:12.353 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Participant/get_participants/19 - null null
2025-06-01 20:09:12.354 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 20:09:12.355 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 20:09:12.365 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 20:09:12.365 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 20:09:12.365 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 10.5665ms
2025-06-01 20:09:12.365 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 20:09:12.365 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 12.0673ms
2025-06-01 20:09:15.908 +07:00 [INF] Handling message from user 2: ok
2025-06-01 20:09:15.929 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-01 20:09:15.949 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 20:09:15.991 +07:00 [INF] Executed DbCommand (42ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-01 20:09:15.993 +07:00 [INF] Message saved to DB with ID: 441
2025-06-01 20:09:15.995 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-01 20:09:16.007 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-01 20:09:16.009 +07:00 [INF] Transaction committed for message: 441
2025-06-01 20:09:16.014 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-01 20:09:16.017 +07:00 [INF] Saved message 441 to Redis
2025-06-01 20:09:16.018 +07:00 [INF] Added message 441 to conversation 19
2025-06-01 20:09:16.019 +07:00 [INF] Published message to channel conversation:19
2025-06-01 20:09:18.937 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Message/getMessages/19/3 - null null
2025-06-01 20:09:18.937 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 20:09:18.938 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-01 20:09:18.964 +07:00 [WRN] Message 245 not found in Redis
2025-06-01 20:09:18.965 +07:00 [WRN] Message 244 not found in Redis
2025-06-01 20:09:18.965 +07:00 [WRN] Message 243 not found in Redis
2025-06-01 20:09:18.966 +07:00 [WRN] Message 242 not found in Redis
2025-06-01 20:09:18.966 +07:00 [WRN] Message 241 not found in Redis
2025-06-01 20:09:18.967 +07:00 [WRN] Message 240 not found in Redis
2025-06-01 20:09:18.967 +07:00 [WRN] Message 239 not found in Redis
2025-06-01 20:09:18.968 +07:00 [WRN] Message 238 not found in Redis
2025-06-01 20:09:18.968 +07:00 [WRN] Message 237 not found in Redis
2025-06-01 20:09:18.969 +07:00 [WRN] Message 231 not found in Redis
2025-06-01 20:09:18.970 +07:00 [WRN] Message 230 not found in Redis
2025-06-01 20:09:18.970 +07:00 [WRN] Message 229 not found in Redis
2025-06-01 20:09:18.971 +07:00 [WRN] Message 228 not found in Redis
2025-06-01 20:09:18.971 +07:00 [WRN] Message 227 not found in Redis
2025-06-01 20:09:18.971 +07:00 [WRN] Message 226 not found in Redis
2025-06-01 20:09:18.972 +07:00 [WRN] Message 225 not found in Redis
2025-06-01 20:09:18.972 +07:00 [WRN] Message 224 not found in Redis
2025-06-01 20:09:18.973 +07:00 [WRN] Message 223 not found in Redis
2025-06-01 20:09:18.973 +07:00 [WRN] Message 222 not found in Redis
2025-06-01 20:09:18.974 +07:00 [WRN] Message 221 not found in Redis
2025-06-01 20:09:18.974 +07:00 [WRN] Message 220 not found in Redis
2025-06-01 20:09:18.975 +07:00 [WRN] Message 219 not found in Redis
2025-06-01 20:09:18.975 +07:00 [WRN] Message 218 not found in Redis
2025-06-01 20:09:18.976 +07:00 [WRN] Message 217 not found in Redis
2025-06-01 20:09:18.977 +07:00 [WRN] Message 216 not found in Redis
2025-06-01 20:09:18.978 +07:00 [WRN] Message 215 not found in Redis
2025-06-01 20:09:18.980 +07:00 [WRN] Message 214 not found in Redis
2025-06-01 20:09:18.981 +07:00 [WRN] Message 213 not found in Redis
2025-06-01 20:09:18.981 +07:00 [WRN] Message 212 not found in Redis
2025-06-01 20:09:18.982 +07:00 [WRN] Message 211 not found in Redis
2025-06-01 20:09:18.982 +07:00 [WRN] Message 210 not found in Redis
2025-06-01 20:09:18.983 +07:00 [WRN] Message 209 not found in Redis
2025-06-01 20:09:18.983 +07:00 [WRN] Message 208 not found in Redis
2025-06-01 20:09:18.983 +07:00 [WRN] Message 207 not found in Redis
2025-06-01 20:09:18.984 +07:00 [WRN] Message 206 not found in Redis
2025-06-01 20:09:18.984 +07:00 [WRN] Message 205 not found in Redis
2025-06-01 20:09:18.985 +07:00 [WRN] Message 204 not found in Redis
2025-06-01 20:09:18.985 +07:00 [WRN] Message 203 not found in Redis
2025-06-01 20:09:18.986 +07:00 [WRN] Message 202 not found in Redis
2025-06-01 20:09:18.986 +07:00 [WRN] Message 201 not found in Redis
2025-06-01 20:09:18.987 +07:00 [WRN] Message 196 not found in Redis
2025-06-01 20:09:18.987 +07:00 [WRN] Message 194 not found in Redis
2025-06-01 20:09:18.988 +07:00 [WRN] Message 193 not found in Redis
2025-06-01 20:09:18.988 +07:00 [WRN] Message 192 not found in Redis
2025-06-01 20:09:18.989 +07:00 [WRN] Message 190 not found in Redis
2025-06-01 20:09:18.989 +07:00 [WRN] Message 189 not found in Redis
2025-06-01 20:09:18.990 +07:00 [WRN] Message 183 not found in Redis
2025-06-01 20:09:18.990 +07:00 [WRN] Message 182 not found in Redis
2025-06-01 20:09:18.990 +07:00 [WRN] Message 181 not found in Redis
2025-06-01 20:09:18.990 +07:00 [INF] Retrieved 45 messages from Redis for conversation 19
2025-06-01 20:09:18.991 +07:00 [INF] Retrieved 45 messages from Redis for conversation 19 and user 3
2025-06-01 20:09:18.991 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-01 20:09:18.992 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 54.2242ms
2025-06-01 20:09:18.994 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-01 20:09:18.995 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 57.5962ms
2025-06-01 20:09:19.108 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-01 20:09:19.108 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 20:09:19.108 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-01 20:09:19.118 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-01 20:09:19.118 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-01 20:09:19.119 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.2444ms
2025-06-01 20:09:19.119 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-01 20:09:19.119 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 10.8675ms
2025-06-01 20:09:19.207 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/api/Participant/get_participants/19 - null null
2025-06-01 20:09:19.207 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 20:09:19.207 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-01 20:09:19.214 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-01 20:09:19.214 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-01 20:09:19.214 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.2626ms
2025-06-01 20:09:19.214 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-01 20:09:19.214 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 7.9ms
2025-06-01 20:11:18.018 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=3 - null null
2025-06-01 20:11:18.021 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-01 20:11:24.954 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 20:11:24.956 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 20:11:24.971 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-01 20:11:24.971 +07:00 [ERR] Connection id "0HND119CLOHB5", Request id "0HND119CLOHB5:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-01 20:11:24.975 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=3 - 101 null null 150090.1823ms
2025-06-01 20:14:09.370 +07:00 [INF] Application is shutting down...
2025-06-01 20:14:26.260 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 20:14:26.260 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-01 20:14:26.264 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-01 20:14:26.265 +07:00 [ERR] Connection id "0HND119CLOHB9", Request id "0HND119CLOHB9:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-01 20:14:26.266 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=2 - 101 null null 316846.0205ms
2025-06-01 20:14:39.420 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 20:14:39.420 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-01 20:14:39.422 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1681638.9652ms
2025-06-01 20:14:39.422 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.4:5053/ws/chat?userId=3 - 101 null null 201404.236ms
