2025-05-10 00:19:48.827 +07:00 [INF] Executed DbCommand (59ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-10 00:19:49.165 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-10 00:19:49.218 +07:00 [WRN] The WebRootPath was not found: C:\Users\Thao\source\Flutter\Message_app\server\wwwroot. Static files may be unavailable.
2025-05-10 00:19:49.239 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-10 00:19:49.251 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-10 00:19:49.252 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-10 00:19:49.252 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-10 00:19:49.252 +07:00 [INF] Hosting environment: Development
2025-05-10 00:19:49.252 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-10 00:24:22.859 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:24:22.962 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:22.982 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 134.3113ms
2025-05-10 00:24:22.988 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 00:24:22.991 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:23.061 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:23.068 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-10 00:24:23.155 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:24:23.235 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:24:23.856 +07:00 [INF] Executed DbCommand (133ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:24:24.096 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:24:24.200 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 959.9904ms
2025-05-10 00:24:24.201 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:24:24.213 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 1224.7584ms
2025-05-10 00:24:24.423 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 00:24:24.435 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:24.438 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:24.439 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:24:24.447 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:24:24.618 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:24:24.618 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:24.618 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:24:24.618 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.5251ms
2025-05-10 00:24:24.619 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:24.619 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 1.016ms
2025-05-10 00:24:24.620 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:24:24.621 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:24.622 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:24.625 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:24:24.634 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:24:24.716 +07:00 [INF] Executed DbCommand (69ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:24:24.719 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:24.740 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 292.6637ms
2025-05-10 00:24:24.740 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:24:24.740 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 317.3745ms
2025-05-10 00:24:24.803 +07:00 [INF] Executed DbCommand (58ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:24:24.810 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:24:24.821 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 186.1396ms
2025-05-10 00:24:24.821 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:24:24.823 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 201.8752ms
2025-05-10 00:24:24.823 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:24:24.824 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:24.828 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:24.828 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:24:24.828 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:24:24.839 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:24:24.841 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:24:24.843 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 14.6457ms
2025-05-10 00:24:24.845 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:24:24.845 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 21.8882ms
2025-05-10 00:24:25.109 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 00:24:25.112 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:25.113 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:25.113 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:24:25.226 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:24:28.332 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/UserProfile/2/profile - null null
2025-05-10 00:24:28.333 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:28.335 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:28.335 +07:00 [INF] Executing endpoint 'server.Controllers.UserProfileController.GetUserProfile (Message_app)'
2025-05-10 00:24:28.340 +07:00 [INF] Route matched with {action = "GetUserProfile", controller = "UserProfile"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserProfile(Int32) on controller server.Controllers.UserProfileController (Message_app).
2025-05-10 00:24:28.404 +07:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-05-10 00:24:28.427 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[avatar_url], [t].[bio], [t].[birthday], [t].[created_at], [t].[email], [t].[gender], [t].[interests], [t].[location], [t].[password], [t].[passwordSalt], [t].[username], [f].[Id], [f].[CreatedAt], [f].[UserId1], [f].[UserId2], [f0].[Id], [f0].[CreatedAt], [f0].[UserId1], [f0].[UserId2]
FROM (
    SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
    FROM [Users] AS [u]
    WHERE [u].[id] = @__userId_0
) AS [t]
LEFT JOIN [Friends] AS [f] ON [t].[id] = [f].[UserId1]
LEFT JOIN [Friends] AS [f0] ON [t].[id] = [f0].[UserId2]
ORDER BY [t].[id], [f].[Id]
2025-05-10 00:24:28.460 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType22`11[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateOnly, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:28.472 +07:00 [INF] Executed action server.Controllers.UserProfileController.GetUserProfile (Message_app) in 131.829ms
2025-05-10 00:24:28.472 +07:00 [INF] Executed endpoint 'server.Controllers.UserProfileController.GetUserProfile (Message_app)'
2025-05-10 00:24:28.473 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/UserProfile/2/profile - 200 null application/json; charset=utf-8 140.8309ms
2025-05-10 00:24:32.247 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - null null
2025-05-10 00:24:32.248 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.251 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.252 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-10 00:24:32.265 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:24:32.301 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-10 00:24:32.303 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:32.308 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 41.1686ms
2025-05-10 00:24:32.308 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-10 00:24:32.309 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 61.2475ms
2025-05-10 00:24:32.310 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - null null
2025-05-10 00:24:32.311 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.311 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.311 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-10 00:24:32.311 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:24:32.315 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-10 00:24:32.316 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:32.316 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 4.6915ms
2025-05-10 00:24:32.317 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-10 00:24:32.318 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 6.8524ms
2025-05-10 00:24:32.318 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - null null
2025-05-10 00:24:32.319 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.319 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.319 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-10 00:24:32.320 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:24:32.324 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-10 00:24:32.325 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:32.326 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 5.8858ms
2025-05-10 00:24:32.326 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-05-10 00:24:32.326 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 7.7272ms
2025-05-10 00:24:32.388 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/2 - null null
2025-05-10 00:24:32.389 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.389 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.390 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-10 00:24:32.395 +07:00 [INF] Route matched with {action = "GetSentFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetSentFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:24:32.416 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[ReceiverId] = [u].[id]
WHERE [f].[SenderId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-10 00:24:32.417 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType13`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:32.419 +07:00 [INF] Executed action server.Controllers.FriendsController.GetSentFriendRequests (Message_app) in 24.1823ms
2025-05-10 00:24:32.420 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-10 00:24:32.420 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/2 - 200 null application/json; charset=utf-8 31.8058ms
2025-05-10 00:24:32.421 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/2 - null null
2025-05-10 00:24:32.421 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.421 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.421 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-10 00:24:32.422 +07:00 [INF] Route matched with {action = "GetSentFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetSentFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:24:32.424 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/2 - null null
2025-05-10 00:24:32.424 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.424 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.425 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-10 00:24:32.432 +07:00 [INF] Route matched with {action = "GetFriendSuggestions", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendSuggestions(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:24:32.432 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[ReceiverId] = [u].[id]
WHERE [f].[SenderId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-10 00:24:32.432 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType13`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:32.433 +07:00 [INF] Executed action server.Controllers.FriendsController.GetSentFriendRequests (Message_app) in 11.3212ms
2025-05-10 00:24:32.433 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-10 00:24:32.434 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/2 - 200 null application/json; charset=utf-8 12.7509ms
2025-05-10 00:24:32.436 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/2 - null null
2025-05-10 00:24:32.437 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.437 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.437 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-10 00:24:32.437 +07:00 [INF] Route matched with {action = "GetSentFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetSentFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:24:32.451 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[ReceiverId] = [u].[id]
WHERE [f].[SenderId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-05-10 00:24:32.452 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType13`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:32.452 +07:00 [INF] Executed action server.Controllers.FriendsController.GetSentFriendRequests (Message_app) in 14.6642ms
2025-05-10 00:24:32.452 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetSentFriendRequests (Message_app)'
2025-05-10 00:24:32.453 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/get-sent-requests/2 - 200 null application/json; charset=utf-8 16.239ms
2025-05-10 00:24:32.460 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__userId_0
2025-05-10 00:24:32.476 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:24:32.491 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-10 00:24:32.499 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-10 00:24:32.501 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-10 00:24:32.508 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[ReceiverId]
FROM [FriendRequests] AS [f]
WHERE [f].[SenderId] = @__userId_0
2025-05-10 00:24:32.516 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[SenderId]
FROM [FriendRequests] AS [f]
WHERE [f].[ReceiverId] = @__userId_0
2025-05-10 00:24:32.525 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType12`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendSuggestionDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:32.529 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendSuggestions (Message_app) in 96.8609ms
2025-05-10 00:24:32.529 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-10 00:24:32.529 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/2 - 200 null application/json; charset=utf-8 105.4221ms
2025-05-10 00:24:32.531 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/2 - null null
2025-05-10 00:24:32.531 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.531 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.532 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-10 00:24:32.532 +07:00 [INF] Route matched with {action = "GetFriendSuggestions", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendSuggestions(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:24:32.533 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/list/2 - null null
2025-05-10 00:24:32.534 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.534 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.534 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-10 00:24:32.540 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendsAsync(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:24:32.540 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__userId_0
2025-05-10 00:24:32.547 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:24:32.550 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-10 00:24:32.552 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-10 00:24:32.555 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-10 00:24:32.557 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[ReceiverId]
FROM [FriendRequests] AS [f]
WHERE [f].[SenderId] = @__userId_0
2025-05-10 00:24:32.561 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[SenderId]
FROM [FriendRequests] AS [f]
WHERE [f].[ReceiverId] = @__userId_0
2025-05-10 00:24:32.561 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType12`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendSuggestionDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:32.562 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendSuggestions (Message_app) in 28.3742ms
2025-05-10 00:24:32.562 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-10 00:24:32.562 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/2 - 200 null application/json; charset=utf-8 31.112ms
2025-05-10 00:24:32.564 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/2 - null null
2025-05-10 00:24:32.564 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.564 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.565 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-10 00:24:32.565 +07:00 [INF] Route matched with {action = "GetFriendSuggestions", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendSuggestions(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:24:32.577 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END, [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[bio], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[gender], [u0].[interests], [u0].[location], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:24:32.579 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:24:32.589 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 00:24:32.597 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 00:24:32.600 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 00:24:32.601 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:32.603 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendsAsync (Message_app) in 63.26ms
2025-05-10 00:24:32.604 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-10 00:24:32.604 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/list/2 - 200 null application/json; charset=utf-8 71.1365ms
2025-05-10 00:24:32.609 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/list/2 - null null
2025-05-10 00:24:32.610 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.611 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.611 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-10 00:24:32.612 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__userId_0
2025-05-10 00:24:32.613 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendsAsync(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:24:32.618 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:24:32.623 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-10 00:24:32.623 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END, [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[bio], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[gender], [u0].[interests], [u0].[location], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:24:32.629 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:24:32.630 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-10 00:24:32.633 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friendId_0='?' (DbType = Int32), @__8__locals1_userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friendId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE ([f].[UserId1] = @__friendId_0 OR [f].[UserId2] = @__friendId_0) AND [f].[UserId1] <> @__8__locals1_userId_1 AND [f].[UserId2] <> @__8__locals1_userId_1
2025-05-10 00:24:32.633 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 00:24:32.637 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[ReceiverId]
FROM [FriendRequests] AS [f]
WHERE [f].[SenderId] = @__userId_0
2025-05-10 00:24:32.638 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 00:24:32.642 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[SenderId]
FROM [FriendRequests] AS [f]
WHERE [f].[ReceiverId] = @__userId_0
2025-05-10 00:24:32.642 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 00:24:32.642 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType12`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendSuggestionDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:32.642 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:32.642 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendSuggestions (Message_app) in 77.3552ms
2025-05-10 00:24:32.642 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendSuggestions (Message_app)'
2025-05-10 00:24:32.642 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendsAsync (Message_app) in 29.5456ms
2025-05-10 00:24:32.643 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-10 00:24:32.643 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/suggestions/2 - 200 null application/json; charset=utf-8 78.67ms
2025-05-10 00:24:32.643 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/list/2 - 200 null application/json; charset=utf-8 34.3804ms
2025-05-10 00:24:32.650 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/list/2 - null null
2025-05-10 00:24:32.650 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.650 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:24:32.651 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-10 00:24:32.651 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendsAsync(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:24:32.659 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END, [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[bio], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[gender], [u0].[interests], [u0].[location], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:24:32.666 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:24:32.673 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 00:24:32.690 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 00:24:32.697 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 00:24:32.698 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:24:32.705 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendsAsync (Message_app) in 54.1622ms
2025-05-10 00:24:32.705 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-10 00:24:32.705 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/list/2 - 200 null application/json; charset=utf-8 55.2282ms
2025-05-10 00:25:33.887 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/send-otp-registration - null null
2025-05-10 00:25:33.888 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:25:33.888 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/send-otp-registration - 204 null null 0.8119ms
2025-05-10 00:25:33.890 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/send-otp-registration - application/json 30
2025-05-10 00:25:33.890 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:25:33.891 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:25:33.892 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.SendOTPRegistration (Message_app)'
2025-05-10 00:25:33.898 +07:00 [INF] Route matched with {action = "SendOTPRegistration", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendOTPRegistration(EmailDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:25:37.272 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/send-otp-registration - application/json 30
2025-05-10 00:25:37.273 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:25:37.273 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:25:37.274 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.SendOTPRegistration (Message_app)'
2025-05-10 00:25:37.274 +07:00 [INF] Route matched with {action = "SendOTPRegistration", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendOTPRegistration(EmailDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:25:38.449 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType4`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:25:38.453 +07:00 [INF] Executed action Message_app.Controllers.AuthController.SendOTPRegistration (Message_app) in 4555.4161ms
2025-05-10 00:25:38.453 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.SendOTPRegistration (Message_app)'
2025-05-10 00:25:38.454 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/send-otp-registration - 200 null application/json; charset=utf-8 4564.1477ms
2025-05-10 00:25:40.771 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType4`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:25:40.772 +07:00 [INF] Executed action Message_app.Controllers.AuthController.SendOTPRegistration (Message_app) in 3498.027ms
2025-05-10 00:25:40.772 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.SendOTPRegistration (Message_app)'
2025-05-10 00:25:40.772 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/send-otp-registration - 200 null application/json; charset=utf-8 3500.5162ms
2025-05-10 00:26:01.955 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/ForgetPassword/ForgetPass - null null
2025-05-10 00:26:01.955 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:26:01.956 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/ForgetPassword/ForgetPass - 204 null null 0.4426ms
2025-05-10 00:26:01.958 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/ForgetPassword/ForgetPass - application/json 37
2025-05-10 00:26:01.958 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:26:01.959 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:26:01.959 +07:00 [INF] Executing endpoint 'Message_app.Controllers.ForgetPasswordController.ForgotPassword (Message_app)'
2025-05-10 00:26:01.967 +07:00 [INF] Route matched with {action = "ForgotPassword", controller = "ForgetPassword"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForgotPassword(server.Models.OTPsDTO) on controller Message_app.Controllers.ForgetPasswordController (Message_app).
2025-05-10 00:26:02.047 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:26:02.049 +07:00 [INF] Executing BadRequestObjectResult, writing value of type '<>f__AnonymousType2`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:26:02.050 +07:00 [INF] Executed action Message_app.Controllers.ForgetPasswordController.ForgotPassword (Message_app) in 81.0033ms
2025-05-10 00:26:02.050 +07:00 [INF] Executed endpoint 'Message_app.Controllers.ForgetPasswordController.ForgotPassword (Message_app)'
2025-05-10 00:26:02.051 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/ForgetPassword/ForgetPass - 400 null application/json; charset=utf-8 92.3513ms
2025-05-10 00:26:44.977 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/send-otp-registration - null null
2025-05-10 00:26:44.977 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:26:44.977 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/send-otp-registration - 204 null null 0.6044ms
2025-05-10 00:26:44.981 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/send-otp-registration - application/json 37
2025-05-10 00:26:44.981 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:26:44.981 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:26:44.981 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.SendOTPRegistration (Message_app)'
2025-05-10 00:26:44.982 +07:00 [INF] Route matched with {action = "SendOTPRegistration", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendOTPRegistration(EmailDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:26:47.913 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType4`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:26:47.914 +07:00 [INF] Executed action Message_app.Controllers.AuthController.SendOTPRegistration (Message_app) in 2931.935ms
2025-05-10 00:26:47.914 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.SendOTPRegistration (Message_app)'
2025-05-10 00:26:47.914 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/send-otp-registration - 200 null application/json; charset=utf-8 2933.5638ms
2025-05-10 00:28:00.945 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/send-otp-registration - null null
2025-05-10 00:28:00.946 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:28:00.946 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/send-otp-registration - 204 null null 0.5606ms
2025-05-10 00:28:00.948 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/send-otp-registration - application/json 37
2025-05-10 00:28:00.948 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:28:00.948 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:28:00.948 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.SendOTPRegistration (Message_app)'
2025-05-10 00:28:00.948 +07:00 [INF] Route matched with {action = "SendOTPRegistration", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendOTPRegistration(EmailDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:28:03.906 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType4`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:28:03.907 +07:00 [INF] Executed action Message_app.Controllers.AuthController.SendOTPRegistration (Message_app) in 2958.5199ms
2025-05-10 00:28:03.907 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.SendOTPRegistration (Message_app)'
2025-05-10 00:28:03.907 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/send-otp-registration - 200 null application/json; charset=utf-8 2959.2782ms
2025-05-10 00:34:40.222 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 00:34:40.224 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 615115.1182ms
2025-05-10 00:38:37.932 +07:00 [INF] Application is shutting down...
2025-05-10 00:38:47.714 +07:00 [INF] Executed DbCommand (53ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-10 00:38:47.857 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-10 00:38:47.906 +07:00 [WRN] The WebRootPath was not found: C:\Users\Thao\source\Flutter\Message_app\server\wwwroot. Static files may be unavailable.
2025-05-10 00:38:47.929 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-10 00:38:47.939 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-10 00:38:47.940 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-10 00:38:47.940 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-10 00:38:47.940 +07:00 [INF] Hosting environment: Development
2025-05-10 00:38:47.940 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-10 00:42:07.303 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:42:07.354 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:07.369 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 69.169ms
2025-05-10 00:42:07.375 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 00:42:07.377 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:07.423 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:07.424 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-10 00:42:07.471 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:42:07.524 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:42:07.803 +07:00 [INF] Executed DbCommand (35ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:42:07.980 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:42:08.074 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 543.9022ms
2025-05-10 00:42:08.075 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:42:08.082 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 707.188ms
2025-05-10 00:42:08.245 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 00:42:08.253 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:08.257 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:08.258 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:42:08.267 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:42:08.448 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:42:08.448 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:42:08.449 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:08.449 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:08.449 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 1.233ms
2025-05-10 00:42:08.450 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 1.077ms
2025-05-10 00:42:08.451 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:42:08.453 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:42:08.454 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:08.454 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:42:08.455 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:08.459 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:42:08.470 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:42:08.477 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 208.3917ms
2025-05-10 00:42:08.477 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:42:08.477 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 232.3156ms
2025-05-10 00:42:08.593 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:42:08.601 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:42:08.609 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 138.8067ms
2025-05-10 00:42:08.609 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:42:08.610 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 156.2265ms
2025-05-10 00:42:08.611 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:42:08.611 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:08.613 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:08.613 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:42:08.614 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:42:08.625 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 00:42:08.628 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:08.629 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:08.629 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:42:08.646 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:42:08.647 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:42:08.648 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 33.8011ms
2025-05-10 00:42:08.648 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:42:08.649 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 38.586ms
2025-05-10 00:42:08.733 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:42:08.779 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 00:42:41.152 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:42:41.153 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:41.153 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.812ms
2025-05-10 00:42:41.155 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 00:42:41.155 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:41.157 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:41.157 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:42:41.158 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:42:41.178 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:42:41.180 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:42:41.181 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 21.7513ms
2025-05-10 00:42:41.181 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:42:41.181 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 26.396ms
2025-05-10 00:42:41.330 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 00:42:41.331 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:41.333 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:41.333 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:42:41.333 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:42:41.347 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:42:41.347 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:42:41.348 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 14.4936ms
2025-05-10 00:42:41.348 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:42:41.348 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 18.0668ms
2025-05-10 00:42:41.558 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:42:41.558 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:41.559 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.753ms
2025-05-10 00:42:41.559 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:42:41.559 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:41.560 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.3536ms
2025-05-10 00:42:41.560 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:42:41.560 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:41.561 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:41.561 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:42:41.561 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:42:41.611 +07:00 [INF] Executed DbCommand (42ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:42:41.612 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:42:41.613 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 52.1778ms
2025-05-10 00:42:41.614 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:42:41.614 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 53.7554ms
2025-05-10 00:42:41.617 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:42:41.618 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:41.618 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:41.618 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:42:41.619 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:42:41.624 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:42:41.625 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:42:41.625 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 6.158ms
2025-05-10 00:42:41.625 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:42:41.626 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 9.0733ms
2025-05-10 00:42:41.743 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 00:42:41.743 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:41.744 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:42:41.745 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:42:41.862 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:43:07.185 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 00:43:07.186 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:07.186 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.6796ms
2025-05-10 00:43:07.187 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 00:43:07.188 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:07.188 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:07.188 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:43:07.199 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 00:43:07.305 +07:00 [INF] Retrieved 15 messages from Redis for conversation 19
2025-05-10 00:43:07.310 +07:00 [INF] Retrieved 15 messages from Redis for conversation 19 and user 3
2025-05-10 00:43:07.310 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:43:07.326 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 126.0915ms
2025-05-10 00:43:07.326 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:43:07.326 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 138.5739ms
2025-05-10 00:43:07.339 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:43:07.340 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:07.340 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.9909ms
2025-05-10 00:43:07.342 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:43:07.343 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:07.343 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:07.343 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:43:07.347 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:43:07.492 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 00:43:07.581 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 00:43:07.589 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 241.918ms
2025-05-10 00:43:07.589 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:43:07.589 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 246.9421ms
2025-05-10 00:43:07.596 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:43:07.596 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:07.597 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.5627ms
2025-05-10 00:43:07.601 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:43:07.602 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:07.602 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:07.603 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:43:07.621 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 00:43:07.642 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 00:43:07.645 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:43:07.649 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 27.9659ms
2025-05-10 00:43:07.649 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:43:07.649 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 47.8349ms
2025-05-10 00:43:11.407 +07:00 [INF] Handling message from user 3: sdfsdf
2025-05-10 00:43:11.436 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 00:43:11.681 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 00:43:11.717 +07:00 [INF] Executed DbCommand (32ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 00:43:11.765 +07:00 [INF] Message saved to DB with ID: 207
2025-05-10 00:43:11.773 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 00:43:11.795 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 00:43:11.819 +07:00 [INF] Transaction committed for message: 207
2025-05-10 00:43:11.827 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:43:11.840 +07:00 [INF] Saved message 207 to Redis
2025-05-10 00:43:11.845 +07:00 [INF] Added message 207 to conversation 19
2025-05-10 00:43:11.860 +07:00 [INF] Published message to channel conversation:19
2025-05-10 00:43:15.305 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/2 - null null
2025-05-10 00:43:15.305 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:15.305 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/2 - 204 null null 0.4728ms
2025-05-10 00:43:15.307 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/2 - null null
2025-05-10 00:43:15.307 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:15.308 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:15.308 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:43:15.308 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 00:43:15.320 +07:00 [INF] Retrieved 16 messages from Redis for conversation 19
2025-05-10 00:43:15.320 +07:00 [INF] Retrieved 16 messages from Redis for conversation 19 and user 2
2025-05-10 00:43:15.320 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:43:15.321 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 12.4483ms
2025-05-10 00:43:15.321 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:43:15.321 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/2 - 200 null application/json; charset=utf-8 14.4383ms
2025-05-10 00:43:15.338 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:43:15.338 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:15.339 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.5113ms
2025-05-10 00:43:15.341 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:43:15.342 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:15.342 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:15.342 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:43:15.343 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:43:15.353 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 00:43:15.360 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 00:43:15.361 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 18.2603ms
2025-05-10 00:43:15.361 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:43:15.362 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 21.2556ms
2025-05-10 00:43:15.373 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:43:15.374 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:15.374 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 1.05ms
2025-05-10 00:43:15.376 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:43:15.376 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:15.377 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:43:15.377 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:43:15.378 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 00:43:15.382 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 00:43:15.382 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:43:15.383 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.9613ms
2025-05-10 00:43:15.383 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:43:15.384 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 8.2818ms
2025-05-10 00:45:11.188 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 00:45:11.188 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 182563.2349ms
2025-05-10 00:45:58.112 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:45:58.112 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:45:58.112 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2753ms
2025-05-10 00:45:58.113 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 00:45:58.113 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:45:58.114 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:45:58.114 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:45:58.114 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:45:58.125 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:45:58.126 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:45:58.126 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 12.1314ms
2025-05-10 00:45:58.127 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:45:58.127 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 14.1706ms
2025-05-10 00:45:58.272 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 00:45:58.272 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:45:58.272 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:45:58.272 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:45:58.273 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:45:58.283 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:45:58.284 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:45:58.284 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.101ms
2025-05-10 00:45:58.284 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:45:58.284 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 11.8317ms
2025-05-10 00:45:58.504 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:45:58.505 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:45:58.505 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.5141ms
2025-05-10 00:45:58.506 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:45:58.506 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:45:58.506 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:45:58.506 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.2892ms
2025-05-10 00:45:58.507 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:45:58.507 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:45:58.507 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:45:58.507 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:45:58.520 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:45:58.521 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:45:58.522 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 14.8494ms
2025-05-10 00:45:58.522 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:45:58.522 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 15.961ms
2025-05-10 00:45:58.525 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:45:58.525 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:45:58.525 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:45:58.525 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:45:58.525 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:45:58.529 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:45:58.529 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:45:58.529 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.9659ms
2025-05-10 00:45:58.530 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:45:58.530 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.8965ms
2025-05-10 00:45:58.546 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 00:45:58.546 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:45:58.546 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:45:58.546 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:45:58.647 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:47:05.675 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:47:05.675 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:05.675 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.4447ms
2025-05-10 00:47:05.677 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 00:47:05.677 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:05.677 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:05.677 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:47:05.677 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:47:05.684 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:47:05.685 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-05-10 00:47:05.686 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 8.3836ms
2025-05-10 00:47:05.686 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:47:05.686 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 400 null application/json; charset=utf-8 9.0975ms
2025-05-10 00:47:15.719 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:47:15.719 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:15.719 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.4735ms
2025-05-10 00:47:15.721 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 00:47:15.721 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:15.722 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:15.722 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:47:15.722 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:47:15.726 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:47:15.727 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:47:15.727 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 4.7767ms
2025-05-10 00:47:15.727 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:47:15.727 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 5.8925ms
2025-05-10 00:47:15.859 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 00:47:15.859 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:15.859 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:15.859 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:47:15.859 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:47:15.868 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:47:15.868 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:47:15.868 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 8.9366ms
2025-05-10 00:47:15.868 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:47:15.869 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 9.6093ms
2025-05-10 00:47:16.017 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:47:16.017 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:16.017 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3435ms
2025-05-10 00:47:16.018 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:47:16.018 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:16.018 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:47:16.018 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2373ms
2025-05-10 00:47:16.018 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:16.019 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:16.019 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:47:16.019 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:47:16.038 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:47:16.038 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:47:16.039 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 19.7758ms
2025-05-10 00:47:16.039 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:47:16.039 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 20.3416ms
2025-05-10 00:47:16.040 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:47:16.041 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:16.042 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:16.042 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:47:16.042 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:47:16.045 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:47:16.045 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:47:16.046 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.3622ms
2025-05-10 00:47:16.046 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:47:16.046 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 5.7687ms
2025-05-10 00:47:16.228 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 00:47:16.229 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:16.229 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:16.229 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:47:16.279 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:47:16.288 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 00:47:23.690 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 00:47:23.690 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:23.691 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.3473ms
2025-05-10 00:47:23.693 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 00:47:23.693 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:23.693 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:23.694 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:47:23.694 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 00:47:23.701 +07:00 [INF] Retrieved 16 messages from Redis for conversation 19
2025-05-10 00:47:23.701 +07:00 [INF] Retrieved 16 messages from Redis for conversation 19 and user 3
2025-05-10 00:47:23.702 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:47:23.702 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 8.2065ms
2025-05-10 00:47:23.702 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:47:23.702 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 9.443ms
2025-05-10 00:47:23.713 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:47:23.713 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:23.713 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.1977ms
2025-05-10 00:47:23.715 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:47:23.715 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:23.715 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:23.715 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:47:23.716 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:47:23.721 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 00:47:23.722 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 00:47:23.723 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.2765ms
2025-05-10 00:47:23.723 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:47:23.724 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 8.4415ms
2025-05-10 00:47:23.731 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:47:23.731 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:23.731 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.2528ms
2025-05-10 00:47:23.732 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:47:23.732 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:23.733 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:47:23.733 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:47:23.733 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 00:47:23.737 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 00:47:23.737 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:47:23.738 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.4068ms
2025-05-10 00:47:23.738 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:47:23.738 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 5.6955ms
2025-05-10 00:47:28.702 +07:00 [INF] Handling message from user 3: askdj
2025-05-10 00:47:28.711 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 00:47:28.732 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 00:47:28.737 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 00:47:28.738 +07:00 [INF] Message saved to DB with ID: 208
2025-05-10 00:47:28.739 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 00:47:28.746 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 00:47:28.747 +07:00 [INF] Transaction committed for message: 208
2025-05-10 00:47:28.751 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:47:28.754 +07:00 [INF] Saved message 208 to Redis
2025-05-10 00:47:28.755 +07:00 [INF] Added message 208 to conversation 19
2025-05-10 00:47:28.756 +07:00 [INF] Published message to channel conversation:19
2025-05-10 00:52:17.080 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:52:17.080 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:17.080 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2302ms
2025-05-10 00:52:17.081 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 00:52:17.081 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:17.081 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:17.087 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:52:17.088 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:52:17.337 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:52:17.339 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:52:17.339 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 251.482ms
2025-05-10 00:52:17.339 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:52:17.340 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 258.5478ms
2025-05-10 00:52:17.462 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 00:52:17.462 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:17.463 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:17.464 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:52:17.464 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:52:17.474 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:52:17.475 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:52:17.475 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.034ms
2025-05-10 00:52:17.475 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:52:17.475 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 12.8265ms
2025-05-10 00:52:17.629 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:52:17.629 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:17.629 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.2334ms
2025-05-10 00:52:17.630 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:52:17.630 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:17.630 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.1466ms
2025-05-10 00:52:17.631 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:52:17.631 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:17.631 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:17.631 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:52:17.632 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:52:17.653 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:52:17.654 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:52:17.654 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 22.2428ms
2025-05-10 00:52:17.655 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:52:17.655 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 24.1827ms
2025-05-10 00:52:17.656 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:52:17.656 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:17.656 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:17.656 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:52:17.656 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:52:17.659 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:52:17.659 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:52:17.660 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.251ms
2025-05-10 00:52:17.660 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:52:17.660 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.134ms
2025-05-10 00:52:17.774 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 00:52:17.774 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:17.774 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:17.774 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:52:17.877 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:52:28.051 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:52:28.051 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:28.051 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3324ms
2025-05-10 00:52:28.052 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 00:52:28.053 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:28.053 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:28.053 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:52:28.053 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:52:28.061 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:52:28.062 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:52:28.063 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 9.8861ms
2025-05-10 00:52:28.063 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:52:28.063 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 10.6331ms
2025-05-10 00:52:28.209 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 00:52:28.209 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:28.209 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:28.210 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:52:28.210 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:52:28.220 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:52:28.221 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:52:28.221 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.5046ms
2025-05-10 00:52:28.221 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:52:28.222 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 12.2392ms
2025-05-10 00:52:28.378 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:52:28.379 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:28.379 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.315ms
2025-05-10 00:52:28.381 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:52:28.381 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:28.381 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:52:28.381 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2476ms
2025-05-10 00:52:28.381 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:28.381 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:28.381 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:52:28.382 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:52:28.396 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:52:28.396 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:52:28.397 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 14.5308ms
2025-05-10 00:52:28.397 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:52:28.397 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 15.8533ms
2025-05-10 00:52:28.398 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:52:28.399 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:28.400 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:28.400 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:52:28.400 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:52:28.405 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:52:28.407 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:52:28.407 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 6.9575ms
2025-05-10 00:52:28.407 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:52:28.407 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 8.7107ms
2025-05-10 00:52:28.585 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 00:52:28.585 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:28.586 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:28.586 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:52:28.635 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:52:28.674 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 00:52:33.571 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/2 - null null
2025-05-10 00:52:33.571 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:33.572 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/2 - 204 null null 0.3306ms
2025-05-10 00:52:33.573 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/2 - null null
2025-05-10 00:52:33.573 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:33.573 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:33.574 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:52:33.574 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 00:52:33.582 +07:00 [INF] Retrieved 17 messages from Redis for conversation 19
2025-05-10 00:52:33.582 +07:00 [INF] Retrieved 17 messages from Redis for conversation 19 and user 2
2025-05-10 00:52:33.583 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:52:33.584 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 10.0351ms
2025-05-10 00:52:33.584 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:52:33.584 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/2 - 200 null application/json; charset=utf-8 11.3967ms
2025-05-10 00:52:33.595 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:52:33.595 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:33.595 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.2914ms
2025-05-10 00:52:33.596 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:52:33.597 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:33.597 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:33.597 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:52:33.597 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:52:33.604 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 00:52:33.605 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 00:52:33.605 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.1575ms
2025-05-10 00:52:33.605 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:52:33.606 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 9.065ms
2025-05-10 00:52:33.613 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:52:33.613 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:33.613 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.1938ms
2025-05-10 00:52:33.615 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:52:33.615 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:33.616 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:52:33.616 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:52:33.616 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 00:52:33.624 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 00:52:33.625 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:52:33.625 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.3333ms
2025-05-10 00:52:33.625 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:52:33.625 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 10.5382ms
2025-05-10 00:52:39.803 +07:00 [INF] Handling message from user 2: nbb
2025-05-10 00:52:39.819 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 00:52:39.847 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 00:52:39.861 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 00:52:39.862 +07:00 [INF] Message saved to DB with ID: 209
2025-05-10 00:52:39.863 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 00:52:39.875 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 00:52:39.876 +07:00 [INF] Transaction committed for message: 209
2025-05-10 00:52:39.879 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:52:39.892 +07:00 [INF] Saved message 209 to Redis
2025-05-10 00:52:39.892 +07:00 [INF] Added message 209 to conversation 19
2025-05-10 00:52:39.893 +07:00 [INF] Published message to channel conversation:19
2025-05-10 00:55:12.948 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:55:12.948 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:12.948 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2253ms
2025-05-10 00:55:12.949 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 00:55:12.949 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:12.949 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:12.949 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:55:12.949 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:55:12.964 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:55:12.966 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:55:12.966 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 16.8937ms
2025-05-10 00:55:12.966 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:55:12.967 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 17.5478ms
2025-05-10 00:55:13.077 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 00:55:13.078 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:13.078 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:13.078 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:55:13.078 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:55:13.087 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:55:13.088 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:55:13.088 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.0933ms
2025-05-10 00:55:13.088 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:55:13.088 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 10.5942ms
2025-05-10 00:55:13.212 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:55:13.212 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:13.213 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.7189ms
2025-05-10 00:55:13.215 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:55:13.215 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:55:13.215 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:13.215 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:13.215 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:55:13.215 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:55:13.216 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:13.216 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 1.2167ms
2025-05-10 00:55:13.237 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:55:13.238 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:55:13.238 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 22.4336ms
2025-05-10 00:55:13.238 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:55:13.238 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 22.9147ms
2025-05-10 00:55:13.240 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:55:13.240 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:13.240 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:13.240 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:55:13.240 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:55:13.242 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:55:13.242 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:55:13.242 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.5099ms
2025-05-10 00:55:13.243 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:55:13.243 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 3.0654ms
2025-05-10 00:55:13.341 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 00:55:13.341 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:13.341 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:13.341 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:55:13.424 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:55:25.939 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:55:25.939 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:25.939 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2254ms
2025-05-10 00:55:25.941 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 00:55:25.941 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:25.941 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:25.941 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:55:25.941 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:55:25.957 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:55:25.958 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:55:25.958 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 17.266ms
2025-05-10 00:55:25.958 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:55:25.958 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 17.8444ms
2025-05-10 00:55:26.086 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 00:55:26.087 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:26.087 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:26.087 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:55:26.087 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:55:26.096 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:55:26.096 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:55:26.096 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.4381ms
2025-05-10 00:55:26.096 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:55:26.096 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 9.9435ms
2025-05-10 00:55:26.260 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:55:26.260 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:26.260 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1834ms
2025-05-10 00:55:26.261 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:55:26.261 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:26.261 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1634ms
2025-05-10 00:55:26.261 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:55:26.261 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:26.261 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:26.262 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:55:26.262 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:55:26.278 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:55:26.279 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:55:26.279 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 17.4461ms
2025-05-10 00:55:26.279 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:55:26.279 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 17.9095ms
2025-05-10 00:55:26.282 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:55:26.282 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:26.282 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:26.282 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:55:26.282 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:55:26.285 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:55:26.285 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:55:26.285 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.955ms
2025-05-10 00:55:26.285 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:55:26.285 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 3.5143ms
2025-05-10 00:55:26.399 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 00:55:26.400 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:26.400 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:26.400 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:55:26.511 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:55:26.523 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 00:55:28.929 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 00:55:28.930 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:28.930 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.2ms
2025-05-10 00:55:28.930 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 00:55:28.931 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:28.931 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:28.931 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:55:28.931 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 00:55:28.938 +07:00 [INF] Retrieved 18 messages from Redis for conversation 19
2025-05-10 00:55:28.938 +07:00 [INF] Retrieved 18 messages from Redis for conversation 19 and user 3
2025-05-10 00:55:28.939 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:55:28.940 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 8.9962ms
2025-05-10 00:55:28.940 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:55:28.940 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 9.5829ms
2025-05-10 00:55:28.956 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:55:28.956 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:28.957 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.1739ms
2025-05-10 00:55:28.958 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:55:28.958 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:28.958 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:28.958 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:55:28.958 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:55:28.972 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 00:55:28.974 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 00:55:28.975 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 16.4237ms
2025-05-10 00:55:28.975 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:55:28.975 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 17.1836ms
2025-05-10 00:55:28.982 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:55:28.982 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:28.983 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.5751ms
2025-05-10 00:55:28.984 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:55:28.985 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:28.985 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:55:28.985 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:55:28.985 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 00:55:28.989 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 00:55:28.990 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:55:28.990 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.1141ms
2025-05-10 00:55:28.990 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:55:28.990 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 5.961ms
2025-05-10 00:55:32.871 +07:00 [INF] Handling message from user 3: sdfsd
2025-05-10 00:55:32.892 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 00:55:32.897 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 00:55:32.905 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 00:55:32.906 +07:00 [INF] Message saved to DB with ID: 210
2025-05-10 00:55:32.906 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 00:55:32.914 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 00:55:32.916 +07:00 [INF] Transaction committed for message: 210
2025-05-10 00:55:32.921 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:55:32.924 +07:00 [INF] Saved message 210 to Redis
2025-05-10 00:55:32.925 +07:00 [INF] Added message 210 to conversation 19
2025-05-10 00:55:32.925 +07:00 [INF] Published message to channel conversation:19
2025-05-10 00:55:52.022 +07:00 [INF] Handling message from user 3: sdf
2025-05-10 00:55:52.031 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 00:55:52.034 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 00:55:52.046 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 00:55:52.046 +07:00 [INF] Message saved to DB with ID: 211
2025-05-10 00:55:52.051 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 00:55:52.058 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 00:55:52.060 +07:00 [INF] Transaction committed for message: 211
2025-05-10 00:55:52.064 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:55:52.069 +07:00 [INF] Saved message 211 to Redis
2025-05-10 00:55:52.070 +07:00 [INF] Added message 211 to conversation 19
2025-05-10 00:55:52.072 +07:00 [INF] Published message to channel conversation:19
2025-05-10 00:57:02.903 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:57:02.903 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:02.903 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2327ms
2025-05-10 00:57:02.907 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 00:57:02.907 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:02.907 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:02.907 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:57:02.908 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:57:02.919 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:57:02.920 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:57:02.921 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 12.5694ms
2025-05-10 00:57:02.921 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:57:02.921 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 13.7886ms
2025-05-10 00:57:03.030 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 00:57:03.030 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:03.030 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:03.030 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:57:03.030 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:57:03.040 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:57:03.040 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:57:03.040 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.6063ms
2025-05-10 00:57:03.040 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:57:03.040 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 10.55ms
2025-05-10 00:57:03.172 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:57:03.173 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:03.173 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.1876ms
2025-05-10 00:57:03.174 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:57:03.175 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:03.175 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.2807ms
2025-05-10 00:57:03.175 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:57:03.175 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:03.177 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:03.177 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:57:03.177 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:57:03.196 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:57:03.197 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:57:03.197 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 19.8471ms
2025-05-10 00:57:03.197 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:57:03.197 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 22.1978ms
2025-05-10 00:57:03.199 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:57:03.199 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:03.199 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:03.199 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:57:03.199 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:57:03.201 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:57:03.203 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:57:03.204 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 4.5833ms
2025-05-10 00:57:03.204 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:57:03.204 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 5.2932ms
2025-05-10 00:57:03.307 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 00:57:03.308 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:03.308 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:03.308 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:57:03.391 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:57:18.288 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:57:18.288 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:18.289 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.249ms
2025-05-10 00:57:18.291 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 00:57:18.291 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:18.291 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:18.291 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:57:18.291 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:57:18.295 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:57:18.296 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:57:18.296 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 4.8323ms
2025-05-10 00:57:18.297 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:57:18.298 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 7.4343ms
2025-05-10 00:57:18.406 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 00:57:18.406 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:18.406 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:18.406 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:57:18.406 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:57:18.408 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:57:18.408 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:57:18.409 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 2.4835ms
2025-05-10 00:57:18.409 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:57:18.409 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 2.904ms
2025-05-10 00:57:18.536 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:57:18.536 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:18.536 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2345ms
2025-05-10 00:57:18.536 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:57:18.536 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:18.537 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1671ms
2025-05-10 00:57:18.538 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:57:18.538 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:18.538 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:18.538 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:57:18.538 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:57:18.541 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:57:18.541 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:57:18.541 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.2373ms
2025-05-10 00:57:18.542 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:57:18.542 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 4.0455ms
2025-05-10 00:57:18.543 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:57:18.543 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:18.543 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:18.543 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:57:18.543 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:57:18.545 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:57:18.546 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:57:18.546 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.2868ms
2025-05-10 00:57:18.546 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:57:18.547 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 3.8183ms
2025-05-10 00:57:18.719 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 00:57:18.719 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:18.720 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:18.720 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:57:18.763 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:57:18.780 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 00:57:20.085 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 00:57:20.085 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:20.085 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.2572ms
2025-05-10 00:57:20.087 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 00:57:20.087 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:20.088 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:20.088 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:57:20.089 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 00:57:20.105 +07:00 [INF] Retrieved 20 messages from Redis for conversation 19
2025-05-10 00:57:20.107 +07:00 [INF] Retrieved 20 messages from Redis for conversation 19 and user 3
2025-05-10 00:57:20.107 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:57:20.108 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 18.9603ms
2025-05-10 00:57:20.108 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:57:20.111 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 24.1653ms
2025-05-10 00:57:20.122 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:57:20.122 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:20.122 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.2429ms
2025-05-10 00:57:20.125 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:57:20.125 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:20.125 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:20.125 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:57:20.125 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:57:20.134 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 00:57:20.135 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 00:57:20.135 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.309ms
2025-05-10 00:57:20.135 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:57:20.135 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 10.2786ms
2025-05-10 00:57:20.144 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:57:20.145 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:20.145 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.1922ms
2025-05-10 00:57:20.146 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:57:20.146 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:20.146 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:57:20.147 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:57:20.147 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 00:57:20.150 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 00:57:20.150 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:57:20.150 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.78ms
2025-05-10 00:57:20.151 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:57:20.151 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 4.44ms
2025-05-10 00:57:30.168 +07:00 [INF] Handling message from user 3: sdfsfas
2025-05-10 00:57:30.177 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 00:57:30.182 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 00:57:30.189 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 00:57:30.190 +07:00 [INF] Message saved to DB with ID: 212
2025-05-10 00:57:30.192 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 00:57:30.200 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 00:57:30.202 +07:00 [INF] Transaction committed for message: 212
2025-05-10 00:57:30.212 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:57:30.215 +07:00 [INF] Saved message 212 to Redis
2025-05-10 00:57:30.216 +07:00 [INF] Added message 212 to conversation 19
2025-05-10 00:57:30.217 +07:00 [INF] Published message to channel conversation:19
2025-05-10 00:58:42.413 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:58:42.413 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:42.414 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 1.5803ms
2025-05-10 00:58:42.416 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 00:58:42.416 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:42.416 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:42.417 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:58:42.420 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:58:42.449 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:58:42.452 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:58:42.452 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 31.8692ms
2025-05-10 00:58:42.452 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:58:42.453 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 36.6596ms
2025-05-10 00:58:42.608 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 00:58:42.609 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:42.609 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:42.609 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:58:42.609 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:58:42.619 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:58:42.619 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:58:42.619 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.3827ms
2025-05-10 00:58:42.619 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:58:42.620 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 11.9552ms
2025-05-10 00:58:42.839 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:58:42.839 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:42.839 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.2314ms
2025-05-10 00:58:42.842 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:58:42.842 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:58:42.842 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:42.842 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:42.843 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.2146ms
2025-05-10 00:58:42.843 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:42.843 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:58:42.843 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:58:42.866 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:58:42.867 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:58:42.867 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 23.8992ms
2025-05-10 00:58:42.867 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:58:42.867 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 24.9748ms
2025-05-10 00:58:42.868 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:58:42.869 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:42.869 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:42.869 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:58:42.869 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:58:42.871 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:58:42.872 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:58:42.872 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.5057ms
2025-05-10 00:58:42.872 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:58:42.872 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.0624ms
2025-05-10 00:58:43.099 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 00:58:43.099 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:43.099 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:43.099 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:58:43.204 +07:00 [INF] Executed DbCommand (48ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:58:55.067 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:58:55.067 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:55.067 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.24ms
2025-05-10 00:58:55.068 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 00:58:55.068 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:55.069 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:55.069 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:58:55.069 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:58:55.085 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:58:55.090 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:58:55.091 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 21.899ms
2025-05-10 00:58:55.091 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:58:55.091 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 22.6309ms
2025-05-10 00:58:55.221 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 00:58:55.221 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:55.221 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:55.221 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:58:55.222 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:58:55.231 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:58:55.231 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:58:55.231 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.5573ms
2025-05-10 00:58:55.231 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:58:55.231 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 10.11ms
2025-05-10 00:58:55.440 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:58:55.440 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:55.440 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1962ms
2025-05-10 00:58:55.442 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:58:55.442 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:55.442 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1732ms
2025-05-10 00:58:55.442 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:58:55.442 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:55.442 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:55.442 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:58:55.442 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:58:55.461 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:58:55.462 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:58:55.463 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 20.259ms
2025-05-10 00:58:55.463 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:58:55.463 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 21.0314ms
2025-05-10 00:58:55.465 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:58:55.465 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:55.465 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:55.465 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:58:55.465 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:58:55.467 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:58:55.468 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:58:55.468 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.8254ms
2025-05-10 00:58:55.468 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:58:55.468 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 3.4655ms
2025-05-10 00:58:55.579 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 00:58:55.579 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:55.580 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:55.580 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:58:55.683 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:58:55.708 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 00:58:57.488 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 00:58:57.488 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:57.488 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.1683ms
2025-05-10 00:58:57.490 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 00:58:57.490 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:57.490 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:57.490 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:58:57.490 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 00:58:57.499 +07:00 [INF] Retrieved 21 messages from Redis for conversation 19
2025-05-10 00:58:57.501 +07:00 [INF] Retrieved 21 messages from Redis for conversation 19 and user 3
2025-05-10 00:58:57.501 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:58:57.501 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 10.6862ms
2025-05-10 00:58:57.501 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 00:58:57.501 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 11.323ms
2025-05-10 00:58:57.514 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:58:57.514 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:57.514 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.2021ms
2025-05-10 00:58:57.516 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 00:58:57.516 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:57.516 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:57.516 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:58:57.516 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:58:57.532 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 00:58:57.534 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 00:58:57.535 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 18.2995ms
2025-05-10 00:58:57.537 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 00:58:57.542 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 26.458ms
2025-05-10 00:58:57.556 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:58:57.556 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:57.556 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.1888ms
2025-05-10 00:58:57.563 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:58:57.563 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:57.564 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:57.564 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:58:57.564 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 00:58:57.579 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 00:58:57.579 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:58:57.579 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 14.7609ms
2025-05-10 00:58:57.579 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:58:57.579 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 16.4897ms
2025-05-10 00:58:59.384 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 00:58:59.384 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:59.384 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:58:59.385 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:58:59.385 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 00:58:59.387 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 00:58:59.388 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:58:59.388 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.5575ms
2025-05-10 00:58:59.388 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 00:58:59.388 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 4.0294ms
2025-05-10 00:59:04.387 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/update_nickname/2/19 - null null
2025-05-10 00:59:04.388 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:04.388 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/update_nickname/2/19 - 204 null null 0.4298ms
2025-05-10 00:59:04.390 +07:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5053/api/Participant/update_nickname/2/19 - application/json 18
2025-05-10 00:59:04.390 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:04.391 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:04.391 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.UpdateNickName (Message_app)'
2025-05-10 00:59:04.434 +07:00 [INF] Route matched with {action = "UpdateNickName", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateNickName(Int32, Int32, server.DTO.NicknameUpdateRequest) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 00:59:04.504 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversation_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__user_id_0 AND [p].[conversation_id] = @__conversation_id_1 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 00:59:04.568 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Participants] SET [name] = @p0
OUTPUT 1
WHERE [id] = @p1;
2025-05-10 00:59:04.645 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__user_id_1='?' (DbType = Int32), @__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) COALESCE((
    SELECT TOP(1) [p].[user_id]
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] <> @__user_id_1 AND [p].[is_deleted] = CAST(0 AS bit)), 0)
FROM [Conversations] AS [c]
WHERE [c].[id] = @__conversation_id_0
2025-05-10 00:59:04.666 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType19`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:59:04.671 +07:00 [INF] Executed action server.Controllers.ParticipantController.UpdateNickName (Message_app) in 237.0441ms
2025-05-10 00:59:04.671 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.UpdateNickName (Message_app)'
2025-05-10 00:59:04.671 +07:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5053/api/Participant/update_nickname/2/19 - 200 null application/json; charset=utf-8 281.2813ms
2025-05-10 00:59:07.460 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:59:07.460 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:07.461 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.364ms
2025-05-10 00:59:07.463 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 00:59:07.463 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:07.463 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:07.463 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:59:07.463 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:59:07.467 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:59:07.467 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:59:07.467 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.6149ms
2025-05-10 00:59:07.467 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:59:07.467 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 4.6168ms
2025-05-10 00:59:44.588 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 00:59:44.588 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:44.588 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.4575ms
2025-05-10 00:59:44.590 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 00:59:44.590 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:44.590 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:44.590 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:59:44.590 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 00:59:44.609 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 00:59:44.621 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 00:59:44.624 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 31.3483ms
2025-05-10 00:59:44.624 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 00:59:44.624 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 34.678ms
2025-05-10 00:59:44.738 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 00:59:44.738 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:44.738 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:44.738 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:59:44.738 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 00:59:44.747 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 00:59:44.748 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 00:59:44.748 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.6434ms
2025-05-10 00:59:44.749 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 00:59:44.749 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 11.5465ms
2025-05-10 00:59:44.907 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:59:44.908 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:44.908 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.8715ms
2025-05-10 00:59:44.909 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:59:44.909 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:44.909 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.1923ms
2025-05-10 00:59:44.913 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:59:44.913 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:44.913 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:44.913 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:59:44.913 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:59:44.963 +07:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:59:44.964 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:59:44.964 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 50.7554ms
2025-05-10 00:59:44.964 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:59:44.964 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 51.6468ms
2025-05-10 00:59:44.966 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 00:59:44.966 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:44.966 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:44.967 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:59:44.967 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 00:59:44.970 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 00:59:44.971 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 00:59:44.971 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 4.151ms
2025-05-10 00:59:44.972 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 00:59:44.972 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 5.5023ms
2025-05-10 00:59:45.062 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 00:59:45.063 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:45.063 +07:00 [INF] CORS policy execution successful.
2025-05-10 00:59:45.063 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 00:59:45.160 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:00:30.027 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:00:30.027 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:30.027 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2149ms
2025-05-10 01:00:30.028 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 01:00:30.029 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:30.029 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:30.029 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:00:30.029 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:00:30.054 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:00:30.055 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:00:30.055 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 25.7827ms
2025-05-10 01:00:30.055 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:00:30.055 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 26.7644ms
2025-05-10 01:00:30.168 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 01:00:30.168 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:30.168 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:30.168 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:00:30.168 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:00:30.181 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:00:30.181 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:00:30.182 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 13.2608ms
2025-05-10 01:00:30.182 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:00:30.182 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 13.6934ms
2025-05-10 01:00:30.385 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:00:30.385 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:30.385 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1708ms
2025-05-10 01:00:30.386 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:00:30.386 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:30.387 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:00:30.387 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:30.387 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:30.387 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:00:30.386 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.166ms
2025-05-10 01:00:30.387 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:00:30.409 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:00:30.409 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:00:30.409 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 22.3188ms
2025-05-10 01:00:30.410 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:00:30.410 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 22.9292ms
2025-05-10 01:00:30.410 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:00:30.411 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:30.411 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:30.411 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:00:30.413 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:00:30.417 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:00:30.418 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:00:30.418 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 4.8692ms
2025-05-10 01:00:30.418 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:00:30.418 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 7.3609ms
2025-05-10 01:00:30.576 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 01:00:30.576 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:30.576 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:30.576 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:00:30.623 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:00:30.646 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 01:00:32.593 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:00:32.593 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:32.593 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.2129ms
2025-05-10 01:00:32.594 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:00:32.596 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:32.596 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:32.596 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:00:32.596 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:00:32.611 +07:00 [INF] Retrieved 21 messages from Redis for conversation 19
2025-05-10 01:00:32.616 +07:00 [INF] Retrieved 21 messages from Redis for conversation 19 and user 3
2025-05-10 01:00:32.616 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:00:32.617 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 20.4611ms
2025-05-10 01:00:32.617 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:00:32.617 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 22.7609ms
2025-05-10 01:00:32.627 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:00:32.627 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:32.627 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.2563ms
2025-05-10 01:00:32.629 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:00:32.629 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:32.630 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:32.636 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:00:32.636 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:00:32.647 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:00:32.653 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:00:32.654 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 17.3205ms
2025-05-10 01:00:32.654 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:00:32.654 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 24.8855ms
2025-05-10 01:00:32.661 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:00:32.661 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:32.662 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.2891ms
2025-05-10 01:00:32.670 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:00:32.670 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:32.670 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:00:32.671 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:00:32.671 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:00:32.683 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:00:32.684 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:00:32.685 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 13.5125ms
2025-05-10 01:00:32.685 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:00:32.685 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 14.9741ms
2025-05-10 01:00:35.954 +07:00 [INF] Handling message from user 3: ád
2025-05-10 01:00:35.987 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 01:00:36.004 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:00:36.025 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 01:00:36.029 +07:00 [INF] Message saved to DB with ID: 213
2025-05-10 01:00:36.030 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:00:36.042 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 01:00:36.043 +07:00 [INF] Transaction committed for message: 213
2025-05-10 01:00:36.050 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:00:36.053 +07:00 [INF] Saved message 213 to Redis
2025-05-10 01:00:36.056 +07:00 [INF] Added message 213 to conversation 19
2025-05-10 01:00:36.057 +07:00 [INF] Published message to channel conversation:19
2025-05-10 01:02:30.883 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:02:30.883 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:30.883 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3122ms
2025-05-10 01:02:30.885 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 01:02:30.885 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:30.885 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:30.885 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:02:30.885 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:02:30.891 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:02:30.892 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:02:30.892 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 6.9792ms
2025-05-10 01:02:30.892 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:02:30.892 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 7.6229ms
2025-05-10 01:02:31.015 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 01:02:31.015 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:31.015 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:31.015 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:02:31.015 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:02:31.023 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:02:31.023 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:02:31.023 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 8.1977ms
2025-05-10 01:02:31.023 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:02:31.024 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 8.7645ms
2025-05-10 01:02:31.167 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:02:31.168 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:31.168 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.7144ms
2025-05-10 01:02:31.170 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:02:31.170 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:31.170 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.1668ms
2025-05-10 01:02:31.170 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:02:31.170 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:31.170 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:31.170 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:02:31.170 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:02:31.186 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:02:31.186 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:02:31.186 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 15.9944ms
2025-05-10 01:02:31.186 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:02:31.186 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 16.4462ms
2025-05-10 01:02:31.188 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:02:31.189 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:31.189 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:31.189 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:02:31.189 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:02:31.192 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:02:31.192 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:02:31.192 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.6567ms
2025-05-10 01:02:31.193 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:02:31.193 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.5151ms
2025-05-10 01:02:31.286 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 01:02:31.286 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:31.286 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:31.286 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:02:31.388 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:02:47.544 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:02:47.544 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:47.544 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 1.3756ms
2025-05-10 01:02:47.545 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 01:02:47.545 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:47.545 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:47.545 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:02:47.546 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:02:47.553 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:02:47.554 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:02:47.554 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 8.6528ms
2025-05-10 01:02:47.554 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:02:47.554 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 9.2632ms
2025-05-10 01:02:47.654 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 01:02:47.654 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:47.654 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:47.654 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:02:47.654 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:02:47.664 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:02:47.664 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:02:47.665 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.7505ms
2025-05-10 01:02:47.665 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:02:47.665 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 11.2825ms
2025-05-10 01:02:47.789 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:02:47.789 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:47.789 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.4172ms
2025-05-10 01:02:47.790 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:02:47.790 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:47.790 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3412ms
2025-05-10 01:02:47.792 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:02:47.792 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:47.792 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:47.792 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:02:47.793 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:02:47.806 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:02:47.807 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:02:47.807 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 14.2494ms
2025-05-10 01:02:47.807 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:02:47.807 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 15.2244ms
2025-05-10 01:02:47.808 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:02:47.809 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:47.809 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:47.809 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:02:47.809 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:02:47.811 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:02:47.812 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:02:47.812 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.4221ms
2025-05-10 01:02:47.812 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:02:47.813 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 4.046ms
2025-05-10 01:02:47.910 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 01:02:47.911 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:47.911 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:47.911 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:02:47.994 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:02:48.004 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 01:02:50.935 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:02:50.935 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:50.935 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.506ms
2025-05-10 01:02:50.937 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:02:50.937 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:50.937 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:50.937 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:02:50.938 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:02:50.949 +07:00 [INF] Retrieved 22 messages from Redis for conversation 19
2025-05-10 01:02:50.949 +07:00 [INF] Retrieved 22 messages from Redis for conversation 19 and user 3
2025-05-10 01:02:50.949 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:02:50.950 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 12.3078ms
2025-05-10 01:02:50.950 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:02:50.950 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 13.0417ms
2025-05-10 01:02:50.964 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:02:50.965 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:50.965 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.7061ms
2025-05-10 01:02:50.967 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:02:50.967 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:50.968 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:50.969 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:02:50.969 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:02:50.976 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:02:50.977 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:02:50.977 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.7443ms
2025-05-10 01:02:50.978 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:02:50.978 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 10.3936ms
2025-05-10 01:02:50.986 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:02:50.986 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:50.986 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.4943ms
2025-05-10 01:02:50.987 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:02:50.988 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:50.988 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:02:50.988 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:02:50.988 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:02:50.992 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:02:50.993 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:02:50.994 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.1241ms
2025-05-10 01:02:50.994 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:02:50.994 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 6.4388ms
2025-05-10 01:02:59.159 +07:00 [INF] Handling message from user 3: abc
2025-05-10 01:02:59.163 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 01:02:59.165 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:02:59.172 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 01:02:59.174 +07:00 [INF] Message saved to DB with ID: 214
2025-05-10 01:02:59.175 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:02:59.180 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 01:02:59.181 +07:00 [INF] Transaction committed for message: 214
2025-05-10 01:02:59.186 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:02:59.191 +07:00 [INF] Saved message 214 to Redis
2025-05-10 01:02:59.191 +07:00 [INF] Added message 214 to conversation 19
2025-05-10 01:02:59.192 +07:00 [INF] Published message to channel conversation:19
2025-05-10 01:06:33.065 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:06:33.065 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:06:33.065 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2736ms
2025-05-10 01:06:33.066 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 01:06:33.067 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:06:33.067 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:06:33.067 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:06:33.067 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:06:33.082 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:06:33.083 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:06:33.083 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 16.466ms
2025-05-10 01:06:33.084 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:06:33.085 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 18.3071ms
2025-05-10 01:06:33.196 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 01:06:33.196 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:06:33.196 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:06:33.196 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:06:33.197 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:06:33.208 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:06:33.208 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:06:33.209 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.5534ms
2025-05-10 01:06:33.209 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:06:33.209 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 12.6521ms
2025-05-10 01:06:33.329 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:06:33.329 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:06:33.329 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.3763ms
2025-05-10 01:06:33.331 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:06:33.331 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:06:33.331 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.2632ms
2025-05-10 01:06:33.331 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:06:33.331 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:06:33.331 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:06:33.332 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:06:33.332 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:06:33.347 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:06:33.347 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:06:33.347 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 15.5254ms
2025-05-10 01:06:33.347 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:06:33.347 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 16.1195ms
2025-05-10 01:06:33.349 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:06:33.349 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:06:33.349 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:06:33.349 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:06:33.349 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:06:33.352 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:06:33.352 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:06:33.353 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.5937ms
2025-05-10 01:06:33.353 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:06:33.353 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.2294ms
2025-05-10 01:06:33.448 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 01:06:33.449 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:06:33.449 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:06:33.449 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:06:33.532 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:07:09.304 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:07:09.304 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:09.304 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2374ms
2025-05-10 01:07:09.305 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 01:07:09.306 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:09.306 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:09.306 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:07:09.306 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:07:09.308 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:07:09.309 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:07:09.309 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 2.6866ms
2025-05-10 01:07:09.309 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:07:09.309 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 3.3957ms
2025-05-10 01:07:09.416 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 01:07:09.416 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:09.416 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:09.416 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:07:09.416 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:07:09.419 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:07:09.420 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:07:09.420 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 3.4913ms
2025-05-10 01:07:09.420 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:07:09.420 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 4.1378ms
2025-05-10 01:07:09.553 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:07:09.553 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:09.553 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1628ms
2025-05-10 01:07:09.554 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:07:09.554 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:09.554 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:09.554 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:07:09.555 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:07:09.557 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:07:09.557 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:07:09.557 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.3853ms
2025-05-10 01:07:09.557 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:07:09.557 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 2.9654ms
2025-05-10 01:07:09.561 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:07:09.561 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:09.561 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:09.561 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:07:09.561 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:07:09.564 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:07:09.564 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:07:09.564 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.6463ms
2025-05-10 01:07:09.564 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:07:09.564 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 3.2173ms
2025-05-10 01:07:09.734 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 01:07:09.735 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:09.735 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:09.735 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:07:09.783 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:07:09.792 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 01:07:10.982 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:07:10.982 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:10.982 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.1808ms
2025-05-10 01:07:10.983 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:07:10.983 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:10.983 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:10.983 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:07:10.984 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:07:10.998 +07:00 [INF] Retrieved 23 messages from Redis for conversation 19
2025-05-10 01:07:10.998 +07:00 [INF] Retrieved 23 messages from Redis for conversation 19 and user 3
2025-05-10 01:07:10.998 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:07:10.998 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 14.2175ms
2025-05-10 01:07:10.998 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:07:10.998 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 15.2388ms
2025-05-10 01:07:11.011 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:07:11.011 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:11.012 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.2008ms
2025-05-10 01:07:11.014 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:07:11.014 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:11.014 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:11.014 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:07:11.015 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:07:11.021 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:07:11.025 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:07:11.026 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 11.1253ms
2025-05-10 01:07:11.026 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:07:11.026 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 12.5653ms
2025-05-10 01:07:11.035 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:07:11.035 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:11.035 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.3155ms
2025-05-10 01:07:11.037 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:07:11.037 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:11.037 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:07:11.037 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:07:11.037 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:07:11.044 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:07:11.045 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:07:11.045 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.2516ms
2025-05-10 01:07:11.045 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:07:11.045 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 8.4826ms
2025-05-10 01:07:25.151 +07:00 [INF] Handling message from user 3: asfs
2025-05-10 01:07:25.158 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 01:07:25.163 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:07:25.168 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 01:07:25.169 +07:00 [INF] Message saved to DB with ID: 215
2025-05-10 01:07:25.169 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:07:25.174 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 01:07:25.175 +07:00 [INF] Transaction committed for message: 215
2025-05-10 01:07:25.180 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:07:25.188 +07:00 [INF] Saved message 215 to Redis
2025-05-10 01:07:25.189 +07:00 [INF] Added message 215 to conversation 19
2025-05-10 01:07:25.190 +07:00 [INF] Published message to channel conversation:19
2025-05-10 01:09:42.286 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:09:42.287 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:42.287 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2035ms
2025-05-10 01:09:42.288 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 01:09:42.288 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:42.288 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:42.288 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:09:42.288 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:09:42.298 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:09:42.299 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:09:42.299 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 11.2746ms
2025-05-10 01:09:42.299 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:09:42.300 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 11.9012ms
2025-05-10 01:09:42.396 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 01:09:42.396 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:42.396 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:42.396 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:09:42.396 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:09:42.405 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:09:42.405 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:09:42.405 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 8.842ms
2025-05-10 01:09:42.405 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:09:42.405 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 9.258ms
2025-05-10 01:09:42.520 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:09:42.520 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:42.520 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.3728ms
2025-05-10 01:09:42.521 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:09:42.521 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:42.521 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.2003ms
2025-05-10 01:09:42.522 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:09:42.522 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:42.522 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:42.522 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:09:42.522 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:09:42.552 +07:00 [INF] Executed DbCommand (29ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:09:42.552 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:09:42.552 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 30.0291ms
2025-05-10 01:09:42.552 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:09:42.553 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 30.6368ms
2025-05-10 01:09:42.554 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:09:42.554 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:42.554 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:42.554 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:09:42.555 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:09:42.556 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:09:42.556 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:09:42.557 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.9822ms
2025-05-10 01:09:42.557 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:09:42.557 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 2.4284ms
2025-05-10 01:09:42.658 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 01:09:42.658 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:42.658 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:42.658 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:09:42.745 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:09:55.061 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:09:55.061 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:55.062 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.7428ms
2025-05-10 01:09:55.063 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 01:09:55.063 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:55.063 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:55.063 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:09:55.063 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:09:55.077 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:09:55.078 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:09:55.081 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 17.1125ms
2025-05-10 01:09:55.081 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:09:55.082 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 18.4577ms
2025-05-10 01:09:55.181 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 01:09:55.181 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:55.181 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:55.181 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:09:55.181 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:09:55.192 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:09:55.192 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:09:55.192 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.8357ms
2025-05-10 01:09:55.192 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:09:55.192 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 11.1582ms
2025-05-10 01:09:55.314 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:09:55.315 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:55.315 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1939ms
2025-05-10 01:09:55.317 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:09:55.317 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:55.317 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1934ms
2025-05-10 01:09:55.318 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:09:55.318 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:55.318 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:55.318 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:09:55.318 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:09:55.334 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:09:55.334 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:09:55.334 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 15.9675ms
2025-05-10 01:09:55.334 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:09:55.334 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 16.4305ms
2025-05-10 01:09:55.335 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:09:55.335 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:55.335 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:55.335 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:09:55.335 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:09:55.337 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:09:55.337 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:09:55.337 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.8291ms
2025-05-10 01:09:55.337 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:09:55.337 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 2.1658ms
2025-05-10 01:09:55.445 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 01:09:55.445 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:55.445 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:55.445 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:09:55.541 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:09:55.551 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 01:09:57.501 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:09:57.501 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:57.502 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.1964ms
2025-05-10 01:09:57.503 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:09:57.503 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:57.503 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:57.503 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:09:57.503 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:09:57.509 +07:00 [INF] Retrieved 24 messages from Redis for conversation 19
2025-05-10 01:09:57.509 +07:00 [INF] Retrieved 24 messages from Redis for conversation 19 and user 3
2025-05-10 01:09:57.509 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:09:57.509 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 6.2695ms
2025-05-10 01:09:57.509 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:09:57.510 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 7.0286ms
2025-05-10 01:09:57.520 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:09:57.520 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:57.520 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.1845ms
2025-05-10 01:09:57.522 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:09:57.522 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:57.522 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:57.522 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:09:57.522 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:09:57.528 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:09:57.530 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:09:57.530 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.0606ms
2025-05-10 01:09:57.530 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:09:57.530 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 8.6804ms
2025-05-10 01:09:57.537 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:09:57.537 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:57.537 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.2477ms
2025-05-10 01:09:57.538 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:09:57.538 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:57.539 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:09:57.539 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:09:57.539 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:09:57.543 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:09:57.544 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:09:57.544 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.6716ms
2025-05-10 01:09:57.545 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:09:57.545 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 6.6386ms
2025-05-10 01:10:05.269 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/2 - null null
2025-05-10 01:10:05.269 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:10:05.269 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/2 - 204 null null 0.2146ms
2025-05-10 01:10:05.271 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/2 - null null
2025-05-10 01:10:05.271 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:10:05.271 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:10:05.271 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:10:05.271 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:10:05.277 +07:00 [INF] Retrieved 24 messages from Redis for conversation 19
2025-05-10 01:10:05.277 +07:00 [INF] Retrieved 24 messages from Redis for conversation 19 and user 2
2025-05-10 01:10:05.277 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:10:05.278 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 6.8335ms
2025-05-10 01:10:05.278 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:10:05.278 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/2 - 200 null application/json; charset=utf-8 7.2664ms
2025-05-10 01:10:05.288 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:10:05.288 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:10:05.288 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.2217ms
2025-05-10 01:10:05.290 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:10:05.290 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:10:05.290 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:10:05.290 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:10:05.290 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:10:05.297 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:10:05.298 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:10:05.298 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.546ms
2025-05-10 01:10:05.298 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:10:05.298 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 8.4129ms
2025-05-10 01:10:05.309 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:10:05.309 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:10:05.309 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.241ms
2025-05-10 01:10:05.312 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:10:05.312 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:10:05.312 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:10:05.312 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:10:05.312 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:10:05.318 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:10:05.318 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:10:05.318 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.1287ms
2025-05-10 01:10:05.318 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:10:05.318 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 6.9523ms
2025-05-10 01:10:13.209 +07:00 [INF] Handling message from user 2: asd
2025-05-10 01:10:13.218 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 01:10:13.222 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:10:13.232 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 01:10:13.232 +07:00 [INF] Message saved to DB with ID: 216
2025-05-10 01:10:13.233 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:10:13.239 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 01:10:13.240 +07:00 [INF] Transaction committed for message: 216
2025-05-10 01:10:13.244 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:10:13.246 +07:00 [INF] Saved message 216 to Redis
2025-05-10 01:10:13.246 +07:00 [INF] Added message 216 to conversation 19
2025-05-10 01:10:13.247 +07:00 [INF] Published message to channel conversation:19
2025-05-10 01:12:12.511 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:12:12.511 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:12.511 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.251ms
2025-05-10 01:12:12.512 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 01:12:12.512 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:12.512 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:12.512 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:12:12.512 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:12:12.518 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:12:12.518 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:12:12.519 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 5.9732ms
2025-05-10 01:12:12.519 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:12:12.519 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 6.5618ms
2025-05-10 01:12:12.624 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 01:12:12.624 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:12.624 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:12.624 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:12:12.624 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:12:12.634 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:12:12.634 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:12:12.634 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.7968ms
2025-05-10 01:12:12.634 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:12:12.635 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 10.7343ms
2025-05-10 01:12:12.757 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:12:12.757 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:12.757 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.2671ms
2025-05-10 01:12:12.758 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:12:12.758 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:12.758 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.2367ms
2025-05-10 01:12:12.759 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:12:12.759 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:12.759 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:12.759 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:12:12.759 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:12:12.775 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:12:12.775 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:12:12.776 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 16.4791ms
2025-05-10 01:12:12.776 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:12:12.776 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 16.9171ms
2025-05-10 01:12:12.777 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:12:12.777 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:12.777 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:12.777 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:12:12.777 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:12:12.782 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:12:12.782 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:12:12.782 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 5.0019ms
2025-05-10 01:12:12.783 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:12:12.783 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 5.5372ms
2025-05-10 01:12:12.933 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 01:12:12.933 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:12.933 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:12.933 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:12:13.017 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:12:24.494 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:12:24.494 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:24.494 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.1803ms
2025-05-10 01:12:24.495 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 01:12:24.495 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:24.495 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:24.495 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:12:24.496 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:12:24.501 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:12:24.501 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:12:24.502 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 5.8633ms
2025-05-10 01:12:24.502 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:12:24.502 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 6.7268ms
2025-05-10 01:12:24.603 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 01:12:24.603 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:24.604 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:24.604 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:12:24.604 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:12:24.613 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:12:24.613 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:12:24.613 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.3651ms
2025-05-10 01:12:24.613 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:12:24.613 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 10.1867ms
2025-05-10 01:12:24.737 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:12:24.737 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:24.737 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3241ms
2025-05-10 01:12:24.738 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:12:24.738 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:24.738 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2106ms
2025-05-10 01:12:24.739 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:12:24.739 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:24.739 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:24.739 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:12:24.739 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:12:24.754 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:12:24.755 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:12:24.755 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 15.3805ms
2025-05-10 01:12:24.755 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:12:24.755 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 16.363ms
2025-05-10 01:12:24.756 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:12:24.757 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:24.757 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:24.757 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:12:24.758 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:12:24.761 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:12:24.761 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:12:24.761 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.421ms
2025-05-10 01:12:24.761 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:12:24.762 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 5.1248ms
2025-05-10 01:12:24.856 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 01:12:24.856 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:24.856 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:24.856 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:12:24.965 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:12:24.972 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 01:12:26.124 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:12:26.124 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:26.124 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.2067ms
2025-05-10 01:12:26.125 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:12:26.125 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:26.125 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:26.125 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:12:26.125 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:12:26.133 +07:00 [INF] Retrieved 25 messages from Redis for conversation 19
2025-05-10 01:12:26.133 +07:00 [INF] Retrieved 25 messages from Redis for conversation 19 and user 3
2025-05-10 01:12:26.133 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:12:26.133 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 7.6649ms
2025-05-10 01:12:26.133 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:12:26.133 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 8.1587ms
2025-05-10 01:12:26.142 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:12:26.142 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:26.142 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.182ms
2025-05-10 01:12:26.144 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:12:26.144 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:26.144 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:26.144 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:12:26.144 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:12:26.150 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:12:26.151 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:12:26.151 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.6983ms
2025-05-10 01:12:26.152 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:12:26.152 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 8.1274ms
2025-05-10 01:12:26.157 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:12:26.157 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:26.157 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.1972ms
2025-05-10 01:12:26.158 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:12:26.159 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:26.159 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:12:26.159 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:12:26.159 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:12:26.164 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:12:26.164 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:12:26.165 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.6932ms
2025-05-10 01:12:26.165 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:12:26.166 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 7.1333ms
2025-05-10 01:12:31.206 +07:00 [INF] Handling message from user 3: aaa
2025-05-10 01:12:31.213 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 01:12:31.216 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:12:31.220 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 01:12:31.221 +07:00 [INF] Message saved to DB with ID: 217
2025-05-10 01:12:31.221 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:12:31.227 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 01:12:31.228 +07:00 [INF] Transaction committed for message: 217
2025-05-10 01:12:31.233 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:12:31.234 +07:00 [INF] Saved message 217 to Redis
2025-05-10 01:12:31.235 +07:00 [INF] Added message 217 to conversation 19
2025-05-10 01:12:31.240 +07:00 [INF] Published message to channel conversation:19
2025-05-10 01:24:10.884 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:24:10.884 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:10.884 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2392ms
2025-05-10 01:24:10.885 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 01:24:10.885 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:10.885 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:10.885 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:24:10.886 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:24:11.071 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:24:11.072 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:24:11.072 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 186.2607ms
2025-05-10 01:24:11.072 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:24:11.072 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 187.0704ms
2025-05-10 01:24:11.190 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 01:24:11.190 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:11.190 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:11.190 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:24:11.190 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:24:11.201 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:24:11.202 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:24:11.202 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.4542ms
2025-05-10 01:24:11.202 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:24:11.202 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 11.8945ms
2025-05-10 01:24:11.334 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:24:11.334 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:11.334 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.1945ms
2025-05-10 01:24:11.336 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:24:11.336 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:11.336 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:24:11.336 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.2464ms
2025-05-10 01:24:11.336 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:11.336 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:11.337 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:24:11.337 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:24:11.354 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:24:11.354 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:24:11.354 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 17.3636ms
2025-05-10 01:24:11.354 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:24:11.354 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 17.7693ms
2025-05-10 01:24:11.356 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:24:11.356 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:11.356 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:11.356 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:24:11.356 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:24:11.361 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:24:11.361 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:24:11.361 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 4.4861ms
2025-05-10 01:24:11.361 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:24:11.361 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 5.488ms
2025-05-10 01:24:11.491 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 01:24:11.491 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:11.491 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:11.491 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:24:11.578 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:24:23.950 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:24:23.950 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:23.950 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2763ms
2025-05-10 01:24:23.951 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 01:24:23.951 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:23.952 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:23.952 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:24:23.952 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:24:23.958 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:24:23.959 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:24:23.959 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 6.8785ms
2025-05-10 01:24:23.959 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:24:23.959 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 7.724ms
2025-05-10 01:24:24.065 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 01:24:24.065 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:24.066 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:24.066 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:24:24.066 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:24:24.075 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:24:24.075 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:24:24.075 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.4736ms
2025-05-10 01:24:24.075 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:24:24.075 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 10.1672ms
2025-05-10 01:24:24.200 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:24:24.200 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:24.200 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2636ms
2025-05-10 01:24:24.202 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:24:24.202 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:24.202 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:24:24.202 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:24.203 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1601ms
2025-05-10 01:24:24.203 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:24.203 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:24:24.203 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:24:24.219 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:24:24.220 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:24:24.220 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 17.0847ms
2025-05-10 01:24:24.220 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:24:24.220 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 17.8565ms
2025-05-10 01:24:24.221 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:24:24.221 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:24.221 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:24.222 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:24:24.222 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:24:24.224 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:24:24.224 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:24:24.225 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.9653ms
2025-05-10 01:24:24.225 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:24:24.225 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 3.7482ms
2025-05-10 01:24:24.337 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 01:24:24.337 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:24.337 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:24.337 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:24:24.429 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:24:24.438 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 01:24:25.714 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:24:25.714 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:25.714 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.2916ms
2025-05-10 01:24:25.716 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:24:25.716 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:25.716 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:25.716 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:24:25.717 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:24:25.729 +07:00 [INF] Retrieved 26 messages from Redis for conversation 19
2025-05-10 01:24:25.729 +07:00 [INF] Retrieved 26 messages from Redis for conversation 19 and user 3
2025-05-10 01:24:25.729 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:24:25.730 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 13.0111ms
2025-05-10 01:24:25.730 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:24:25.730 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 14.1095ms
2025-05-10 01:24:25.741 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:24:25.741 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:25.741 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.2566ms
2025-05-10 01:24:25.743 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:24:25.743 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:25.743 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:25.743 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:24:25.743 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:24:25.751 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:24:25.752 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:24:25.753 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.2738ms
2025-05-10 01:24:25.753 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:24:25.753 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 10.0374ms
2025-05-10 01:24:25.759 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:24:25.759 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:25.760 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.428ms
2025-05-10 01:24:25.761 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:24:25.762 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:25.762 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:24:25.762 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:24:25.762 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:24:25.765 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:24:25.766 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:24:25.766 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.0531ms
2025-05-10 01:24:25.766 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:24:25.767 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 5.1623ms
2025-05-10 01:24:29.564 +07:00 [INF] Handling message from user 3: ddd
2025-05-10 01:24:29.574 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 01:24:29.578 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:24:29.585 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 01:24:29.587 +07:00 [INF] Message saved to DB with ID: 218
2025-05-10 01:24:29.587 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:24:29.593 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 01:24:29.594 +07:00 [INF] Transaction committed for message: 218
2025-05-10 01:24:29.599 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:24:29.602 +07:00 [INF] Saved message 218 to Redis
2025-05-10 01:24:29.602 +07:00 [INF] Added message 218 to conversation 19
2025-05-10 01:24:29.602 +07:00 [INF] Published message to channel conversation:19
2025-05-10 01:25:03.664 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:25:03.664 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:25:03.665 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.4982ms
2025-05-10 01:25:03.666 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:25:03.666 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:25:03.666 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:25:03.667 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:25:03.667 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:25:03.677 +07:00 [INF] Retrieved 27 messages from Redis for conversation 19
2025-05-10 01:25:03.677 +07:00 [INF] Retrieved 27 messages from Redis for conversation 19 and user 3
2025-05-10 01:25:03.678 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:25:03.678 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 11.0263ms
2025-05-10 01:25:03.678 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:25:03.678 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 12.1868ms
2025-05-10 01:25:03.689 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:25:03.689 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:25:03.689 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.1872ms
2025-05-10 01:25:03.690 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:25:03.691 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:25:03.691 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:25:03.691 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:25:03.693 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:25:03.702 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:25:03.704 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:25:03.704 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.6129ms
2025-05-10 01:25:03.704 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:25:03.704 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 13.8943ms
2025-05-10 01:25:03.709 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:25:03.710 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:25:03.710 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.2727ms
2025-05-10 01:25:03.711 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:25:03.711 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:25:03.711 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:25:03.711 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:25:03.711 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:25:03.715 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:25:03.715 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:25:03.715 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.5972ms
2025-05-10 01:25:03.715 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:25:03.715 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 4.2777ms
2025-05-10 01:25:11.111 +07:00 [INF] Handling message from user 3: asda
2025-05-10 01:25:11.115 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 01:25:11.117 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:25:11.122 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 01:25:11.124 +07:00 [INF] Message saved to DB with ID: 219
2025-05-10 01:25:11.124 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:25:11.129 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 01:25:11.130 +07:00 [INF] Transaction committed for message: 219
2025-05-10 01:25:11.134 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:25:11.136 +07:00 [INF] Saved message 219 to Redis
2025-05-10 01:25:11.138 +07:00 [INF] Added message 219 to conversation 19
2025-05-10 01:25:11.139 +07:00 [INF] Published message to channel conversation:19
2025-05-10 01:28:02.368 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:02.369 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:02.369 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1955969.2078ms
2025-05-10 01:28:02.369 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1746789.4849ms
2025-05-10 01:28:02.370 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:02.370 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 218033.2756ms
2025-05-10 01:28:02.370 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:02.370 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1086925.4653ms
2025-05-10 01:28:02.370 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:02.370 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1843651.1581ms
2025-05-10 01:28:02.370 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:02.371 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:02.371 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1252636.1047ms
2025-05-10 01:28:02.371 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 2133785.6259ms
2025-05-10 01:28:02.371 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:02.371 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 937515.1317ms
2025-05-10 01:28:02.371 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:02.372 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1651795.5504ms
2025-05-10 01:28:02.372 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:02.372 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1514461.9324ms
2025-05-10 01:28:02.373 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:02.373 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 2523827.0461ms
2025-05-10 01:28:04.959 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:04.960 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:04.960 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 952026.6146ms
2025-05-10 01:28:04.960 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 2723217.2906ms
2025-05-10 01:28:04.961 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:04.961 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 1761862.1491ms
2025-05-10 01:28:04.963 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:04.963 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 233471.8452ms
2025-05-10 01:28:04.965 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:04.965 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 1699902.8607ms
2025-05-10 01:28:04.966 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:04.966 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 1102308.0141ms
2025-05-10 01:28:04.966 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:04.966 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 1971625.5425ms
2025-05-10 01:28:04.966 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:04.966 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 2147192.7276ms
2025-05-10 01:28:04.966 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:04.966 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 1291517.9424ms
2025-05-10 01:28:04.967 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:04.967 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 1861659.4974ms
2025-05-10 01:28:04.967 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:04.967 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 2448738.5791ms
2025-05-10 01:28:04.967 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:28:04.967 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 1533681.7166ms
2025-05-10 01:29:16.243 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:29:16.244 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:16.244 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 1.0184ms
2025-05-10 01:29:16.245 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 01:29:16.245 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:16.246 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:16.246 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:29:16.246 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:29:16.263 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:29:16.267 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-05-10 01:29:16.267 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 20.9268ms
2025-05-10 01:29:16.268 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:29:16.268 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 400 null application/json; charset=utf-8 22.4149ms
2025-05-10 01:29:22.688 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:29:22.688 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:22.688 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3853ms
2025-05-10 01:29:22.690 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 01:29:22.691 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:22.692 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:22.692 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:29:22.693 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:29:22.703 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:29:22.709 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:29:22.712 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 18.3286ms
2025-05-10 01:29:22.712 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:29:22.713 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 22.6738ms
2025-05-10 01:29:22.851 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 01:29:22.851 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:22.851 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:22.852 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:29:22.852 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:29:22.859 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:29:22.859 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:29:22.860 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 8.6406ms
2025-05-10 01:29:22.860 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:29:22.861 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 9.6152ms
2025-05-10 01:29:23.079 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:29:23.079 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:23.079 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.3137ms
2025-05-10 01:29:23.080 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:29:23.081 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:29:23.081 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:23.081 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:23.081 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:23.081 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:29:23.081 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.3915ms
2025-05-10 01:29:23.081 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:29:23.102 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:29:23.102 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:29:23.102 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 21.5571ms
2025-05-10 01:29:23.103 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:29:23.103 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 21.9913ms
2025-05-10 01:29:23.104 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:29:23.104 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:23.104 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:23.104 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:29:23.105 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:29:23.106 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:29:23.107 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:29:23.108 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.5191ms
2025-05-10 01:29:23.108 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:29:23.109 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.3038ms
2025-05-10 01:29:23.280 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 01:29:23.281 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:23.281 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:23.281 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:29:23.397 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:29:33.589 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:29:33.589 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:33.589 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.1731ms
2025-05-10 01:29:33.590 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 01:29:33.590 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:33.590 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:33.591 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:29:33.591 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:29:33.596 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:29:33.597 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-05-10 01:29:33.597 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 5.9796ms
2025-05-10 01:29:33.597 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:29:33.597 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 400 null application/json; charset=utf-8 6.8139ms
2025-05-10 01:29:40.886 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:29:40.886 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:40.886 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.259ms
2025-05-10 01:29:40.887 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 01:29:40.888 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:40.889 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:40.889 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:29:40.889 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:29:40.905 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:29:40.908 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:29:40.909 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 20.5841ms
2025-05-10 01:29:40.910 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:29:40.910 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 23.3416ms
2025-05-10 01:29:41.065 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 01:29:41.065 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:41.065 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:41.065 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:29:41.065 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:29:41.076 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:29:41.077 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:29:41.077 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.4688ms
2025-05-10 01:29:41.077 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:29:41.077 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 11.9138ms
2025-05-10 01:29:41.325 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:29:41.325 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:41.325 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3315ms
2025-05-10 01:29:41.328 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:29:41.328 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:41.328 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:29:41.328 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1988ms
2025-05-10 01:29:41.328 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:41.328 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:41.328 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:29:41.328 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:29:41.350 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:29:41.350 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:29:41.350 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 22.329ms
2025-05-10 01:29:41.350 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:29:41.351 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 22.6663ms
2025-05-10 01:29:41.352 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:29:41.352 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:41.352 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:41.352 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:29:41.352 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:29:41.354 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:29:41.355 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:29:41.355 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.6889ms
2025-05-10 01:29:41.355 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:29:41.355 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 3.1349ms
2025-05-10 01:29:41.383 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 01:29:41.384 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:41.384 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:29:41.384 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:29:41.509 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:29:41.522 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 01:30:00.055 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/2 - null null
2025-05-10 01:30:00.055 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:00.055 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/2 - 204 null null 0.2421ms
2025-05-10 01:30:00.058 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/2 - null null
2025-05-10 01:30:00.061 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:00.063 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:00.064 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:30:00.064 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:30:00.086 +07:00 [INF] Retrieved 28 messages from Redis for conversation 19
2025-05-10 01:30:00.086 +07:00 [INF] Retrieved 28 messages from Redis for conversation 19 and user 2
2025-05-10 01:30:00.087 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:30:00.088 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 23.9186ms
2025-05-10 01:30:00.088 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:30:00.088 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/2 - 200 null application/json; charset=utf-8 30.038ms
2025-05-10 01:30:00.112 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:30:00.113 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:00.113 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.1944ms
2025-05-10 01:30:00.114 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:30:00.114 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:00.114 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:00.114 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:30:00.114 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:30:00.122 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:30:00.123 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:30:00.123 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.0897ms
2025-05-10 01:30:00.123 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:30:00.124 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 9.6711ms
2025-05-10 01:30:00.132 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:30:00.132 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:00.132 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.4655ms
2025-05-10 01:30:00.133 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:30:00.134 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:00.134 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:00.134 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:30:00.134 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:30:00.140 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:30:00.140 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:30:00.140 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.1025ms
2025-05-10 01:30:00.140 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:30:00.140 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 7.0274ms
2025-05-10 01:30:05.357 +07:00 [INF] Handling message from user 2: sdfs
2025-05-10 01:30:05.365 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 01:30:05.382 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:30:05.389 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 01:30:05.389 +07:00 [INF] Message saved to DB with ID: 220
2025-05-10 01:30:05.393 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:30:05.402 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 01:30:05.403 +07:00 [INF] Transaction committed for message: 220
2025-05-10 01:30:05.408 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:30:05.414 +07:00 [INF] Saved message 220 to Redis
2025-05-10 01:30:05.415 +07:00 [INF] Added message 220 to conversation 19
2025-05-10 01:30:05.416 +07:00 [INF] Published message to channel conversation:19
2025-05-10 01:30:29.289 +07:00 [INF] Handling message from user 2: asdad
2025-05-10 01:30:29.297 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 01:30:29.299 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:30:29.306 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 01:30:29.306 +07:00 [INF] Message saved to DB with ID: 221
2025-05-10 01:30:29.306 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:30:29.312 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 01:30:29.313 +07:00 [INF] Transaction committed for message: 221
2025-05-10 01:30:29.318 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:30:29.322 +07:00 [INF] Saved message 221 to Redis
2025-05-10 01:30:29.322 +07:00 [INF] Added message 221 to conversation 19
2025-05-10 01:30:29.323 +07:00 [INF] Published message to channel conversation:19
2025-05-10 01:30:54.654 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:30:54.654 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:54.654 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.3213ms
2025-05-10 01:30:54.656 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:30:54.656 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:54.657 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:54.657 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:30:54.657 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:30:54.678 +07:00 [INF] Retrieved 30 messages from Redis for conversation 19
2025-05-10 01:30:54.678 +07:00 [INF] Retrieved 30 messages from Redis for conversation 19 and user 3
2025-05-10 01:30:54.678 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:30:54.679 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 21.6925ms
2025-05-10 01:30:54.679 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:30:54.679 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 23.1976ms
2025-05-10 01:30:54.692 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:30:54.692 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:54.692 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.1959ms
2025-05-10 01:30:54.693 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:30:54.693 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:54.694 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:54.694 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:30:54.694 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:30:54.710 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:30:54.712 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:30:54.712 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 17.8817ms
2025-05-10 01:30:54.712 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:30:54.713 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 19.2372ms
2025-05-10 01:30:54.721 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:30:54.721 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:54.721 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.1983ms
2025-05-10 01:30:54.722 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:30:54.722 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:54.723 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:30:54.723 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:30:54.723 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:30:54.727 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:30:54.727 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:30:54.728 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.4285ms
2025-05-10 01:30:54.728 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:30:54.729 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 7.1174ms
2025-05-10 01:31:00.279 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/2 - null null
2025-05-10 01:31:00.280 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:31:00.282 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/2 - 204 null null 2.1941ms
2025-05-10 01:31:00.284 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/2 - null null
2025-05-10 01:31:00.284 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:31:00.284 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:31:00.284 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:31:00.285 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:31:00.321 +07:00 [INF] Retrieved 30 messages from Redis for conversation 19
2025-05-10 01:31:00.322 +07:00 [INF] Retrieved 30 messages from Redis for conversation 19 and user 2
2025-05-10 01:31:00.322 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:31:00.322 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 36.8685ms
2025-05-10 01:31:00.322 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:31:00.322 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/2 - 200 null application/json; charset=utf-8 38.553ms
2025-05-10 01:31:00.334 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:31:00.334 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:31:00.334 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.2338ms
2025-05-10 01:31:00.335 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:31:00.335 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:31:00.335 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:31:00.335 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:31:00.335 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:31:00.338 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:31:00.338 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:31:00.338 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 2.6561ms
2025-05-10 01:31:00.338 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:31:00.338 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 3.1967ms
2025-05-10 01:31:00.346 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:31:00.347 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:31:00.347 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.2554ms
2025-05-10 01:31:00.348 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:31:00.348 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:31:00.349 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:31:00.349 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:31:00.349 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:31:00.350 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:31:00.350 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:31:00.350 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 1.7547ms
2025-05-10 01:31:00.350 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:31:00.351 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 2.3939ms
2025-05-10 01:31:07.786 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 01:31:07.787 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:31:07.787 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:31:07.787 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:31:07.803 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:33:37.610 +07:00 [INF] Handling message from user 2: asd
2025-05-10 01:33:37.633 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 01:33:37.650 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:33:37.657 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 01:33:37.659 +07:00 [INF] Message saved to DB with ID: 222
2025-05-10 01:33:37.662 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:33:37.668 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 01:33:37.670 +07:00 [INF] Transaction committed for message: 222
2025-05-10 01:33:37.676 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:33:37.677 +07:00 [INF] Saved message 222 to Redis
2025-05-10 01:33:37.678 +07:00 [INF] Added message 222 to conversation 19
2025-05-10 01:33:37.679 +07:00 [INF] Published message to channel conversation:19
2025-05-10 01:33:45.922 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:33:45.922 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:33:45.923 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.3621ms
2025-05-10 01:33:45.924 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:33:45.924 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:33:45.924 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:33:45.925 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:33:45.925 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:33:45.936 +07:00 [INF] Retrieved 31 messages from Redis for conversation 19
2025-05-10 01:33:45.937 +07:00 [INF] Retrieved 31 messages from Redis for conversation 19 and user 3
2025-05-10 01:33:45.937 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:33:45.937 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 12.1762ms
2025-05-10 01:33:45.937 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:33:45.937 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 12.7709ms
2025-05-10 01:33:45.953 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:33:45.953 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:33:45.953 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.2019ms
2025-05-10 01:33:45.955 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:33:45.955 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:33:45.955 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:33:45.955 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:33:45.955 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:33:45.970 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:33:45.971 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:33:45.971 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 16.2053ms
2025-05-10 01:33:45.971 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:33:45.972 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 16.8246ms
2025-05-10 01:33:45.978 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:33:45.978 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:33:45.979 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.1774ms
2025-05-10 01:33:45.980 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:33:45.981 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:33:45.981 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:33:45.981 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:33:45.981 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:33:45.986 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:33:45.987 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:33:45.987 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.1318ms
2025-05-10 01:33:45.989 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:33:45.989 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 9.5696ms
2025-05-10 01:33:49.215 +07:00 [INF] Handling message from user 3: kjs
2025-05-10 01:33:49.221 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 01:33:49.223 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:33:49.230 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 01:33:49.231 +07:00 [INF] Message saved to DB with ID: 223
2025-05-10 01:33:49.232 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:33:49.236 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 01:33:49.237 +07:00 [INF] Transaction committed for message: 223
2025-05-10 01:33:49.241 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:33:49.242 +07:00 [INF] Saved message 223 to Redis
2025-05-10 01:33:49.243 +07:00 [INF] Added message 223 to conversation 19
2025-05-10 01:33:49.243 +07:00 [INF] Published message to channel conversation:19
2025-05-10 01:35:40.941 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:35:40.941 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:35:40.964 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 536
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 161
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-10 01:35:40.965 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 536
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 161
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-10 01:35:41.100 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-10 01:35:41.101 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-10 01:35:41.112 +07:00 [ERR] Connection id "0HNCF438NDGB5", Request id "0HNCF438NDGB5:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 536
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 161
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-10 01:35:41.112 +07:00 [ERR] Connection id "0HNCF438NDGBD", Request id "0HNCF438NDGBD:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 536
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 161
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-10 01:35:41.120 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 377840.165ms
2025-05-10 01:35:41.122 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 273335.5581ms
2025-05-10 01:35:44.151 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:35:44.152 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 536
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 161
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-10 01:35:44.153 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-10 01:35:44.153 +07:00 [ERR] Connection id "0HNCF438NDGB9", Request id "0HNCF438NDGB9:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 536
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 161
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-10 01:35:44.157 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 362773.4815ms
2025-05-10 01:35:50.702 +07:00 [INF] Application is shutting down...
2025-05-10 01:36:01.559 +07:00 [INF] Executed DbCommand (38ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-10 01:36:01.713 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-10 01:36:01.777 +07:00 [WRN] The WebRootPath was not found: C:\Users\Thao\source\Flutter\Message_app\server\wwwroot. Static files may be unavailable.
2025-05-10 01:36:01.796 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-10 01:36:01.805 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-10 01:36:01.805 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-10 01:36:01.806 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-10 01:36:01.806 +07:00 [INF] Hosting environment: Development
2025-05-10 01:36:01.806 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-10 01:39:59.670 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:39:59.830 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:39:59.844 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 185.4164ms
2025-05-10 01:39:59.851 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-10 01:39:59.854 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:39:59.921 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:39:59.924 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-10 01:39:59.999 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:40:00.092 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:40:00.615 +07:00 [INF] Executed DbCommand (77ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:40:00.815 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:40:00.907 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 810.4432ms
2025-05-10 01:40:00.908 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:40:00.916 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 1064.8279ms
2025-05-10 01:40:01.088 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 01:40:01.098 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:01.101 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:01.116 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:40:01.151 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:40:01.279 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:40:01.280 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:01.280 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:40:01.280 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.7331ms
2025-05-10 01:40:01.281 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:01.281 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 1.1474ms
2025-05-10 01:40:01.282 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:40:01.282 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:01.283 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:01.286 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:40:01.294 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:40:01.412 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:40:01.416 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:40:01.440 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 287.9482ms
2025-05-10 01:40:01.440 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:40:01.442 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 354.5993ms
2025-05-10 01:40:01.457 +07:00 [INF] Executed DbCommand (42ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:40:01.466 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:40:01.476 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 181.2831ms
2025-05-10 01:40:01.477 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:40:01.477 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 195.4147ms
2025-05-10 01:40:01.478 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:40:01.479 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:01.481 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:01.481 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:40:01.481 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:40:01.490 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:40:01.491 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:40:01.494 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 12.2353ms
2025-05-10 01:40:01.494 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:40:01.494 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 15.783ms
2025-05-10 01:40:01.699 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-10 01:40:01.702 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:01.702 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:01.702 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:40:01.800 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:40:13.014 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/list/2 - null null
2025-05-10 01:40:13.016 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:13.021 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:13.022 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-10 01:40:13.034 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendsAsync(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:40:13.106 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END, [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[bio], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[gender], [u0].[interests], [u0].[location], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:40:13.117 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:40:13.129 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 01:40:13.135 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 01:40:13.138 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 01:40:13.139 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:40:13.147 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendsAsync (Message_app) in 113.3209ms
2025-05-10 01:40:13.147 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-10 01:40:13.148 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/list/2 - 200 null application/json; charset=utf-8 134.0142ms
2025-05-10 01:40:13.150 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/list/2 - null null
2025-05-10 01:40:13.150 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:13.151 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:40:13.151 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-10 01:40:13.152 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriendsAsync(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:40:13.159 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END, [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[bio], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[gender], [u0].[interests], [u0].[location], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:40:13.165 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:40:13.167 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 01:40:13.170 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 01:40:13.171 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__friend_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__friend_id_0 THEN [f].[UserId2]
    ELSE [f].[UserId1]
END
FROM [Friends] AS [f]
WHERE [f].[UserId1] = @__friend_id_0 OR [f].[UserId2] = @__friend_id_0
2025-05-10 01:40:13.172 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:40:13.173 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriendsAsync (Message_app) in 21.0808ms
2025-05-10 01:40:13.173 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriendsAsync (Message_app)'
2025-05-10 01:40:13.174 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/list/2 - 200 null application/json; charset=utf-8 23.98ms
2025-05-10 01:51:15.365 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:51:15.413 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 536
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 161
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-10 01:51:15.541 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-10 01:51:15.553 +07:00 [ERR] Connection id "0HNCF53JHK4B1", Request id "0HNCF53JHK4B1:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 536
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 161
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-10 01:51:15.563 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 673862.371ms
2025-05-10 01:51:31.802 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.228.155:5053/api/Auth/login - application/json 57
2025-05-10 01:51:31.861 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:51:31.868 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:51:33.249 +07:00 [INF] Executed DbCommand (194ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:51:33.286 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:51:33.290 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 1421.7086ms
2025-05-10 01:51:33.290 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:51:33.292 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.228.155:5053/api/Auth/login - 200 null application/json; charset=utf-8 1489.5723ms
2025-05-10 01:51:34.971 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.228.155:5053/api/friends/GetAllFriends/2 - null null
2025-05-10 01:51:34.977 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:51:34.978 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:51:35.048 +07:00 [INF] Executed DbCommand (53ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:51:35.049 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:51:35.050 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 71.7895ms
2025-05-10 01:51:35.050 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:51:35.050 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.228.155:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 79.5127ms
2025-05-10 01:51:35.084 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.228.155:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:51:35.084 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.228.155:5053/api/Conversation/get_conversations/2 - null null
2025-05-10 01:51:35.084 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:51:35.085 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:51:35.085 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:51:35.085 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:51:35.147 +07:00 [INF] Executed DbCommand (49ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:51:35.149 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:51:35.149 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:51:35.150 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:51:35.150 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 65.4228ms
2025-05-10 01:51:35.150 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 65.4391ms
2025-05-10 01:51:35.150 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:51:35.150 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:51:35.151 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.228.155:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 66.5961ms
2025-05-10 01:51:35.151 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.228.155:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 66.5698ms
2025-05-10 01:51:36.004 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.228.155:5053/ws/chat?userId=2 - null null
2025-05-10 01:51:36.005 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:51:36.251 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:52:11.315 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-10 01:52:11.316 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:11.318 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.9364ms
2025-05-10 01:52:11.320 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-10 01:52:11.320 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:11.321 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:11.321 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:52:11.321 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-10 01:52:11.335 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-10 01:52:11.336 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-10 01:52:11.336 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 15.1888ms
2025-05-10 01:52:11.336 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-10 01:52:11.336 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 16.6545ms
2025-05-10 01:52:11.510 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-10 01:52:11.510 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:11.510 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:11.511 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:52:11.511 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-10 01:52:11.521 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-10 01:52:11.521 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:52:11.522 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.1335ms
2025-05-10 01:52:11.522 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-10 01:52:11.522 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 11.8264ms
2025-05-10 01:52:11.722 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:52:11.722 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:11.723 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.4888ms
2025-05-10 01:52:11.724 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:52:11.724 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:11.724 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:11.724 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:52:11.725 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:52:11.725 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:52:11.725 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:11.725 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1339ms
2025-05-10 01:52:11.742 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:52:11.746 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:52:11.746 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 21.4456ms
2025-05-10 01:52:11.746 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:52:11.746 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 22.0919ms
2025-05-10 01:52:11.748 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-10 01:52:11.748 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:11.748 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:11.748 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:52:11.748 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:52:11.751 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-10 01:52:11.752 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:52:11.752 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.8986ms
2025-05-10 01:52:11.752 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-10 01:52:11.752 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 4.7503ms
2025-05-10 01:52:11.875 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 01:52:11.875 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:11.875 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:11.876 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:52:12.030 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:52:12.098 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 01:52:14.618 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:52:14.619 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:14.619 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/3 - 204 null null 0.5457ms
2025-05-10 01:52:14.620 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - null null
2025-05-10 01:52:14.620 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:14.622 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:14.623 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:52:14.635 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:52:14.717 +07:00 [INF] Retrieved 32 messages from Redis for conversation 19
2025-05-10 01:52:14.720 +07:00 [INF] Retrieved 32 messages from Redis for conversation 19 and user 3
2025-05-10 01:52:14.720 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:52:14.723 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 87.5063ms
2025-05-10 01:52:14.723 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:52:14.723 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/3 - 200 null application/json; charset=utf-8 102.95ms
2025-05-10 01:52:14.744 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:52:14.744 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:14.744 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.2403ms
2025-05-10 01:52:14.748 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:52:14.749 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:14.749 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:14.749 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:52:14.753 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:52:14.815 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:52:14.853 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:52:14.856 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 102.9505ms
2025-05-10 01:52:14.856 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:52:14.856 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 107.9871ms
2025-05-10 01:52:14.864 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:52:14.864 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:14.864 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.2251ms
2025-05-10 01:52:14.865 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:52:14.866 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:14.866 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:14.866 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:52:14.870 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:52:14.880 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:52:14.882 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:52:14.886 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 15.5287ms
2025-05-10 01:52:14.886 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:52:14.886 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 20.976ms
2025-05-10 01:52:18.018 +07:00 [INF] Handling message from user 3: sdf
2025-05-10 01:52:18.057 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-10 01:52:18.218 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:52:18.261 +07:00 [INF] Executed DbCommand (39ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-10 01:52:18.277 +07:00 [INF] Message saved to DB with ID: 224
2025-05-10 01:52:18.282 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-10 01:52:18.296 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-10 01:52:18.305 +07:00 [INF] Transaction committed for message: 224
2025-05-10 01:52:18.314 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:52:18.322 +07:00 [INF] Saved message 224 to Redis
2025-05-10 01:52:18.325 +07:00 [INF] Added message 224 to conversation 19
2025-05-10 01:52:18.332 +07:00 [INF] Published message to channel conversation:19
2025-05-10 01:52:41.758 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.228.155:5053/api/Message/getMessages/19/2 - null null
2025-05-10 01:52:41.763 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:52:41.763 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-10 01:52:41.787 +07:00 [INF] Retrieved 33 messages from Redis for conversation 19
2025-05-10 01:52:41.787 +07:00 [INF] Retrieved 33 messages from Redis for conversation 19 and user 2
2025-05-10 01:52:41.787 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-10 01:52:41.788 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 24.8466ms
2025-05-10 01:52:41.788 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-10 01:52:41.788 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.228.155:5053/api/Message/getMessages/19/2 - 200 null application/json; charset=utf-8 29.3143ms
2025-05-10 01:52:41.833 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.228.155:5053/api/Conversation/get_first_conversation/19 - null null
2025-05-10 01:52:41.833 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:52:41.833 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-10 01:52:41.852 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-10 01:52:41.856 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-10 01:52:41.857 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 24.438ms
2025-05-10 01:52:41.858 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-10 01:52:41.858 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.228.155:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 25.2163ms
2025-05-10 01:52:41.906 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.228.155:5053/api/Participant/get_participants/19 - null null
2025-05-10 01:52:41.908 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:52:41.909 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-10 01:52:41.913 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-10 01:52:41.914 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-10 01:52:41.914 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.8984ms
2025-05-10 01:52:41.915 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-10 01:52:41.915 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.228.155:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 8.3698ms
2025-05-10 01:52:49.397 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-10 01:52:49.397 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:49.397 +07:00 [INF] CORS policy execution successful.
2025-05-10 01:52:49.398 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:52:49.433 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:52:49.442 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-10 01:53:05.410 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.228.155:5053/ws/chat?userId=2 - null null
2025-05-10 01:53:05.410 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-10 01:53:05.444 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-10 01:57:39.940 +07:00 [INF] Application is shutting down...
2025-05-10 01:58:09.981 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:58:09.981 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:58:09.981 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:58:09.981 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-10 01:58:09.993 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.228.155:5053/ws/chat?userId=2 - 101 null null 393988.1806ms
2025-05-10 01:58:09.993 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 320593.7899ms
2025-05-10 01:58:09.993 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.228.155:5053/ws/chat?userId=2 - 101 null null 304581.3321ms
2025-05-10 01:58:09.993 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 358115.9826ms
