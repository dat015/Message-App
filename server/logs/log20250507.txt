2025-05-07 00:13:52.832 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 00:13:52.896 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 00:13:52.939 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 00:13:52.941 +07:00 [ERR] Connection id "0HNCCN2VSLHNQ", Request id "0HNCCN2VSLHNQ:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 00:13:52.956 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 901763.3021ms
2025-05-07 00:18:53.562 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 00:18:53.563 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 00:18:53.628 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 00:18:58.412 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 00:18:58.414 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 00:18:58.422 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 00:18:58.422 +07:00 [ERR] Connection id "0HNCCN2VSLHO8", Request id "0HNCCN2VSLHO8:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 00:18:58.437 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 4874.8741ms
2025-05-07 00:28:56.339 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 00:28:56.340 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 00:28:56.387 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 00:28:58.071 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 00:28:58.072 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 00:28:58.078 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 00:28:58.079 +07:00 [ERR] Connection id "0HNCCN2VSLHO9", Request id "0HNCCN2VSLHO9:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 00:28:58.083 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 1743.5662ms
2025-05-07 02:54:45.940 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 02:54:45.940 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 02:54:45.941 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 02:54:45.974 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 02:55:05.147 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 02:55:05.150 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 02:55:05.155 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 02:55:05.155 +07:00 [ERR] Connection id "0HNCCN2VSLHOA", Request id "0HNCCN2VSLHOA:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 02:55:05.175 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 19234.8547ms
2025-05-07 02:55:05.224 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 02:55:05.224 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 02:55:05.228 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 02:55:05.228 +07:00 [ERR] Connection id "0HNCCN2VSLHOB", Request id "0HNCCN2VSLHOB:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 02:55:05.240 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 19298.3192ms
2025-05-07 06:53:55.975 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 06:53:55.976 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 06:53:55.977 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 06:53:55.977 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 06:53:56.052 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 06:53:56.052 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 06:53:56.052 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 06:53:56.053 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 06:53:56.082 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 06:53:56.123 +07:00 [ERR] Connection id "0HNCCN2VSLHOC", Request id "0HNCCN2VSLHOC:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 06:53:56.146 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 06:53:57.520 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 1544.637ms
2025-05-07 06:53:56.195 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 06:53:57.520 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 06:53:57.521 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 06:53:58.089 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 06:53:58.090 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 06:53:58.217 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 06:53:58.217 +07:00 [ERR] Connection id "0HNCCN2VSLHOG", Request id "0HNCCN2VSLHOG:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 06:53:58.519 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 2324.6468ms
2025-05-07 06:54:17.650 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 06:54:17.650 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 06:54:17.656 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 06:54:17.656 +07:00 [ERR] Connection id "0HNCCN2VSLHOE", Request id "0HNCCN2VSLHOE:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 06:54:17.678 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 21625.2006ms
2025-05-07 06:54:18.945 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 06:54:18.945 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 06:54:18.949 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 06:54:18.950 +07:00 [ERR] Connection id "0HNCCN2VSLHOD", Request id "0HNCCN2VSLHOD:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 06:54:18.961 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 22984.0828ms
2025-05-07 06:54:19.445 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 06:54:19.446 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 06:54:19.450 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 06:54:19.450 +07:00 [ERR] Connection id "0HNCCN2VSLHOF", Request id "0HNCCN2VSLHOF:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 06:54:19.466 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 23319.5313ms
2025-05-07 07:00:53.389 +07:00 [INF] Application is shutting down...
2025-05-07 07:01:03.379 +07:00 [INF] Executed DbCommand (46ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-07 07:01:03.553 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-07 07:01:03.655 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-07 07:01:03.664 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-07 07:01:03.664 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-07 07:01:03.664 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-07 07:01:03.665 +07:00 [INF] Hosting environment: Development
2025-05-07 07:01:03.665 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-07 07:04:03.969 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 53
2025-05-07 07:04:04.264 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-07 07:04:04.380 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 07:04:04.466 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 07:04:05.184 +07:00 [INF] Executed DbCommand (163ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 07:04:05.455 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 07:04:05.583 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 1111.1571ms
2025-05-07 07:04:05.584 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 07:04:05.596 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 1639.0939ms
2025-05-07 07:04:06.421 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - null null
2025-05-07 07:04:06.447 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 07:04:06.458 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 07:04:06.676 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - null null
2025-05-07 07:04:06.682 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 07:04:06.695 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 07:04:06.773 +07:00 [INF] Executed DbCommand (56ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 07:04:06.800 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 07:04:06.807 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 07:04:06.993 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 296.8029ms
2025-05-07 07:04:06.994 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 07:04:07.021 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 334.4465ms
2025-05-07 07:04:07.036 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 577.2032ms
2025-05-07 07:04:07.045 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 07:04:07.046 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - 200 null application/json; charset=utf-8 625.324ms
2025-05-07 07:04:07.225 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 07:04:07.226 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 07:04:07.684 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 07:07:37.701 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 07:07:37.703 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 07:07:37.707 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 07:07:37.749 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 07:07:37.750 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 07:07:37.758 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 50.3573ms
2025-05-07 07:07:37.758 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 07:07:37.758 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 57.1234ms
2025-05-07 07:07:39.055 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 07:07:39.057 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 07:07:39.059 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 07:07:39.151 +07:00 [INF] Executed DbCommand (49ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 07:07:39.166 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-05-07 07:07:39.167 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 107.8236ms
2025-05-07 07:07:39.167 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 07:07:39.167 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 400 null text/plain; charset=utf-8 112.1562ms
2025-05-07 07:07:39.917 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 07:07:39.917 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 07:07:39.920 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 07:07:39.947 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 07:07:39.948 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 07:07:39.949 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 28.891ms
2025-05-07 07:07:39.949 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 07:07:39.950 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 32.8927ms
2025-05-07 07:08:35.237 +07:00 [INF] Application is shutting down...
2025-05-07 07:09:07.491 +07:00 [INF] Executed DbCommand (36ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-07 07:09:07.620 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-07 07:09:07.676 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-07 07:09:07.685 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-07 07:09:07.685 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-07 07:09:07.686 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-07 07:09:07.686 +07:00 [INF] Hosting environment: Development
2025-05-07 07:09:07.686 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-07 07:09:28.207 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 53
2025-05-07 07:09:28.317 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-07 07:09:28.359 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 07:09:28.399 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 07:09:28.715 +07:00 [INF] Executed DbCommand (41ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 07:09:28.955 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 07:09:29.092 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 688.6313ms
2025-05-07 07:09:29.094 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 07:09:29.104 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 900.6107ms
2025-05-07 07:09:29.257 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - null null
2025-05-07 07:09:29.275 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 07:09:29.289 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 07:09:29.331 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - null null
2025-05-07 07:09:29.336 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 07:09:29.341 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 07:09:29.481 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 07:09:29.485 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 07:09:29.512 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 222.8039ms
2025-05-07 07:09:29.516 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 07:09:29.518 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - 200 null application/json; charset=utf-8 260.0171ms
2025-05-07 07:09:29.536 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 07:09:29.570 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 07:09:29.573 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 231.835ms
2025-05-07 07:09:29.573 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 07:09:29.573 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 242.3094ms
2025-05-07 07:09:29.715 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 07:09:29.716 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 07:09:29.772 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 07:09:29.816 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 07:09:29.829 +07:00 [INF] Saved message 114 to Redis
2025-05-07 07:09:29.835 +07:00 [INF] Added message 114 to conversation 1
2025-05-07 07:09:29.838 +07:00 [INF] Saved message 113 to Redis
2025-05-07 07:09:29.838 +07:00 [INF] Added message 113 to conversation 1
2025-05-07 07:09:29.840 +07:00 [INF] Saved message 112 to Redis
2025-05-07 07:09:29.841 +07:00 [INF] Added message 112 to conversation 1
2025-05-07 07:09:29.842 +07:00 [INF] Saved message 110 to Redis
2025-05-07 07:09:29.842 +07:00 [INF] Added message 110 to conversation 1
2025-05-07 07:09:29.843 +07:00 [INF] Saved message 109 to Redis
2025-05-07 07:09:29.844 +07:00 [INF] Added message 109 to conversation 1
2025-05-07 07:09:29.845 +07:00 [INF] Saved message 108 to Redis
2025-05-07 07:09:29.846 +07:00 [INF] Added message 108 to conversation 1
2025-05-07 07:09:29.851 +07:00 [INF] Saved message 107 to Redis
2025-05-07 07:09:29.851 +07:00 [INF] Added message 107 to conversation 1
2025-05-07 07:09:29.852 +07:00 [INF] Saved message 106 to Redis
2025-05-07 07:09:29.853 +07:00 [INF] Added message 106 to conversation 1
2025-05-07 07:09:29.855 +07:00 [INF] Saved message 105 to Redis
2025-05-07 07:09:29.856 +07:00 [INF] Added message 105 to conversation 1
2025-05-07 07:09:29.858 +07:00 [INF] Saved message 104 to Redis
2025-05-07 07:09:29.858 +07:00 [INF] Added message 104 to conversation 1
2025-05-07 07:09:29.860 +07:00 [INF] Saved message 103 to Redis
2025-05-07 07:09:29.861 +07:00 [INF] Added message 103 to conversation 1
2025-05-07 07:09:29.873 +07:00 [INF] Saved message 102 to Redis
2025-05-07 07:09:29.877 +07:00 [INF] Added message 102 to conversation 1
2025-05-07 07:09:29.882 +07:00 [INF] Saved message 101 to Redis
2025-05-07 07:09:29.883 +07:00 [INF] Added message 101 to conversation 1
2025-05-07 07:09:29.885 +07:00 [INF] Saved message 100 to Redis
2025-05-07 07:09:29.886 +07:00 [INF] Added message 100 to conversation 1
2025-05-07 07:09:29.887 +07:00 [INF] Saved message 99 to Redis
2025-05-07 07:09:29.887 +07:00 [INF] Added message 99 to conversation 1
2025-05-07 07:09:29.888 +07:00 [INF] Saved message 98 to Redis
2025-05-07 07:09:29.889 +07:00 [INF] Added message 98 to conversation 1
2025-05-07 07:09:29.890 +07:00 [INF] Saved message 95 to Redis
2025-05-07 07:09:29.890 +07:00 [INF] Added message 95 to conversation 1
2025-05-07 07:09:29.892 +07:00 [INF] Saved message 94 to Redis
2025-05-07 07:09:29.893 +07:00 [INF] Added message 94 to conversation 1
2025-05-07 07:09:29.895 +07:00 [INF] Saved message 93 to Redis
2025-05-07 07:09:29.896 +07:00 [INF] Added message 93 to conversation 1
2025-05-07 07:09:29.899 +07:00 [INF] Saved message 92 to Redis
2025-05-07 07:09:29.900 +07:00 [INF] Added message 92 to conversation 1
2025-05-07 07:09:29.901 +07:00 [INF] Saved message 91 to Redis
2025-05-07 07:09:29.901 +07:00 [INF] Added message 91 to conversation 1
2025-05-07 07:09:29.902 +07:00 [INF] Saved message 90 to Redis
2025-05-07 07:09:29.903 +07:00 [INF] Added message 90 to conversation 1
2025-05-07 07:09:29.904 +07:00 [INF] Saved message 87 to Redis
2025-05-07 07:09:29.904 +07:00 [INF] Added message 87 to conversation 1
2025-05-07 07:09:29.906 +07:00 [INF] Saved message 86 to Redis
2025-05-07 07:09:29.907 +07:00 [INF] Added message 86 to conversation 1
2025-05-07 07:09:29.908 +07:00 [INF] Saved message 85 to Redis
2025-05-07 07:09:29.909 +07:00 [INF] Added message 85 to conversation 1
2025-05-07 07:09:29.910 +07:00 [INF] Saved message 84 to Redis
2025-05-07 07:09:29.910 +07:00 [INF] Added message 84 to conversation 1
2025-05-07 07:09:29.911 +07:00 [INF] Saved message 83 to Redis
2025-05-07 07:09:29.912 +07:00 [INF] Added message 83 to conversation 1
2025-05-07 07:09:29.915 +07:00 [INF] Saved message 82 to Redis
2025-05-07 07:09:29.916 +07:00 [INF] Added message 82 to conversation 1
2025-05-07 07:09:29.918 +07:00 [INF] Saved message 81 to Redis
2025-05-07 07:09:29.918 +07:00 [INF] Added message 81 to conversation 1
2025-05-07 07:09:29.919 +07:00 [INF] Saved message 80 to Redis
2025-05-07 07:09:29.920 +07:00 [INF] Added message 80 to conversation 1
2025-05-07 07:09:29.921 +07:00 [INF] Saved message 79 to Redis
2025-05-07 07:09:29.922 +07:00 [INF] Added message 79 to conversation 1
2025-05-07 07:09:29.924 +07:00 [INF] Saved message 78 to Redis
2025-05-07 07:09:29.925 +07:00 [INF] Added message 78 to conversation 1
2025-05-07 07:09:29.925 +07:00 [INF] Saved message 77 to Redis
2025-05-07 07:09:29.926 +07:00 [INF] Added message 77 to conversation 1
2025-05-07 07:09:29.927 +07:00 [INF] Saved message 76 to Redis
2025-05-07 07:09:29.927 +07:00 [INF] Added message 76 to conversation 1
2025-05-07 07:09:29.928 +07:00 [INF] Saved message 75 to Redis
2025-05-07 07:09:29.929 +07:00 [INF] Added message 75 to conversation 1
2025-05-07 07:09:29.934 +07:00 [INF] Saved message 74 to Redis
2025-05-07 07:09:29.934 +07:00 [INF] Added message 74 to conversation 1
2025-05-07 07:09:29.935 +07:00 [INF] Saved message 73 to Redis
2025-05-07 07:09:29.935 +07:00 [INF] Added message 73 to conversation 1
2025-05-07 07:09:29.936 +07:00 [INF] Saved message 72 to Redis
2025-05-07 07:09:29.937 +07:00 [INF] Added message 72 to conversation 1
2025-05-07 07:09:29.938 +07:00 [INF] Saved message 71 to Redis
2025-05-07 07:09:29.938 +07:00 [INF] Added message 71 to conversation 1
2025-05-07 07:09:29.939 +07:00 [INF] Saved message 68 to Redis
2025-05-07 07:09:29.939 +07:00 [INF] Added message 68 to conversation 1
2025-05-07 07:09:29.940 +07:00 [INF] Saved message 64 to Redis
2025-05-07 07:09:29.940 +07:00 [INF] Added message 64 to conversation 1
2025-05-07 07:09:29.941 +07:00 [INF] Saved message 62 to Redis
2025-05-07 07:09:29.942 +07:00 [INF] Added message 62 to conversation 1
2025-05-07 07:09:29.944 +07:00 [INF] Saved message 61 to Redis
2025-05-07 07:09:29.944 +07:00 [INF] Added message 61 to conversation 1
2025-05-07 07:09:29.945 +07:00 [INF] Saved message 60 to Redis
2025-05-07 07:09:29.946 +07:00 [INF] Added message 60 to conversation 1
2025-05-07 07:09:29.950 +07:00 [INF] Saved message 59 to Redis
2025-05-07 07:09:29.951 +07:00 [INF] Added message 59 to conversation 1
2025-05-07 07:09:29.952 +07:00 [INF] Saved message 57 to Redis
2025-05-07 07:09:29.953 +07:00 [INF] Added message 57 to conversation 1
2025-05-07 07:09:29.954 +07:00 [INF] Saved message 55 to Redis
2025-05-07 07:09:29.954 +07:00 [INF] Added message 55 to conversation 1
2025-05-07 07:09:29.956 +07:00 [INF] Saved message 54 to Redis
2025-05-07 07:09:29.957 +07:00 [INF] Added message 54 to conversation 1
2025-05-07 07:09:29.959 +07:00 [INF] Saved message 51 to Redis
2025-05-07 07:09:29.959 +07:00 [INF] Added message 51 to conversation 1
2025-05-07 07:09:29.960 +07:00 [INF] Saved message 49 to Redis
2025-05-07 07:09:29.961 +07:00 [INF] Added message 49 to conversation 1
2025-05-07 07:09:29.973 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 07:09:29.975 +07:00 [INF] Saved message 126 to Redis
2025-05-07 07:09:29.976 +07:00 [INF] Added message 126 to conversation 4
2025-05-07 07:09:29.977 +07:00 [INF] Saved message 125 to Redis
2025-05-07 07:09:29.978 +07:00 [INF] Added message 125 to conversation 4
2025-05-07 07:09:29.979 +07:00 [INF] Saved message 124 to Redis
2025-05-07 07:09:29.979 +07:00 [INF] Added message 124 to conversation 4
2025-05-07 07:09:29.984 +07:00 [INF] Saved message 123 to Redis
2025-05-07 07:09:29.984 +07:00 [INF] Added message 123 to conversation 4
2025-05-07 07:09:29.985 +07:00 [INF] Saved message 122 to Redis
2025-05-07 07:09:29.986 +07:00 [INF] Added message 122 to conversation 4
2025-05-07 07:09:29.986 +07:00 [INF] Saved message 121 to Redis
2025-05-07 07:09:29.987 +07:00 [INF] Added message 121 to conversation 4
2025-05-07 07:09:29.988 +07:00 [INF] Saved message 120 to Redis
2025-05-07 07:09:29.988 +07:00 [INF] Added message 120 to conversation 4
2025-05-07 07:09:29.990 +07:00 [INF] Saved message 119 to Redis
2025-05-07 07:09:29.991 +07:00 [INF] Added message 119 to conversation 4
2025-05-07 07:09:29.992 +07:00 [INF] Saved message 118 to Redis
2025-05-07 07:09:29.992 +07:00 [INF] Added message 118 to conversation 4
2025-05-07 07:09:29.993 +07:00 [INF] Saved message 111 to Redis
2025-05-07 07:09:29.994 +07:00 [INF] Added message 111 to conversation 4
2025-05-07 07:09:29.995 +07:00 [INF] Saved message 97 to Redis
2025-05-07 07:09:29.995 +07:00 [INF] Added message 97 to conversation 4
2025-05-07 07:09:29.996 +07:00 [INF] Saved message 96 to Redis
2025-05-07 07:09:29.998 +07:00 [INF] Added message 96 to conversation 4
2025-05-07 07:09:30.000 +07:00 [INF] Saved message 89 to Redis
2025-05-07 07:09:30.001 +07:00 [INF] Added message 89 to conversation 4
2025-05-07 07:09:30.003 +07:00 [INF] Saved message 69 to Redis
2025-05-07 07:09:30.003 +07:00 [INF] Added message 69 to conversation 4
2025-05-07 07:09:30.005 +07:00 [INF] Saved message 67 to Redis
2025-05-07 07:09:30.005 +07:00 [INF] Added message 67 to conversation 4
2025-05-07 07:09:30.007 +07:00 [INF] Saved message 66 to Redis
2025-05-07 07:09:30.008 +07:00 [INF] Added message 66 to conversation 4
2025-05-07 07:09:30.009 +07:00 [INF] Saved message 63 to Redis
2025-05-07 07:09:30.009 +07:00 [INF] Added message 63 to conversation 4
2025-05-07 07:09:30.011 +07:00 [INF] Saved message 58 to Redis
2025-05-07 07:09:30.011 +07:00 [INF] Added message 58 to conversation 4
2025-05-07 07:09:30.013 +07:00 [INF] Saved message 56 to Redis
2025-05-07 07:09:30.013 +07:00 [INF] Added message 56 to conversation 4
2025-05-07 07:09:30.017 +07:00 [INF] Saved message 53 to Redis
2025-05-07 07:09:30.017 +07:00 [INF] Added message 53 to conversation 4
2025-05-07 07:09:30.018 +07:00 [INF] Saved message 52 to Redis
2025-05-07 07:09:30.019 +07:00 [INF] Added message 52 to conversation 4
2025-05-07 07:09:30.020 +07:00 [INF] Saved message 50 to Redis
2025-05-07 07:09:30.020 +07:00 [INF] Added message 50 to conversation 4
2025-05-07 07:09:30.021 +07:00 [INF] Saved message 47 to Redis
2025-05-07 07:09:30.021 +07:00 [INF] Added message 47 to conversation 4
2025-05-07 07:09:30.022 +07:00 [INF] Saved message 46 to Redis
2025-05-07 07:09:30.022 +07:00 [INF] Added message 46 to conversation 4
2025-05-07 07:09:30.023 +07:00 [INF] Saved message 45 to Redis
2025-05-07 07:09:30.025 +07:00 [INF] Added message 45 to conversation 4
2025-05-07 07:09:30.026 +07:00 [INF] Saved message 44 to Redis
2025-05-07 07:09:30.026 +07:00 [INF] Added message 44 to conversation 4
2025-05-07 07:09:30.027 +07:00 [INF] Saved message 43 to Redis
2025-05-07 07:09:30.027 +07:00 [INF] Added message 43 to conversation 4
2025-05-07 07:09:30.028 +07:00 [INF] Saved message 42 to Redis
2025-05-07 07:09:30.028 +07:00 [INF] Added message 42 to conversation 4
2025-05-07 07:09:30.031 +07:00 [INF] Saved message 41 to Redis
2025-05-07 07:09:30.032 +07:00 [INF] Added message 41 to conversation 4
2025-05-07 07:09:30.034 +07:00 [INF] Saved message 40 to Redis
2025-05-07 07:09:30.035 +07:00 [INF] Added message 40 to conversation 4
2025-05-07 07:09:30.036 +07:00 [INF] Saved message 39 to Redis
2025-05-07 07:09:30.037 +07:00 [INF] Added message 39 to conversation 4
2025-05-07 07:09:30.038 +07:00 [INF] Saved message 38 to Redis
2025-05-07 07:09:30.039 +07:00 [INF] Added message 38 to conversation 4
2025-05-07 07:09:30.039 +07:00 [INF] Saved message 37 to Redis
2025-05-07 07:09:30.040 +07:00 [INF] Added message 37 to conversation 4
2025-05-07 07:09:30.041 +07:00 [INF] Saved message 36 to Redis
2025-05-07 07:09:30.042 +07:00 [INF] Added message 36 to conversation 4
2025-05-07 07:09:30.044 +07:00 [INF] Saved message 35 to Redis
2025-05-07 07:09:30.045 +07:00 [INF] Added message 35 to conversation 4
2025-05-07 07:09:30.046 +07:00 [INF] Saved message 34 to Redis
2025-05-07 07:09:30.048 +07:00 [INF] Added message 34 to conversation 4
2025-05-07 07:09:30.049 +07:00 [INF] Saved message 33 to Redis
2025-05-07 07:09:30.049 +07:00 [INF] Added message 33 to conversation 4
2025-05-07 07:09:30.050 +07:00 [INF] Saved message 32 to Redis
2025-05-07 07:09:30.050 +07:00 [INF] Added message 32 to conversation 4
2025-05-07 07:09:30.052 +07:00 [INF] Saved message 31 to Redis
2025-05-07 07:09:30.052 +07:00 [INF] Added message 31 to conversation 4
2025-05-07 07:09:30.053 +07:00 [INF] Saved message 30 to Redis
2025-05-07 07:09:30.054 +07:00 [INF] Added message 30 to conversation 4
2025-05-07 07:09:30.055 +07:00 [INF] Saved message 29 to Redis
2025-05-07 07:09:30.055 +07:00 [INF] Added message 29 to conversation 4
2025-05-07 07:09:30.056 +07:00 [INF] Saved message 28 to Redis
2025-05-07 07:09:30.056 +07:00 [INF] Added message 28 to conversation 4
2025-05-07 07:09:30.058 +07:00 [INF] Saved message 27 to Redis
2025-05-07 07:09:30.059 +07:00 [INF] Added message 27 to conversation 4
2025-05-07 07:09:30.060 +07:00 [INF] Saved message 26 to Redis
2025-05-07 07:09:30.060 +07:00 [INF] Added message 26 to conversation 4
2025-05-07 07:09:30.061 +07:00 [INF] Saved message 25 to Redis
2025-05-07 07:09:30.061 +07:00 [INF] Added message 25 to conversation 4
2025-05-07 07:09:30.064 +07:00 [INF] Saved message 24 to Redis
2025-05-07 07:09:30.066 +07:00 [INF] Added message 24 to conversation 4
2025-05-07 07:09:30.068 +07:00 [INF] Saved message 23 to Redis
2025-05-07 07:09:30.068 +07:00 [INF] Added message 23 to conversation 4
2025-05-07 07:09:30.070 +07:00 [INF] Saved message 22 to Redis
2025-05-07 07:09:30.071 +07:00 [INF] Added message 22 to conversation 4
2025-05-07 07:09:30.073 +07:00 [INF] Saved message 21 to Redis
2025-05-07 07:09:30.075 +07:00 [INF] Added message 21 to conversation 4
2025-05-07 07:09:30.077 +07:00 [INF] Saved message 20 to Redis
2025-05-07 07:09:30.077 +07:00 [INF] Added message 20 to conversation 4
2025-05-07 07:09:33.259 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - null null
2025-05-07 07:09:33.261 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 07:09:33.268 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 07:09:33.342 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4
2025-05-07 07:09:33.346 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-07 07:09:33.347 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 07:09:33.357 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 88.6824ms
2025-05-07 07:09:33.357 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 07:09:33.358 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 98.7813ms
2025-05-07 07:09:33.512 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 07:09:33.516 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 07:09:33.520 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 07:09:33.572 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 07:09:33.616 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 07:09:33.620 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 99.6775ms
2025-05-07 07:09:33.620 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 07:09:33.621 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 108.5547ms
2025-05-07 07:09:33.653 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 07:09:33.654 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 07:09:33.662 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 07:09:33.711 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 07:09:33.751 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 07:09:33.760 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 98.2476ms
2025-05-07 07:09:33.761 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 07:09:33.761 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 107.6607ms
2025-05-07 07:09:52.963 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 07:09:52.973 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 07:09:52.974 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 07:09:53.012 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 07:09:53.026 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 07:09:53.027 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 52.8166ms
2025-05-07 07:09:53.027 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 07:09:53.028 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 65.0387ms
2025-05-07 07:09:53.251 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 07:09:53.258 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 07:09:53.258 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 07:09:53.282 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 07:09:53.283 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 07:09:53.283 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 24.7242ms
2025-05-07 07:09:53.286 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 07:09:53.287 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 35.7718ms
2025-05-07 07:09:53.305 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 07:09:53.306 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 07:09:53.306 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 07:09:53.337 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 07:09:53.342 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 07:09:53.342 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 35.6114ms
2025-05-07 07:09:53.342 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 07:09:53.343 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 37.7062ms
2025-05-07 07:09:53.770 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 07:09:53.772 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 07:09:53.845 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 07:09:53.880 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 07:09:53.889 +07:00 [INF] Saved message 117 to Redis
2025-05-07 07:09:53.891 +07:00 [INF] Added message 117 to conversation 3
2025-05-07 07:09:53.894 +07:00 [INF] Saved message 115 to Redis
2025-05-07 07:09:53.895 +07:00 [INF] Added message 115 to conversation 3
2025-05-07 07:09:53.902 +07:00 [INF] Saved message 88 to Redis
2025-05-07 07:09:53.904 +07:00 [INF] Added message 88 to conversation 3
2025-05-07 07:09:53.906 +07:00 [INF] Saved message 70 to Redis
2025-05-07 07:09:53.907 +07:00 [INF] Added message 70 to conversation 3
2025-05-07 07:09:53.909 +07:00 [INF] Saved message 65 to Redis
2025-05-07 07:09:53.910 +07:00 [INF] Added message 65 to conversation 3
2025-05-07 07:09:53.911 +07:00 [INF] Saved message 48 to Redis
2025-05-07 07:09:53.912 +07:00 [INF] Added message 48 to conversation 3
2025-05-07 07:10:02.857 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - null null
2025-05-07 07:10:02.858 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 07:10:02.858 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 07:10:02.893 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4
2025-05-07 07:10:02.893 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-07 07:10:02.893 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 07:10:02.894 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 35.4757ms
2025-05-07 07:10:02.894 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 07:10:02.894 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 37.6375ms
2025-05-07 07:10:03.017 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 07:10:03.017 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 07:10:03.018 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 07:10:03.027 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 07:10:03.028 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 07:10:03.028 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.3793ms
2025-05-07 07:10:03.028 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 07:10:03.028 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 11.7587ms
2025-05-07 07:10:03.094 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 07:10:03.096 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 07:10:03.096 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 07:10:03.105 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 07:10:03.106 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 07:10:03.106 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.4231ms
2025-05-07 07:10:03.106 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 07:10:03.107 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 11.768ms
2025-05-07 07:10:09.318 +07:00 [INF] Handling message from user 5: kj
2025-05-07 07:10:09.325 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 07:10:09.582 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 07:10:09.639 +07:00 [INF] Executed DbCommand (50ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 07:10:09.729 +07:00 [INF] Message saved to DB with ID: 127
2025-05-07 07:10:09.733 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 07:10:09.747 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 07:10:09.761 +07:00 [INF] Transaction committed for message: 127
2025-05-07 07:10:09.762 +07:00 [INF] Saved message 127 to Redis
2025-05-07 07:10:09.763 +07:00 [INF] Added message 127 to conversation 4
2025-05-07 07:10:09.773 +07:00 [INF] Published message to channel conversation:4
2025-05-07 07:10:19.443 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-07 07:10:19.444 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 07:10:19.444 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 07:10:19.543 +07:00 [INF] Retrieved 51 messages from Redis for conversation 4
2025-05-07 07:10:19.543 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-07 07:10:19.543 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 07:10:19.545 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 100.1757ms
2025-05-07 07:10:19.545 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 07:10:19.545 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 102.1582ms
2025-05-07 07:10:19.711 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 07:10:19.711 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 07:10:19.711 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 07:10:19.717 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 07:10:19.717 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 07:10:19.717 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.2795ms
2025-05-07 07:10:19.718 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 07:10:19.719 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 8.0564ms
2025-05-07 07:10:20.090 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 07:10:20.091 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 07:10:20.092 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 07:10:20.102 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 07:10:20.102 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 07:10:20.103 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 11.1664ms
2025-05-07 07:10:20.103 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 07:10:20.104 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 14.1736ms
2025-05-07 07:11:10.724 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 07:11:10.724 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 07:11:10.753 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 07:25:43.916 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 07:25:43.917 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 07:25:43.998 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 07:25:44.003 +07:00 [ERR] Connection id "0HNCCVDNE1Q09", Request id "0HNCCVDNE1Q09:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 07:25:44.033 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 950262.3953ms
2025-05-07 07:29:23.868 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 07:29:23.868 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 07:29:23.936 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 07:34:07.822 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 07:34:07.823 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 07:34:07.829 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 07:34:07.831 +07:00 [ERR] Connection id "0HNCCVDNE1Q0H", Request id "0HNCCVDNE1Q0H:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 07:34:07.849 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 283980.721ms
2025-05-07 07:35:52.147 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 07:35:52.148 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 07:35:52.186 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 07:40:22.498 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 07:40:22.499 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 07:40:22.503 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 07:40:22.503 +07:00 [ERR] Connection id "0HNCCVDNE1Q0I", Request id "0HNCCVDNE1Q0I:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 07:40:22.523 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 270375.707ms
2025-05-07 07:45:01.574 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 07:45:01.574 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 07:45:01.641 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 08:07:03.967 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 08:07:03.968 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 08:07:03.989 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 08:07:03.992 +07:00 [ERR] Connection id "0HNCCVDNE1Q0J", Request id "0HNCCVDNE1Q0J:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 08:07:03.998 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 1322423.8951ms
2025-05-07 08:07:58.922 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 08:07:58.953 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 08:07:58.973 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 08:07:59.129 +07:00 [INF] Executed DbCommand (41ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 08:07:59.150 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 08:07:59.157 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 183.7595ms
2025-05-07 08:07:59.157 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 08:07:59.158 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 236.1624ms
2025-05-07 08:08:00.370 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 08:08:00.373 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 08:08:00.373 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 08:08:00.402 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 08:08:00.402 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 08:08:00.403 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 29.396ms
2025-05-07 08:08:00.403 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 08:08:00.404 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 33.9295ms
2025-05-07 08:08:00.946 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 08:08:00.946 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 08:08:00.946 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 08:08:01.001 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 08:08:01.002 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 55.4705ms
2025-05-07 08:08:01.002 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 08:08:01.003 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 56.7562ms
2025-05-07 08:08:01.326 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 08:08:01.327 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 08:08:01.402 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 08:08:09.335 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 08:08:09.336 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 08:08:09.343 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 08:08:09.343 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 08:08:09.363 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 08:08:09.366 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 08:08:11.725 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 08:08:11.727 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 08:08:11.732 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 08:08:11.732 +07:00 [ERR] Connection id "0HNCCVDNE1Q0G", Request id "0HNCCVDNE1Q0G:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 08:08:11.745 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 3421021.2274ms
2025-05-07 08:08:30.624 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 08:08:30.626 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 08:08:30.630 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 08:08:30.630 +07:00 [ERR] Connection id "0HNCCVDNE1Q02", Request id "0HNCCVDNE1Q02:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 08:08:30.640 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 3540925.2924ms
2025-05-07 08:08:32.499 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-07 08:08:32.499 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 08:08:32.499 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 08:08:32.569 +07:00 [INF] Retrieved 51 messages from Redis for conversation 4
2025-05-07 08:08:32.571 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-07 08:08:32.571 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 08:08:32.571 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 71.7969ms
2025-05-07 08:08:32.571 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 08:08:32.571 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 72.9047ms
2025-05-07 08:08:32.635 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 08:08:32.636 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 08:08:32.636 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 08:08:32.661 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 08:08:32.662 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 08:08:32.662 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 25.4432ms
2025-05-07 08:08:32.662 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 08:08:32.662 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 27.4853ms
2025-05-07 08:08:32.712 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 08:08:32.712 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 08:08:32.712 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 08:08:32.729 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 08:08:32.730 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 08:08:32.731 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 18.3758ms
2025-05-07 08:08:32.731 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 08:08:32.731 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 19.081ms
2025-05-07 08:08:35.980 +07:00 [INF] Handling message from user 2: x
2025-05-07 08:08:35.993 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 08:08:36.035 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 08:08:36.058 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 08:08:36.068 +07:00 [INF] Message saved to DB with ID: 128
2025-05-07 08:08:36.070 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 08:08:36.084 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 08:08:36.088 +07:00 [INF] Transaction committed for message: 128
2025-05-07 08:08:36.097 +07:00 [INF] Saved message 128 to Redis
2025-05-07 08:08:36.099 +07:00 [INF] Added message 128 to conversation 4
2025-05-07 08:08:36.102 +07:00 [INF] Published message to channel conversation:4
2025-05-07 08:15:11.813 +07:00 [INF] Handling message from user 2: d
2025-05-07 08:15:11.847 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 08:15:11.882 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 08:15:11.897 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 08:15:11.898 +07:00 [INF] Message saved to DB with ID: 129
2025-05-07 08:15:11.899 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 08:15:11.910 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 08:15:11.911 +07:00 [INF] Transaction committed for message: 129
2025-05-07 08:15:11.914 +07:00 [INF] Saved message 129 to Redis
2025-05-07 08:15:11.915 +07:00 [INF] Added message 129 to conversation 4
2025-05-07 08:15:11.916 +07:00 [INF] Published message to channel conversation:4
2025-05-07 08:28:20.928 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - null null
2025-05-07 08:28:20.931 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 08:28:20.932 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 08:28:20.991 +07:00 [INF] Retrieved 53 messages from Redis for conversation 4
2025-05-07 08:28:20.991 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-07 08:28:20.992 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 08:28:20.993 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 61.3211ms
2025-05-07 08:28:20.994 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 08:28:20.994 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 66.0783ms
2025-05-07 08:28:21.220 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 08:28:21.221 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 08:28:21.221 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 08:28:21.243 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 08:28:21.244 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 08:28:21.244 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 23.2725ms
2025-05-07 08:28:21.245 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 08:28:21.245 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 25.2003ms
2025-05-07 08:28:21.292 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 08:28:21.293 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 08:28:21.293 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 08:28:21.301 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 08:28:21.302 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 08:28:21.302 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.1015ms
2025-05-07 08:28:21.302 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 08:28:21.302 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 10.058ms
2025-05-07 08:28:22.778 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 08:28:22.779 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 08:28:22.817 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 08:28:32.320 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 08:28:32.320 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 08:28:32.413 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 08:54:20.279 +07:00 [INF] Handling message from user 2: xds
2025-05-07 08:54:20.541 +07:00 [INF] Executed DbCommand (55ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 08:54:20.598 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 08:54:20.635 +07:00 [INF] Executed DbCommand (35ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 08:54:20.645 +07:00 [INF] Message saved to DB with ID: 130
2025-05-07 08:54:20.651 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 08:54:20.664 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 08:54:20.668 +07:00 [INF] Transaction committed for message: 130
2025-05-07 08:54:20.677 +07:00 [INF] Saved message 130 to Redis
2025-05-07 08:54:20.679 +07:00 [INF] Added message 130 to conversation 4
2025-05-07 08:54:20.685 +07:00 [INF] Published message to channel conversation:4
2025-05-07 09:31:26.942 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 09:31:26.945 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 09:31:26.959 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 09:31:26.961 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 09:31:26.968 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 09:31:26.966 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 09:31:26.961 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 09:31:26.968 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 09:31:26.961 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 09:31:26.962 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 09:31:27.141 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 09:31:27.176 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 09:31:27.308 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 09:31:27.385 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 09:31:27.340 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 09:31:27.390 +07:00 [ERR] Connection id "0HNCCVDNE1Q11", Request id "0HNCCVDNE1Q11:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 09:31:27.389 +07:00 [ERR] Connection id "0HNCCVDNE1Q10", Request id "0HNCCVDNE1Q10:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 09:31:27.389 +07:00 [ERR] Connection id "0HNCCVDNE1Q0O", Request id "0HNCCVDNE1Q0O:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 09:31:27.389 +07:00 [ERR] Connection id "0HNCCVDNE1Q0N", Request id "0HNCCVDNE1Q0N:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 09:31:27.389 +07:00 [ERR] Connection id "0HNCCVDNE1Q0P", Request id "0HNCCVDNE1Q0P:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 09:31:27.432 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 3775109.7867ms
2025-05-07 09:31:27.449 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 3784670.9278ms
2025-05-07 09:31:27.483 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 4998147.8091ms
2025-05-07 09:31:27.506 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 5006180.0221ms
2025-05-07 09:31:27.513 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 4998170.5878ms
2025-05-07 09:57:04.050 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 09:57:04.050 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 09:57:04.050 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 09:57:04.077 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 09:57:04.077 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 09:57:04.077 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 09:57:04.447 +07:00 [INF] Executed DbCommand (59ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 09:57:04.447 +07:00 [INF] Executed DbCommand (54ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 09:57:04.447 +07:00 [INF] Executed DbCommand (48ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 09:57:05.745 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 09:57:05.745 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 09:57:05.745 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 09:57:05.746 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 09:57:05.747 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 09:57:05.746 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 09:57:05.746 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 09:57:05.752 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 09:57:05.750 +07:00 [ERR] Connection id "0HNCCVDNE1Q14", Request id "0HNCCVDNE1Q14:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 09:57:05.751 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 09:57:05.752 +07:00 [ERR] Connection id "0HNCCVDNE1Q13", Request id "0HNCCVDNE1Q13:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 09:57:05.753 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 1703.4446ms
2025-05-07 09:57:05.754 +07:00 [ERR] Connection id "0HNCCVDNE1Q12", Request id "0HNCCVDNE1Q12:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 09:57:05.756 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 1706.5861ms
2025-05-07 09:57:05.758 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 1707.9423ms
2025-05-07 09:58:31.054 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 09:58:31.055 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 09:58:31.064 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 09:58:31.064 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 09:58:31.255 +07:00 [INF] Executed DbCommand (84ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 09:58:31.255 +07:00 [INF] Executed DbCommand (83ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 10:03:51.816 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 10:03:51.816 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 10:03:51.824 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 10:03:51.824 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 10:03:51.859 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 10:03:51.858 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 10:03:51.862 +07:00 [ERR] Connection id "0HNCCVDNE1Q16", Request id "0HNCCVDNE1Q16:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 10:03:51.862 +07:00 [ERR] Connection id "0HNCCVDNE1Q15", Request id "0HNCCVDNE1Q15:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 10:03:51.871 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 320814.878ms
2025-05-07 10:03:51.874 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 320821.193ms
2025-05-07 10:05:27.482 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 53
2025-05-07 10:05:27.519 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:05:27.538 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 10:05:27.732 +07:00 [INF] Executed DbCommand (55ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 10:05:27.786 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 10:05:27.795 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 255.8886ms
2025-05-07 10:05:27.796 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:05:27.797 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 315.0407ms
2025-05-07 10:05:29.635 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - null null
2025-05-07 10:05:29.638 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:05:29.638 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 10:05:29.689 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 10:05:29.690 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:05:29.692 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 54.2787ms
2025-05-07 10:05:29.692 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:05:29.693 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - 200 null application/json; charset=utf-8 57.7071ms
2025-05-07 10:05:29.825 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - null null
2025-05-07 10:05:29.826 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:05:29.827 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:05:29.847 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:05:29.849 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 21.4966ms
2025-05-07 10:05:29.849 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:05:29.849 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 23.639ms
2025-05-07 10:05:30.207 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 10:05:30.207 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 10:05:30.410 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 10:05:46.713 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 10:05:46.715 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:05:46.715 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 10:05:46.761 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 10:05:46.766 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 10:05:46.768 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 52.6713ms
2025-05-07 10:05:46.768 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:05:46.770 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 56.7129ms
2025-05-07 10:05:47.892 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 10:05:47.892 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:05:47.893 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:05:47.894 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:05:47.895 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.6145ms
2025-05-07 10:05:47.895 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:05:47.896 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 3.6814ms
2025-05-07 10:05:48.312 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 10:05:48.312 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 10:05:48.432 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 10:05:50.814 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 10:05:50.815 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:05:50.815 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 10:05:50.832 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 10:05:50.832 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:05:50.833 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 17.0754ms
2025-05-07 10:05:50.833 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:05:50.833 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 18.7832ms
2025-05-07 10:06:58.519 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-07 10:06:58.519 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:06:58.526 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 10:06:58.586 +07:00 [INF] Retrieved 54 messages from Redis for conversation 4
2025-05-07 10:06:58.592 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-07 10:06:58.594 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:06:58.597 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 71.1549ms
2025-05-07 10:06:58.601 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:06:58.601 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 82.5421ms
2025-05-07 10:06:58.706 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 10:06:58.706 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:06:58.707 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:06:58.768 +07:00 [INF] Executed DbCommand (32ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 10:06:58.769 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 10:06:58.770 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 61.9905ms
2025-05-07 10:06:58.770 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:06:58.770 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 63.9439ms
2025-05-07 10:06:58.821 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 10:06:58.821 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:06:58.822 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 10:06:58.833 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 10:06:58.836 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:06:58.837 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 14.3845ms
2025-05-07 10:06:58.837 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:06:58.837 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 16.0638ms
2025-05-07 10:07:01.784 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 10:07:01.784 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:07:01.785 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 10:07:01.792 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 10:07:01.794 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:07:01.794 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.5983ms
2025-05-07 10:07:01.795 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:07:01.795 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 10.9894ms
2025-05-07 10:07:06.639 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 10:07:06.640 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:07:06.640 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 10:07:06.643 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 10:07:06.644 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:07:06.644 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.9527ms
2025-05-07 10:07:06.645 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:07:06.645 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 5.2316ms
2025-05-07 10:07:14.044 +07:00 [INF] Request starting HTTP/1.1 PUT http://192.168.1.10:5053/api/Participant/update_nickname/5/4 - application/json 19
2025-05-07 10:07:14.044 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.UpdateNickName (Message_app)'
2025-05-07 10:07:14.094 +07:00 [INF] Route matched with {action = "UpdateNickName", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateNickName(Int32, Int32, server.DTO.NicknameUpdateRequest) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 10:07:14.206 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversation_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__user_id_0 AND [p].[conversation_id] = @__conversation_id_1 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 10:07:14.275 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Participants] SET [name] = @p0
OUTPUT 1
WHERE [id] = @p1;
2025-05-07 10:07:14.355 +07:00 [INF] Request starting HTTP/1.1 PUT http://192.168.1.10:5053/api/Participant/update_nickname/5/4 - application/json 19
2025-05-07 10:07:14.356 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.UpdateNickName (Message_app)'
2025-05-07 10:07:14.356 +07:00 [INF] Route matched with {action = "UpdateNickName", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateNickName(Int32, Int32, server.DTO.NicknameUpdateRequest) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 10:07:14.371 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__user_id_1='?' (DbType = Int32), @__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) COALESCE((
    SELECT TOP(1) [p].[user_id]
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] <> @__user_id_1 AND [p].[is_deleted] = CAST(0 AS bit)), 0)
FROM [Conversations] AS [c]
WHERE [c].[id] = @__conversation_id_0
2025-05-07 10:07:14.420 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversation_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__user_id_0 AND [p].[conversation_id] = @__conversation_id_1 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 10:07:14.422 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_id_1='?' (DbType = Int32), @__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) COALESCE((
    SELECT TOP(1) [p].[user_id]
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] <> @__user_id_1 AND [p].[is_deleted] = CAST(0 AS bit)), 0)
FROM [Conversations] AS [c]
WHERE [c].[id] = @__conversation_id_0
2025-05-07 10:07:14.798 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:07:14.798 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:07:14.808 +07:00 [INF] Executed action server.Controllers.ParticipantController.UpdateNickName (Message_app) in 451.8693ms
2025-05-07 10:07:14.808 +07:00 [INF] Executed action server.Controllers.ParticipantController.UpdateNickName (Message_app) in 714.3316ms
2025-05-07 10:07:14.808 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.UpdateNickName (Message_app)'
2025-05-07 10:07:14.808 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.UpdateNickName (Message_app)'
2025-05-07 10:07:14.808 +07:00 [INF] Request finished HTTP/1.1 PUT http://192.168.1.10:5053/api/Participant/update_nickname/5/4 - 200 null application/json; charset=utf-8 452.9331ms
2025-05-07 10:07:14.808 +07:00 [INF] Request finished HTTP/1.1 PUT http://192.168.1.10:5053/api/Participant/update_nickname/5/4 - 200 null application/json; charset=utf-8 764.5076ms
2025-05-07 10:07:15.416 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 10:07:15.416 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:07:15.417 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:07:15.455 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 10:07:15.457 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:07:15.458 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 41.2561ms
2025-05-07 10:07:15.458 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:07:15.459 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 42.8842ms
2025-05-07 10:07:23.349 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-07 10:07:23.350 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:07:23.350 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 10:07:23.410 +07:00 [INF] Retrieved 54 messages from Redis for conversation 4
2025-05-07 10:07:23.410 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-07 10:07:23.410 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:07:23.411 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 60.9682ms
2025-05-07 10:07:23.411 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:07:23.411 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 62.4322ms
2025-05-07 10:07:23.454 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 10:07:23.455 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:07:23.455 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:07:23.461 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 10:07:23.462 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 10:07:23.462 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.6665ms
2025-05-07 10:07:23.463 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:07:23.463 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 8.5686ms
2025-05-07 10:07:23.513 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 10:07:23.514 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:07:23.515 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 10:07:23.521 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 10:07:23.522 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:07:23.523 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.4438ms
2025-05-07 10:07:23.523 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:07:23.523 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 11.9464ms
2025-05-07 10:11:28.929 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 10:11:28.930 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 10:11:28.938 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 10:11:28.940 +07:00 [ERR] Connection id "0HNCCVDNE1Q1D", Request id "0HNCCVDNE1Q1D:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 10:11:28.946 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 340634.3028ms
2025-05-07 10:22:14.110 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 10:22:14.119 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:22:14.125 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 10:22:14.271 +07:00 [INF] Executed DbCommand (52ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 10:22:14.295 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 10:22:14.298 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 172.3812ms
2025-05-07 10:22:14.298 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:22:14.298 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 188.3063ms
2025-05-07 10:22:15.408 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 10:22:15.409 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:22:15.410 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 10:22:15.420 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 10:22:15.420 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:22:15.420 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:22:15.426 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:22:15.427 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 6.3099ms
2025-05-07 10:22:15.427 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:22:15.427 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 7.028ms
2025-05-07 10:22:15.441 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 10:22:15.441 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:22:15.441 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 31.7508ms
2025-05-07 10:22:15.441 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:22:15.442 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 33.241ms
2025-05-07 10:22:15.977 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 10:22:15.977 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 10:22:16.098 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 10:22:19.673 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-07 10:22:19.673 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:22:19.674 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 10:22:19.692 +07:00 [INF] Retrieved 54 messages from Redis for conversation 4
2025-05-07 10:22:19.693 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-07 10:22:19.694 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:22:19.695 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 20.9337ms
2025-05-07 10:22:19.695 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:22:19.695 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 23.9982ms
2025-05-07 10:22:19.788 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 10:22:19.789 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:22:19.789 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:22:19.820 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 10:22:19.820 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 10:22:19.820 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 30.3292ms
2025-05-07 10:22:19.820 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:22:19.821 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 32.1403ms
2025-05-07 10:22:19.858 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 10:22:19.858 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:22:19.858 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 10:22:19.869 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 10:22:19.870 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:22:19.871 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 12.4515ms
2025-05-07 10:22:19.871 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:22:19.871 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 13.1106ms
2025-05-07 10:22:34.476 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 52
2025-05-07 10:22:34.477 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:22:34.477 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 10:22:34.492 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 10:22:34.496 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-05-07 10:22:34.499 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 21.2534ms
2025-05-07 10:22:34.499 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:22:34.499 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 400 null application/json; charset=utf-8 22.8432ms
2025-05-07 10:22:44.716 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 53
2025-05-07 10:22:44.716 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:22:44.716 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 10:22:44.723 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 10:22:44.725 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 10:22:44.727 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 10.6425ms
2025-05-07 10:22:44.727 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:22:44.727 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 11.3208ms
2025-05-07 10:22:45.436 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - null null
2025-05-07 10:22:45.436 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:22:45.437 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 10:22:45.452 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 10:22:45.453 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:22:45.454 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 16.8761ms
2025-05-07 10:22:45.454 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:22:45.455 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - 200 null application/json; charset=utf-8 19.0463ms
2025-05-07 10:22:45.520 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - null null
2025-05-07 10:22:45.520 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:22:45.521 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:22:45.563 +07:00 [INF] Executed DbCommand (37ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 10:22:45.567 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:22:45.568 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 46.9342ms
2025-05-07 10:22:45.568 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:22:45.568 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 48.1733ms
2025-05-07 10:22:45.679 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 10:22:45.680 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 10:22:45.762 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 10:22:50.177 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-07 10:22:50.177 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:22:50.178 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 10:22:50.199 +07:00 [INF] Retrieved 54 messages from Redis for conversation 4
2025-05-07 10:22:50.200 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-07 10:22:50.200 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:22:50.200 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 21.9978ms
2025-05-07 10:22:50.200 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:22:50.200 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 23.3208ms
2025-05-07 10:22:50.239 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 10:22:50.239 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:22:50.239 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:22:50.245 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 10:22:50.245 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 10:22:50.246 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.4719ms
2025-05-07 10:22:50.246 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:22:50.246 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 7.1556ms
2025-05-07 10:22:50.266 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 10:22:50.266 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:22:50.266 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 10:22:50.271 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 10:22:50.272 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:22:50.274 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.2386ms
2025-05-07 10:22:50.274 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:22:50.274 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 7.9931ms
2025-05-07 10:22:53.645 +07:00 [INF] Handling message from user 2: vg
2025-05-07 10:22:53.653 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 10:22:53.688 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 10:22:53.722 +07:00 [INF] Executed DbCommand (32ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 10:22:53.726 +07:00 [INF] Message saved to DB with ID: 131
2025-05-07 10:22:53.729 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 10:22:53.738 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 10:22:53.743 +07:00 [INF] Transaction committed for message: 131
2025-05-07 10:22:53.748 +07:00 [INF] Saved message 131 to Redis
2025-05-07 10:22:53.749 +07:00 [INF] Added message 131 to conversation 4
2025-05-07 10:22:53.750 +07:00 [INF] Published message to channel conversation:4
2025-05-07 10:22:58.298 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 10:22:58.299 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:22:58.301 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 10:22:58.310 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 10:22:58.311 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:22:58.311 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.4626ms
2025-05-07 10:22:58.311 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:22:58.311 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 13.3917ms
2025-05-07 10:23:05.158 +07:00 [INF] Request starting HTTP/1.1 PUT http://192.168.1.10:5053/api/Participant/update_nickname/5/4 - application/json 19
2025-05-07 10:23:05.160 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.UpdateNickName (Message_app)'
2025-05-07 10:23:05.160 +07:00 [INF] Route matched with {action = "UpdateNickName", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateNickName(Int32, Int32, server.DTO.NicknameUpdateRequest) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 10:23:05.172 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversation_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__user_id_0 AND [p].[conversation_id] = @__conversation_id_1 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 10:23:05.182 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Participants] SET [name] = @p0
OUTPUT 1
WHERE [id] = @p1;
2025-05-07 10:23:05.212 +07:00 [INF] Executed DbCommand (26ms) [Parameters=[@__user_id_1='?' (DbType = Int32), @__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) COALESCE((
    SELECT TOP(1) [p].[user_id]
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] <> @__user_id_1 AND [p].[is_deleted] = CAST(0 AS bit)), 0)
FROM [Conversations] AS [c]
WHERE [c].[id] = @__conversation_id_0
2025-05-07 10:23:05.218 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:23:05.218 +07:00 [INF] Executed action server.Controllers.ParticipantController.UpdateNickName (Message_app) in 57.6686ms
2025-05-07 10:23:05.218 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.UpdateNickName (Message_app)'
2025-05-07 10:23:05.218 +07:00 [INF] Request finished HTTP/1.1 PUT http://192.168.1.10:5053/api/Participant/update_nickname/5/4 - 200 null application/json; charset=utf-8 62.6999ms
2025-05-07 10:23:11.899 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 10:23:11.899 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:23:11.899 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:23:11.904 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 10:23:11.908 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:23:11.909 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 9.7704ms
2025-05-07 10:23:11.910 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:23:11.910 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 11.0296ms
2025-05-07 10:29:28.000 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 10:29:28.010 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 10:29:28.043 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 10:29:28.044 +07:00 [ERR] Connection id "0HNCCVDNE1Q1T", Request id "0HNCCVDNE1Q1T:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 10:29:28.051 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 432073.6654ms
2025-05-07 10:34:36.466 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 10:34:36.483 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:34:36.487 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 10:34:36.612 +07:00 [INF] Executed DbCommand (38ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 10:34:36.623 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 10:34:36.624 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 136.1974ms
2025-05-07 10:34:36.624 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:34:36.624 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 158.3395ms
2025-05-07 10:34:37.608 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 10:34:37.609 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:34:37.610 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 10:34:37.640 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 10:34:37.641 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:34:37.642 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 31.881ms
2025-05-07 10:34:37.643 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:34:37.643 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 34.9561ms
2025-05-07 10:34:37.789 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 10:34:37.789 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:34:37.789 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:34:37.800 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:34:37.801 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 11.3006ms
2025-05-07 10:34:37.801 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:34:37.801 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 12.3734ms
2025-05-07 10:34:38.361 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 10:34:38.362 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 10:34:38.463 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 10:34:40.215 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 10:34:40.217 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:34:40.273 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:34:40.340 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:34:40.345 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:34:40.482 +07:00 [INF] Executed DbCommand (90ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 10:34:40.555 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-07 10:34:40.644 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__user_id_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] IN (
    SELECT [u0].[value]
    FROM OPENJSON(@__user_id_0) WITH ([value] int '$') AS [u0]
)
2025-05-07 10:34:40.685 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-07 10:34:40.701 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN (
    SELECT [p].[id] AS [Id], [p].[user_id], [p].[conversation_id] AS [ConversationId], [p].[name] AS [Name], [p].[is_deleted] AS [IsDeleted], [p].[img_url]
    FROM [Participants] AS [p]
    WHERE [p].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 10:34:40.702 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 10:34:40.702 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 429.1892ms
2025-05-07 10:34:40.702 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:34:40.702 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 486.9944ms
2025-05-07 10:37:01.417 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/4 - null null
2025-05-07 10:37:01.418 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:37:01.418 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:37:01.431 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:37:01.433 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:37:01.494 +07:00 [INF] Executed DbCommand (59ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 10:37:01.494 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 10:37:01.495 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 76.5856ms
2025-05-07 10:37:01.495 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:37:01.495 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/4 - 200 null application/json; charset=utf-8 77.404ms
2025-05-07 10:40:39.593 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/4 - null null
2025-05-07 10:40:39.594 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:40:39.594 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:40:39.613 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:40:39.615 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:40:39.671 +07:00 [INF] Executed DbCommand (56ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 10:40:39.672 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 10:40:39.672 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 78.3169ms
2025-05-07 10:40:39.672 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:40:39.672 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/4 - 200 null application/json; charset=utf-8 78.891ms
2025-05-07 10:40:43.954 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 10:40:43.954 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 10:40:43.959 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 10:40:43.959 +07:00 [ERR] Connection id "0HNCCVDNE1Q1A", Request id "0HNCCVDNE1Q1A:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 10:40:43.961 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 2113753.9286ms
2025-05-07 10:40:43.976 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 10:40:43.977 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 10:40:43.978 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 10:40:43.978 +07:00 [ERR] Connection id "0HNCCVDNE1Q25", Request id "0HNCCVDNE1Q25:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 10:40:43.980 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 1078301.1017ms
2025-05-07 10:40:48.284 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 10:40:48.285 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 10:40:48.285 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 10:40:48.285 +07:00 [ERR] Connection id "0HNCCVDNE1Q2F", Request id "0HNCCVDNE1Q2F:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 10:40:48.288 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 369926.8797ms
2025-05-07 10:44:41.316 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 53
2025-05-07 10:44:41.354 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:44:41.363 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 10:44:41.509 +07:00 [INF] Executed DbCommand (56ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 10:44:41.528 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 10:44:41.533 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 168.1603ms
2025-05-07 10:44:41.533 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:44:41.534 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 220.2595ms
2025-05-07 10:44:42.664 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - null null
2025-05-07 10:44:42.665 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:44:42.666 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 10:44:42.704 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 10:44:42.705 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:44:42.705 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 39.3036ms
2025-05-07 10:44:42.705 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:44:42.705 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - 200 null application/json; charset=utf-8 41.6032ms
2025-05-07 10:44:42.851 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - null null
2025-05-07 10:44:42.852 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:44:42.852 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:44:42.899 +07:00 [INF] Executed DbCommand (42ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 10:44:42.903 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:44:42.905 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 52.9155ms
2025-05-07 10:44:42.905 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:44:42.905 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 53.6729ms
2025-05-07 10:44:43.264 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 10:44:43.265 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 10:44:43.351 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 10:47:46.611 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/3 - null null
2025-05-07 10:47:46.612 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:47:46.612 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:47:46.633 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:47:46.636 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:47:46.717 +07:00 [INF] Executed DbCommand (78ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 10:47:46.756 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-07 10:47:46.783 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__user_id_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] IN (
    SELECT [u0].[value]
    FROM OPENJSON(@__user_id_0) WITH ([value] int '$') AS [u0]
)
2025-05-07 10:47:46.818 +07:00 [INF] Executed DbCommand (29ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-07 10:47:46.828 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN (
    SELECT [p].[id] AS [Id], [p].[user_id], [p].[conversation_id] AS [ConversationId], [p].[name] AS [Name], [p].[is_deleted] AS [IsDeleted], [p].[img_url]
    FROM [Participants] AS [p]
    WHERE [p].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 10:47:46.828 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 10:47:46.828 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 216.3873ms
2025-05-07 10:47:46.828 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:47:46.828 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/3 - 200 null application/json; charset=utf-8 217.1806ms
2025-05-07 10:51:41.747 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/3 - null null
2025-05-07 10:51:41.748 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:51:41.748 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:51:41.762 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:51:41.765 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:51:41.837 +07:00 [INF] Executed DbCommand (71ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 10:51:41.838 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 10:51:41.839 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 90.6359ms
2025-05-07 10:51:41.839 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:51:41.839 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/3 - 200 null application/json; charset=utf-8 92.2459ms
2025-05-07 10:51:45.491 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 10:51:45.494 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 10:51:45.512 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 10:51:45.513 +07:00 [ERR] Connection id "0HNCCVDNE1Q2L", Request id "0HNCCVDNE1Q2L:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 10:51:45.521 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 422256.5073ms
2025-05-07 10:53:01.968 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 53
2025-05-07 10:53:01.968 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:53:01.969 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 10:53:01.993 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 10:53:01.995 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 10:53:01.995 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 25.9533ms
2025-05-07 10:53:01.995 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 10:53:01.995 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 27.7888ms
2025-05-07 10:53:02.905 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - null null
2025-05-07 10:53:02.905 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:53:02.905 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 10:53:02.925 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 10:53:02.925 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:53:02.925 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 20.292ms
2025-05-07 10:53:02.925 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 10:53:02.925 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - 200 null application/json; charset=utf-8 20.6542ms
2025-05-07 10:53:03.420 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - null null
2025-05-07 10:53:03.420 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:53:03.421 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:53:03.427 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:53:03.428 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 6.9983ms
2025-05-07 10:53:03.428 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 10:53:03.428 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 7.9608ms
2025-05-07 10:53:03.546 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 10:53:03.546 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 10:53:03.605 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 10:53:03.637 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 10:53:05.752 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/3 - null null
2025-05-07 10:53:05.753 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:53:05.753 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:53:05.757 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:53:05.758 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:53:05.832 +07:00 [INF] Executed DbCommand (73ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 10:53:05.832 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 10:53:05.832 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 79.7288ms
2025-05-07 10:53:05.832 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:53:05.832 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/3 - 200 null application/json; charset=utf-8 80.0004ms
2025-05-07 10:56:07.756 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/3 - null null
2025-05-07 10:56:07.756 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:56:07.757 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:56:07.772 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:56:07.773 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:56:07.838 +07:00 [INF] Executed DbCommand (62ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 10:56:07.840 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 10:56:07.841 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 83.2518ms
2025-05-07 10:56:07.841 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:56:07.841 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/3 - 200 null application/json; charset=utf-8 85.4483ms
2025-05-07 10:56:08.115 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/9/5 - null null
2025-05-07 10:56:08.115 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:56:08.115 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 10:56:08.122 +07:00 [INF] Retrieved 0 messages from Redis for conversation 9
2025-05-07 10:56:08.270 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 10:56:08.380 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 10:56:08.386 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 10:56:08.401 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 285.3801ms
2025-05-07 10:56:08.401 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:56:08.401 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/9/5 - 404 null text/plain; charset=utf-8 286.3451ms
2025-05-07 10:56:08.444 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/9 - null null
2025-05-07 10:56:08.445 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:56:08.445 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:56:08.451 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 10:56:08.451 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 10:56:08.451 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.2257ms
2025-05-07 10:56:08.451 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:56:08.452 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/9 - 200 null application/json; charset=utf-8 7.7166ms
2025-05-07 10:56:08.484 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/9 - null null
2025-05-07 10:56:08.484 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:56:08.484 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 10:56:08.491 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 10:56:08.491 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:56:08.492 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.715ms
2025-05-07 10:56:08.492 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:56:08.492 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/9 - 200 null application/json; charset=utf-8 8.3592ms
2025-05-07 10:56:13.273 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/2 - null null
2025-05-07 10:56:13.273 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:56:13.273 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:56:13.279 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:56:13.281 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:56:13.346 +07:00 [INF] Executed DbCommand (64ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 10:56:13.347 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 10:56:13.347 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 73.3211ms
2025-05-07 10:56:13.347 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:56:13.347 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/2 - 200 null application/json; charset=utf-8 73.8296ms
2025-05-07 10:56:13.506 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - null null
2025-05-07 10:56:13.506 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:56:13.506 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 10:56:13.528 +07:00 [INF] Retrieved 55 messages from Redis for conversation 4
2025-05-07 10:56:13.528 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-07 10:56:13.528 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 10:56:13.529 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 22.7609ms
2025-05-07 10:56:13.529 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:56:13.529 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 23.4226ms
2025-05-07 10:56:13.664 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 10:56:13.665 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:56:13.665 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:56:13.669 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 10:56:13.669 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 10:56:13.670 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 4.6116ms
2025-05-07 10:56:13.670 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:56:13.670 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 5.8526ms
2025-05-07 10:56:13.793 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 10:56:13.793 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:56:13.793 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 10:56:13.798 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 10:56:13.799 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:56:13.799 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.5541ms
2025-05-07 10:56:13.799 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:56:13.799 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 6.1182ms
2025-05-07 10:56:17.204 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/4 - null null
2025-05-07 10:56:17.204 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:56:17.204 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:56:17.208 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:56:17.212 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 10:56:17.281 +07:00 [INF] Executed DbCommand (68ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 10:56:17.305 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-07 10:56:17.325 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__user_id_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] IN (
    SELECT [u0].[value]
    FROM OPENJSON(@__user_id_0) WITH ([value] int '$') AS [u0]
)
2025-05-07 10:56:17.361 +07:00 [INF] Executed DbCommand (33ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-07 10:56:17.370 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN (
    SELECT [p].[id] AS [Id], [p].[user_id], [p].[conversation_id] AS [ConversationId], [p].[name] AS [Name], [p].[is_deleted] AS [IsDeleted], [p].[img_url]
    FROM [Participants] AS [p]
    WHERE [p].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 10:56:17.370 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 10:56:17.371 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 166.6297ms
2025-05-07 10:56:17.371 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 10:56:17.371 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/4 - 200 null application/json; charset=utf-8 167.1052ms
2025-05-07 10:56:17.526 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/10/5 - null null
2025-05-07 10:56:17.526 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:56:17.526 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 10:56:17.527 +07:00 [INF] Retrieved 0 messages from Redis for conversation 10
2025-05-07 10:56:17.538 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 10:56:17.551 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 10:56:17.552 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 10:56:17.552 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 26.4376ms
2025-05-07 10:56:17.553 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 10:56:17.553 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/10/5 - 404 null text/plain; charset=utf-8 26.9412ms
2025-05-07 10:56:17.619 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/10 - null null
2025-05-07 10:56:17.620 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:56:17.620 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 10:56:17.624 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 10:56:17.625 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 10:56:17.625 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.0163ms
2025-05-07 10:56:17.625 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 10:56:17.625 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/10 - 200 null application/json; charset=utf-8 5.8342ms
2025-05-07 10:56:17.688 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/10 - null null
2025-05-07 10:56:17.689 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:56:17.689 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 10:56:17.695 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 10:56:17.695 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 10:56:17.695 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.3739ms
2025-05-07 10:56:17.695 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 10:56:17.695 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/10 - 200 null application/json; charset=utf-8 6.9865ms
2025-05-07 13:47:18.979 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 13:47:18.994 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 13:47:19.093 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 13:47:19.099 +07:00 [ERR] Connection id "0HNCCVDNE1Q2R", Request id "0HNCCVDNE1Q2R:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 13:47:19.118 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 10455566.8353ms
2025-05-07 13:49:41.070 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 13:49:41.108 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 13:49:41.112 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 13:49:41.387 +07:00 [INF] Executed DbCommand (133ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 13:49:41.414 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 13:49:41.418 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 304.5001ms
2025-05-07 13:49:41.418 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 13:49:41.418 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 349.8158ms
2025-05-07 13:49:42.530 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 13:49:42.534 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 13:49:42.535 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 13:49:42.574 +07:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 13:49:42.575 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:49:42.576 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 41.6837ms
2025-05-07 13:49:42.577 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 13:49:42.577 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 46.2169ms
2025-05-07 13:49:42.666 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 13:49:42.666 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 13:49:42.667 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:49:42.676 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 13:49:42.676 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 9.3151ms
2025-05-07 13:49:42.677 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 13:49:42.677 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 11.1586ms
2025-05-07 13:49:43.180 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 13:49:43.181 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 13:49:43.361 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 13:49:43.396 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 13:49:46.642 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/4 - null null
2025-05-07 13:49:46.643 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 13:49:46.643 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:49:46.670 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 13:49:46.672 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 13:49:46.766 +07:00 [INF] Executed DbCommand (89ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 13:49:46.769 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 13:49:46.770 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 126.5079ms
2025-05-07 13:49:46.770 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 13:49:46.770 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/4 - 200 null application/json; charset=utf-8 127.7728ms
2025-05-07 13:49:47.379 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/3/2 - null null
2025-05-07 13:49:47.380 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:49:47.381 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 13:49:47.391 +07:00 [INF] Retrieved 6 messages from Redis for conversation 3
2025-05-07 13:49:47.393 +07:00 [INF] Retrieved 6 messages from Redis for conversation 3 and user 2
2025-05-07 13:49:47.393 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 13:49:47.394 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 12.7453ms
2025-05-07 13:49:47.394 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:49:47.394 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/3/2 - 200 null application/json; charset=utf-8 15.0409ms
2025-05-07 13:49:47.445 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/3 - null null
2025-05-07 13:49:47.445 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:49:47.446 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:49:47.456 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:49:47.457 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 13:49:47.458 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 12.6154ms
2025-05-07 13:49:47.458 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:49:47.458 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/3 - 200 null application/json; charset=utf-8 13.1612ms
2025-05-07 13:49:47.501 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - null null
2025-05-07 13:49:47.501 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:49:47.501 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 13:49:47.506 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 13:49:47.509 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:49:47.509 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.8375ms
2025-05-07 13:49:47.509 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:49:47.510 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - 200 null application/json; charset=utf-8 8.597ms
2025-05-07 13:49:52.432 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 13:49:52.433 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 13:49:52.433 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:49:52.435 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 13:49:52.437 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 13:49:52.440 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 13:49:52.440 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 13:49:52.441 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 7.185ms
2025-05-07 13:49:52.441 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 13:49:52.441 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 8.5581ms
2025-05-07 13:49:52.700 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/8/2 - null null
2025-05-07 13:49:52.701 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:49:52.701 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 13:49:52.703 +07:00 [INF] Retrieved 0 messages from Redis for conversation 8
2025-05-07 13:49:52.761 +07:00 [INF] Executed DbCommand (45ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 13:49:52.785 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 13:49:52.787 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 13:49:52.789 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 87.4904ms
2025-05-07 13:49:52.789 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:49:52.789 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/8/2 - 404 null text/plain; charset=utf-8 88.358ms
2025-05-07 13:49:52.824 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/8 - null null
2025-05-07 13:49:52.824 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:49:52.824 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:49:52.826 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:49:52.826 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 13:49:52.826 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 1.935ms
2025-05-07 13:49:52.827 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:49:52.827 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/8 - 200 null application/json; charset=utf-8 2.8351ms
2025-05-07 13:49:52.847 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/8 - null null
2025-05-07 13:49:52.847 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:49:52.847 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 13:49:52.849 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 13:49:52.849 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:49:52.850 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 2.8096ms
2025-05-07 13:49:52.850 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:49:52.850 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/8 - 200 null application/json; charset=utf-8 3.204ms
2025-05-07 13:49:56.681 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/3/2 - null null
2025-05-07 13:49:56.681 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:49:56.681 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 13:49:56.685 +07:00 [INF] Retrieved 6 messages from Redis for conversation 3
2025-05-07 13:49:56.687 +07:00 [INF] Retrieved 6 messages from Redis for conversation 3 and user 2
2025-05-07 13:49:56.687 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 13:49:56.687 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 5.7508ms
2025-05-07 13:49:56.687 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:49:56.687 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/3/2 - 200 null application/json; charset=utf-8 6.3111ms
2025-05-07 13:49:56.717 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/3 - null null
2025-05-07 13:49:56.717 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:49:56.718 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:49:56.723 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:49:56.724 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 13:49:56.724 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.1478ms
2025-05-07 13:49:56.724 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:49:56.724 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/3 - 200 null application/json; charset=utf-8 7.1507ms
2025-05-07 13:49:56.743 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - null null
2025-05-07 13:49:56.743 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:49:56.743 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 13:49:56.745 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 13:49:56.746 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:49:56.746 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 2.7748ms
2025-05-07 13:49:56.746 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:49:56.746 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - 200 null application/json; charset=utf-8 3.6339ms
2025-05-07 13:49:58.653 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/5 - null null
2025-05-07 13:49:58.654 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 13:49:58.654 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:49:58.657 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 13:49:58.658 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 13:49:58.659 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 13:49:58.660 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 13:49:58.660 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 6.2578ms
2025-05-07 13:49:58.660 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 13:49:58.660 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/5 - 200 null application/json; charset=utf-8 7.0163ms
2025-05-07 13:49:59.174 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-07 13:49:59.174 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:49:59.174 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 13:49:59.196 +07:00 [INF] Retrieved 55 messages from Redis for conversation 4
2025-05-07 13:49:59.196 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-07 13:49:59.196 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 13:49:59.197 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 23.1451ms
2025-05-07 13:49:59.197 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:49:59.197 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 23.4885ms
2025-05-07 13:49:59.272 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 13:49:59.272 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:49:59.273 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:49:59.274 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:49:59.275 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 13:49:59.275 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 2.3382ms
2025-05-07 13:49:59.275 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:49:59.275 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 3.5491ms
2025-05-07 13:49:59.301 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 13:49:59.301 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:49:59.301 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 13:49:59.305 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 13:49:59.305 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:49:59.305 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.5493ms
2025-05-07 13:49:59.305 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:49:59.306 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 5.4292ms
2025-05-07 13:50:53.228 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 53
2025-05-07 13:50:53.228 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 13:50:53.228 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 13:50:53.243 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 13:50:53.243 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 13:50:53.244 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 15.396ms
2025-05-07 13:50:53.244 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 13:50:53.244 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 16.077ms
2025-05-07 13:50:54.353 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - null null
2025-05-07 13:50:54.353 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 13:50:54.353 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 13:50:54.361 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 13:50:54.362 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:50:54.362 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 8.6296ms
2025-05-07 13:50:54.362 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 13:50:54.362 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - 200 null application/json; charset=utf-8 9.1585ms
2025-05-07 13:50:54.841 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - null null
2025-05-07 13:50:54.841 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 13:50:54.841 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:50:54.842 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 13:50:54.842 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.0081ms
2025-05-07 13:50:54.842 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 13:50:54.842 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 1.36ms
2025-05-07 13:50:54.985 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 13:50:54.985 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 13:50:55.143 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 13:50:55.150 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 13:50:55.153 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 13:51:00.739 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - null null
2025-05-07 13:51:00.739 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:51:00.739 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 13:51:00.753 +07:00 [INF] Retrieved 55 messages from Redis for conversation 4
2025-05-07 13:51:00.753 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-07 13:51:00.754 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 13:51:00.754 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 14.363ms
2025-05-07 13:51:00.754 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:51:00.754 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 15.7458ms
2025-05-07 13:51:00.926 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 13:51:00.927 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:51:00.927 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:51:00.932 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:51:00.932 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 13:51:00.932 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.0201ms
2025-05-07 13:51:00.932 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:51:00.932 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 5.5106ms
2025-05-07 13:51:00.985 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 13:51:00.985 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:51:00.986 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 13:51:00.991 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 13:51:00.992 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:51:00.992 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.7154ms
2025-05-07 13:51:00.992 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:51:00.992 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 6.5723ms
2025-05-07 13:51:11.311 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/2 - null null
2025-05-07 13:51:11.312 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 13:51:11.312 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:51:11.318 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 13:51:11.320 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 13:51:11.382 +07:00 [INF] Executed DbCommand (61ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 13:51:11.382 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 13:51:11.382 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 70.1833ms
2025-05-07 13:51:11.382 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 13:51:11.382 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/5/2 - 200 null application/json; charset=utf-8 70.4359ms
2025-05-07 13:51:11.563 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - null null
2025-05-07 13:51:11.563 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:51:11.563 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 13:51:11.586 +07:00 [INF] Retrieved 55 messages from Redis for conversation 4
2025-05-07 13:51:11.587 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-07 13:51:11.587 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 13:51:11.587 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 23.3794ms
2025-05-07 13:51:11.587 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:51:11.587 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 23.8561ms
2025-05-07 13:51:11.684 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 13:51:11.684 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:51:11.684 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:51:11.688 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:51:11.689 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 13:51:11.689 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 4.8518ms
2025-05-07 13:51:11.689 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:51:11.689 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 5.1331ms
2025-05-07 13:51:11.739 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 13:51:11.739 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:51:11.739 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 13:51:11.746 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 13:51:11.746 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:51:11.747 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.7127ms
2025-05-07 13:51:11.747 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:51:11.747 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 8.1403ms
2025-05-07 13:51:48.906 +07:00 [INF] Handling message from user 5: kjn
2025-05-07 13:51:48.919 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:51:48.942 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 13:51:48.975 +07:00 [INF] Executed DbCommand (33ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 13:51:48.977 +07:00 [INF] Message saved to DB with ID: 132
2025-05-07 13:51:48.980 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 13:51:48.994 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 13:51:48.997 +07:00 [INF] Transaction committed for message: 132
2025-05-07 13:51:49.000 +07:00 [INF] Saved message 132 to Redis
2025-05-07 13:51:49.001 +07:00 [INF] Added message 132 to conversation 4
2025-05-07 13:51:49.002 +07:00 [INF] Published message to channel conversation:4
2025-05-07 13:52:00.419 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-07 13:52:00.419 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:52:00.419 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 13:52:00.428 +07:00 [INF] Retrieved 56 messages from Redis for conversation 4
2025-05-07 13:52:00.428 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-07 13:52:00.428 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 13:52:00.429 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 9.4497ms
2025-05-07 13:52:00.429 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:52:00.429 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 10.0047ms
2025-05-07 13:52:00.476 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 13:52:00.476 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:52:00.476 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:52:00.481 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:52:00.481 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 13:52:00.481 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 4.7589ms
2025-05-07 13:52:00.481 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:52:00.481 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 5.2194ms
2025-05-07 13:52:00.515 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 13:52:00.515 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:52:00.516 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 13:52:00.520 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 13:52:00.521 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:52:00.521 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.9839ms
2025-05-07 13:52:00.521 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:52:00.521 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 5.462ms
2025-05-07 13:52:03.108 +07:00 [INF] Handling message from user 2: bv
2025-05-07 13:52:03.113 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:52:03.121 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 13:52:03.127 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 13:52:03.127 +07:00 [INF] Message saved to DB with ID: 133
2025-05-07 13:52:03.129 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 13:52:03.134 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 13:52:03.135 +07:00 [INF] Transaction committed for message: 133
2025-05-07 13:52:03.139 +07:00 [INF] Saved message 133 to Redis
2025-05-07 13:52:03.139 +07:00 [INF] Added message 133 to conversation 4
2025-05-07 13:52:03.140 +07:00 [INF] Published message to channel conversation:4
2025-05-07 13:52:07.968 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 13:52:07.968 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 13:52:07.968 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:52:07.975 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 13:52:07.978 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 13:52:08.037 +07:00 [INF] Executed DbCommand (58ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 13:52:08.037 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 13:52:08.037 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 68.6233ms
2025-05-07 13:52:08.037 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 13:52:08.037 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 69.3467ms
2025-05-07 13:52:08.189 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/8/2 - null null
2025-05-07 13:52:08.189 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:52:08.189 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 13:52:08.190 +07:00 [INF] Retrieved 0 messages from Redis for conversation 8
2025-05-07 13:52:08.198 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 13:52:08.210 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 13:52:08.210 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 13:52:08.210 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 20.839ms
2025-05-07 13:52:08.210 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:52:08.210 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/8/2 - 404 null text/plain; charset=utf-8 21.1691ms
2025-05-07 13:52:08.336 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/8 - null null
2025-05-07 13:52:08.336 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:52:08.336 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:52:08.340 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:52:08.340 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 13:52:08.340 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 4.0105ms
2025-05-07 13:52:08.340 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:52:08.340 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/8 - 200 null application/json; charset=utf-8 4.3019ms
2025-05-07 13:52:08.359 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/8 - null null
2025-05-07 13:52:08.359 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:52:08.359 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 13:52:08.362 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 13:52:08.363 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:52:08.363 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.5348ms
2025-05-07 13:52:08.363 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:52:08.363 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/8 - 200 null application/json; charset=utf-8 3.9396ms
2025-05-07 13:52:11.799 +07:00 [INF] Handling message from user 2: bjvj
2025-05-07 13:52:11.803 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:52:11.805 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 13:52:11.811 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 13:52:11.811 +07:00 [INF] Message saved to DB with ID: 134
2025-05-07 13:52:11.811 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 13:52:11.816 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 13:52:11.817 +07:00 [INF] Transaction committed for message: 134
2025-05-07 13:52:11.819 +07:00 [INF] Saved message 134 to Redis
2025-05-07 13:52:11.820 +07:00 [INF] Added message 134 to conversation 8
2025-05-07 13:52:11.820 +07:00 [INF] Published message to channel conversation:8
2025-05-07 13:54:15.315 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 13:54:15.317 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 13:54:15.317 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 13:54:15.336 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 13:54:15.337 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 13:54:15.337 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 19.5461ms
2025-05-07 13:54:15.337 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 13:54:15.337 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 22.0913ms
2025-05-07 13:54:15.531 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 13:54:15.531 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 13:54:15.531 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 13:54:15.546 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 13:54:15.547 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:54:15.547 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 15.7696ms
2025-05-07 13:54:15.547 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 13:54:15.547 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 16.2761ms
2025-05-07 13:54:15.869 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 13:54:15.870 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 13:54:15.870 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:54:15.873 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 13:54:15.873 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.6523ms
2025-05-07 13:54:15.873 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 13:54:15.873 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.0256ms
2025-05-07 13:54:16.029 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 13:54:16.029 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 13:54:16.050 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 13:54:26.730 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 13:54:26.730 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 13:54:26.730 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:54:26.739 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 13:54:26.742 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 13:54:26.816 +07:00 [INF] Executed DbCommand (72ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 13:54:26.817 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 13:54:26.817 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 86.3933ms
2025-05-07 13:54:26.817 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 13:54:26.817 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 86.8317ms
2025-05-07 13:54:27.043 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/8/2 - null null
2025-05-07 13:54:27.043 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:54:27.043 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 13:54:27.046 +07:00 [INF] Retrieved 1 messages from Redis for conversation 8
2025-05-07 13:54:27.052 +07:00 [INF] Retrieved 1 messages from Redis for conversation 8 and user 2
2025-05-07 13:54:27.052 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 13:54:27.052 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 8.3396ms
2025-05-07 13:54:27.052 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:54:27.052 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/8/2 - 200 null application/json; charset=utf-8 8.8311ms
2025-05-07 13:54:27.069 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/8 - null null
2025-05-07 13:54:27.070 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:54:27.070 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:54:27.073 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:54:27.074 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 13:54:27.074 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 3.8281ms
2025-05-07 13:54:27.074 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:54:27.074 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/8 - 200 null application/json; charset=utf-8 4.2806ms
2025-05-07 13:54:27.093 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/8 - null null
2025-05-07 13:54:27.093 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:54:27.094 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 13:54:27.100 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 13:54:27.101 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:54:27.101 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.237ms
2025-05-07 13:54:27.101 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:54:27.101 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/8 - 200 null application/json; charset=utf-8 7.729ms
2025-05-07 13:55:06.424 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 13:55:06.424 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 13:55:06.425 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 13:55:06.445 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 13:55:06.445 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 13:55:06.446 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 20.8401ms
2025-05-07 13:55:06.446 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 13:55:06.446 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 21.5919ms
2025-05-07 13:55:07.568 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 13:55:07.568 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 13:55:07.568 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 13:55:07.578 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 13:55:07.578 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:55:07.578 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.5661ms
2025-05-07 13:55:07.578 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 13:55:07.579 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 10.8303ms
2025-05-07 13:55:07.696 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 13:55:07.696 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 13:55:07.696 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:55:07.719 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 13:55:07.724 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 13:55:07.724 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 27.2789ms
2025-05-07 13:55:07.724 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 13:55:07.724 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 27.7671ms
2025-05-07 13:55:08.301 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 13:55:08.301 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 13:55:08.466 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 13:55:08.476 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 13:55:08.477 +07:00 [INF] Saved message 117 to Redis
2025-05-07 13:55:08.478 +07:00 [INF] Added message 117 to conversation 3
2025-05-07 13:55:08.479 +07:00 [INF] Saved message 115 to Redis
2025-05-07 13:55:08.479 +07:00 [INF] Added message 115 to conversation 3
2025-05-07 13:55:08.480 +07:00 [INF] Saved message 88 to Redis
2025-05-07 13:55:08.480 +07:00 [INF] Added message 88 to conversation 3
2025-05-07 13:55:08.480 +07:00 [INF] Saved message 70 to Redis
2025-05-07 13:55:08.481 +07:00 [INF] Added message 70 to conversation 3
2025-05-07 13:55:08.482 +07:00 [INF] Saved message 65 to Redis
2025-05-07 13:55:08.482 +07:00 [INF] Added message 65 to conversation 3
2025-05-07 13:55:08.483 +07:00 [INF] Saved message 48 to Redis
2025-05-07 13:55:08.483 +07:00 [INF] Added message 48 to conversation 3
2025-05-07 13:55:08.489 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 13:55:08.490 +07:00 [INF] Saved message 133 to Redis
2025-05-07 13:55:08.490 +07:00 [INF] Added message 133 to conversation 4
2025-05-07 13:55:08.491 +07:00 [INF] Saved message 132 to Redis
2025-05-07 13:55:08.491 +07:00 [INF] Added message 132 to conversation 4
2025-05-07 13:55:08.492 +07:00 [INF] Saved message 131 to Redis
2025-05-07 13:55:08.492 +07:00 [INF] Added message 131 to conversation 4
2025-05-07 13:55:08.492 +07:00 [INF] Saved message 130 to Redis
2025-05-07 13:55:08.493 +07:00 [INF] Added message 130 to conversation 4
2025-05-07 13:55:08.493 +07:00 [INF] Saved message 129 to Redis
2025-05-07 13:55:08.493 +07:00 [INF] Added message 129 to conversation 4
2025-05-07 13:55:08.494 +07:00 [INF] Saved message 128 to Redis
2025-05-07 13:55:08.494 +07:00 [INF] Added message 128 to conversation 4
2025-05-07 13:55:08.495 +07:00 [INF] Saved message 127 to Redis
2025-05-07 13:55:08.495 +07:00 [INF] Added message 127 to conversation 4
2025-05-07 13:55:08.496 +07:00 [INF] Saved message 126 to Redis
2025-05-07 13:55:08.496 +07:00 [INF] Added message 126 to conversation 4
2025-05-07 13:55:08.497 +07:00 [INF] Saved message 125 to Redis
2025-05-07 13:55:08.497 +07:00 [INF] Added message 125 to conversation 4
2025-05-07 13:55:08.498 +07:00 [INF] Saved message 124 to Redis
2025-05-07 13:55:08.498 +07:00 [INF] Added message 124 to conversation 4
2025-05-07 13:55:08.499 +07:00 [INF] Saved message 123 to Redis
2025-05-07 13:55:08.499 +07:00 [INF] Added message 123 to conversation 4
2025-05-07 13:55:08.499 +07:00 [INF] Saved message 122 to Redis
2025-05-07 13:55:08.499 +07:00 [INF] Added message 122 to conversation 4
2025-05-07 13:55:08.500 +07:00 [INF] Saved message 121 to Redis
2025-05-07 13:55:08.500 +07:00 [INF] Added message 121 to conversation 4
2025-05-07 13:55:08.501 +07:00 [INF] Saved message 120 to Redis
2025-05-07 13:55:08.501 +07:00 [INF] Added message 120 to conversation 4
2025-05-07 13:55:08.502 +07:00 [INF] Saved message 119 to Redis
2025-05-07 13:55:08.503 +07:00 [INF] Added message 119 to conversation 4
2025-05-07 13:55:08.503 +07:00 [INF] Saved message 118 to Redis
2025-05-07 13:55:08.504 +07:00 [INF] Added message 118 to conversation 4
2025-05-07 13:55:08.504 +07:00 [INF] Saved message 111 to Redis
2025-05-07 13:55:08.504 +07:00 [INF] Added message 111 to conversation 4
2025-05-07 13:55:08.505 +07:00 [INF] Saved message 97 to Redis
2025-05-07 13:55:08.505 +07:00 [INF] Added message 97 to conversation 4
2025-05-07 13:55:08.506 +07:00 [INF] Saved message 96 to Redis
2025-05-07 13:55:08.506 +07:00 [INF] Added message 96 to conversation 4
2025-05-07 13:55:08.507 +07:00 [INF] Saved message 89 to Redis
2025-05-07 13:55:08.507 +07:00 [INF] Added message 89 to conversation 4
2025-05-07 13:55:08.508 +07:00 [INF] Saved message 69 to Redis
2025-05-07 13:55:08.508 +07:00 [INF] Added message 69 to conversation 4
2025-05-07 13:55:08.508 +07:00 [INF] Saved message 67 to Redis
2025-05-07 13:55:08.509 +07:00 [INF] Added message 67 to conversation 4
2025-05-07 13:55:08.509 +07:00 [INF] Saved message 66 to Redis
2025-05-07 13:55:08.509 +07:00 [INF] Added message 66 to conversation 4
2025-05-07 13:55:08.510 +07:00 [INF] Saved message 63 to Redis
2025-05-07 13:55:08.510 +07:00 [INF] Added message 63 to conversation 4
2025-05-07 13:55:08.511 +07:00 [INF] Saved message 58 to Redis
2025-05-07 13:55:08.511 +07:00 [INF] Added message 58 to conversation 4
2025-05-07 13:55:08.512 +07:00 [INF] Saved message 56 to Redis
2025-05-07 13:55:08.512 +07:00 [INF] Added message 56 to conversation 4
2025-05-07 13:55:08.512 +07:00 [INF] Saved message 53 to Redis
2025-05-07 13:55:08.513 +07:00 [INF] Added message 53 to conversation 4
2025-05-07 13:55:08.513 +07:00 [INF] Saved message 52 to Redis
2025-05-07 13:55:08.513 +07:00 [INF] Added message 52 to conversation 4
2025-05-07 13:55:08.514 +07:00 [INF] Saved message 50 to Redis
2025-05-07 13:55:08.515 +07:00 [INF] Added message 50 to conversation 4
2025-05-07 13:55:08.516 +07:00 [INF] Saved message 47 to Redis
2025-05-07 13:55:08.516 +07:00 [INF] Added message 47 to conversation 4
2025-05-07 13:55:08.517 +07:00 [INF] Saved message 46 to Redis
2025-05-07 13:55:08.517 +07:00 [INF] Added message 46 to conversation 4
2025-05-07 13:55:08.518 +07:00 [INF] Saved message 45 to Redis
2025-05-07 13:55:08.518 +07:00 [INF] Added message 45 to conversation 4
2025-05-07 13:55:08.519 +07:00 [INF] Saved message 44 to Redis
2025-05-07 13:55:08.519 +07:00 [INF] Added message 44 to conversation 4
2025-05-07 13:55:08.520 +07:00 [INF] Saved message 43 to Redis
2025-05-07 13:55:08.520 +07:00 [INF] Added message 43 to conversation 4
2025-05-07 13:55:08.521 +07:00 [INF] Saved message 42 to Redis
2025-05-07 13:55:08.521 +07:00 [INF] Added message 42 to conversation 4
2025-05-07 13:55:08.522 +07:00 [INF] Saved message 41 to Redis
2025-05-07 13:55:08.522 +07:00 [INF] Added message 41 to conversation 4
2025-05-07 13:55:08.522 +07:00 [INF] Saved message 40 to Redis
2025-05-07 13:55:08.523 +07:00 [INF] Added message 40 to conversation 4
2025-05-07 13:55:08.523 +07:00 [INF] Saved message 39 to Redis
2025-05-07 13:55:08.523 +07:00 [INF] Added message 39 to conversation 4
2025-05-07 13:55:08.528 +07:00 [INF] Saved message 38 to Redis
2025-05-07 13:55:08.529 +07:00 [INF] Added message 38 to conversation 4
2025-05-07 13:55:08.529 +07:00 [INF] Saved message 37 to Redis
2025-05-07 13:55:08.529 +07:00 [INF] Added message 37 to conversation 4
2025-05-07 13:55:08.530 +07:00 [INF] Saved message 36 to Redis
2025-05-07 13:55:08.530 +07:00 [INF] Added message 36 to conversation 4
2025-05-07 13:55:08.530 +07:00 [INF] Saved message 35 to Redis
2025-05-07 13:55:08.530 +07:00 [INF] Added message 35 to conversation 4
2025-05-07 13:55:08.531 +07:00 [INF] Saved message 34 to Redis
2025-05-07 13:55:08.531 +07:00 [INF] Added message 34 to conversation 4
2025-05-07 13:55:08.531 +07:00 [INF] Saved message 33 to Redis
2025-05-07 13:55:08.531 +07:00 [INF] Added message 33 to conversation 4
2025-05-07 13:55:08.532 +07:00 [INF] Saved message 32 to Redis
2025-05-07 13:55:08.532 +07:00 [INF] Added message 32 to conversation 4
2025-05-07 13:55:08.533 +07:00 [INF] Saved message 31 to Redis
2025-05-07 13:55:08.533 +07:00 [INF] Added message 31 to conversation 4
2025-05-07 13:55:08.533 +07:00 [INF] Saved message 30 to Redis
2025-05-07 13:55:08.533 +07:00 [INF] Added message 30 to conversation 4
2025-05-07 13:55:08.534 +07:00 [INF] Saved message 29 to Redis
2025-05-07 13:55:08.534 +07:00 [INF] Added message 29 to conversation 4
2025-05-07 13:55:08.535 +07:00 [INF] Saved message 28 to Redis
2025-05-07 13:55:08.535 +07:00 [INF] Added message 28 to conversation 4
2025-05-07 13:55:08.535 +07:00 [INF] Saved message 27 to Redis
2025-05-07 13:55:08.536 +07:00 [INF] Added message 27 to conversation 4
2025-05-07 13:55:08.542 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 13:55:08.543 +07:00 [INF] Saved message 134 to Redis
2025-05-07 13:55:08.543 +07:00 [INF] Added message 134 to conversation 8
2025-05-07 13:55:28.760 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 13:55:28.761 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 13:55:28.761 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 13:55:28.773 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 13:55:28.778 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 13:55:28.778 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 17.264ms
2025-05-07 13:55:28.778 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 13:55:28.778 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 17.9385ms
2025-05-07 13:55:29.015 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 13:55:29.015 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 13:55:29.015 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 13:55:29.039 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 13:55:29.040 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:55:29.040 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 24.7613ms
2025-05-07 13:55:29.040 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 13:55:29.040 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 25.0997ms
2025-05-07 13:55:29.073 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 13:55:29.074 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 13:55:29.074 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:55:29.076 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 13:55:29.076 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.9902ms
2025-05-07 13:55:29.076 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 13:55:29.076 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 3.2349ms
2025-05-07 13:55:29.201 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 13:55:29.201 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 13:55:29.359 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 13:59:34.543 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - null null
2025-05-07 13:59:34.544 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:59:34.562 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 13:59:34.572 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4
2025-05-07 13:59:34.572 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-07 13:59:34.572 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 13:59:34.586 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 23.2128ms
2025-05-07 13:59:34.586 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 13:59:34.586 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 43.1659ms
2025-05-07 13:59:34.765 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 13:59:34.767 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:59:34.770 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 13:59:34.804 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:59:34.804 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 13:59:34.815 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 45.3413ms
2025-05-07 13:59:34.815 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 13:59:34.816 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 50.256ms
2025-05-07 13:59:35.195 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 13:59:35.195 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:59:35.198 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 13:59:35.203 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 13:59:35.203 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 13:59:35.207 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.0382ms
2025-05-07 13:59:35.207 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 13:59:35.207 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 11.9961ms
2025-05-07 13:59:43.025 +07:00 [INF] Handling message from user 5: sdfsfd
2025-05-07 13:59:43.029 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 13:59:43.031 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 13:59:43.041 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 13:59:43.041 +07:00 [INF] Message saved to DB with ID: 135
2025-05-07 13:59:43.041 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 13:59:43.047 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 13:59:43.048 +07:00 [INF] Transaction committed for message: 135
2025-05-07 13:59:43.049 +07:00 [INF] Saved message 135 to Redis
2025-05-07 13:59:43.049 +07:00 [INF] Added message 135 to conversation 4
2025-05-07 13:59:43.052 +07:00 [INF] Published message to channel conversation:4
2025-05-07 14:03:28.033 +07:00 [INF] Application is shutting down...
2025-05-07 14:03:58.065 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 14:03:58.065 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 14:03:58.065 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 14:03:58.065 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 14:03:58.065 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 14:03:58.072 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 529771.4141ms
2025-05-07 14:03:58.072 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 508871.4507ms
2025-05-07 14:03:58.072 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 854892.0117ms
2025-05-07 14:03:58.072 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 783087.5806ms
2025-05-07 14:03:58.072 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 582042.8533ms
2025-05-07 14:04:15.721 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-07 14:04:15.856 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-07 14:04:15.934 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-07 14:04:15.944 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-07 14:04:15.944 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-07 14:04:15.945 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-07 14:04:15.945 +07:00 [INF] Hosting environment: Development
2025-05-07 14:04:15.945 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-07 14:04:18.626 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 14:04:18.666 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-07 14:04:18.754 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 14:04:18.958 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 14:04:19.587 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 14:04:19.591 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 14:04:19.670 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 14:05:10.539 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 14:05:10.545 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 14:05:10.576 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 14:05:10.683 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 14:05:10.864 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 14:05:10.950 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 369.0736ms
2025-05-07 14:05:10.952 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 14:05:10.962 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 422.5079ms
2025-05-07 14:05:12.070 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 14:05:12.073 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 14:05:12.079 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 14:05:12.180 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 14:05:12.183 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:05:12.207 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 126.9478ms
2025-05-07 14:05:12.207 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 14:05:12.208 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 138.0878ms
2025-05-07 14:05:12.215 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 14:05:12.216 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 14:05:12.226 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:05:12.366 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 14:05:12.391 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:05:12.393 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 166.6973ms
2025-05-07 14:05:12.394 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 14:05:12.394 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 178.5163ms
2025-05-07 14:05:13.110 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 14:05:13.110 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 14:05:13.183 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 14:05:13.209 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 14:05:13.228 +07:00 [INF] Saved message 117 to Redis
2025-05-07 14:05:13.232 +07:00 [INF] Added message 117 to conversation 3
2025-05-07 14:05:13.236 +07:00 [INF] Saved message 115 to Redis
2025-05-07 14:05:13.237 +07:00 [INF] Added message 115 to conversation 3
2025-05-07 14:05:13.244 +07:00 [INF] Saved message 88 to Redis
2025-05-07 14:05:13.245 +07:00 [INF] Added message 88 to conversation 3
2025-05-07 14:05:13.249 +07:00 [INF] Saved message 70 to Redis
2025-05-07 14:05:13.250 +07:00 [INF] Added message 70 to conversation 3
2025-05-07 14:05:13.253 +07:00 [INF] Saved message 65 to Redis
2025-05-07 14:05:13.256 +07:00 [INF] Added message 65 to conversation 3
2025-05-07 14:05:13.260 +07:00 [INF] Saved message 48 to Redis
2025-05-07 14:05:13.261 +07:00 [INF] Added message 48 to conversation 3
2025-05-07 14:05:13.271 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 14:05:13.275 +07:00 [INF] Saved message 135 to Redis
2025-05-07 14:05:13.276 +07:00 [INF] Added message 135 to conversation 4
2025-05-07 14:05:13.278 +07:00 [INF] Saved message 133 to Redis
2025-05-07 14:05:13.278 +07:00 [INF] Added message 133 to conversation 4
2025-05-07 14:05:13.280 +07:00 [INF] Saved message 132 to Redis
2025-05-07 14:05:13.280 +07:00 [INF] Added message 132 to conversation 4
2025-05-07 14:05:13.282 +07:00 [INF] Saved message 131 to Redis
2025-05-07 14:05:13.282 +07:00 [INF] Added message 131 to conversation 4
2025-05-07 14:05:13.284 +07:00 [INF] Saved message 130 to Redis
2025-05-07 14:05:13.284 +07:00 [INF] Added message 130 to conversation 4
2025-05-07 14:05:13.286 +07:00 [INF] Saved message 129 to Redis
2025-05-07 14:05:13.287 +07:00 [INF] Added message 129 to conversation 4
2025-05-07 14:05:13.289 +07:00 [INF] Saved message 128 to Redis
2025-05-07 14:05:13.290 +07:00 [INF] Added message 128 to conversation 4
2025-05-07 14:05:13.292 +07:00 [INF] Saved message 127 to Redis
2025-05-07 14:05:13.292 +07:00 [INF] Added message 127 to conversation 4
2025-05-07 14:05:13.294 +07:00 [INF] Saved message 126 to Redis
2025-05-07 14:05:13.294 +07:00 [INF] Added message 126 to conversation 4
2025-05-07 14:05:13.295 +07:00 [INF] Saved message 125 to Redis
2025-05-07 14:05:13.295 +07:00 [INF] Added message 125 to conversation 4
2025-05-07 14:05:13.296 +07:00 [INF] Saved message 124 to Redis
2025-05-07 14:05:13.297 +07:00 [INF] Added message 124 to conversation 4
2025-05-07 14:05:13.298 +07:00 [INF] Saved message 123 to Redis
2025-05-07 14:05:13.298 +07:00 [INF] Added message 123 to conversation 4
2025-05-07 14:05:13.299 +07:00 [INF] Saved message 122 to Redis
2025-05-07 14:05:13.300 +07:00 [INF] Added message 122 to conversation 4
2025-05-07 14:05:13.302 +07:00 [INF] Saved message 121 to Redis
2025-05-07 14:05:13.303 +07:00 [INF] Added message 121 to conversation 4
2025-05-07 14:05:13.305 +07:00 [INF] Saved message 120 to Redis
2025-05-07 14:05:13.306 +07:00 [INF] Added message 120 to conversation 4
2025-05-07 14:05:13.308 +07:00 [INF] Saved message 119 to Redis
2025-05-07 14:05:13.309 +07:00 [INF] Added message 119 to conversation 4
2025-05-07 14:05:13.310 +07:00 [INF] Saved message 118 to Redis
2025-05-07 14:05:13.311 +07:00 [INF] Added message 118 to conversation 4
2025-05-07 14:05:13.312 +07:00 [INF] Saved message 111 to Redis
2025-05-07 14:05:13.312 +07:00 [INF] Added message 111 to conversation 4
2025-05-07 14:05:13.314 +07:00 [INF] Saved message 97 to Redis
2025-05-07 14:05:13.314 +07:00 [INF] Added message 97 to conversation 4
2025-05-07 14:05:13.316 +07:00 [INF] Saved message 96 to Redis
2025-05-07 14:05:13.317 +07:00 [INF] Added message 96 to conversation 4
2025-05-07 14:05:13.319 +07:00 [INF] Saved message 89 to Redis
2025-05-07 14:05:13.321 +07:00 [INF] Added message 89 to conversation 4
2025-05-07 14:05:13.323 +07:00 [INF] Saved message 69 to Redis
2025-05-07 14:05:13.324 +07:00 [INF] Added message 69 to conversation 4
2025-05-07 14:05:13.325 +07:00 [INF] Saved message 67 to Redis
2025-05-07 14:05:13.326 +07:00 [INF] Added message 67 to conversation 4
2025-05-07 14:05:13.327 +07:00 [INF] Saved message 66 to Redis
2025-05-07 14:05:13.329 +07:00 [INF] Added message 66 to conversation 4
2025-05-07 14:05:13.330 +07:00 [INF] Saved message 63 to Redis
2025-05-07 14:05:13.331 +07:00 [INF] Added message 63 to conversation 4
2025-05-07 14:05:13.332 +07:00 [INF] Saved message 58 to Redis
2025-05-07 14:05:13.333 +07:00 [INF] Added message 58 to conversation 4
2025-05-07 14:05:13.334 +07:00 [INF] Saved message 56 to Redis
2025-05-07 14:05:13.335 +07:00 [INF] Added message 56 to conversation 4
2025-05-07 14:05:13.338 +07:00 [INF] Saved message 53 to Redis
2025-05-07 14:05:13.339 +07:00 [INF] Added message 53 to conversation 4
2025-05-07 14:05:13.340 +07:00 [INF] Saved message 52 to Redis
2025-05-07 14:05:13.341 +07:00 [INF] Added message 52 to conversation 4
2025-05-07 14:05:13.342 +07:00 [INF] Saved message 50 to Redis
2025-05-07 14:05:13.343 +07:00 [INF] Added message 50 to conversation 4
2025-05-07 14:05:13.343 +07:00 [INF] Saved message 47 to Redis
2025-05-07 14:05:13.344 +07:00 [INF] Added message 47 to conversation 4
2025-05-07 14:05:13.345 +07:00 [INF] Saved message 46 to Redis
2025-05-07 14:05:13.345 +07:00 [INF] Added message 46 to conversation 4
2025-05-07 14:05:13.346 +07:00 [INF] Saved message 45 to Redis
2025-05-07 14:05:13.346 +07:00 [INF] Added message 45 to conversation 4
2025-05-07 14:05:13.347 +07:00 [INF] Saved message 44 to Redis
2025-05-07 14:05:13.347 +07:00 [INF] Added message 44 to conversation 4
2025-05-07 14:05:13.348 +07:00 [INF] Saved message 43 to Redis
2025-05-07 14:05:13.349 +07:00 [INF] Added message 43 to conversation 4
2025-05-07 14:05:13.349 +07:00 [INF] Saved message 42 to Redis
2025-05-07 14:05:13.350 +07:00 [INF] Added message 42 to conversation 4
2025-05-07 14:05:13.351 +07:00 [INF] Saved message 41 to Redis
2025-05-07 14:05:13.351 +07:00 [INF] Added message 41 to conversation 4
2025-05-07 14:05:13.353 +07:00 [INF] Saved message 40 to Redis
2025-05-07 14:05:13.355 +07:00 [INF] Added message 40 to conversation 4
2025-05-07 14:05:13.356 +07:00 [INF] Saved message 39 to Redis
2025-05-07 14:05:13.357 +07:00 [INF] Added message 39 to conversation 4
2025-05-07 14:05:13.357 +07:00 [INF] Saved message 38 to Redis
2025-05-07 14:05:13.358 +07:00 [INF] Added message 38 to conversation 4
2025-05-07 14:05:13.359 +07:00 [INF] Saved message 37 to Redis
2025-05-07 14:05:13.359 +07:00 [INF] Added message 37 to conversation 4
2025-05-07 14:05:13.361 +07:00 [INF] Saved message 36 to Redis
2025-05-07 14:05:13.361 +07:00 [INF] Added message 36 to conversation 4
2025-05-07 14:05:13.362 +07:00 [INF] Saved message 35 to Redis
2025-05-07 14:05:13.363 +07:00 [INF] Added message 35 to conversation 4
2025-05-07 14:05:13.364 +07:00 [INF] Saved message 34 to Redis
2025-05-07 14:05:13.364 +07:00 [INF] Added message 34 to conversation 4
2025-05-07 14:05:13.365 +07:00 [INF] Saved message 33 to Redis
2025-05-07 14:05:13.366 +07:00 [INF] Added message 33 to conversation 4
2025-05-07 14:05:13.368 +07:00 [INF] Saved message 32 to Redis
2025-05-07 14:05:13.371 +07:00 [INF] Added message 32 to conversation 4
2025-05-07 14:05:13.372 +07:00 [INF] Saved message 31 to Redis
2025-05-07 14:05:13.373 +07:00 [INF] Added message 31 to conversation 4
2025-05-07 14:05:13.374 +07:00 [INF] Saved message 30 to Redis
2025-05-07 14:05:13.375 +07:00 [INF] Added message 30 to conversation 4
2025-05-07 14:05:13.376 +07:00 [INF] Saved message 29 to Redis
2025-05-07 14:05:13.376 +07:00 [INF] Added message 29 to conversation 4
2025-05-07 14:05:13.377 +07:00 [INF] Saved message 28 to Redis
2025-05-07 14:05:13.378 +07:00 [INF] Added message 28 to conversation 4
2025-05-07 14:05:54.331 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/4 - null null
2025-05-07 14:05:54.335 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:05:54.343 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:05:54.413 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:05:54.417 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:05:54.541 +07:00 [INF] Executed DbCommand (72ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 14:05:54.542 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 14:05:54.543 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 199.9524ms
2025-05-07 14:05:54.543 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:05:54.543 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/4 - 200 null application/json; charset=utf-8 211.9573ms
2025-05-07 14:05:54.932 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/3/2 - null null
2025-05-07 14:05:54.932 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:05:54.947 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 14:05:55.023 +07:00 [INF] Retrieved 6 messages from Redis for conversation 3
2025-05-07 14:05:55.026 +07:00 [INF] Retrieved 6 messages from Redis for conversation 3 and user 2
2025-05-07 14:05:55.026 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:05:55.030 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 83.124ms
2025-05-07 14:05:55.031 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:05:55.031 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/3/2 - 200 null application/json; charset=utf-8 99.1773ms
2025-05-07 14:05:55.065 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/3 - null null
2025-05-07 14:05:55.065 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:05:55.073 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:05:55.096 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:05:55.141 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 14:05:55.144 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 71.4074ms
2025-05-07 14:05:55.144 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:05:55.145 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/3 - 200 null application/json; charset=utf-8 79.8748ms
2025-05-07 14:05:55.281 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - null null
2025-05-07 14:05:55.282 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:05:55.291 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 14:05:55.316 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 14:05:55.356 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:05:55.363 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 72.0208ms
2025-05-07 14:05:55.363 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:05:55.363 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - 200 null application/json; charset=utf-8 82.5816ms
2025-05-07 14:06:23.536 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 14:06:23.537 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 14:06:23.569 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 14:06:23.587 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 14:06:23.593 +07:00 [INF] Saved message 114 to Redis
2025-05-07 14:06:23.594 +07:00 [INF] Added message 114 to conversation 1
2025-05-07 14:06:23.596 +07:00 [INF] Saved message 113 to Redis
2025-05-07 14:06:23.597 +07:00 [INF] Added message 113 to conversation 1
2025-05-07 14:06:23.598 +07:00 [INF] Saved message 112 to Redis
2025-05-07 14:06:23.599 +07:00 [INF] Added message 112 to conversation 1
2025-05-07 14:06:23.600 +07:00 [INF] Saved message 110 to Redis
2025-05-07 14:06:23.600 +07:00 [INF] Added message 110 to conversation 1
2025-05-07 14:06:23.603 +07:00 [INF] Saved message 109 to Redis
2025-05-07 14:06:23.607 +07:00 [INF] Added message 109 to conversation 1
2025-05-07 14:06:23.611 +07:00 [INF] Saved message 108 to Redis
2025-05-07 14:06:23.611 +07:00 [INF] Added message 108 to conversation 1
2025-05-07 14:06:23.613 +07:00 [INF] Saved message 107 to Redis
2025-05-07 14:06:23.614 +07:00 [INF] Added message 107 to conversation 1
2025-05-07 14:06:23.616 +07:00 [INF] Saved message 106 to Redis
2025-05-07 14:06:23.616 +07:00 [INF] Added message 106 to conversation 1
2025-05-07 14:06:23.617 +07:00 [INF] Saved message 105 to Redis
2025-05-07 14:06:23.618 +07:00 [INF] Added message 105 to conversation 1
2025-05-07 14:06:23.619 +07:00 [INF] Saved message 104 to Redis
2025-05-07 14:06:23.619 +07:00 [INF] Added message 104 to conversation 1
2025-05-07 14:06:23.620 +07:00 [INF] Saved message 103 to Redis
2025-05-07 14:06:23.620 +07:00 [INF] Added message 103 to conversation 1
2025-05-07 14:06:23.623 +07:00 [INF] Saved message 102 to Redis
2025-05-07 14:06:23.624 +07:00 [INF] Added message 102 to conversation 1
2025-05-07 14:06:23.625 +07:00 [INF] Saved message 101 to Redis
2025-05-07 14:06:23.625 +07:00 [INF] Added message 101 to conversation 1
2025-05-07 14:06:23.626 +07:00 [INF] Saved message 100 to Redis
2025-05-07 14:06:23.626 +07:00 [INF] Added message 100 to conversation 1
2025-05-07 14:06:23.627 +07:00 [INF] Saved message 99 to Redis
2025-05-07 14:06:23.627 +07:00 [INF] Added message 99 to conversation 1
2025-05-07 14:06:23.628 +07:00 [INF] Saved message 98 to Redis
2025-05-07 14:06:23.628 +07:00 [INF] Added message 98 to conversation 1
2025-05-07 14:06:23.629 +07:00 [INF] Saved message 95 to Redis
2025-05-07 14:06:23.630 +07:00 [INF] Added message 95 to conversation 1
2025-05-07 14:06:23.630 +07:00 [INF] Saved message 94 to Redis
2025-05-07 14:06:23.631 +07:00 [INF] Added message 94 to conversation 1
2025-05-07 14:06:23.632 +07:00 [INF] Saved message 93 to Redis
2025-05-07 14:06:23.632 +07:00 [INF] Added message 93 to conversation 1
2025-05-07 14:06:23.633 +07:00 [INF] Saved message 92 to Redis
2025-05-07 14:06:23.634 +07:00 [INF] Added message 92 to conversation 1
2025-05-07 14:06:23.635 +07:00 [INF] Saved message 91 to Redis
2025-05-07 14:06:23.635 +07:00 [INF] Added message 91 to conversation 1
2025-05-07 14:06:23.639 +07:00 [INF] Saved message 90 to Redis
2025-05-07 14:06:23.639 +07:00 [INF] Added message 90 to conversation 1
2025-05-07 14:06:23.641 +07:00 [INF] Saved message 87 to Redis
2025-05-07 14:06:23.641 +07:00 [INF] Added message 87 to conversation 1
2025-05-07 14:06:23.643 +07:00 [INF] Saved message 86 to Redis
2025-05-07 14:06:23.643 +07:00 [INF] Added message 86 to conversation 1
2025-05-07 14:06:23.644 +07:00 [INF] Saved message 85 to Redis
2025-05-07 14:06:23.644 +07:00 [INF] Added message 85 to conversation 1
2025-05-07 14:06:23.645 +07:00 [INF] Saved message 84 to Redis
2025-05-07 14:06:23.646 +07:00 [INF] Added message 84 to conversation 1
2025-05-07 14:06:23.646 +07:00 [INF] Saved message 83 to Redis
2025-05-07 14:06:23.647 +07:00 [INF] Added message 83 to conversation 1
2025-05-07 14:06:23.648 +07:00 [INF] Saved message 82 to Redis
2025-05-07 14:06:23.648 +07:00 [INF] Added message 82 to conversation 1
2025-05-07 14:06:23.649 +07:00 [INF] Saved message 81 to Redis
2025-05-07 14:06:23.650 +07:00 [INF] Added message 81 to conversation 1
2025-05-07 14:06:23.651 +07:00 [INF] Saved message 80 to Redis
2025-05-07 14:06:23.652 +07:00 [INF] Added message 80 to conversation 1
2025-05-07 14:06:23.653 +07:00 [INF] Saved message 79 to Redis
2025-05-07 14:06:23.653 +07:00 [INF] Added message 79 to conversation 1
2025-05-07 14:06:23.656 +07:00 [INF] Saved message 78 to Redis
2025-05-07 14:06:23.656 +07:00 [INF] Added message 78 to conversation 1
2025-05-07 14:06:23.657 +07:00 [INF] Saved message 77 to Redis
2025-05-07 14:06:23.658 +07:00 [INF] Added message 77 to conversation 1
2025-05-07 14:06:23.659 +07:00 [INF] Saved message 76 to Redis
2025-05-07 14:06:23.660 +07:00 [INF] Added message 76 to conversation 1
2025-05-07 14:06:23.661 +07:00 [INF] Saved message 75 to Redis
2025-05-07 14:06:23.661 +07:00 [INF] Added message 75 to conversation 1
2025-05-07 14:06:23.662 +07:00 [INF] Saved message 74 to Redis
2025-05-07 14:06:23.663 +07:00 [INF] Added message 74 to conversation 1
2025-05-07 14:06:23.664 +07:00 [INF] Saved message 73 to Redis
2025-05-07 14:06:23.664 +07:00 [INF] Added message 73 to conversation 1
2025-05-07 14:06:23.665 +07:00 [INF] Saved message 72 to Redis
2025-05-07 14:06:23.666 +07:00 [INF] Added message 72 to conversation 1
2025-05-07 14:06:23.667 +07:00 [INF] Saved message 71 to Redis
2025-05-07 14:06:23.667 +07:00 [INF] Added message 71 to conversation 1
2025-05-07 14:06:23.668 +07:00 [INF] Saved message 68 to Redis
2025-05-07 14:06:23.668 +07:00 [INF] Added message 68 to conversation 1
2025-05-07 14:06:23.672 +07:00 [INF] Saved message 64 to Redis
2025-05-07 14:06:23.673 +07:00 [INF] Added message 64 to conversation 1
2025-05-07 14:06:23.674 +07:00 [INF] Saved message 62 to Redis
2025-05-07 14:06:23.674 +07:00 [INF] Added message 62 to conversation 1
2025-05-07 14:06:23.675 +07:00 [INF] Saved message 61 to Redis
2025-05-07 14:06:23.676 +07:00 [INF] Added message 61 to conversation 1
2025-05-07 14:06:23.677 +07:00 [INF] Saved message 60 to Redis
2025-05-07 14:06:23.677 +07:00 [INF] Added message 60 to conversation 1
2025-05-07 14:06:23.678 +07:00 [INF] Saved message 59 to Redis
2025-05-07 14:06:23.678 +07:00 [INF] Added message 59 to conversation 1
2025-05-07 14:06:23.679 +07:00 [INF] Saved message 57 to Redis
2025-05-07 14:06:23.679 +07:00 [INF] Added message 57 to conversation 1
2025-05-07 14:06:23.681 +07:00 [INF] Saved message 55 to Redis
2025-05-07 14:06:23.681 +07:00 [INF] Added message 55 to conversation 1
2025-05-07 14:06:23.683 +07:00 [INF] Saved message 54 to Redis
2025-05-07 14:06:23.683 +07:00 [INF] Added message 54 to conversation 1
2025-05-07 14:06:23.684 +07:00 [INF] Saved message 51 to Redis
2025-05-07 14:06:23.685 +07:00 [INF] Added message 51 to conversation 1
2025-05-07 14:06:23.686 +07:00 [INF] Saved message 49 to Redis
2025-05-07 14:06:23.688 +07:00 [INF] Added message 49 to conversation 1
2025-05-07 14:06:23.693 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 14:06:23.696 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 14:07:29.056 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 60
2025-05-07 14:07:29.058 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 14:07:29.058 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 14:07:29.065 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 14:07:29.066 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 14:07:29.067 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 8.6968ms
2025-05-07 14:07:29.067 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 14:07:29.067 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 11.2064ms
2025-05-07 14:07:29.476 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/3 - null null
2025-05-07 14:07:29.478 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 14:07:29.478 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 14:07:29.493 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 14:07:29.493 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:07:29.493 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 15.1051ms
2025-05-07 14:07:29.494 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 14:07:29.494 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 17.3277ms
2025-05-07 14:07:29.595 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 14:07:29.596 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 14:07:29.597 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:07:29.623 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 14:07:29.627 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:07:29.627 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 30.3742ms
2025-05-07 14:07:29.628 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 14:07:29.628 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 32.3372ms
2025-05-07 14:07:29.743 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=3 - null null
2025-05-07 14:07:29.744 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 14:07:29.760 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 14:07:29.767 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 14:07:29.769 +07:00 [INF] Saved message 4 to Redis
2025-05-07 14:07:29.770 +07:00 [INF] Added message 4 to conversation 2
2025-05-07 14:07:29.772 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 14:07:35.991 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/9/3 - null null
2025-05-07 14:07:35.993 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:07:35.993 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 14:07:35.996 +07:00 [INF] Retrieved 0 messages from Redis for conversation 9
2025-05-07 14:07:36.027 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 14:07:36.081 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 14:07:36.083 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 14:07:36.084 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 90.8049ms
2025-05-07 14:07:36.084 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:07:36.085 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/9/3 - 404 null text/plain; charset=utf-8 94.0132ms
2025-05-07 14:07:36.171 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/9 - null null
2025-05-07 14:07:36.172 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:07:36.172 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:07:36.178 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:07:36.179 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 14:07:36.180 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.5545ms
2025-05-07 14:07:36.180 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:07:36.182 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/9 - 200 null application/json; charset=utf-8 9.7828ms
2025-05-07 14:07:36.214 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/9 - null null
2025-05-07 14:07:36.216 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:07:36.216 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 14:07:36.221 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 14:07:36.222 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:07:36.223 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.851ms
2025-05-07 14:07:36.224 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:07:36.226 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/9 - 200 null application/json; charset=utf-8 12.0675ms
2025-05-07 14:07:47.319 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 14:07:47.321 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:07:47.321 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:07:47.348 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:07:47.351 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:07:47.422 +07:00 [INF] Executed DbCommand (69ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 14:07:47.687 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-07 14:07:47.809 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__user_id_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] IN (
    SELECT [u0].[value]
    FROM OPENJSON(@__user_id_0) WITH ([value] int '$') AS [u0]
)
2025-05-07 14:07:47.915 +07:00 [INF] Executed DbCommand (35ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-07 14:07:47.956 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN (
    SELECT [p].[id] AS [Id], [p].[user_id], [p].[conversation_id] AS [ConversationId], [p].[name] AS [Name], [p].[is_deleted] AS [IsDeleted], [p].[img_url]
    FROM [Participants] AS [p]
    WHERE [p].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 14:07:47.995 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 14:07:47.996 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 674.1085ms
2025-05-07 14:07:47.996 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:07:47.997 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 677.6325ms
2025-05-07 14:07:48.374 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/2 - null null
2025-05-07 14:07:48.374 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:07:48.374 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 14:07:48.379 +07:00 [INF] Retrieved 0 messages from Redis for conversation 11
2025-05-07 14:07:48.382 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 14:07:48.385 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 14:07:48.385 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 14:07:48.386 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 11.1929ms
2025-05-07 14:07:48.386 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:07:48.386 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/2 - 404 null text/plain; charset=utf-8 12.3981ms
2025-05-07 14:07:48.433 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - null null
2025-05-07 14:07:48.434 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:07:48.434 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:07:48.437 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:07:48.438 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 14:07:48.438 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 3.551ms
2025-05-07 14:07:48.438 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:07:48.438 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - 200 null application/json; charset=utf-8 4.8767ms
2025-05-07 14:07:48.488 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - null null
2025-05-07 14:07:48.489 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:07:48.489 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 14:07:48.494 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 14:07:48.495 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:07:48.495 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.1561ms
2025-05-07 14:07:48.495 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:07:48.495 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - 200 null application/json; charset=utf-8 6.9199ms
2025-05-07 14:07:55.264 +07:00 [INF] Handling message from user 2: jsjs
2025-05-07 14:07:55.274 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:07:55.384 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:07:55.394 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 14:07:55.400 +07:00 [INF] Message saved to DB with ID: 136
2025-05-07 14:07:55.414 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:07:55.419 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 14:07:55.440 +07:00 [INF] Transaction committed for message: 136
2025-05-07 14:07:55.443 +07:00 [INF] Saved message 136 to Redis
2025-05-07 14:07:55.443 +07:00 [INF] Added message 136 to conversation 11
2025-05-07 14:07:55.456 +07:00 [INF] Published message to channel conversation:11
2025-05-07 14:08:16.115 +07:00 [INF] Handling message from user 2: dhky
2025-05-07 14:08:16.121 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:08:16.126 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:08:16.131 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 14:08:16.132 +07:00 [INF] Message saved to DB with ID: 137
2025-05-07 14:08:16.132 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:08:16.137 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 14:08:16.138 +07:00 [INF] Transaction committed for message: 137
2025-05-07 14:08:16.139 +07:00 [INF] Saved message 137 to Redis
2025-05-07 14:08:16.139 +07:00 [INF] Added message 137 to conversation 11
2025-05-07 14:08:16.140 +07:00 [INF] Published message to channel conversation:11
2025-05-07 14:08:37.010 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/3/2 - null null
2025-05-07 14:08:37.010 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:08:37.010 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:08:37.014 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:08:37.016 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:08:37.086 +07:00 [INF] Executed DbCommand (69ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 14:08:37.086 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 14:08:37.087 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 76.1476ms
2025-05-07 14:08:37.087 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:08:37.087 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/3/2 - 200 null application/json; charset=utf-8 77.395ms
2025-05-07 14:08:37.260 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/3 - null null
2025-05-07 14:08:37.261 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:08:37.261 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 14:08:37.264 +07:00 [INF] Retrieved 2 messages from Redis for conversation 11
2025-05-07 14:08:37.264 +07:00 [INF] Retrieved 2 messages from Redis for conversation 11 and user 3
2025-05-07 14:08:37.264 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:08:37.265 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 3.7302ms
2025-05-07 14:08:37.265 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:08:37.265 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/3 - 200 null application/json; charset=utf-8 4.383ms
2025-05-07 14:08:37.316 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - null null
2025-05-07 14:08:37.316 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:08:37.316 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:08:37.318 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:08:37.318 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 14:08:37.319 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 2.3919ms
2025-05-07 14:08:37.319 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:08:37.319 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - 200 null application/json; charset=utf-8 3.1376ms
2025-05-07 14:08:37.377 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - null null
2025-05-07 14:08:37.378 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:08:37.378 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 14:08:37.382 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 14:08:37.382 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:08:37.382 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.3246ms
2025-05-07 14:08:37.382 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:08:37.382 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - 200 null application/json; charset=utf-8 5.0183ms
2025-05-07 14:09:26.644 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 14:09:26.645 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:09:26.645 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:09:26.655 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:09:26.664 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:09:26.734 +07:00 [INF] Executed DbCommand (67ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 14:09:26.734 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 14:09:26.735 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 89.3199ms
2025-05-07 14:09:26.735 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:09:26.735 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 91.0895ms
2025-05-07 14:09:27.182 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/2 - null null
2025-05-07 14:09:27.182 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:09:27.183 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 14:09:27.186 +07:00 [INF] Retrieved 2 messages from Redis for conversation 11
2025-05-07 14:09:27.186 +07:00 [INF] Retrieved 2 messages from Redis for conversation 11 and user 2
2025-05-07 14:09:27.187 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:09:27.187 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 3.8614ms
2025-05-07 14:09:27.187 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:09:27.187 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/2 - 200 null application/json; charset=utf-8 5.124ms
2025-05-07 14:09:27.321 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - null null
2025-05-07 14:09:27.321 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:09:27.321 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:09:27.324 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:09:27.325 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 14:09:27.325 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 3.9709ms
2025-05-07 14:09:27.325 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:09:27.326 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - 200 null application/json; charset=utf-8 4.8897ms
2025-05-07 14:09:27.429 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - null null
2025-05-07 14:09:27.430 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:09:27.430 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 14:09:27.434 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 14:09:27.435 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:09:27.437 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.7068ms
2025-05-07 14:09:27.437 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:09:27.437 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - 200 null application/json; charset=utf-8 7.7864ms
2025-05-07 14:09:30.363 +07:00 [INF] Handling message from user 2: cc
2025-05-07 14:09:30.367 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:09:30.405 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:09:30.415 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 14:09:30.417 +07:00 [INF] Message saved to DB with ID: 138
2025-05-07 14:09:30.419 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:09:30.426 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 14:09:30.428 +07:00 [INF] Transaction committed for message: 138
2025-05-07 14:09:30.434 +07:00 [INF] Saved message 138 to Redis
2025-05-07 14:09:30.435 +07:00 [INF] Added message 138 to conversation 11
2025-05-07 14:09:30.436 +07:00 [INF] Published message to channel conversation:11
2025-05-07 14:09:47.398 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/3/2 - null null
2025-05-07 14:09:47.398 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:09:47.399 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:09:47.406 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:09:47.407 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:09:47.468 +07:00 [INF] Executed DbCommand (59ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 14:09:47.468 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 14:09:47.468 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 69.5226ms
2025-05-07 14:09:47.468 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:09:47.468 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/3/2 - 200 null application/json; charset=utf-8 70.6159ms
2025-05-07 14:09:48.049 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/3 - null null
2025-05-07 14:09:48.050 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:09:48.050 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 14:09:48.052 +07:00 [INF] Retrieved 3 messages from Redis for conversation 11
2025-05-07 14:09:48.052 +07:00 [INF] Retrieved 3 messages from Redis for conversation 11 and user 3
2025-05-07 14:09:48.052 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:09:48.053 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.5598ms
2025-05-07 14:09:48.053 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:09:48.053 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/3 - 200 null application/json; charset=utf-8 3.5683ms
2025-05-07 14:09:48.316 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - null null
2025-05-07 14:09:48.316 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:09:48.316 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:09:48.322 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:09:48.322 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 14:09:48.323 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.2165ms
2025-05-07 14:09:48.323 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:09:48.323 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - 200 null application/json; charset=utf-8 6.878ms
2025-05-07 14:09:48.535 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - null null
2025-05-07 14:09:48.536 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:09:48.536 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 14:09:48.540 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 14:09:48.540 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:09:48.540 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.4523ms
2025-05-07 14:09:48.540 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:09:48.541 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - 200 null application/json; charset=utf-8 5.3117ms
2025-05-07 14:09:54.351 +07:00 [INF] Handling message from user 3: sfg
2025-05-07 14:09:54.356 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:09:54.358 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:09:54.363 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 14:09:54.363 +07:00 [INF] Message saved to DB with ID: 139
2025-05-07 14:09:54.364 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:09:54.368 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 14:09:54.369 +07:00 [INF] Transaction committed for message: 139
2025-05-07 14:09:54.370 +07:00 [INF] Saved message 139 to Redis
2025-05-07 14:09:54.370 +07:00 [INF] Added message 139 to conversation 11
2025-05-07 14:09:54.370 +07:00 [INF] Published message to channel conversation:11
2025-05-07 14:11:48.175 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 14:11:48.175 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:11:48.176 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:11:48.200 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:11:48.202 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:11:48.277 +07:00 [INF] Executed DbCommand (73ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 14:11:48.277 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 14:11:48.277 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 100.9793ms
2025-05-07 14:11:48.277 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:11:48.278 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 103.016ms
2025-05-07 14:11:48.684 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/2 - null null
2025-05-07 14:11:48.686 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:11:48.686 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 14:11:48.694 +07:00 [INF] Retrieved 4 messages from Redis for conversation 11
2025-05-07 14:11:48.694 +07:00 [INF] Retrieved 4 messages from Redis for conversation 11 and user 2
2025-05-07 14:11:48.695 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:11:48.695 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 8.1026ms
2025-05-07 14:11:48.695 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:11:48.695 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/2 - 200 null application/json; charset=utf-8 10.798ms
2025-05-07 14:11:49.120 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - null null
2025-05-07 14:11:49.121 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:11:49.122 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:11:49.127 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:11:49.127 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 14:11:49.128 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.2522ms
2025-05-07 14:11:49.128 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:11:49.129 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - 200 null application/json; charset=utf-8 8.654ms
2025-05-07 14:11:49.173 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - null null
2025-05-07 14:11:49.173 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:11:49.173 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 14:11:49.178 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 14:11:49.178 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:11:49.179 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.6388ms
2025-05-07 14:11:49.179 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:11:49.180 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - 200 null application/json; charset=utf-8 6.9358ms
2025-05-07 14:12:03.585 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/3/2 - null null
2025-05-07 14:12:03.585 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:12:03.585 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:12:03.589 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:12:03.591 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:12:03.592 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 14:12:03.592 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 14:12:03.593 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 7.1201ms
2025-05-07 14:12:03.593 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:12:03.593 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/3/2 - 200 null application/json; charset=utf-8 8.2607ms
2025-05-07 14:12:03.789 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/3 - null null
2025-05-07 14:12:03.789 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:12:03.790 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 14:12:03.793 +07:00 [INF] Retrieved 4 messages from Redis for conversation 11
2025-05-07 14:12:03.793 +07:00 [INF] Retrieved 4 messages from Redis for conversation 11 and user 3
2025-05-07 14:12:03.794 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:12:03.794 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.6145ms
2025-05-07 14:12:03.794 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:12:03.795 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/3 - 200 null application/json; charset=utf-8 5.4886ms
2025-05-07 14:12:03.922 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - null null
2025-05-07 14:12:03.922 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:12:03.922 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:12:03.924 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:12:03.924 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 14:12:03.925 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 2.2939ms
2025-05-07 14:12:03.925 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:12:03.925 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - 200 null application/json; charset=utf-8 2.7707ms
2025-05-07 14:12:04.084 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - null null
2025-05-07 14:12:04.084 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:12:04.084 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 14:12:04.086 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 14:12:04.086 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:12:04.087 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 2.057ms
2025-05-07 14:12:04.087 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:12:04.087 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - 200 null application/json; charset=utf-8 2.7278ms
2025-05-07 14:12:13.077 +07:00 [INF] Handling message from user 3: dfggd
2025-05-07 14:12:13.079 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:12:13.082 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:12:13.088 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 14:12:13.088 +07:00 [INF] Message saved to DB with ID: 140
2025-05-07 14:12:13.089 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:12:13.095 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 14:12:13.099 +07:00 [INF] Transaction committed for message: 140
2025-05-07 14:12:13.100 +07:00 [INF] Saved message 140 to Redis
2025-05-07 14:12:13.101 +07:00 [INF] Added message 140 to conversation 11
2025-05-07 14:12:13.101 +07:00 [INF] Published message to channel conversation:11
2025-05-07 14:12:23.117 +07:00 [INF] Handling message from user 2: yu
2025-05-07 14:12:23.120 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:12:23.122 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:12:23.124 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 14:12:23.124 +07:00 [INF] Message saved to DB with ID: 141
2025-05-07 14:12:23.126 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:12:23.126 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 14:12:23.127 +07:00 [INF] Transaction committed for message: 141
2025-05-07 14:12:23.128 +07:00 [INF] Saved message 141 to Redis
2025-05-07 14:12:23.128 +07:00 [INF] Added message 141 to conversation 11
2025-05-07 14:12:23.129 +07:00 [INF] Published message to channel conversation:11
2025-05-07 14:13:33.432 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/2/3 - null null
2025-05-07 14:13:33.433 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:13:33.433 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 14:13:33.438 +07:00 [INF] Retrieved 1 messages from Redis for conversation 2
2025-05-07 14:13:33.441 +07:00 [INF] Retrieved 1 messages from Redis for conversation 2 and user 3
2025-05-07 14:13:33.441 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:13:33.441 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 8.1254ms
2025-05-07 14:13:33.441 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:13:33.441 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/2/3 - 200 null application/json; charset=utf-8 8.9433ms
2025-05-07 14:13:33.514 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/2 - null null
2025-05-07 14:13:33.514 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:13:33.514 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:13:33.527 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:13:33.527 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 14:13:33.528 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 13.669ms
2025-05-07 14:13:33.528 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:13:33.528 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/2 - 200 null application/json; charset=utf-8 14.2464ms
2025-05-07 14:13:33.609 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/2 - null null
2025-05-07 14:13:33.609 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:13:33.609 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 14:13:33.617 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 14:13:33.618 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:13:33.618 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.7524ms
2025-05-07 14:13:33.618 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:13:33.618 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/2 - 200 null application/json; charset=utf-8 9.4132ms
2025-05-07 14:13:40.891 +07:00 [INF] Handling message from user 3: sdsg
2025-05-07 14:13:40.907 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:13:40.913 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:13:40.925 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 14:13:40.926 +07:00 [INF] Message saved to DB with ID: 142
2025-05-07 14:13:40.927 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:13:40.936 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 14:13:40.937 +07:00 [INF] Transaction committed for message: 142
2025-05-07 14:13:40.940 +07:00 [INF] Saved message 142 to Redis
2025-05-07 14:13:40.941 +07:00 [INF] Added message 142 to conversation 2
2025-05-07 14:13:40.941 +07:00 [INF] Published message to channel conversation:2
2025-05-07 14:22:18.054 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 14:22:18.054 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 14:22:18.070 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 14:22:18.069 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 14:22:18.257 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 14:22:18.258 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 14:22:18.285 +07:00 [ERR] Connection id "0HNCD6LHBPM2A", Request id "0HNCD6LHBPM2A:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 14:22:18.285 +07:00 [ERR] Connection id "0HNCD6LHBPM26", Request id "0HNCD6LHBPM26:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 14:22:18.298 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=3 - 101 null null 888554.7824ms
2025-05-07 14:22:18.301 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 954764.7302ms
2025-05-07 14:25:02.138 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 14:25:02.164 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 14:25:02.299 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 14:25:02.322 +07:00 [ERR] Connection id "0HNCD6LHBPM21", Request id "0HNCD6LHBPM21:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 14:25:02.365 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 1189253.7912ms
2025-05-07 14:25:19.242 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 14:25:19.243 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 14:25:19.278 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 14:25:19.279 +07:00 [ERR] Connection id "0HNCD6LHBPM1S", Request id "0HNCD6LHBPM1S:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 14:25:19.286 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 1260661.7484ms
2025-05-07 14:25:20.114 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 14:25:20.115 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 14:25:20.130 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 14:25:20.130 +07:00 [ERR] Connection id "0HNCD6LHBPM1T", Request id "0HNCD6LHBPM1T:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 14:25:20.160 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 1260573.1585ms
2025-05-07 14:25:30.771 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 60
2025-05-07 14:25:30.819 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 14:25:30.824 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 14:25:31.180 +07:00 [INF] Executed DbCommand (108ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 14:25:31.244 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 14:25:31.252 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 425.7672ms
2025-05-07 14:25:31.252 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 14:25:31.257 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 487.0809ms
2025-05-07 14:25:32.058 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/3 - null null
2025-05-07 14:25:32.061 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 14:25:32.061 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 14:25:32.122 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 14:25:32.122 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:25:32.124 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 62.3612ms
2025-05-07 14:25:32.124 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 14:25:32.125 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 66.4606ms
2025-05-07 14:25:32.379 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 14:25:32.380 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 14:25:32.381 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:25:32.398 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:25:32.399 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 18.1588ms
2025-05-07 14:25:32.399 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 14:25:32.399 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 20.1536ms
2025-05-07 14:25:33.032 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=3 - null null
2025-05-07 14:25:33.032 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 14:25:33.154 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 14:25:33.211 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 14:26:16.644 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 14:26:16.645 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 14:26:16.645 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 14:26:16.664 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 14:26:16.667 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 14:26:16.667 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 21.9517ms
2025-05-07 14:26:16.667 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 14:26:16.667 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 23.3622ms
2025-05-07 14:26:17.695 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 14:26:17.695 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 14:26:17.695 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:26:17.696 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 14:26:17.696 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 14:26:17.696 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 14:26:17.699 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:26:17.700 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 5.0772ms
2025-05-07 14:26:17.700 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 14:26:17.700 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 5.663ms
2025-05-07 14:26:17.707 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 14:26:17.708 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:26:17.708 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.9454ms
2025-05-07 14:26:17.708 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 14:26:17.708 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 12.3698ms
2025-05-07 14:26:18.262 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 14:26:18.263 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 14:26:18.335 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 14:26:21.586 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/2 - null null
2025-05-07 14:26:21.588 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:26:21.588 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 14:26:21.618 +07:00 [INF] Retrieved 6 messages from Redis for conversation 11
2025-05-07 14:26:21.622 +07:00 [INF] Retrieved 6 messages from Redis for conversation 11 and user 2
2025-05-07 14:26:21.623 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:26:21.626 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 37.0867ms
2025-05-07 14:26:21.627 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:26:21.628 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/11/2 - 200 null application/json; charset=utf-8 41.2902ms
2025-05-07 14:26:21.660 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - null null
2025-05-07 14:26:21.661 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:26:21.661 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:26:21.674 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:26:21.675 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 14:26:21.676 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 15.012ms
2025-05-07 14:26:21.676 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:26:21.676 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/11 - 200 null application/json; charset=utf-8 15.989ms
2025-05-07 14:26:21.720 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - null null
2025-05-07 14:26:21.720 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:26:21.720 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 14:26:21.728 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 14:26:21.731 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:26:21.732 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 11.8977ms
2025-05-07 14:26:21.733 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:26:21.733 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/11 - 200 null application/json; charset=utf-8 12.8834ms
2025-05-07 14:26:24.862 +07:00 [INF] Handling message from user 2: bhshs
2025-05-07 14:26:24.869 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:26:24.913 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:26:24.930 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 14:26:24.933 +07:00 [INF] Message saved to DB with ID: 143
2025-05-07 14:26:24.934 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 14:26:24.944 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 14:26:24.947 +07:00 [INF] Transaction committed for message: 143
2025-05-07 14:26:24.949 +07:00 [INF] Saved message 143 to Redis
2025-05-07 14:26:24.950 +07:00 [INF] Added message 143 to conversation 11
2025-05-07 14:26:24.951 +07:00 [INF] Published message to channel conversation:11
2025-05-07 14:26:57.397 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/4 - null null
2025-05-07 14:26:57.397 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:26:57.397 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:26:57.403 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:26:57.417 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:26:57.507 +07:00 [INF] Executed DbCommand (85ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 14:26:57.507 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 14:26:57.507 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 110.2184ms
2025-05-07 14:26:57.508 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:26:57.508 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/4 - 200 null application/json; charset=utf-8 110.7222ms
2025-05-07 14:26:57.715 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/3/2 - null null
2025-05-07 14:26:57.715 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:26:57.715 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 14:26:57.719 +07:00 [INF] Retrieved 6 messages from Redis for conversation 3
2025-05-07 14:26:57.719 +07:00 [INF] Retrieved 6 messages from Redis for conversation 3 and user 2
2025-05-07 14:26:57.720 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:26:57.720 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.4564ms
2025-05-07 14:26:57.720 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:26:57.720 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/3/2 - 200 null application/json; charset=utf-8 5.3447ms
2025-05-07 14:26:57.761 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/3 - null null
2025-05-07 14:26:57.761 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:26:57.761 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:26:57.771 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:26:57.771 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 14:26:57.772 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 11.0506ms
2025-05-07 14:26:57.772 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:26:57.773 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/3 - 200 null application/json; charset=utf-8 11.6183ms
2025-05-07 14:26:57.793 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - null null
2025-05-07 14:26:57.793 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:26:57.793 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 14:26:57.802 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 14:26:57.803 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:26:57.803 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.8775ms
2025-05-07 14:26:57.803 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:26:57.803 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - 200 null application/json; charset=utf-8 10.4075ms
2025-05-07 14:27:00.643 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/5 - null null
2025-05-07 14:27:00.645 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:27:00.645 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:27:00.668 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:27:00.675 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 14:27:00.763 +07:00 [INF] Executed DbCommand (86ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 14:27:00.764 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 14:27:00.764 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 118.8474ms
2025-05-07 14:27:00.764 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 14:27:00.764 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/5 - 200 null application/json; charset=utf-8 120.7648ms
2025-05-07 14:27:00.966 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-07 14:27:00.967 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:27:00.967 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 14:27:00.991 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4
2025-05-07 14:27:00.991 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-07 14:27:00.991 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 14:27:00.995 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 28.3425ms
2025-05-07 14:27:00.995 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 14:27:00.996 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 29.2954ms
2025-05-07 14:27:01.044 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 14:27:01.045 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:27:01.045 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 14:27:01.056 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 14:27:01.057 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 14:27:01.057 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 11.971ms
2025-05-07 14:27:01.057 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 14:27:01.057 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 12.8447ms
2025-05-07 14:27:01.085 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-07 14:27:01.086 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:27:01.086 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 14:27:01.098 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 14:27:01.099 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 14:27:01.099 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 13.302ms
2025-05-07 14:27:01.099 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 14:27:01.100 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 14.4829ms
2025-05-07 14:43:52.401 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 14:43:52.421 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 14:43:52.468 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 14:43:52.469 +07:00 [ERR] Connection id "0HNCD6LHBPM3G", Request id "0HNCD6LHBPM3G:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 14:43:52.483 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 1054219.5853ms
2025-05-07 16:06:40.148 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 16:06:40.218 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 16:06:40.817 +07:00 [INF] Executed DbCommand (53ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 16:20:08.878 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 16:20:08.880 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 16:20:08.905 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 16:20:08.906 +07:00 [ERR] Connection id "0HNCD6LHBPM3C", Request id "0HNCD6LHBPM3C:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 16:20:08.919 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=3 - 101 null null 6875887.3408ms
2025-05-07 16:23:00.857 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 53
2025-05-07 16:23:00.879 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 16:23:00.888 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 16:23:01.098 +07:00 [INF] Executed DbCommand (61ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 16:23:01.130 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 16:23:01.141 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 250.3579ms
2025-05-07 16:23:01.141 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 16:23:01.141 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 284.8749ms
2025-05-07 16:23:01.837 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - null null
2025-05-07 16:23:01.841 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 16:23:01.845 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 16:23:01.942 +07:00 [INF] Executed DbCommand (38ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 16:23:01.946 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 16:23:01.949 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 96.7419ms
2025-05-07 16:23:01.949 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 16:23:01.950 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - 200 null application/json; charset=utf-8 113.2849ms
2025-05-07 16:23:02.323 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - null null
2025-05-07 16:23:02.323 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 16:23:02.325 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 16:23:02.394 +07:00 [INF] Executed DbCommand (42ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 16:23:02.410 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 16:23:02.411 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 86.0773ms
2025-05-07 16:23:02.411 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 16:23:02.412 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 88.4266ms
2025-05-07 16:23:02.602 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-07 16:23:02.602 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 16:23:02.828 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 16:23:02.897 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 16:23:02.912 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 16:52:00.447 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 16:52:00.567 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 16:52:00.941 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 16:52:00.944 +07:00 [ERR] Connection id "0HNCD6LHBPM3S", Request id "0HNCD6LHBPM3S:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 16:52:01.755 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 2721608.9721ms
2025-05-07 20:55:01.335 +07:00 [INF] Application is shutting down...
2025-05-07 20:55:31.415 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 20:55:31.428 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 16348823.3453ms
2025-05-07 21:14:45.966 +07:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-07 21:14:46.112 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-07 21:14:46.221 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-07 21:14:46.233 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-07 21:14:46.234 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-07 21:14:46.234 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-07 21:14:46.234 +07:00 [INF] Hosting environment: Development
2025-05-07 21:14:46.234 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-07 21:19:45.756 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 60
2025-05-07 21:19:45.806 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-07 21:19:45.842 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:19:45.865 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 21:19:46.019 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 21:19:46.097 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 21:19:46.140 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 273.2151ms
2025-05-07 21:19:46.141 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:19:46.145 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 391.4125ms
2025-05-07 21:19:46.907 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/3 - null null
2025-05-07 21:19:46.914 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:19:46.922 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 21:19:47.038 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 21:19:47.041 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 21:19:47.056 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 133.5809ms
2025-05-07 21:19:47.056 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:19:47.057 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 149.1031ms
2025-05-07 21:19:47.095 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 21:19:47.098 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:19:47.101 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:19:47.176 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 21:19:47.189 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 21:19:47.191 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 89.6235ms
2025-05-07 21:19:47.191 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:19:47.191 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 95.9652ms
2025-05-07 21:19:47.861 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=3 - null null
2025-05-07 21:19:47.862 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 21:19:48.323 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 21:19:48.343 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 21:19:48.349 +07:00 [INF] Saved message 114 to Redis
2025-05-07 21:19:48.351 +07:00 [INF] Added message 114 to conversation 1
2025-05-07 21:19:48.352 +07:00 [INF] Saved message 113 to Redis
2025-05-07 21:19:48.352 +07:00 [INF] Added message 113 to conversation 1
2025-05-07 21:19:48.356 +07:00 [INF] Saved message 112 to Redis
2025-05-07 21:19:48.357 +07:00 [INF] Added message 112 to conversation 1
2025-05-07 21:19:48.357 +07:00 [INF] Saved message 110 to Redis
2025-05-07 21:19:48.358 +07:00 [INF] Added message 110 to conversation 1
2025-05-07 21:19:48.359 +07:00 [INF] Saved message 109 to Redis
2025-05-07 21:19:48.359 +07:00 [INF] Added message 109 to conversation 1
2025-05-07 21:19:48.360 +07:00 [INF] Saved message 108 to Redis
2025-05-07 21:19:48.360 +07:00 [INF] Added message 108 to conversation 1
2025-05-07 21:19:48.361 +07:00 [INF] Saved message 107 to Redis
2025-05-07 21:19:48.361 +07:00 [INF] Added message 107 to conversation 1
2025-05-07 21:19:48.363 +07:00 [INF] Saved message 106 to Redis
2025-05-07 21:19:48.364 +07:00 [INF] Added message 106 to conversation 1
2025-05-07 21:19:48.365 +07:00 [INF] Saved message 105 to Redis
2025-05-07 21:19:48.365 +07:00 [INF] Added message 105 to conversation 1
2025-05-07 21:19:48.366 +07:00 [INF] Saved message 104 to Redis
2025-05-07 21:19:48.367 +07:00 [INF] Added message 104 to conversation 1
2025-05-07 21:19:48.367 +07:00 [INF] Saved message 103 to Redis
2025-05-07 21:19:48.368 +07:00 [INF] Added message 103 to conversation 1
2025-05-07 21:19:48.369 +07:00 [INF] Saved message 102 to Redis
2025-05-07 21:19:48.369 +07:00 [INF] Added message 102 to conversation 1
2025-05-07 21:19:48.370 +07:00 [INF] Saved message 101 to Redis
2025-05-07 21:19:48.371 +07:00 [INF] Added message 101 to conversation 1
2025-05-07 21:19:48.372 +07:00 [INF] Saved message 100 to Redis
2025-05-07 21:19:48.373 +07:00 [INF] Added message 100 to conversation 1
2025-05-07 21:19:48.374 +07:00 [INF] Saved message 99 to Redis
2025-05-07 21:19:48.375 +07:00 [INF] Added message 99 to conversation 1
2025-05-07 21:19:48.376 +07:00 [INF] Saved message 98 to Redis
2025-05-07 21:19:48.376 +07:00 [INF] Added message 98 to conversation 1
2025-05-07 21:19:48.377 +07:00 [INF] Saved message 95 to Redis
2025-05-07 21:19:48.377 +07:00 [INF] Added message 95 to conversation 1
2025-05-07 21:19:48.378 +07:00 [INF] Saved message 94 to Redis
2025-05-07 21:19:48.378 +07:00 [INF] Added message 94 to conversation 1
2025-05-07 21:19:48.379 +07:00 [INF] Saved message 93 to Redis
2025-05-07 21:19:48.379 +07:00 [INF] Added message 93 to conversation 1
2025-05-07 21:19:48.380 +07:00 [INF] Saved message 92 to Redis
2025-05-07 21:19:48.381 +07:00 [INF] Added message 92 to conversation 1
2025-05-07 21:19:48.381 +07:00 [INF] Saved message 91 to Redis
2025-05-07 21:19:48.382 +07:00 [INF] Added message 91 to conversation 1
2025-05-07 21:19:48.383 +07:00 [INF] Saved message 90 to Redis
2025-05-07 21:19:48.383 +07:00 [INF] Added message 90 to conversation 1
2025-05-07 21:19:48.384 +07:00 [INF] Saved message 87 to Redis
2025-05-07 21:19:48.384 +07:00 [INF] Added message 87 to conversation 1
2025-05-07 21:19:48.385 +07:00 [INF] Saved message 86 to Redis
2025-05-07 21:19:48.385 +07:00 [INF] Added message 86 to conversation 1
2025-05-07 21:19:48.386 +07:00 [INF] Saved message 85 to Redis
2025-05-07 21:19:48.387 +07:00 [INF] Added message 85 to conversation 1
2025-05-07 21:19:48.389 +07:00 [INF] Saved message 84 to Redis
2025-05-07 21:19:48.389 +07:00 [INF] Added message 84 to conversation 1
2025-05-07 21:19:48.390 +07:00 [INF] Saved message 83 to Redis
2025-05-07 21:19:48.391 +07:00 [INF] Added message 83 to conversation 1
2025-05-07 21:19:48.392 +07:00 [INF] Saved message 82 to Redis
2025-05-07 21:19:48.392 +07:00 [INF] Added message 82 to conversation 1
2025-05-07 21:19:48.393 +07:00 [INF] Saved message 81 to Redis
2025-05-07 21:19:48.393 +07:00 [INF] Added message 81 to conversation 1
2025-05-07 21:19:48.394 +07:00 [INF] Saved message 80 to Redis
2025-05-07 21:19:48.395 +07:00 [INF] Added message 80 to conversation 1
2025-05-07 21:19:48.396 +07:00 [INF] Saved message 79 to Redis
2025-05-07 21:19:48.396 +07:00 [INF] Added message 79 to conversation 1
2025-05-07 21:19:48.397 +07:00 [INF] Saved message 78 to Redis
2025-05-07 21:19:48.397 +07:00 [INF] Added message 78 to conversation 1
2025-05-07 21:19:48.398 +07:00 [INF] Saved message 77 to Redis
2025-05-07 21:19:48.399 +07:00 [INF] Added message 77 to conversation 1
2025-05-07 21:19:48.400 +07:00 [INF] Saved message 76 to Redis
2025-05-07 21:19:48.400 +07:00 [INF] Added message 76 to conversation 1
2025-05-07 21:19:48.401 +07:00 [INF] Saved message 75 to Redis
2025-05-07 21:19:48.402 +07:00 [INF] Added message 75 to conversation 1
2025-05-07 21:19:48.403 +07:00 [INF] Saved message 74 to Redis
2025-05-07 21:19:48.403 +07:00 [INF] Added message 74 to conversation 1
2025-05-07 21:19:48.405 +07:00 [INF] Saved message 73 to Redis
2025-05-07 21:19:48.406 +07:00 [INF] Added message 73 to conversation 1
2025-05-07 21:19:48.407 +07:00 [INF] Saved message 72 to Redis
2025-05-07 21:19:48.408 +07:00 [INF] Added message 72 to conversation 1
2025-05-07 21:19:48.409 +07:00 [INF] Saved message 71 to Redis
2025-05-07 21:19:48.410 +07:00 [INF] Added message 71 to conversation 1
2025-05-07 21:19:48.411 +07:00 [INF] Saved message 68 to Redis
2025-05-07 21:19:48.411 +07:00 [INF] Added message 68 to conversation 1
2025-05-07 21:19:48.412 +07:00 [INF] Saved message 64 to Redis
2025-05-07 21:19:48.412 +07:00 [INF] Added message 64 to conversation 1
2025-05-07 21:19:48.413 +07:00 [INF] Saved message 62 to Redis
2025-05-07 21:19:48.414 +07:00 [INF] Added message 62 to conversation 1
2025-05-07 21:19:48.414 +07:00 [INF] Saved message 61 to Redis
2025-05-07 21:19:48.415 +07:00 [INF] Added message 61 to conversation 1
2025-05-07 21:19:48.416 +07:00 [INF] Saved message 60 to Redis
2025-05-07 21:19:48.417 +07:00 [INF] Added message 60 to conversation 1
2025-05-07 21:19:48.418 +07:00 [INF] Saved message 59 to Redis
2025-05-07 21:19:48.418 +07:00 [INF] Added message 59 to conversation 1
2025-05-07 21:19:48.419 +07:00 [INF] Saved message 57 to Redis
2025-05-07 21:19:48.420 +07:00 [INF] Added message 57 to conversation 1
2025-05-07 21:19:48.422 +07:00 [INF] Saved message 55 to Redis
2025-05-07 21:19:48.423 +07:00 [INF] Added message 55 to conversation 1
2025-05-07 21:19:48.424 +07:00 [INF] Saved message 54 to Redis
2025-05-07 21:19:48.425 +07:00 [INF] Added message 54 to conversation 1
2025-05-07 21:19:48.426 +07:00 [INF] Saved message 51 to Redis
2025-05-07 21:19:48.426 +07:00 [INF] Added message 51 to conversation 1
2025-05-07 21:19:48.427 +07:00 [INF] Saved message 49 to Redis
2025-05-07 21:19:48.428 +07:00 [INF] Added message 49 to conversation 1
2025-05-07 21:19:48.434 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 21:19:48.435 +07:00 [INF] Saved message 142 to Redis
2025-05-07 21:19:48.436 +07:00 [INF] Added message 142 to conversation 2
2025-05-07 21:19:48.450 +07:00 [INF] Saved message 4 to Redis
2025-05-07 21:19:48.451 +07:00 [INF] Added message 4 to conversation 2
2025-05-07 21:19:48.455 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 21:20:15.328 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 21:20:15.330 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:20:15.331 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 21:20:15.335 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 21:20:15.340 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 21:20:15.341 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 10.5305ms
2025-05-07 21:20:15.342 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:20:15.343 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 15.3628ms
2025-05-07 21:20:16.570 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 21:20:16.573 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 21:20:16.575 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:20:16.576 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 21:20:16.578 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:20:16.579 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:20:16.586 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 21:20:16.586 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 21:20:16.587 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.654ms
2025-05-07 21:20:16.587 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:20:16.587 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 17.0717ms
2025-05-07 21:20:16.590 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 21:20:16.597 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 21:20:16.597 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 18.1895ms
2025-05-07 21:20:16.597 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:20:16.597 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 24.3227ms
2025-05-07 21:20:17.091 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 21:20:17.092 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 21:20:17.232 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 21:20:17.241 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 21:20:17.246 +07:00 [INF] Saved message 117 to Redis
2025-05-07 21:20:17.248 +07:00 [INF] Added message 117 to conversation 3
2025-05-07 21:20:17.251 +07:00 [INF] Saved message 115 to Redis
2025-05-07 21:20:17.252 +07:00 [INF] Added message 115 to conversation 3
2025-05-07 21:20:17.255 +07:00 [INF] Saved message 88 to Redis
2025-05-07 21:20:17.257 +07:00 [INF] Added message 88 to conversation 3
2025-05-07 21:20:17.261 +07:00 [INF] Saved message 70 to Redis
2025-05-07 21:20:17.262 +07:00 [INF] Added message 70 to conversation 3
2025-05-07 21:20:17.266 +07:00 [INF] Saved message 65 to Redis
2025-05-07 21:20:17.267 +07:00 [INF] Added message 65 to conversation 3
2025-05-07 21:20:17.270 +07:00 [INF] Saved message 48 to Redis
2025-05-07 21:20:17.270 +07:00 [INF] Added message 48 to conversation 3
2025-05-07 21:20:17.277 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 21:20:17.280 +07:00 [INF] Saved message 135 to Redis
2025-05-07 21:20:17.280 +07:00 [INF] Added message 135 to conversation 4
2025-05-07 21:20:17.281 +07:00 [INF] Saved message 133 to Redis
2025-05-07 21:20:17.282 +07:00 [INF] Added message 133 to conversation 4
2025-05-07 21:20:17.283 +07:00 [INF] Saved message 132 to Redis
2025-05-07 21:20:17.283 +07:00 [INF] Added message 132 to conversation 4
2025-05-07 21:20:17.284 +07:00 [INF] Saved message 131 to Redis
2025-05-07 21:20:17.284 +07:00 [INF] Added message 131 to conversation 4
2025-05-07 21:20:17.285 +07:00 [INF] Saved message 130 to Redis
2025-05-07 21:20:17.285 +07:00 [INF] Added message 130 to conversation 4
2025-05-07 21:20:17.286 +07:00 [INF] Saved message 129 to Redis
2025-05-07 21:20:17.286 +07:00 [INF] Added message 129 to conversation 4
2025-05-07 21:20:17.287 +07:00 [INF] Saved message 128 to Redis
2025-05-07 21:20:17.287 +07:00 [INF] Added message 128 to conversation 4
2025-05-07 21:20:17.287 +07:00 [INF] Saved message 127 to Redis
2025-05-07 21:20:17.288 +07:00 [INF] Added message 127 to conversation 4
2025-05-07 21:20:17.289 +07:00 [INF] Saved message 126 to Redis
2025-05-07 21:20:17.290 +07:00 [INF] Added message 126 to conversation 4
2025-05-07 21:20:17.290 +07:00 [INF] Saved message 125 to Redis
2025-05-07 21:20:17.291 +07:00 [INF] Added message 125 to conversation 4
2025-05-07 21:20:17.292 +07:00 [INF] Saved message 124 to Redis
2025-05-07 21:20:17.292 +07:00 [INF] Added message 124 to conversation 4
2025-05-07 21:20:17.293 +07:00 [INF] Saved message 123 to Redis
2025-05-07 21:20:17.293 +07:00 [INF] Added message 123 to conversation 4
2025-05-07 21:20:17.294 +07:00 [INF] Saved message 122 to Redis
2025-05-07 21:20:17.294 +07:00 [INF] Added message 122 to conversation 4
2025-05-07 21:20:17.294 +07:00 [INF] Saved message 121 to Redis
2025-05-07 21:20:17.295 +07:00 [INF] Added message 121 to conversation 4
2025-05-07 21:20:17.295 +07:00 [INF] Saved message 120 to Redis
2025-05-07 21:20:17.296 +07:00 [INF] Added message 120 to conversation 4
2025-05-07 21:20:17.296 +07:00 [INF] Saved message 119 to Redis
2025-05-07 21:20:17.296 +07:00 [INF] Added message 119 to conversation 4
2025-05-07 21:20:17.297 +07:00 [INF] Saved message 118 to Redis
2025-05-07 21:20:17.297 +07:00 [INF] Added message 118 to conversation 4
2025-05-07 21:20:17.297 +07:00 [INF] Saved message 111 to Redis
2025-05-07 21:20:17.297 +07:00 [INF] Added message 111 to conversation 4
2025-05-07 21:20:17.298 +07:00 [INF] Saved message 97 to Redis
2025-05-07 21:20:17.298 +07:00 [INF] Added message 97 to conversation 4
2025-05-07 21:20:17.299 +07:00 [INF] Saved message 96 to Redis
2025-05-07 21:20:17.299 +07:00 [INF] Added message 96 to conversation 4
2025-05-07 21:20:17.299 +07:00 [INF] Saved message 89 to Redis
2025-05-07 21:20:17.299 +07:00 [INF] Added message 89 to conversation 4
2025-05-07 21:20:17.300 +07:00 [INF] Saved message 69 to Redis
2025-05-07 21:20:17.300 +07:00 [INF] Added message 69 to conversation 4
2025-05-07 21:20:17.300 +07:00 [INF] Saved message 67 to Redis
2025-05-07 21:20:17.301 +07:00 [INF] Added message 67 to conversation 4
2025-05-07 21:20:17.301 +07:00 [INF] Saved message 66 to Redis
2025-05-07 21:20:17.301 +07:00 [INF] Added message 66 to conversation 4
2025-05-07 21:20:17.302 +07:00 [INF] Saved message 63 to Redis
2025-05-07 21:20:17.302 +07:00 [INF] Added message 63 to conversation 4
2025-05-07 21:20:17.303 +07:00 [INF] Saved message 58 to Redis
2025-05-07 21:20:17.303 +07:00 [INF] Added message 58 to conversation 4
2025-05-07 21:20:17.304 +07:00 [INF] Saved message 56 to Redis
2025-05-07 21:20:17.304 +07:00 [INF] Added message 56 to conversation 4
2025-05-07 21:20:17.305 +07:00 [INF] Saved message 53 to Redis
2025-05-07 21:20:17.305 +07:00 [INF] Added message 53 to conversation 4
2025-05-07 21:20:17.306 +07:00 [INF] Saved message 52 to Redis
2025-05-07 21:20:17.307 +07:00 [INF] Added message 52 to conversation 4
2025-05-07 21:20:17.307 +07:00 [INF] Saved message 50 to Redis
2025-05-07 21:20:17.308 +07:00 [INF] Added message 50 to conversation 4
2025-05-07 21:20:17.308 +07:00 [INF] Saved message 47 to Redis
2025-05-07 21:20:17.309 +07:00 [INF] Added message 47 to conversation 4
2025-05-07 21:20:17.309 +07:00 [INF] Saved message 46 to Redis
2025-05-07 21:20:17.309 +07:00 [INF] Added message 46 to conversation 4
2025-05-07 21:20:17.310 +07:00 [INF] Saved message 45 to Redis
2025-05-07 21:20:17.310 +07:00 [INF] Added message 45 to conversation 4
2025-05-07 21:20:17.310 +07:00 [INF] Saved message 44 to Redis
2025-05-07 21:20:17.311 +07:00 [INF] Added message 44 to conversation 4
2025-05-07 21:20:17.311 +07:00 [INF] Saved message 43 to Redis
2025-05-07 21:20:17.311 +07:00 [INF] Added message 43 to conversation 4
2025-05-07 21:20:17.312 +07:00 [INF] Saved message 42 to Redis
2025-05-07 21:20:17.312 +07:00 [INF] Added message 42 to conversation 4
2025-05-07 21:20:17.313 +07:00 [INF] Saved message 41 to Redis
2025-05-07 21:20:17.313 +07:00 [INF] Added message 41 to conversation 4
2025-05-07 21:20:17.313 +07:00 [INF] Saved message 40 to Redis
2025-05-07 21:20:17.314 +07:00 [INF] Added message 40 to conversation 4
2025-05-07 21:20:17.314 +07:00 [INF] Saved message 39 to Redis
2025-05-07 21:20:17.314 +07:00 [INF] Added message 39 to conversation 4
2025-05-07 21:20:17.315 +07:00 [INF] Saved message 38 to Redis
2025-05-07 21:20:17.315 +07:00 [INF] Added message 38 to conversation 4
2025-05-07 21:20:17.315 +07:00 [INF] Saved message 37 to Redis
2025-05-07 21:20:17.316 +07:00 [INF] Added message 37 to conversation 4
2025-05-07 21:20:17.316 +07:00 [INF] Saved message 36 to Redis
2025-05-07 21:20:17.316 +07:00 [INF] Added message 36 to conversation 4
2025-05-07 21:20:17.317 +07:00 [INF] Saved message 35 to Redis
2025-05-07 21:20:17.317 +07:00 [INF] Added message 35 to conversation 4
2025-05-07 21:20:17.317 +07:00 [INF] Saved message 34 to Redis
2025-05-07 21:20:17.318 +07:00 [INF] Added message 34 to conversation 4
2025-05-07 21:20:17.318 +07:00 [INF] Saved message 33 to Redis
2025-05-07 21:20:17.318 +07:00 [INF] Added message 33 to conversation 4
2025-05-07 21:20:17.319 +07:00 [INF] Saved message 32 to Redis
2025-05-07 21:20:17.319 +07:00 [INF] Added message 32 to conversation 4
2025-05-07 21:20:17.319 +07:00 [INF] Saved message 31 to Redis
2025-05-07 21:20:17.319 +07:00 [INF] Added message 31 to conversation 4
2025-05-07 21:20:17.320 +07:00 [INF] Saved message 30 to Redis
2025-05-07 21:20:17.320 +07:00 [INF] Added message 30 to conversation 4
2025-05-07 21:20:17.321 +07:00 [INF] Saved message 29 to Redis
2025-05-07 21:20:17.322 +07:00 [INF] Added message 29 to conversation 4
2025-05-07 21:20:17.323 +07:00 [INF] Saved message 28 to Redis
2025-05-07 21:20:17.323 +07:00 [INF] Added message 28 to conversation 4
2025-05-07 21:20:18.748 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 21:20:18.749 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 21:20:18.762 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:20:18.805 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 21:20:18.808 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 21:20:18.893 +07:00 [INF] Executed DbCommand (64ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 21:20:19.032 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-07 21:20:19.086 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__user_id_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] IN (
    SELECT [u0].[value]
    FROM OPENJSON(@__user_id_0) WITH ([value] int '$') AS [u0]
)
2025-05-07 21:20:19.145 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-07 21:20:19.160 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN (
    SELECT [p].[id] AS [Id], [p].[user_id], [p].[conversation_id] AS [ConversationId], [p].[name] AS [Name], [p].[is_deleted] AS [IsDeleted], [p].[img_url]
    FROM [Participants] AS [p]
    WHERE [p].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 21:20:19.169 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 21:20:19.169 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 407.3101ms
2025-05-07 21:20:19.169 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 21:20:19.170 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 421.3049ms
2025-05-07 21:20:19.518 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/12/2 - null null
2025-05-07 21:20:19.518 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 21:20:19.521 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 21:20:19.532 +07:00 [INF] Retrieved 0 messages from Redis for conversation 12
2025-05-07 21:20:19.551 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 21:20:19.586 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 21:20:19.587 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 21:20:19.588 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 67.2128ms
2025-05-07 21:20:19.589 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 21:20:19.589 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/12/2 - 404 null text/plain; charset=utf-8 70.7342ms
2025-05-07 21:20:19.677 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/12 - null null
2025-05-07 21:20:19.677 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 21:20:19.679 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:20:19.689 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:20:19.690 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 21:20:19.691 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 11.5455ms
2025-05-07 21:20:19.691 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 21:20:19.691 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/12 - 200 null application/json; charset=utf-8 14.5156ms
2025-05-07 21:20:19.722 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/12 - null null
2025-05-07 21:20:19.723 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 21:20:19.727 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 21:20:19.744 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 21:20:19.746 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 21:20:19.748 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 20.8896ms
2025-05-07 21:20:19.749 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 21:20:19.749 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/12 - 200 null application/json; charset=utf-8 26.8487ms
2025-05-07 21:20:24.458 +07:00 [INF] Handling message from user 2: nsnsn
2025-05-07 21:20:24.460 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:20:24.495 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:20:24.502 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 21:20:24.507 +07:00 [INF] Message saved to DB with ID: 144
2025-05-07 21:20:24.513 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:20:24.524 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 21:20:24.532 +07:00 [INF] Transaction committed for message: 144
2025-05-07 21:20:24.534 +07:00 [INF] Saved message 144 to Redis
2025-05-07 21:20:24.534 +07:00 [INF] Added message 144 to conversation 12
2025-05-07 21:20:24.543 +07:00 [INF] Published message to channel conversation:12
2025-05-07 21:31:14.550 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 21:31:14.553 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 21:31:14.601 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 21:31:14.604 +07:00 [ERR] Connection id "0HNCDE8RR218A", Request id "0HNCDE8RR218A:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 21:31:14.610 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 657518.3306ms
2025-05-07 21:32:07.111 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 60
2025-05-07 21:32:07.119 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:32:07.124 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 21:32:07.200 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 21:32:07.206 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 21:32:07.210 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 83.9629ms
2025-05-07 21:32:07.210 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:32:07.210 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 98.7001ms
2025-05-07 21:32:07.998 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/3 - null null
2025-05-07 21:32:07.999 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:32:07.999 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 21:32:08.014 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 21:32:08.014 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 21:32:08.015 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 15.4429ms
2025-05-07 21:32:08.015 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:32:08.015 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 16.9431ms
2025-05-07 21:32:08.418 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 21:32:08.419 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:32:08.419 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:32:08.442 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 21:32:08.445 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 21:32:08.446 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 26.7939ms
2025-05-07 21:32:08.446 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:32:08.446 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 27.9149ms
2025-05-07 21:32:08.705 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=3 - null null
2025-05-07 21:32:08.706 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 21:32:08.755 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 21:32:08.770 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 21:32:08.775 +07:00 [INF] Saved message 114 to Redis
2025-05-07 21:32:08.776 +07:00 [INF] Added message 114 to conversation 1
2025-05-07 21:32:08.777 +07:00 [INF] Saved message 113 to Redis
2025-05-07 21:32:08.778 +07:00 [INF] Added message 113 to conversation 1
2025-05-07 21:32:08.780 +07:00 [INF] Saved message 112 to Redis
2025-05-07 21:32:08.780 +07:00 [INF] Added message 112 to conversation 1
2025-05-07 21:32:08.781 +07:00 [INF] Saved message 110 to Redis
2025-05-07 21:32:08.781 +07:00 [INF] Added message 110 to conversation 1
2025-05-07 21:32:08.782 +07:00 [INF] Saved message 109 to Redis
2025-05-07 21:32:08.783 +07:00 [INF] Added message 109 to conversation 1
2025-05-07 21:32:08.784 +07:00 [INF] Saved message 108 to Redis
2025-05-07 21:32:08.784 +07:00 [INF] Added message 108 to conversation 1
2025-05-07 21:32:08.784 +07:00 [INF] Saved message 107 to Redis
2025-05-07 21:32:08.785 +07:00 [INF] Added message 107 to conversation 1
2025-05-07 21:32:08.785 +07:00 [INF] Saved message 106 to Redis
2025-05-07 21:32:08.786 +07:00 [INF] Added message 106 to conversation 1
2025-05-07 21:32:08.787 +07:00 [INF] Saved message 105 to Redis
2025-05-07 21:32:08.788 +07:00 [INF] Added message 105 to conversation 1
2025-05-07 21:32:08.793 +07:00 [INF] Saved message 104 to Redis
2025-05-07 21:32:08.794 +07:00 [INF] Added message 104 to conversation 1
2025-05-07 21:32:08.795 +07:00 [INF] Saved message 103 to Redis
2025-05-07 21:32:08.795 +07:00 [INF] Added message 103 to conversation 1
2025-05-07 21:32:08.796 +07:00 [INF] Saved message 102 to Redis
2025-05-07 21:32:08.796 +07:00 [INF] Added message 102 to conversation 1
2025-05-07 21:32:08.797 +07:00 [INF] Saved message 101 to Redis
2025-05-07 21:32:08.797 +07:00 [INF] Added message 101 to conversation 1
2025-05-07 21:32:08.798 +07:00 [INF] Saved message 100 to Redis
2025-05-07 21:32:08.799 +07:00 [INF] Added message 100 to conversation 1
2025-05-07 21:32:08.800 +07:00 [INF] Saved message 99 to Redis
2025-05-07 21:32:08.800 +07:00 [INF] Added message 99 to conversation 1
2025-05-07 21:32:08.802 +07:00 [INF] Saved message 98 to Redis
2025-05-07 21:32:08.803 +07:00 [INF] Added message 98 to conversation 1
2025-05-07 21:32:08.804 +07:00 [INF] Saved message 95 to Redis
2025-05-07 21:32:08.804 +07:00 [INF] Added message 95 to conversation 1
2025-05-07 21:32:08.805 +07:00 [INF] Saved message 94 to Redis
2025-05-07 21:32:08.805 +07:00 [INF] Added message 94 to conversation 1
2025-05-07 21:32:08.806 +07:00 [INF] Saved message 93 to Redis
2025-05-07 21:32:08.809 +07:00 [INF] Added message 93 to conversation 1
2025-05-07 21:32:08.810 +07:00 [INF] Saved message 92 to Redis
2025-05-07 21:32:08.811 +07:00 [INF] Added message 92 to conversation 1
2025-05-07 21:32:08.812 +07:00 [INF] Saved message 91 to Redis
2025-05-07 21:32:08.812 +07:00 [INF] Added message 91 to conversation 1
2025-05-07 21:32:08.813 +07:00 [INF] Saved message 90 to Redis
2025-05-07 21:32:08.813 +07:00 [INF] Added message 90 to conversation 1
2025-05-07 21:32:08.814 +07:00 [INF] Saved message 87 to Redis
2025-05-07 21:32:08.815 +07:00 [INF] Added message 87 to conversation 1
2025-05-07 21:32:08.816 +07:00 [INF] Saved message 86 to Redis
2025-05-07 21:32:08.816 +07:00 [INF] Added message 86 to conversation 1
2025-05-07 21:32:08.816 +07:00 [INF] Saved message 85 to Redis
2025-05-07 21:32:08.817 +07:00 [INF] Added message 85 to conversation 1
2025-05-07 21:32:08.817 +07:00 [INF] Saved message 84 to Redis
2025-05-07 21:32:08.818 +07:00 [INF] Added message 84 to conversation 1
2025-05-07 21:32:08.818 +07:00 [INF] Saved message 83 to Redis
2025-05-07 21:32:08.819 +07:00 [INF] Added message 83 to conversation 1
2025-05-07 21:32:08.819 +07:00 [INF] Saved message 82 to Redis
2025-05-07 21:32:08.820 +07:00 [INF] Added message 82 to conversation 1
2025-05-07 21:32:08.821 +07:00 [INF] Saved message 81 to Redis
2025-05-07 21:32:08.821 +07:00 [INF] Added message 81 to conversation 1
2025-05-07 21:32:08.822 +07:00 [INF] Saved message 80 to Redis
2025-05-07 21:32:08.822 +07:00 [INF] Added message 80 to conversation 1
2025-05-07 21:32:08.823 +07:00 [INF] Saved message 79 to Redis
2025-05-07 21:32:08.825 +07:00 [INF] Added message 79 to conversation 1
2025-05-07 21:32:08.827 +07:00 [INF] Saved message 78 to Redis
2025-05-07 21:32:08.827 +07:00 [INF] Added message 78 to conversation 1
2025-05-07 21:32:08.828 +07:00 [INF] Saved message 77 to Redis
2025-05-07 21:32:08.829 +07:00 [INF] Added message 77 to conversation 1
2025-05-07 21:32:08.830 +07:00 [INF] Saved message 76 to Redis
2025-05-07 21:32:08.830 +07:00 [INF] Added message 76 to conversation 1
2025-05-07 21:32:08.831 +07:00 [INF] Saved message 75 to Redis
2025-05-07 21:32:08.831 +07:00 [INF] Added message 75 to conversation 1
2025-05-07 21:32:08.833 +07:00 [INF] Saved message 74 to Redis
2025-05-07 21:32:08.833 +07:00 [INF] Added message 74 to conversation 1
2025-05-07 21:32:08.834 +07:00 [INF] Saved message 73 to Redis
2025-05-07 21:32:08.834 +07:00 [INF] Added message 73 to conversation 1
2025-05-07 21:32:08.835 +07:00 [INF] Saved message 72 to Redis
2025-05-07 21:32:08.835 +07:00 [INF] Added message 72 to conversation 1
2025-05-07 21:32:08.836 +07:00 [INF] Saved message 71 to Redis
2025-05-07 21:32:08.836 +07:00 [INF] Added message 71 to conversation 1
2025-05-07 21:32:08.837 +07:00 [INF] Saved message 68 to Redis
2025-05-07 21:32:08.837 +07:00 [INF] Added message 68 to conversation 1
2025-05-07 21:32:08.839 +07:00 [INF] Saved message 64 to Redis
2025-05-07 21:32:08.839 +07:00 [INF] Added message 64 to conversation 1
2025-05-07 21:32:08.843 +07:00 [INF] Saved message 62 to Redis
2025-05-07 21:32:08.843 +07:00 [INF] Added message 62 to conversation 1
2025-05-07 21:32:08.844 +07:00 [INF] Saved message 61 to Redis
2025-05-07 21:32:08.845 +07:00 [INF] Added message 61 to conversation 1
2025-05-07 21:32:08.846 +07:00 [INF] Saved message 60 to Redis
2025-05-07 21:32:08.846 +07:00 [INF] Added message 60 to conversation 1
2025-05-07 21:32:08.847 +07:00 [INF] Saved message 59 to Redis
2025-05-07 21:32:08.847 +07:00 [INF] Added message 59 to conversation 1
2025-05-07 21:32:08.848 +07:00 [INF] Saved message 57 to Redis
2025-05-07 21:32:08.848 +07:00 [INF] Added message 57 to conversation 1
2025-05-07 21:32:08.849 +07:00 [INF] Saved message 55 to Redis
2025-05-07 21:32:08.849 +07:00 [INF] Added message 55 to conversation 1
2025-05-07 21:32:08.850 +07:00 [INF] Saved message 54 to Redis
2025-05-07 21:32:08.850 +07:00 [INF] Added message 54 to conversation 1
2025-05-07 21:32:08.851 +07:00 [INF] Saved message 51 to Redis
2025-05-07 21:32:08.851 +07:00 [INF] Added message 51 to conversation 1
2025-05-07 21:32:08.852 +07:00 [INF] Saved message 49 to Redis
2025-05-07 21:32:08.852 +07:00 [INF] Added message 49 to conversation 1
2025-05-07 21:32:08.861 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 21:32:08.861 +07:00 [INF] Saved message 142 to Redis
2025-05-07 21:32:08.862 +07:00 [INF] Added message 142 to conversation 2
2025-05-07 21:32:08.862 +07:00 [INF] Saved message 4 to Redis
2025-05-07 21:32:08.863 +07:00 [INF] Added message 4 to conversation 2
2025-05-07 21:32:08.865 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 21:33:45.925 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-07 21:33:45.926 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:33:45.926 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 21:33:45.972 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 21:33:45.973 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 21:33:45.974 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 47.34ms
2025-05-07 21:33:45.974 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:33:45.974 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 49.2301ms
2025-05-07 21:33:47.058 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 21:33:47.063 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:33:47.064 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 21:33:47.070 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 21:33:47.071 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:33:47.071 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:33:47.082 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 21:33:47.083 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 21:33:47.084 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 19.9892ms
2025-05-07 21:33:47.084 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:33:47.085 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 26.4162ms
2025-05-07 21:33:47.127 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 21:33:47.135 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 21:33:47.135 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 63.9808ms
2025-05-07 21:33:47.135 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:33:47.135 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 64.7925ms
2025-05-07 21:33:47.595 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-07 21:33:47.596 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 21:33:47.773 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 21:33:47.785 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 21:33:47.790 +07:00 [INF] Saved message 117 to Redis
2025-05-07 21:33:47.791 +07:00 [INF] Added message 117 to conversation 3
2025-05-07 21:33:47.796 +07:00 [INF] Saved message 115 to Redis
2025-05-07 21:33:47.798 +07:00 [INF] Added message 115 to conversation 3
2025-05-07 21:33:47.803 +07:00 [INF] Saved message 88 to Redis
2025-05-07 21:33:47.804 +07:00 [INF] Added message 88 to conversation 3
2025-05-07 21:33:47.806 +07:00 [INF] Saved message 70 to Redis
2025-05-07 21:33:47.807 +07:00 [INF] Added message 70 to conversation 3
2025-05-07 21:33:47.812 +07:00 [INF] Saved message 65 to Redis
2025-05-07 21:33:47.814 +07:00 [INF] Added message 65 to conversation 3
2025-05-07 21:33:47.817 +07:00 [INF] Saved message 48 to Redis
2025-05-07 21:33:47.818 +07:00 [INF] Added message 48 to conversation 3
2025-05-07 21:33:47.823 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 21:33:47.829 +07:00 [INF] Saved message 135 to Redis
2025-05-07 21:33:47.831 +07:00 [INF] Added message 135 to conversation 4
2025-05-07 21:33:47.834 +07:00 [INF] Saved message 133 to Redis
2025-05-07 21:33:47.835 +07:00 [INF] Added message 133 to conversation 4
2025-05-07 21:33:47.837 +07:00 [INF] Saved message 132 to Redis
2025-05-07 21:33:47.837 +07:00 [INF] Added message 132 to conversation 4
2025-05-07 21:33:47.837 +07:00 [INF] Saved message 131 to Redis
2025-05-07 21:33:47.838 +07:00 [INF] Added message 131 to conversation 4
2025-05-07 21:33:47.839 +07:00 [INF] Saved message 130 to Redis
2025-05-07 21:33:47.840 +07:00 [INF] Added message 130 to conversation 4
2025-05-07 21:33:47.840 +07:00 [INF] Saved message 129 to Redis
2025-05-07 21:33:47.845 +07:00 [INF] Added message 129 to conversation 4
2025-05-07 21:33:47.848 +07:00 [INF] Saved message 128 to Redis
2025-05-07 21:33:47.849 +07:00 [INF] Added message 128 to conversation 4
2025-05-07 21:33:47.850 +07:00 [INF] Saved message 127 to Redis
2025-05-07 21:33:47.850 +07:00 [INF] Added message 127 to conversation 4
2025-05-07 21:33:47.851 +07:00 [INF] Saved message 126 to Redis
2025-05-07 21:33:47.851 +07:00 [INF] Added message 126 to conversation 4
2025-05-07 21:33:47.852 +07:00 [INF] Saved message 125 to Redis
2025-05-07 21:33:47.853 +07:00 [INF] Added message 125 to conversation 4
2025-05-07 21:33:47.854 +07:00 [INF] Saved message 124 to Redis
2025-05-07 21:33:47.855 +07:00 [INF] Added message 124 to conversation 4
2025-05-07 21:33:47.856 +07:00 [INF] Saved message 123 to Redis
2025-05-07 21:33:47.856 +07:00 [INF] Added message 123 to conversation 4
2025-05-07 21:33:47.858 +07:00 [INF] Saved message 122 to Redis
2025-05-07 21:33:47.858 +07:00 [INF] Added message 122 to conversation 4
2025-05-07 21:33:47.861 +07:00 [INF] Saved message 121 to Redis
2025-05-07 21:33:47.861 +07:00 [INF] Added message 121 to conversation 4
2025-05-07 21:33:47.862 +07:00 [INF] Saved message 120 to Redis
2025-05-07 21:33:47.862 +07:00 [INF] Added message 120 to conversation 4
2025-05-07 21:33:47.863 +07:00 [INF] Saved message 119 to Redis
2025-05-07 21:33:47.864 +07:00 [INF] Added message 119 to conversation 4
2025-05-07 21:33:47.865 +07:00 [INF] Saved message 118 to Redis
2025-05-07 21:33:47.865 +07:00 [INF] Added message 118 to conversation 4
2025-05-07 21:33:47.866 +07:00 [INF] Saved message 111 to Redis
2025-05-07 21:33:47.866 +07:00 [INF] Added message 111 to conversation 4
2025-05-07 21:33:47.868 +07:00 [INF] Saved message 97 to Redis
2025-05-07 21:33:47.869 +07:00 [INF] Added message 97 to conversation 4
2025-05-07 21:33:47.870 +07:00 [INF] Saved message 96 to Redis
2025-05-07 21:33:47.870 +07:00 [INF] Added message 96 to conversation 4
2025-05-07 21:33:47.871 +07:00 [INF] Saved message 89 to Redis
2025-05-07 21:33:47.872 +07:00 [INF] Added message 89 to conversation 4
2025-05-07 21:33:47.873 +07:00 [INF] Saved message 69 to Redis
2025-05-07 21:33:47.874 +07:00 [INF] Added message 69 to conversation 4
2025-05-07 21:33:47.875 +07:00 [INF] Saved message 67 to Redis
2025-05-07 21:33:47.877 +07:00 [INF] Added message 67 to conversation 4
2025-05-07 21:33:47.878 +07:00 [INF] Saved message 66 to Redis
2025-05-07 21:33:47.879 +07:00 [INF] Added message 66 to conversation 4
2025-05-07 21:33:47.880 +07:00 [INF] Saved message 63 to Redis
2025-05-07 21:33:47.881 +07:00 [INF] Added message 63 to conversation 4
2025-05-07 21:33:47.882 +07:00 [INF] Saved message 58 to Redis
2025-05-07 21:33:47.882 +07:00 [INF] Added message 58 to conversation 4
2025-05-07 21:33:47.884 +07:00 [INF] Saved message 56 to Redis
2025-05-07 21:33:47.884 +07:00 [INF] Added message 56 to conversation 4
2025-05-07 21:33:47.886 +07:00 [INF] Saved message 53 to Redis
2025-05-07 21:33:47.886 +07:00 [INF] Added message 53 to conversation 4
2025-05-07 21:33:47.887 +07:00 [INF] Saved message 52 to Redis
2025-05-07 21:33:47.887 +07:00 [INF] Added message 52 to conversation 4
2025-05-07 21:33:47.889 +07:00 [INF] Saved message 50 to Redis
2025-05-07 21:33:47.889 +07:00 [INF] Added message 50 to conversation 4
2025-05-07 21:33:47.890 +07:00 [INF] Saved message 47 to Redis
2025-05-07 21:33:47.890 +07:00 [INF] Added message 47 to conversation 4
2025-05-07 21:33:47.891 +07:00 [INF] Saved message 46 to Redis
2025-05-07 21:33:47.891 +07:00 [INF] Added message 46 to conversation 4
2025-05-07 21:33:47.892 +07:00 [INF] Saved message 45 to Redis
2025-05-07 21:33:47.893 +07:00 [INF] Added message 45 to conversation 4
2025-05-07 21:33:47.894 +07:00 [INF] Saved message 44 to Redis
2025-05-07 21:33:47.895 +07:00 [INF] Added message 44 to conversation 4
2025-05-07 21:33:47.897 +07:00 [INF] Saved message 43 to Redis
2025-05-07 21:33:47.897 +07:00 [INF] Added message 43 to conversation 4
2025-05-07 21:33:47.899 +07:00 [INF] Saved message 42 to Redis
2025-05-07 21:33:47.899 +07:00 [INF] Added message 42 to conversation 4
2025-05-07 21:33:47.900 +07:00 [INF] Saved message 41 to Redis
2025-05-07 21:33:47.900 +07:00 [INF] Added message 41 to conversation 4
2025-05-07 21:33:47.901 +07:00 [INF] Saved message 40 to Redis
2025-05-07 21:33:47.901 +07:00 [INF] Added message 40 to conversation 4
2025-05-07 21:33:47.902 +07:00 [INF] Saved message 39 to Redis
2025-05-07 21:33:47.902 +07:00 [INF] Added message 39 to conversation 4
2025-05-07 21:33:47.903 +07:00 [INF] Saved message 38 to Redis
2025-05-07 21:33:47.903 +07:00 [INF] Added message 38 to conversation 4
2025-05-07 21:33:47.904 +07:00 [INF] Saved message 37 to Redis
2025-05-07 21:33:47.905 +07:00 [INF] Added message 37 to conversation 4
2025-05-07 21:33:47.905 +07:00 [INF] Saved message 36 to Redis
2025-05-07 21:33:47.905 +07:00 [INF] Added message 36 to conversation 4
2025-05-07 21:33:47.906 +07:00 [INF] Saved message 35 to Redis
2025-05-07 21:33:47.906 +07:00 [INF] Added message 35 to conversation 4
2025-05-07 21:33:47.907 +07:00 [INF] Saved message 34 to Redis
2025-05-07 21:33:47.908 +07:00 [INF] Added message 34 to conversation 4
2025-05-07 21:33:47.909 +07:00 [INF] Saved message 33 to Redis
2025-05-07 21:33:47.909 +07:00 [INF] Added message 33 to conversation 4
2025-05-07 21:33:47.911 +07:00 [INF] Saved message 32 to Redis
2025-05-07 21:33:47.911 +07:00 [INF] Added message 32 to conversation 4
2025-05-07 21:33:47.912 +07:00 [INF] Saved message 31 to Redis
2025-05-07 21:33:47.912 +07:00 [INF] Added message 31 to conversation 4
2025-05-07 21:33:47.913 +07:00 [INF] Saved message 30 to Redis
2025-05-07 21:33:47.914 +07:00 [INF] Added message 30 to conversation 4
2025-05-07 21:33:47.914 +07:00 [INF] Saved message 29 to Redis
2025-05-07 21:33:47.915 +07:00 [INF] Added message 29 to conversation 4
2025-05-07 21:33:47.916 +07:00 [INF] Saved message 28 to Redis
2025-05-07 21:33:47.916 +07:00 [INF] Added message 28 to conversation 4
2025-05-07 21:33:51.079 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/3/2 - null null
2025-05-07 21:33:51.079 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 21:33:51.080 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:33:51.096 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 21:33:51.099 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 21:33:51.164 +07:00 [INF] Executed DbCommand (61ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 21:33:51.223 +07:00 [INF] Executed DbCommand (46ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-07 21:33:51.247 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__user_id_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] IN (
    SELECT [u0].[value]
    FROM OPENJSON(@__user_id_0) WITH ([value] int '$') AS [u0]
)
2025-05-07 21:33:51.280 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-07 21:33:51.288 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN (
    SELECT [p].[id] AS [Id], [p].[user_id], [p].[conversation_id] AS [ConversationId], [p].[name] AS [Name], [p].[is_deleted] AS [IsDeleted], [p].[img_url]
    FROM [Participants] AS [p]
    WHERE [p].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 21:33:51.298 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 21:33:51.298 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 218.4511ms
2025-05-07 21:33:51.298 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 21:33:51.299 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/3/2 - 200 null application/json; charset=utf-8 219.5786ms
2025-05-07 21:33:51.675 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/13/3 - null null
2025-05-07 21:33:51.678 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 21:33:51.678 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 21:33:51.685 +07:00 [INF] Retrieved 0 messages from Redis for conversation 13
2025-05-07 21:33:51.703 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 21:33:51.719 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 21:33:51.721 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 21:33:51.723 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 45.0105ms
2025-05-07 21:33:51.724 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 21:33:51.724 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/13/3 - 404 null text/plain; charset=utf-8 48.738ms
2025-05-07 21:33:51.828 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/13 - null null
2025-05-07 21:33:51.829 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 21:33:51.829 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:33:51.835 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:33:51.835 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 21:33:51.835 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.8477ms
2025-05-07 21:33:51.835 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 21:33:51.836 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/13 - 200 null application/json; charset=utf-8 7.7627ms
2025-05-07 21:33:51.960 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/13 - null null
2025-05-07 21:33:51.962 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 21:33:51.962 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 21:33:51.971 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 21:33:51.972 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 21:33:51.972 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 10.1576ms
2025-05-07 21:33:51.972 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 21:33:51.972 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/13 - 200 null application/json; charset=utf-8 12.6457ms
2025-05-07 21:33:58.501 +07:00 [INF] Handling message from user 3: asdasad
2025-05-07 21:33:58.506 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:33:58.515 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:33:58.522 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 21:33:58.523 +07:00 [INF] Message saved to DB with ID: 145
2025-05-07 21:33:58.523 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:33:58.530 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 21:33:58.531 +07:00 [INF] Transaction committed for message: 145
2025-05-07 21:33:58.533 +07:00 [INF] Saved message 145 to Redis
2025-05-07 21:33:58.533 +07:00 [INF] Added message 145 to conversation 13
2025-05-07 21:33:58.535 +07:00 [INF] Published message to channel conversation:13
2025-05-07 21:34:31.281 +07:00 [INF] Handling message from user 3: asfaf
2025-05-07 21:34:31.287 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:34:31.307 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:34:31.312 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 21:34:31.313 +07:00 [INF] Message saved to DB with ID: 146
2025-05-07 21:34:31.314 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:34:31.318 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 21:34:31.319 +07:00 [INF] Transaction committed for message: 146
2025-05-07 21:34:31.320 +07:00 [INF] Saved message 146 to Redis
2025-05-07 21:34:31.320 +07:00 [INF] Added message 146 to conversation 13
2025-05-07 21:34:31.320 +07:00 [INF] Published message to channel conversation:13
2025-05-07 21:35:33.292 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 21:35:33.293 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 21:35:33.307 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 21:35:33.308 +07:00 [ERR] Connection id "0HNCDE8RR218L", Request id "0HNCDE8RR218L:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 21:35:33.326 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 105731.533ms
2025-05-07 21:37:20.663 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-07 21:37:20.689 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:20.704 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 40.7422ms
2025-05-07 21:37:20.710 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-07 21:37:20.711 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:20.716 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:20.718 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:37:20.723 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 21:37:20.759 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 21:37:20.775 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 21:37:20.777 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 53.9655ms
2025-05-07 21:37:20.777 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:37:20.777 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 67.0571ms
2025-05-07 21:37:20.923 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 21:37:20.925 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:20.926 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:20.926 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:37:20.926 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 21:37:20.949 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 21:37:20.952 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 21:37:20.952 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 26.3212ms
2025-05-07 21:37:20.952 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:37:20.952 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 29.2169ms
2025-05-07 21:37:21.009 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 21:37:21.026 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:21.029 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 19.856ms
2025-05-07 21:37:21.030 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 21:37:21.041 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:21.041 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:21.041 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:37:21.041 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:37:21.044 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 21:37:21.044 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.6112ms
2025-05-07 21:37:21.044 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:37:21.044 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 13.5734ms
2025-05-07 21:37:21.116 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-07 21:37:21.118 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:21.118 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:21.118 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 21:37:21.214 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 21:37:26.264 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 21:37:26.269 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:26.269 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - 204 null null 4.9588ms
2025-05-07 21:37:26.270 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 21:37:26.270 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:26.270 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:26.270 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 21:37:26.270 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:37:26.285 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 21:37:26.287 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 21:37:26.361 +07:00 [INF] Executed DbCommand (73ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 21:37:26.362 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 21:37:26.362 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 91.475ms
2025-05-07 21:37:26.362 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 21:37:26.362 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 92.3465ms
2025-05-07 21:37:26.479 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/13/2 - null null
2025-05-07 21:37:26.479 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:26.479 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/13/2 - 204 null null 0.3412ms
2025-05-07 21:37:26.481 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/13/2 - null null
2025-05-07 21:37:26.481 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:26.482 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:26.482 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 21:37:26.482 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 21:37:26.543 +07:00 [INF] Retrieved 2 messages from Redis for conversation 13
2025-05-07 21:37:26.546 +07:00 [INF] Retrieved 2 messages from Redis for conversation 13 and user 2
2025-05-07 21:37:26.546 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 21:37:26.560 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 77.5926ms
2025-05-07 21:37:26.560 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 21:37:26.560 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/13/2 - 200 null application/json; charset=utf-8 79.0709ms
2025-05-07 21:37:26.566 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/13 - null null
2025-05-07 21:37:26.567 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:26.567 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/13 - 204 null null 1.3904ms
2025-05-07 21:37:26.569 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/13 - null null
2025-05-07 21:37:26.569 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:26.569 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:26.569 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 21:37:26.569 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:37:26.573 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:37:26.574 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 21:37:26.574 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 4.8431ms
2025-05-07 21:37:26.575 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 21:37:26.575 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/13 - 200 null application/json; charset=utf-8 6.2342ms
2025-05-07 21:37:26.579 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/13 - null null
2025-05-07 21:37:26.579 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:26.580 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/13 - 204 null null 0.3389ms
2025-05-07 21:37:26.581 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/13 - null null
2025-05-07 21:37:26.582 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:26.582 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:37:26.582 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 21:37:26.582 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 21:37:26.588 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 21:37:26.588 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 21:37:26.589 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.1773ms
2025-05-07 21:37:26.589 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 21:37:26.589 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/13 - 200 null application/json; charset=utf-8 8.1336ms
2025-05-07 21:37:36.660 +07:00 [INF] Handling message from user 2: wwe
2025-05-07 21:37:36.666 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:37:36.675 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:37:36.687 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 21:37:36.688 +07:00 [INF] Message saved to DB with ID: 147
2025-05-07 21:37:36.690 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:37:36.702 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 21:37:36.704 +07:00 [INF] Transaction committed for message: 147
2025-05-07 21:37:36.706 +07:00 [INF] Saved message 147 to Redis
2025-05-07 21:37:36.707 +07:00 [INF] Added message 147 to conversation 13
2025-05-07 21:37:36.709 +07:00 [INF] Published message to channel conversation:13
2025-05-07 21:37:48.178 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/3/2 - null null
2025-05-07 21:37:48.179 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 21:37:48.179 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:37:48.183 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 21:37:48.186 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 21:37:48.189 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 21:37:48.190 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 21:37:48.190 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 11.1193ms
2025-05-07 21:37:48.190 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 21:37:48.190 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/3/2 - 200 null application/json; charset=utf-8 13.1109ms
2025-05-07 21:37:48.555 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/13/3 - null null
2025-05-07 21:37:48.556 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 21:37:48.556 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 21:37:48.560 +07:00 [INF] Retrieved 3 messages from Redis for conversation 13
2025-05-07 21:37:48.560 +07:00 [INF] Retrieved 3 messages from Redis for conversation 13 and user 3
2025-05-07 21:37:48.561 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 21:37:48.561 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.4381ms
2025-05-07 21:37:48.561 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 21:37:48.561 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/13/3 - 200 null application/json; charset=utf-8 5.6519ms
2025-05-07 21:37:48.709 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/13 - null null
2025-05-07 21:37:48.709 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 21:37:48.710 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:37:48.712 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:37:48.713 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 21:37:48.713 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 3.3492ms
2025-05-07 21:37:48.713 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 21:37:48.713 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/13 - 200 null application/json; charset=utf-8 4.5235ms
2025-05-07 21:37:48.879 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/13 - null null
2025-05-07 21:37:48.880 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 21:37:48.880 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 21:37:48.883 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 21:37:48.884 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 21:37:48.884 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.4263ms
2025-05-07 21:37:48.884 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 21:37:48.884 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/13 - 200 null application/json; charset=utf-8 5.2048ms
2025-05-07 21:37:58.332 +07:00 [INF] Handling message from user 3: werwe
2025-05-07 21:37:58.335 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:37:58.338 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:37:58.339 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 21:37:58.340 +07:00 [INF] Message saved to DB with ID: 148
2025-05-07 21:37:58.341 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:37:58.343 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 21:37:58.344 +07:00 [INF] Transaction committed for message: 148
2025-05-07 21:37:58.347 +07:00 [INF] Saved message 148 to Redis
2025-05-07 21:37:58.348 +07:00 [INF] Added message 148 to conversation 13
2025-05-07 21:37:58.348 +07:00 [INF] Published message to channel conversation:13
2025-05-07 21:38:07.412 +07:00 [INF] Handling message from user 2: wegwg
2025-05-07 21:38:07.415 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:38:07.420 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:38:07.421 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 21:38:07.421 +07:00 [INF] Message saved to DB with ID: 149
2025-05-07 21:38:07.422 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:38:07.424 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 21:38:07.426 +07:00 [INF] Transaction committed for message: 149
2025-05-07 21:38:07.428 +07:00 [INF] Saved message 149 to Redis
2025-05-07 21:38:07.429 +07:00 [INF] Added message 149 to conversation 13
2025-05-07 21:38:07.430 +07:00 [INF] Published message to channel conversation:13
2025-05-07 21:38:15.863 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 21:38:15.864 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 54747.1171ms
2025-05-07 21:38:17.972 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 21:38:17.972 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 21:38:17.979 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 21:38:17.989 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-07 21:38:17.987 +07:00 [ERR] Connection id "0HNCDE8RR2186", Request id "0HNCDE8RR2186:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 21:38:17.990 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-07 21:38:17.996 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=3 - 101 null null 1110134.5171ms
2025-05-07 21:38:17.998 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-07 21:38:18.007 +07:00 [ERR] Connection id "0HNCDE8RR218H", Request id "0HNCDE8RR218H:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-07 21:38:18.024 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=3 - 101 null null 369318.6147ms
2025-05-07 21:41:12.332 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-07 21:41:12.336 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:12.347 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 15.7602ms
2025-05-07 21:41:12.350 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-07 21:41:12.352 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:12.353 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:12.355 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:41:12.360 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 21:41:12.408 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 21:41:12.425 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 21:41:12.427 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 66.3528ms
2025-05-07 21:41:12.428 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:41:12.429 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 78.3861ms
2025-05-07 21:41:12.576 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-07 21:41:12.578 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:12.578 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:12.578 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:41:12.579 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 21:41:12.589 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 21:41:12.590 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 21:41:12.590 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.5318ms
2025-05-07 21:41:12.590 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:41:12.590 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 14.1474ms
2025-05-07 21:41:12.724 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 21:41:12.724 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:12.724 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.4047ms
2025-05-07 21:41:12.728 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 21:41:12.728 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:12.728 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:12.729 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:41:12.729 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:41:12.732 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 21:41:12.733 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 4.2415ms
2025-05-07 21:41:12.734 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:41:12.734 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 6.6932ms
2025-05-07 21:41:12.749 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-07 21:41:12.750 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:12.751 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:12.752 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 21:41:12.868 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 21:41:12.885 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 21:41:28.119 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-07 21:41:28.119 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:28.119 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2118ms
2025-05-07 21:41:28.120 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-07 21:41:28.120 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:28.120 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:28.120 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:41:28.121 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 21:41:28.129 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 21:41:28.130 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 21:41:28.130 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 9.3544ms
2025-05-07 21:41:28.130 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 21:41:28.130 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 10.0098ms
2025-05-07 21:41:28.267 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 21:41:28.267 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:28.267 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:28.267 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:41:28.267 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 21:41:28.275 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 21:41:28.276 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 21:41:28.276 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.0076ms
2025-05-07 21:41:28.276 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 21:41:28.277 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 10.0519ms
2025-05-07 21:41:28.358 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 21:41:28.358 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:28.359 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.8844ms
2025-05-07 21:41:28.360 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 21:41:28.361 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:28.361 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:28.361 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:41:28.361 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:41:28.363 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 21:41:28.364 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.3068ms
2025-05-07 21:41:28.364 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 21:41:28.364 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 3.2875ms
2025-05-07 21:41:28.431 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-07 21:41:28.433 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:28.433 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:28.433 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 21:41:28.474 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 21:41:31.293 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/3/2 - null null
2025-05-07 21:41:31.294 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:31.294 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/3/2 - 204 null null 1.1204ms
2025-05-07 21:41:31.296 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/3/2 - null null
2025-05-07 21:41:31.296 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:31.296 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:31.297 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 21:41:31.297 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:41:31.320 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 21:41:31.322 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 21:41:31.392 +07:00 [INF] Executed DbCommand (67ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 21:41:31.429 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-07 21:41:31.458 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__user_id_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] IN (
    SELECT [u0].[value]
    FROM OPENJSON(@__user_id_0) WITH ([value] int '$') AS [u0]
)
2025-05-07 21:41:31.493 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-07 21:41:31.504 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN (
    SELECT [p].[id] AS [Id], [p].[user_id], [p].[conversation_id] AS [ConversationId], [p].[name] AS [Name], [p].[is_deleted] AS [IsDeleted], [p].[img_url]
    FROM [Participants] AS [p]
    WHERE [p].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 21:41:31.518 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 21:41:31.518 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 221.3406ms
2025-05-07 21:41:31.518 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 21:41:31.518 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/3/2 - 200 null application/json; charset=utf-8 222.1754ms
2025-05-07 21:41:31.661 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/14/3 - null null
2025-05-07 21:41:31.661 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:31.661 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/14/3 - 204 null null 0.2955ms
2025-05-07 21:41:31.662 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/14/3 - null null
2025-05-07 21:41:31.662 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:31.662 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:31.663 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 21:41:31.663 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 21:41:31.666 +07:00 [INF] Retrieved 0 messages from Redis for conversation 14
2025-05-07 21:41:31.675 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 21:41:31.686 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 21:41:31.690 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 21:41:31.692 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 29.4803ms
2025-05-07 21:41:31.693 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 21:41:31.693 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/14/3 - 404 null text/plain; charset=utf-8 30.7689ms
2025-05-07 21:41:31.845 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/14 - null null
2025-05-07 21:41:31.846 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:31.846 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/14 - 204 null null 0.2719ms
2025-05-07 21:41:31.847 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/14 - null null
2025-05-07 21:41:31.847 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:31.847 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:31.847 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 21:41:31.847 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:41:31.851 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:41:31.851 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 21:41:31.851 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 3.9526ms
2025-05-07 21:41:31.852 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 21:41:31.852 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/14 - 200 null application/json; charset=utf-8 4.9992ms
2025-05-07 21:41:31.859 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/14 - null null
2025-05-07 21:41:31.859 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:31.859 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/14 - 204 null null 0.2764ms
2025-05-07 21:41:31.861 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/14 - null null
2025-05-07 21:41:31.861 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:31.861 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:41:31.861 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 21:41:31.861 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 21:41:31.866 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 21:41:31.867 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 21:41:31.869 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.3801ms
2025-05-07 21:41:31.869 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 21:41:31.869 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/14 - 200 null application/json; charset=utf-8 8.098ms
2025-05-07 21:41:36.070 +07:00 [INF] Handling message from user 3: dff
2025-05-07 21:41:36.075 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:41:36.078 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:41:36.083 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 21:41:36.084 +07:00 [INF] Message saved to DB with ID: 150
2025-05-07 21:41:36.085 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:41:36.091 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 21:41:36.092 +07:00 [INF] Transaction committed for message: 150
2025-05-07 21:41:36.093 +07:00 [INF] Saved message 150 to Redis
2025-05-07 21:41:36.095 +07:00 [INF] Added message 150 to conversation 14
2025-05-07 21:41:36.095 +07:00 [INF] Published message to channel conversation:14
2025-05-07 21:54:51.681 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 21:54:51.681 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:54:51.682 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - 204 null null 1.0592ms
2025-05-07 21:54:51.685 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 21:54:51.685 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:54:51.685 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:54:51.685 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 21:54:51.686 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:54:51.764 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 21:54:51.766 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 21:54:51.840 +07:00 [INF] Executed DbCommand (73ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 21:54:51.841 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 21:54:51.841 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 155.3081ms
2025-05-07 21:54:51.841 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 21:54:51.842 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 157.0836ms
2025-05-07 21:54:52.062 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/14/2 - null null
2025-05-07 21:54:52.062 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:54:52.063 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/14/2 - 204 null null 0.4698ms
2025-05-07 21:54:52.065 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/14/2 - null null
2025-05-07 21:54:52.065 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:54:52.065 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:54:52.065 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 21:54:52.066 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 21:54:52.073 +07:00 [INF] Retrieved 1 messages from Redis for conversation 14
2025-05-07 21:54:52.075 +07:00 [INF] Retrieved 1 messages from Redis for conversation 14 and user 2
2025-05-07 21:54:52.076 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 21:54:52.076 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 10.2469ms
2025-05-07 21:54:52.077 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 21:54:52.079 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/14/2 - 200 null application/json; charset=utf-8 13.8823ms
2025-05-07 21:54:52.087 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/14 - null null
2025-05-07 21:54:52.087 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:54:52.087 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/14 - 204 null null 0.2533ms
2025-05-07 21:54:52.089 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/14 - null null
2025-05-07 21:54:52.089 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:54:52.090 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:54:52.090 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 21:54:52.090 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 21:54:52.094 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:54:52.095 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 21:54:52.095 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 4.8701ms
2025-05-07 21:54:52.095 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 21:54:52.095 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/14 - 200 null application/json; charset=utf-8 6.019ms
2025-05-07 21:54:52.103 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/14 - null null
2025-05-07 21:54:52.103 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:54:52.103 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/14 - 204 null null 0.2198ms
2025-05-07 21:54:52.104 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/14 - null null
2025-05-07 21:54:52.104 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:54:52.104 +07:00 [INF] CORS policy execution successful.
2025-05-07 21:54:52.105 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 21:54:52.105 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 21:54:52.111 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 21:54:52.112 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 21:54:52.112 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.1121ms
2025-05-07 21:54:52.112 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 21:54:52.113 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/14 - 200 null application/json; charset=utf-8 8.5854ms
2025-05-07 21:54:56.307 +07:00 [INF] Handling message from user 2: zxc
2025-05-07 21:54:56.312 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 21:54:56.317 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:54:56.324 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 21:54:56.325 +07:00 [INF] Message saved to DB with ID: 151
2025-05-07 21:54:56.327 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 21:54:56.338 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 21:54:56.339 +07:00 [INF] Transaction committed for message: 151
2025-05-07 21:54:56.341 +07:00 [INF] Saved message 151 to Redis
2025-05-07 21:54:56.342 +07:00 [INF] Added message 151 to conversation 14
2025-05-07 21:54:56.342 +07:00 [INF] Published message to channel conversation:14
2025-05-07 22:37:42.354 +07:00 [INF] Application is shutting down...
2025-05-07 22:44:10.684 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-07 22:44:10.830 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-07 22:44:10.881 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-07 22:44:10.888 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-07 22:44:10.889 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-07 22:44:10.889 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-07 22:44:10.889 +07:00 [INF] Hosting environment: Development
2025-05-07 22:44:10.889 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-07 22:44:11.371 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-07 22:44:11.397 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:11.418 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:11.419 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-07 22:44:11.451 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 22:44:11.585 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 22:44:11.608 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:44:11.617 +07:00 [INF] Saved message 114 to Redis
2025-05-07 22:44:11.619 +07:00 [INF] Added message 114 to conversation 1
2025-05-07 22:44:11.620 +07:00 [INF] Saved message 113 to Redis
2025-05-07 22:44:11.621 +07:00 [INF] Added message 113 to conversation 1
2025-05-07 22:44:11.622 +07:00 [INF] Saved message 112 to Redis
2025-05-07 22:44:11.622 +07:00 [INF] Added message 112 to conversation 1
2025-05-07 22:44:11.623 +07:00 [INF] Saved message 110 to Redis
2025-05-07 22:44:11.624 +07:00 [INF] Added message 110 to conversation 1
2025-05-07 22:44:11.625 +07:00 [INF] Saved message 109 to Redis
2025-05-07 22:44:11.626 +07:00 [INF] Added message 109 to conversation 1
2025-05-07 22:44:11.626 +07:00 [INF] Saved message 108 to Redis
2025-05-07 22:44:11.627 +07:00 [INF] Added message 108 to conversation 1
2025-05-07 22:44:11.628 +07:00 [INF] Saved message 107 to Redis
2025-05-07 22:44:11.629 +07:00 [INF] Added message 107 to conversation 1
2025-05-07 22:44:11.630 +07:00 [INF] Saved message 106 to Redis
2025-05-07 22:44:11.631 +07:00 [INF] Added message 106 to conversation 1
2025-05-07 22:44:11.632 +07:00 [INF] Saved message 105 to Redis
2025-05-07 22:44:11.632 +07:00 [INF] Added message 105 to conversation 1
2025-05-07 22:44:11.633 +07:00 [INF] Saved message 104 to Redis
2025-05-07 22:44:11.634 +07:00 [INF] Added message 104 to conversation 1
2025-05-07 22:44:11.634 +07:00 [INF] Saved message 103 to Redis
2025-05-07 22:44:11.635 +07:00 [INF] Added message 103 to conversation 1
2025-05-07 22:44:11.636 +07:00 [INF] Saved message 102 to Redis
2025-05-07 22:44:11.637 +07:00 [INF] Added message 102 to conversation 1
2025-05-07 22:44:11.638 +07:00 [INF] Saved message 101 to Redis
2025-05-07 22:44:11.638 +07:00 [INF] Added message 101 to conversation 1
2025-05-07 22:44:11.640 +07:00 [INF] Saved message 100 to Redis
2025-05-07 22:44:11.640 +07:00 [INF] Added message 100 to conversation 1
2025-05-07 22:44:11.641 +07:00 [INF] Saved message 99 to Redis
2025-05-07 22:44:11.642 +07:00 [INF] Added message 99 to conversation 1
2025-05-07 22:44:11.643 +07:00 [INF] Saved message 98 to Redis
2025-05-07 22:44:11.643 +07:00 [INF] Added message 98 to conversation 1
2025-05-07 22:44:11.645 +07:00 [INF] Saved message 95 to Redis
2025-05-07 22:44:11.645 +07:00 [INF] Added message 95 to conversation 1
2025-05-07 22:44:11.646 +07:00 [INF] Saved message 94 to Redis
2025-05-07 22:44:11.647 +07:00 [INF] Added message 94 to conversation 1
2025-05-07 22:44:11.647 +07:00 [INF] Saved message 93 to Redis
2025-05-07 22:44:11.648 +07:00 [INF] Added message 93 to conversation 1
2025-05-07 22:44:11.649 +07:00 [INF] Saved message 92 to Redis
2025-05-07 22:44:11.649 +07:00 [INF] Added message 92 to conversation 1
2025-05-07 22:44:11.650 +07:00 [INF] Saved message 91 to Redis
2025-05-07 22:44:11.650 +07:00 [INF] Added message 91 to conversation 1
2025-05-07 22:44:11.651 +07:00 [INF] Saved message 90 to Redis
2025-05-07 22:44:11.652 +07:00 [INF] Added message 90 to conversation 1
2025-05-07 22:44:11.653 +07:00 [INF] Saved message 87 to Redis
2025-05-07 22:44:11.653 +07:00 [INF] Added message 87 to conversation 1
2025-05-07 22:44:11.654 +07:00 [INF] Saved message 86 to Redis
2025-05-07 22:44:11.654 +07:00 [INF] Added message 86 to conversation 1
2025-05-07 22:44:11.657 +07:00 [INF] Saved message 85 to Redis
2025-05-07 22:44:11.657 +07:00 [INF] Added message 85 to conversation 1
2025-05-07 22:44:11.659 +07:00 [INF] Saved message 84 to Redis
2025-05-07 22:44:11.659 +07:00 [INF] Added message 84 to conversation 1
2025-05-07 22:44:11.661 +07:00 [INF] Saved message 83 to Redis
2025-05-07 22:44:11.661 +07:00 [INF] Added message 83 to conversation 1
2025-05-07 22:44:11.662 +07:00 [INF] Saved message 82 to Redis
2025-05-07 22:44:11.663 +07:00 [INF] Added message 82 to conversation 1
2025-05-07 22:44:11.664 +07:00 [INF] Saved message 81 to Redis
2025-05-07 22:44:11.664 +07:00 [INF] Added message 81 to conversation 1
2025-05-07 22:44:11.665 +07:00 [INF] Saved message 80 to Redis
2025-05-07 22:44:11.666 +07:00 [INF] Added message 80 to conversation 1
2025-05-07 22:44:11.667 +07:00 [INF] Saved message 79 to Redis
2025-05-07 22:44:11.667 +07:00 [INF] Added message 79 to conversation 1
2025-05-07 22:44:11.668 +07:00 [INF] Saved message 78 to Redis
2025-05-07 22:44:11.668 +07:00 [INF] Added message 78 to conversation 1
2025-05-07 22:44:11.669 +07:00 [INF] Saved message 77 to Redis
2025-05-07 22:44:11.670 +07:00 [INF] Added message 77 to conversation 1
2025-05-07 22:44:11.671 +07:00 [INF] Saved message 76 to Redis
2025-05-07 22:44:11.671 +07:00 [INF] Added message 76 to conversation 1
2025-05-07 22:44:11.672 +07:00 [INF] Saved message 75 to Redis
2025-05-07 22:44:11.672 +07:00 [INF] Added message 75 to conversation 1
2025-05-07 22:44:11.674 +07:00 [INF] Saved message 74 to Redis
2025-05-07 22:44:11.674 +07:00 [INF] Added message 74 to conversation 1
2025-05-07 22:44:11.675 +07:00 [INF] Saved message 73 to Redis
2025-05-07 22:44:11.676 +07:00 [INF] Added message 73 to conversation 1
2025-05-07 22:44:11.677 +07:00 [INF] Saved message 72 to Redis
2025-05-07 22:44:11.678 +07:00 [INF] Added message 72 to conversation 1
2025-05-07 22:44:11.678 +07:00 [INF] Saved message 71 to Redis
2025-05-07 22:44:11.679 +07:00 [INF] Added message 71 to conversation 1
2025-05-07 22:44:11.680 +07:00 [INF] Saved message 68 to Redis
2025-05-07 22:44:11.680 +07:00 [INF] Added message 68 to conversation 1
2025-05-07 22:44:11.681 +07:00 [INF] Saved message 64 to Redis
2025-05-07 22:44:11.682 +07:00 [INF] Added message 64 to conversation 1
2025-05-07 22:44:11.683 +07:00 [INF] Saved message 62 to Redis
2025-05-07 22:44:11.683 +07:00 [INF] Added message 62 to conversation 1
2025-05-07 22:44:11.684 +07:00 [INF] Saved message 61 to Redis
2025-05-07 22:44:11.684 +07:00 [INF] Added message 61 to conversation 1
2025-05-07 22:44:11.685 +07:00 [INF] Saved message 60 to Redis
2025-05-07 22:44:11.686 +07:00 [INF] Added message 60 to conversation 1
2025-05-07 22:44:11.686 +07:00 [INF] Saved message 59 to Redis
2025-05-07 22:44:11.687 +07:00 [INF] Added message 59 to conversation 1
2025-05-07 22:44:11.687 +07:00 [INF] Saved message 57 to Redis
2025-05-07 22:44:11.688 +07:00 [INF] Added message 57 to conversation 1
2025-05-07 22:44:11.689 +07:00 [INF] Saved message 55 to Redis
2025-05-07 22:44:11.690 +07:00 [INF] Added message 55 to conversation 1
2025-05-07 22:44:11.691 +07:00 [INF] Saved message 54 to Redis
2025-05-07 22:44:11.691 +07:00 [INF] Added message 54 to conversation 1
2025-05-07 22:44:11.692 +07:00 [INF] Saved message 51 to Redis
2025-05-07 22:44:11.692 +07:00 [INF] Added message 51 to conversation 1
2025-05-07 22:44:11.694 +07:00 [INF] Saved message 49 to Redis
2025-05-07 22:44:11.695 +07:00 [INF] Added message 49 to conversation 1
2025-05-07 22:44:11.702 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:44:11.703 +07:00 [INF] Saved message 142 to Redis
2025-05-07 22:44:11.704 +07:00 [INF] Added message 142 to conversation 2
2025-05-07 22:44:11.705 +07:00 [INF] Saved message 4 to Redis
2025-05-07 22:44:11.705 +07:00 [INF] Added message 4 to conversation 2
2025-05-07 22:44:11.709 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:44:44.582 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-07 22:44:44.584 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:44.592 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 6.8814ms
2025-05-07 22:44:44.603 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-07 22:44:44.605 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:44.617 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:44.628 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 22:44:44.680 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 22:44:44.961 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 22:44:45.165 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 22:44:45.261 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 574.5952ms
2025-05-07 22:44:45.262 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 22:44:45.271 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 667.8645ms
2025-05-07 22:44:45.424 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 22:44:45.425 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:45.429 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:45.436 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 22:44:45.454 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 22:44:45.514 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 22:44:45.514 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:45.514 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.6561ms
2025-05-07 22:44:45.518 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 22:44:45.518 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:45.518 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:45.519 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 22:44:45.552 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 22:44:45.625 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 22:44:45.628 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 22:44:45.646 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 192.662ms
2025-05-07 22:44:45.647 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 22:44:45.647 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 223.3893ms
2025-05-07 22:44:45.700 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 22:44:45.735 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 22:44:45.741 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 189.2737ms
2025-05-07 22:44:45.742 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 22:44:45.743 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 224.8589ms
2025-05-07 22:44:45.770 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-07 22:44:45.770 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:45.781 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:45.791 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 22:44:45.897 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 22:44:45.914 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:44:45.933 +07:00 [INF] Saved message 117 to Redis
2025-05-07 22:44:45.934 +07:00 [INF] Added message 117 to conversation 3
2025-05-07 22:44:45.936 +07:00 [INF] Saved message 115 to Redis
2025-05-07 22:44:45.937 +07:00 [INF] Added message 115 to conversation 3
2025-05-07 22:44:45.938 +07:00 [INF] Saved message 88 to Redis
2025-05-07 22:44:45.941 +07:00 [INF] Added message 88 to conversation 3
2025-05-07 22:44:45.977 +07:00 [INF] Saved message 70 to Redis
2025-05-07 22:44:45.979 +07:00 [INF] Added message 70 to conversation 3
2025-05-07 22:44:45.981 +07:00 [INF] Saved message 65 to Redis
2025-05-07 22:44:45.982 +07:00 [INF] Added message 65 to conversation 3
2025-05-07 22:44:45.985 +07:00 [INF] Saved message 48 to Redis
2025-05-07 22:44:45.986 +07:00 [INF] Added message 48 to conversation 3
2025-05-07 22:44:45.997 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:44:46.004 +07:00 [INF] Saved message 135 to Redis
2025-05-07 22:44:46.010 +07:00 [INF] Added message 135 to conversation 4
2025-05-07 22:44:46.021 +07:00 [INF] Saved message 133 to Redis
2025-05-07 22:44:46.021 +07:00 [INF] Added message 133 to conversation 4
2025-05-07 22:44:46.029 +07:00 [INF] Saved message 132 to Redis
2025-05-07 22:44:46.031 +07:00 [INF] Added message 132 to conversation 4
2025-05-07 22:44:46.035 +07:00 [INF] Saved message 131 to Redis
2025-05-07 22:44:46.037 +07:00 [INF] Added message 131 to conversation 4
2025-05-07 22:44:46.043 +07:00 [INF] Saved message 130 to Redis
2025-05-07 22:44:46.044 +07:00 [INF] Added message 130 to conversation 4
2025-05-07 22:44:46.046 +07:00 [INF] Saved message 129 to Redis
2025-05-07 22:44:46.047 +07:00 [INF] Added message 129 to conversation 4
2025-05-07 22:44:46.049 +07:00 [INF] Saved message 128 to Redis
2025-05-07 22:44:46.050 +07:00 [INF] Added message 128 to conversation 4
2025-05-07 22:44:46.053 +07:00 [INF] Saved message 127 to Redis
2025-05-07 22:44:46.053 +07:00 [INF] Added message 127 to conversation 4
2025-05-07 22:44:46.055 +07:00 [INF] Saved message 126 to Redis
2025-05-07 22:44:46.055 +07:00 [INF] Added message 126 to conversation 4
2025-05-07 22:44:46.060 +07:00 [INF] Saved message 125 to Redis
2025-05-07 22:44:46.061 +07:00 [INF] Added message 125 to conversation 4
2025-05-07 22:44:46.063 +07:00 [INF] Saved message 124 to Redis
2025-05-07 22:44:46.066 +07:00 [INF] Added message 124 to conversation 4
2025-05-07 22:44:46.068 +07:00 [INF] Saved message 123 to Redis
2025-05-07 22:44:46.069 +07:00 [INF] Added message 123 to conversation 4
2025-05-07 22:44:46.070 +07:00 [INF] Saved message 122 to Redis
2025-05-07 22:44:46.071 +07:00 [INF] Added message 122 to conversation 4
2025-05-07 22:44:46.073 +07:00 [INF] Saved message 121 to Redis
2025-05-07 22:44:46.076 +07:00 [INF] Added message 121 to conversation 4
2025-05-07 22:44:46.078 +07:00 [INF] Saved message 120 to Redis
2025-05-07 22:44:46.079 +07:00 [INF] Added message 120 to conversation 4
2025-05-07 22:44:46.082 +07:00 [INF] Saved message 119 to Redis
2025-05-07 22:44:46.083 +07:00 [INF] Added message 119 to conversation 4
2025-05-07 22:44:46.085 +07:00 [INF] Saved message 118 to Redis
2025-05-07 22:44:46.085 +07:00 [INF] Added message 118 to conversation 4
2025-05-07 22:44:46.086 +07:00 [INF] Saved message 111 to Redis
2025-05-07 22:44:46.086 +07:00 [INF] Added message 111 to conversation 4
2025-05-07 22:44:46.087 +07:00 [INF] Saved message 97 to Redis
2025-05-07 22:44:46.087 +07:00 [INF] Added message 97 to conversation 4
2025-05-07 22:44:46.088 +07:00 [INF] Saved message 96 to Redis
2025-05-07 22:44:46.089 +07:00 [INF] Added message 96 to conversation 4
2025-05-07 22:44:46.096 +07:00 [INF] Saved message 89 to Redis
2025-05-07 22:44:46.096 +07:00 [INF] Added message 89 to conversation 4
2025-05-07 22:44:46.098 +07:00 [INF] Saved message 69 to Redis
2025-05-07 22:44:46.099 +07:00 [INF] Added message 69 to conversation 4
2025-05-07 22:44:46.100 +07:00 [INF] Saved message 67 to Redis
2025-05-07 22:44:46.101 +07:00 [INF] Added message 67 to conversation 4
2025-05-07 22:44:46.102 +07:00 [INF] Saved message 66 to Redis
2025-05-07 22:44:46.103 +07:00 [INF] Added message 66 to conversation 4
2025-05-07 22:44:46.104 +07:00 [INF] Saved message 63 to Redis
2025-05-07 22:44:46.105 +07:00 [INF] Added message 63 to conversation 4
2025-05-07 22:44:46.106 +07:00 [INF] Saved message 58 to Redis
2025-05-07 22:44:46.107 +07:00 [INF] Added message 58 to conversation 4
2025-05-07 22:44:46.109 +07:00 [INF] Saved message 56 to Redis
2025-05-07 22:44:46.109 +07:00 [INF] Added message 56 to conversation 4
2025-05-07 22:44:46.110 +07:00 [INF] Saved message 53 to Redis
2025-05-07 22:44:46.111 +07:00 [INF] Added message 53 to conversation 4
2025-05-07 22:44:46.113 +07:00 [INF] Saved message 52 to Redis
2025-05-07 22:44:46.114 +07:00 [INF] Added message 52 to conversation 4
2025-05-07 22:44:46.116 +07:00 [INF] Saved message 50 to Redis
2025-05-07 22:44:46.117 +07:00 [INF] Added message 50 to conversation 4
2025-05-07 22:44:46.132 +07:00 [INF] Saved message 47 to Redis
2025-05-07 22:44:46.132 +07:00 [INF] Added message 47 to conversation 4
2025-05-07 22:44:46.134 +07:00 [INF] Saved message 46 to Redis
2025-05-07 22:44:46.134 +07:00 [INF] Added message 46 to conversation 4
2025-05-07 22:44:46.137 +07:00 [INF] Saved message 45 to Redis
2025-05-07 22:44:46.137 +07:00 [INF] Added message 45 to conversation 4
2025-05-07 22:44:46.138 +07:00 [INF] Saved message 44 to Redis
2025-05-07 22:44:46.140 +07:00 [INF] Added message 44 to conversation 4
2025-05-07 22:44:46.143 +07:00 [INF] Saved message 43 to Redis
2025-05-07 22:44:46.143 +07:00 [INF] Added message 43 to conversation 4
2025-05-07 22:44:46.146 +07:00 [INF] Saved message 42 to Redis
2025-05-07 22:44:46.147 +07:00 [INF] Added message 42 to conversation 4
2025-05-07 22:44:46.148 +07:00 [INF] Saved message 41 to Redis
2025-05-07 22:44:46.148 +07:00 [INF] Added message 41 to conversation 4
2025-05-07 22:44:46.150 +07:00 [INF] Saved message 40 to Redis
2025-05-07 22:44:46.150 +07:00 [INF] Added message 40 to conversation 4
2025-05-07 22:44:46.151 +07:00 [INF] Saved message 39 to Redis
2025-05-07 22:44:46.152 +07:00 [INF] Added message 39 to conversation 4
2025-05-07 22:44:46.153 +07:00 [INF] Saved message 38 to Redis
2025-05-07 22:44:46.153 +07:00 [INF] Added message 38 to conversation 4
2025-05-07 22:44:46.155 +07:00 [INF] Saved message 37 to Redis
2025-05-07 22:44:46.155 +07:00 [INF] Added message 37 to conversation 4
2025-05-07 22:44:46.160 +07:00 [INF] Saved message 36 to Redis
2025-05-07 22:44:46.160 +07:00 [INF] Added message 36 to conversation 4
2025-05-07 22:44:46.162 +07:00 [INF] Saved message 35 to Redis
2025-05-07 22:44:46.164 +07:00 [INF] Added message 35 to conversation 4
2025-05-07 22:44:46.166 +07:00 [INF] Saved message 34 to Redis
2025-05-07 22:44:46.166 +07:00 [INF] Added message 34 to conversation 4
2025-05-07 22:44:46.168 +07:00 [INF] Saved message 33 to Redis
2025-05-07 22:44:46.169 +07:00 [INF] Added message 33 to conversation 4
2025-05-07 22:44:46.170 +07:00 [INF] Saved message 32 to Redis
2025-05-07 22:44:46.170 +07:00 [INF] Added message 32 to conversation 4
2025-05-07 22:44:46.172 +07:00 [INF] Saved message 31 to Redis
2025-05-07 22:44:46.173 +07:00 [INF] Added message 31 to conversation 4
2025-05-07 22:44:46.176 +07:00 [INF] Saved message 30 to Redis
2025-05-07 22:44:46.177 +07:00 [INF] Added message 30 to conversation 4
2025-05-07 22:44:46.179 +07:00 [INF] Saved message 29 to Redis
2025-05-07 22:44:46.180 +07:00 [INF] Added message 29 to conversation 4
2025-05-07 22:44:46.181 +07:00 [INF] Saved message 28 to Redis
2025-05-07 22:44:46.182 +07:00 [INF] Added message 28 to conversation 4
2025-05-07 22:44:47.850 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-07 22:44:47.850 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:47.851 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.7569ms
2025-05-07 22:44:47.852 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-07 22:44:47.853 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:47.853 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:47.854 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 22:44:47.854 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 22:44:47.860 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 22:44:47.863 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 22:44:47.864 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 9.5588ms
2025-05-07 22:44:47.864 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 22:44:47.864 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 11.7054ms
2025-05-07 22:44:47.991 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-07 22:44:47.991 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:47.993 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:47.994 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 22:44:47.994 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 22:44:48.000 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 22:44:48.001 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 22:44:48.003 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 8.6065ms
2025-05-07 22:44:48.004 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 22:44:48.004 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 12.8241ms
2025-05-07 22:44:48.069 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 22:44:48.069 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:48.070 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3856ms
2025-05-07 22:44:48.072 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 22:44:48.073 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:48.077 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:48.077 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 22:44:48.082 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 22:44:48.098 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 22:44:48.103 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 22:44:48.104 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 22.3809ms
2025-05-07 22:44:48.105 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 22:44:48.105 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 32.5759ms
2025-05-07 22:44:48.199 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-07 22:44:48.199 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:48.199 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:48.200 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 22:44:48.327 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 22:44:48.338 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:44:53.816 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 22:44:53.817 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:53.817 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - 204 null null 1.3791ms
2025-05-07 22:44:53.822 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 22:44:53.823 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:53.823 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:53.823 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 22:44:53.875 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 22:44:53.934 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 22:44:53.937 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 22:44:54.054 +07:00 [INF] Executed DbCommand (71ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 22:44:54.376 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-07 22:44:54.518 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__user_id_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] IN (
    SELECT [u0].[value]
    FROM OPENJSON(@__user_id_0) WITH ([value] int '$') AS [u0]
)
2025-05-07 22:44:54.656 +07:00 [INF] Executed DbCommand (34ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-07 22:44:54.688 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN (
    SELECT [p].[id] AS [Id], [p].[user_id], [p].[conversation_id] AS [ConversationId], [p].[name] AS [Name], [p].[is_deleted] AS [IsDeleted], [p].[img_url]
    FROM [Participants] AS [p]
    WHERE [p].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 22:44:54.720 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 22:44:54.721 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 846.0592ms
2025-05-07 22:44:54.721 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 22:44:54.721 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 899.2368ms
2025-05-07 22:44:54.857 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/15/2 - null null
2025-05-07 22:44:54.857 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:54.858 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/15/2 - 204 null null 0.8235ms
2025-05-07 22:44:54.861 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/15/2 - null null
2025-05-07 22:44:54.861 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:54.861 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:54.861 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 22:44:54.880 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 22:44:54.928 +07:00 [INF] Retrieved 0 messages from Redis for conversation 15
2025-05-07 22:44:54.947 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 22:44:54.987 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 22:44:54.989 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 22:44:54.990 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 109.8152ms
2025-05-07 22:44:54.991 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 22:44:54.991 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/15/2 - 404 null text/plain; charset=utf-8 129.889ms
2025-05-07 22:44:55.003 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/15 - null null
2025-05-07 22:44:55.003 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:55.004 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/15 - 204 null null 0.8768ms
2025-05-07 22:44:55.009 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/15 - null null
2025-05-07 22:44:55.010 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:55.010 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:55.011 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 22:44:55.029 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 22:44:55.067 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-07 22:44:55.071 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 22:44:55.078 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 48.5813ms
2025-05-07 22:44:55.078 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 22:44:55.078 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/15 - 200 null application/json; charset=utf-8 69.1968ms
2025-05-07 22:44:55.083 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/15 - null null
2025-05-07 22:44:55.083 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:55.084 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/15 - 204 null null 0.482ms
2025-05-07 22:44:55.086 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/15 - null null
2025-05-07 22:44:55.086 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:55.086 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:55.086 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:44:55.099 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 22:44:55.115 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 22:44:55.117 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 22:44:55.119 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 20.2558ms
2025-05-07 22:44:55.120 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:44:55.120 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/15 - 200 null application/json; charset=utf-8 34.2421ms
2025-05-07 22:44:59.769 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/2/3 - null null
2025-05-07 22:44:59.769 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:59.769 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/2/3 - 204 null null 0.4558ms
2025-05-07 22:44:59.771 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/2/3 - null null
2025-05-07 22:44:59.771 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:59.774 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:59.775 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 22:44:59.775 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 22:44:59.848 +07:00 [INF] Retrieved 2 messages from Redis for conversation 2
2025-05-07 22:44:59.852 +07:00 [INF] Retrieved 2 messages from Redis for conversation 2 and user 3
2025-05-07 22:44:59.852 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 22:44:59.858 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 83.5975ms
2025-05-07 22:44:59.859 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 22:44:59.860 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/2/3 - 200 null application/json; charset=utf-8 88.9147ms
2025-05-07 22:44:59.868 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/2 - null null
2025-05-07 22:44:59.868 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:59.868 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/2 - 204 null null 0.4116ms
2025-05-07 22:44:59.871 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/2 - null null
2025-05-07 22:44:59.871 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:59.871 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:59.871 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 22:44:59.872 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 22:44:59.878 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-07 22:44:59.879 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 22:44:59.880 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.4814ms
2025-05-07 22:44:59.880 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 22:44:59.881 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/2 - 200 null application/json; charset=utf-8 9.8187ms
2025-05-07 22:44:59.888 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/2 - null null
2025-05-07 22:44:59.888 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:59.888 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/2 - 204 null null 0.6354ms
2025-05-07 22:44:59.895 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/2 - null null
2025-05-07 22:44:59.895 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:59.900 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:44:59.900 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:44:59.901 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 22:44:59.904 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 22:44:59.905 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 22:44:59.906 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.6583ms
2025-05-07 22:44:59.906 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:44:59.906 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/2 - 200 null application/json; charset=utf-8 12.0965ms
2025-05-07 22:45:04.549 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/2 - null null
2025-05-07 22:45:04.549 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:04.549 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:04.549 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:45:04.550 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 22:45:04.554 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 22:45:04.555 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 22:45:04.555 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.3864ms
2025-05-07 22:45:04.555 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:45:04.555 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/2 - 200 null application/json; charset=utf-8 6.4079ms
2025-05-07 22:45:09.697 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/update_nickname/4/2 - null null
2025-05-07 22:45:09.697 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:09.697 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/update_nickname/4/2 - 204 null null 0.6313ms
2025-05-07 22:45:09.706 +07:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5053/api/Participant/update_nickname/4/2 - application/json 18
2025-05-07 22:45:09.706 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:09.706 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:09.707 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.UpdateNickName (Message_app)'
2025-05-07 22:45:09.721 +07:00 [INF] Route matched with {action = "UpdateNickName", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateNickName(Int32, Int32, server.DTO.NicknameUpdateRequest) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 22:45:09.774 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversation_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__user_id_0 AND [p].[conversation_id] = @__conversation_id_1 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 22:45:09.793 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Participants] SET [name] = @p0
OUTPUT 1
WHERE [id] = @p1;
2025-05-07 22:45:09.821 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__user_id_1='?' (DbType = Int32), @__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) COALESCE((
    SELECT TOP(1) [p].[user_id]
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] <> @__user_id_1 AND [p].[is_deleted] = CAST(0 AS bit)), 0)
FROM [Conversations] AS [c]
WHERE [c].[id] = @__conversation_id_0
2025-05-07 22:45:09.850 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 22:45:09.851 +07:00 [INF] Executed action server.Controllers.ParticipantController.UpdateNickName (Message_app) in 129.8474ms
2025-05-07 22:45:09.852 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.UpdateNickName (Message_app)'
2025-05-07 22:45:09.852 +07:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5053/api/Participant/update_nickname/4/2 - 200 null application/json; charset=utf-8 145.9962ms
2025-05-07 22:45:13.520 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 22:45:13.520 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:13.520 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3738ms
2025-05-07 22:45:13.522 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 22:45:13.522 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:13.522 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:13.523 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 22:45:13.523 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 22:45:13.542 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 22:45:13.546 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 22:45:13.548 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 24.7208ms
2025-05-07 22:45:13.549 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 22:45:13.551 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 28.2904ms
2025-05-07 22:45:16.123 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/4/2 - null null
2025-05-07 22:45:16.123 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:16.124 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/4/2 - 204 null null 1.1494ms
2025-05-07 22:45:16.126 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/4/2 - null null
2025-05-07 22:45:16.126 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:16.126 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:16.126 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 22:45:16.127 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 22:45:16.189 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4
2025-05-07 22:45:16.189 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-07 22:45:16.189 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 22:45:16.191 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 64.7315ms
2025-05-07 22:45:16.192 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 22:45:16.192 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 65.6771ms
2025-05-07 22:45:16.220 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 22:45:16.220 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:16.220 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/4 - 204 null null 0.5702ms
2025-05-07 22:45:16.222 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 22:45:16.222 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:16.222 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:16.222 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 22:45:16.223 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 22:45:16.226 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-07 22:45:16.228 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 22:45:16.228 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.3989ms
2025-05-07 22:45:16.228 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 22:45:16.228 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 6.59ms
2025-05-07 22:45:16.234 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/4 - null null
2025-05-07 22:45:16.234 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:16.234 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/4 - 204 null null 0.3313ms
2025-05-07 22:45:16.236 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/4 - null null
2025-05-07 22:45:16.237 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:16.237 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:16.237 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:45:16.237 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 22:45:16.241 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 22:45:16.242 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 22:45:16.242 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.4519ms
2025-05-07 22:45:16.242 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:45:16.242 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 6.0858ms
2025-05-07 22:45:23.120 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/4/2 - null null
2025-05-07 22:45:23.120 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:23.120 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/4/2 - 204 null null 0.5022ms
2025-05-07 22:45:23.122 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/4/2 - null null
2025-05-07 22:45:23.122 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:23.122 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:23.123 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 22:45:23.123 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 22:45:23.204 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4
2025-05-07 22:45:23.204 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-07 22:45:23.204 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 22:45:23.205 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 82.1428ms
2025-05-07 22:45:23.205 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 22:45:23.205 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 83.4127ms
2025-05-07 22:45:23.218 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 22:45:23.218 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:23.218 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/4 - 204 null null 0.3371ms
2025-05-07 22:45:23.220 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-07 22:45:23.221 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:23.221 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:23.221 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 22:45:23.221 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 22:45:23.225 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-07 22:45:23.227 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 22:45:23.228 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.8132ms
2025-05-07 22:45:23.231 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 22:45:23.231 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 10.4284ms
2025-05-07 22:45:23.238 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/4 - null null
2025-05-07 22:45:23.238 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:23.238 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/4 - 204 null null 0.2291ms
2025-05-07 22:45:23.239 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/4 - null null
2025-05-07 22:45:23.239 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:23.240 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:23.241 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:45:23.241 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 22:45:23.244 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 22:45:23.245 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 22:45:23.247 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.9128ms
2025-05-07 22:45:23.247 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:45:23.247 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 7.7179ms
2025-05-07 22:45:28.469 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/2/3 - null null
2025-05-07 22:45:28.469 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:28.470 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/2/3 - 204 null null 0.7716ms
2025-05-07 22:45:28.472 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/2/3 - null null
2025-05-07 22:45:28.472 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:28.473 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:28.473 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 22:45:28.474 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 22:45:28.484 +07:00 [INF] Retrieved 2 messages from Redis for conversation 2
2025-05-07 22:45:28.485 +07:00 [INF] Retrieved 2 messages from Redis for conversation 2 and user 3
2025-05-07 22:45:28.485 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 22:45:28.485 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 11.0253ms
2025-05-07 22:45:28.485 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 22:45:28.485 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/2/3 - 200 null application/json; charset=utf-8 13.8545ms
2025-05-07 22:45:28.496 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/2 - null null
2025-05-07 22:45:28.496 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:28.496 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/2 - 204 null null 0.3459ms
2025-05-07 22:45:28.498 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/2 - null null
2025-05-07 22:45:28.499 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:28.499 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:28.499 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 22:45:28.499 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 22:45:28.503 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-07 22:45:28.504 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 22:45:28.505 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.0843ms
2025-05-07 22:45:28.505 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 22:45:28.506 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/2 - 200 null application/json; charset=utf-8 7.6183ms
2025-05-07 22:45:28.520 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/2 - null null
2025-05-07 22:45:28.520 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:28.521 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/2 - 204 null null 0.7851ms
2025-05-07 22:45:28.529 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/2 - null null
2025-05-07 22:45:28.530 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:28.530 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:28.530 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:45:28.530 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 22:45:28.536 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 22:45:28.538 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 22:45:28.538 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.0637ms
2025-05-07 22:45:28.538 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:45:28.538 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/2 - 200 null application/json; charset=utf-8 9.304ms
2025-05-07 22:45:37.462 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 22:45:37.463 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:37.463 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - 204 null null 0.7111ms
2025-05-07 22:45:37.465 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 22:45:37.465 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:37.465 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:37.465 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 22:45:37.465 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 22:45:37.488 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 22:45:37.500 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 22:45:37.581 +07:00 [INF] Executed DbCommand (77ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 22:45:37.581 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 22:45:37.581 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 115.929ms
2025-05-07 22:45:37.581 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 22:45:37.582 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 116.9484ms
2025-05-07 22:45:37.668 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/15/2 - null null
2025-05-07 22:45:37.669 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:37.669 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/15/2 - 204 null null 0.9366ms
2025-05-07 22:45:37.671 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/15/2 - null null
2025-05-07 22:45:37.671 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:37.671 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:37.671 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 22:45:37.671 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 22:45:37.673 +07:00 [INF] Retrieved 0 messages from Redis for conversation 15
2025-05-07 22:45:37.694 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 22:45:37.711 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 22:45:37.712 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 22:45:37.712 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 40.6695ms
2025-05-07 22:45:37.712 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 22:45:37.713 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/15/2 - 404 null text/plain; charset=utf-8 41.7655ms
2025-05-07 22:45:37.728 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/15 - null null
2025-05-07 22:45:37.728 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:37.729 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/15 - 204 null null 1.3656ms
2025-05-07 22:45:37.731 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/15 - null null
2025-05-07 22:45:37.731 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:37.731 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:37.731 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 22:45:37.731 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 22:45:37.747 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-07 22:45:37.748 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 22:45:37.748 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 17.1749ms
2025-05-07 22:45:37.749 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 22:45:37.749 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/15 - 200 null application/json; charset=utf-8 17.9683ms
2025-05-07 22:45:37.762 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/15 - null null
2025-05-07 22:45:37.762 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:37.762 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/15 - 204 null null 0.2824ms
2025-05-07 22:45:37.778 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/15 - null null
2025-05-07 22:45:37.779 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:37.779 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:45:37.779 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:45:37.779 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 22:45:37.803 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 22:45:37.803 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 22:45:37.804 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 24.6489ms
2025-05-07 22:45:37.804 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 22:45:37.804 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/15 - 200 null application/json; charset=utf-8 32.7518ms
2025-05-07 22:45:42.155 +07:00 [INF] Handling message from user 2: sdfs
2025-05-07 22:45:42.193 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 22:45:42.268 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 22:45:42.280 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 22:45:42.284 +07:00 [INF] Message saved to DB with ID: 152
2025-05-07 22:45:42.285 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 22:45:42.294 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 22:45:42.315 +07:00 [INF] Transaction committed for message: 152
2025-05-07 22:45:42.317 +07:00 [INF] Saved message 152 to Redis
2025-05-07 22:45:42.317 +07:00 [INF] Added message 152 to conversation 15
2025-05-07 22:45:42.322 +07:00 [INF] Published message to channel conversation:15
2025-05-07 22:58:28.206 +07:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-07 22:58:28.327 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-07 22:58:28.374 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-07 22:58:28.384 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-07 22:58:28.384 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-07 22:58:28.384 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-07 22:58:28.384 +07:00 [INF] Hosting environment: Development
2025-05-07 22:58:28.384 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-07 22:58:28.487 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-07 22:58:28.507 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:58:28.523 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:58:28.523 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-07 22:58:28.541 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 22:58:28.646 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 22:58:28.665 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:58:28.674 +07:00 [INF] Saved message 117 to Redis
2025-05-07 22:58:28.675 +07:00 [INF] Added message 117 to conversation 3
2025-05-07 22:58:28.676 +07:00 [INF] Saved message 115 to Redis
2025-05-07 22:58:28.676 +07:00 [INF] Added message 115 to conversation 3
2025-05-07 22:58:28.677 +07:00 [INF] Saved message 88 to Redis
2025-05-07 22:58:28.677 +07:00 [INF] Added message 88 to conversation 3
2025-05-07 22:58:28.677 +07:00 [INF] Saved message 70 to Redis
2025-05-07 22:58:28.678 +07:00 [INF] Added message 70 to conversation 3
2025-05-07 22:58:28.680 +07:00 [INF] Saved message 65 to Redis
2025-05-07 22:58:28.681 +07:00 [INF] Added message 65 to conversation 3
2025-05-07 22:58:28.682 +07:00 [INF] Saved message 48 to Redis
2025-05-07 22:58:28.682 +07:00 [INF] Added message 48 to conversation 3
2025-05-07 22:58:28.689 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:58:28.690 +07:00 [INF] Saved message 135 to Redis
2025-05-07 22:58:28.690 +07:00 [INF] Added message 135 to conversation 4
2025-05-07 22:58:28.690 +07:00 [INF] Saved message 133 to Redis
2025-05-07 22:58:28.691 +07:00 [INF] Added message 133 to conversation 4
2025-05-07 22:58:28.691 +07:00 [INF] Saved message 132 to Redis
2025-05-07 22:58:28.691 +07:00 [INF] Added message 132 to conversation 4
2025-05-07 22:58:28.692 +07:00 [INF] Saved message 131 to Redis
2025-05-07 22:58:28.692 +07:00 [INF] Added message 131 to conversation 4
2025-05-07 22:58:28.693 +07:00 [INF] Saved message 130 to Redis
2025-05-07 22:58:28.693 +07:00 [INF] Added message 130 to conversation 4
2025-05-07 22:58:28.694 +07:00 [INF] Saved message 129 to Redis
2025-05-07 22:58:28.695 +07:00 [INF] Added message 129 to conversation 4
2025-05-07 22:58:28.697 +07:00 [INF] Saved message 128 to Redis
2025-05-07 22:58:28.698 +07:00 [INF] Added message 128 to conversation 4
2025-05-07 22:58:28.698 +07:00 [INF] Saved message 127 to Redis
2025-05-07 22:58:28.699 +07:00 [INF] Added message 127 to conversation 4
2025-05-07 22:58:28.699 +07:00 [INF] Saved message 126 to Redis
2025-05-07 22:58:28.700 +07:00 [INF] Added message 126 to conversation 4
2025-05-07 22:58:28.701 +07:00 [INF] Saved message 125 to Redis
2025-05-07 22:58:28.701 +07:00 [INF] Added message 125 to conversation 4
2025-05-07 22:58:28.702 +07:00 [INF] Saved message 124 to Redis
2025-05-07 22:58:28.702 +07:00 [INF] Added message 124 to conversation 4
2025-05-07 22:58:28.702 +07:00 [INF] Saved message 123 to Redis
2025-05-07 22:58:28.703 +07:00 [INF] Added message 123 to conversation 4
2025-05-07 22:58:28.703 +07:00 [INF] Saved message 122 to Redis
2025-05-07 22:58:28.704 +07:00 [INF] Added message 122 to conversation 4
2025-05-07 22:58:28.704 +07:00 [INF] Saved message 121 to Redis
2025-05-07 22:58:28.705 +07:00 [INF] Added message 121 to conversation 4
2025-05-07 22:58:28.705 +07:00 [INF] Saved message 120 to Redis
2025-05-07 22:58:28.706 +07:00 [INF] Added message 120 to conversation 4
2025-05-07 22:58:28.707 +07:00 [INF] Saved message 119 to Redis
2025-05-07 22:58:28.707 +07:00 [INF] Added message 119 to conversation 4
2025-05-07 22:58:28.708 +07:00 [INF] Saved message 118 to Redis
2025-05-07 22:58:28.708 +07:00 [INF] Added message 118 to conversation 4
2025-05-07 22:58:28.709 +07:00 [INF] Saved message 111 to Redis
2025-05-07 22:58:28.709 +07:00 [INF] Added message 111 to conversation 4
2025-05-07 22:58:28.709 +07:00 [INF] Saved message 97 to Redis
2025-05-07 22:58:28.710 +07:00 [INF] Added message 97 to conversation 4
2025-05-07 22:58:28.710 +07:00 [INF] Saved message 96 to Redis
2025-05-07 22:58:28.710 +07:00 [INF] Added message 96 to conversation 4
2025-05-07 22:58:28.711 +07:00 [INF] Saved message 89 to Redis
2025-05-07 22:58:28.711 +07:00 [INF] Added message 89 to conversation 4
2025-05-07 22:58:28.712 +07:00 [INF] Saved message 69 to Redis
2025-05-07 22:58:28.713 +07:00 [INF] Added message 69 to conversation 4
2025-05-07 22:58:28.714 +07:00 [INF] Saved message 67 to Redis
2025-05-07 22:58:28.714 +07:00 [INF] Added message 67 to conversation 4
2025-05-07 22:58:28.715 +07:00 [INF] Saved message 66 to Redis
2025-05-07 22:58:28.715 +07:00 [INF] Added message 66 to conversation 4
2025-05-07 22:58:28.716 +07:00 [INF] Saved message 63 to Redis
2025-05-07 22:58:28.716 +07:00 [INF] Added message 63 to conversation 4
2025-05-07 22:58:28.717 +07:00 [INF] Saved message 58 to Redis
2025-05-07 22:58:28.717 +07:00 [INF] Added message 58 to conversation 4
2025-05-07 22:58:28.717 +07:00 [INF] Saved message 56 to Redis
2025-05-07 22:58:28.718 +07:00 [INF] Added message 56 to conversation 4
2025-05-07 22:58:28.718 +07:00 [INF] Saved message 53 to Redis
2025-05-07 22:58:28.718 +07:00 [INF] Added message 53 to conversation 4
2025-05-07 22:58:28.719 +07:00 [INF] Saved message 52 to Redis
2025-05-07 22:58:28.719 +07:00 [INF] Added message 52 to conversation 4
2025-05-07 22:58:28.720 +07:00 [INF] Saved message 50 to Redis
2025-05-07 22:58:28.720 +07:00 [INF] Added message 50 to conversation 4
2025-05-07 22:58:28.720 +07:00 [INF] Saved message 47 to Redis
2025-05-07 22:58:28.721 +07:00 [INF] Added message 47 to conversation 4
2025-05-07 22:58:28.721 +07:00 [INF] Saved message 46 to Redis
2025-05-07 22:58:28.721 +07:00 [INF] Added message 46 to conversation 4
2025-05-07 22:58:28.722 +07:00 [INF] Saved message 45 to Redis
2025-05-07 22:58:28.722 +07:00 [INF] Added message 45 to conversation 4
2025-05-07 22:58:28.723 +07:00 [INF] Saved message 44 to Redis
2025-05-07 22:58:28.723 +07:00 [INF] Added message 44 to conversation 4
2025-05-07 22:58:28.723 +07:00 [INF] Saved message 43 to Redis
2025-05-07 22:58:28.724 +07:00 [INF] Added message 43 to conversation 4
2025-05-07 22:58:28.724 +07:00 [INF] Saved message 42 to Redis
2025-05-07 22:58:28.724 +07:00 [INF] Added message 42 to conversation 4
2025-05-07 22:58:28.725 +07:00 [INF] Saved message 41 to Redis
2025-05-07 22:58:28.725 +07:00 [INF] Added message 41 to conversation 4
2025-05-07 22:58:28.726 +07:00 [INF] Saved message 40 to Redis
2025-05-07 22:58:28.726 +07:00 [INF] Added message 40 to conversation 4
2025-05-07 22:58:28.727 +07:00 [INF] Saved message 39 to Redis
2025-05-07 22:58:28.727 +07:00 [INF] Added message 39 to conversation 4
2025-05-07 22:58:28.728 +07:00 [INF] Saved message 38 to Redis
2025-05-07 22:58:28.729 +07:00 [INF] Added message 38 to conversation 4
2025-05-07 22:58:28.730 +07:00 [INF] Saved message 37 to Redis
2025-05-07 22:58:28.730 +07:00 [INF] Added message 37 to conversation 4
2025-05-07 22:58:28.731 +07:00 [INF] Saved message 36 to Redis
2025-05-07 22:58:28.731 +07:00 [INF] Added message 36 to conversation 4
2025-05-07 22:58:28.732 +07:00 [INF] Saved message 35 to Redis
2025-05-07 22:58:28.733 +07:00 [INF] Added message 35 to conversation 4
2025-05-07 22:58:28.733 +07:00 [INF] Saved message 34 to Redis
2025-05-07 22:58:28.733 +07:00 [INF] Added message 34 to conversation 4
2025-05-07 22:58:28.734 +07:00 [INF] Saved message 33 to Redis
2025-05-07 22:58:28.734 +07:00 [INF] Added message 33 to conversation 4
2025-05-07 22:58:28.735 +07:00 [INF] Saved message 32 to Redis
2025-05-07 22:58:28.735 +07:00 [INF] Added message 32 to conversation 4
2025-05-07 22:58:28.736 +07:00 [INF] Saved message 31 to Redis
2025-05-07 22:58:28.737 +07:00 [INF] Added message 31 to conversation 4
2025-05-07 22:58:28.737 +07:00 [INF] Saved message 30 to Redis
2025-05-07 22:58:28.738 +07:00 [INF] Added message 30 to conversation 4
2025-05-07 22:58:28.738 +07:00 [INF] Saved message 29 to Redis
2025-05-07 22:58:28.738 +07:00 [INF] Added message 29 to conversation 4
2025-05-07 22:58:28.739 +07:00 [INF] Saved message 28 to Redis
2025-05-07 22:58:28.739 +07:00 [INF] Added message 28 to conversation 4
2025-05-07 22:58:28.742 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:58:28.743 +07:00 [INF] Saved message 152 to Redis
2025-05-07 22:58:28.744 +07:00 [INF] Added message 152 to conversation 15
2025-05-07 22:58:31.914 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-07 22:58:31.915 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:58:31.917 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:58:31.919 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 22:58:31.938 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-07 22:58:31.939 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:58:31.939 +07:00 [INF] CORS policy execution successful.
2025-05-07 22:58:31.941 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 22:58:31.991 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 22:58:31.996 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 22:58:31.997 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:58:31.999 +07:00 [INF] Saved message 114 to Redis
2025-05-07 22:58:31.999 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:58:32.000 +07:00 [INF] Added message 114 to conversation 1
2025-05-07 22:58:32.000 +07:00 [INF] Message 114 already exists in Redis
2025-05-07 22:58:32.004 +07:00 [INF] Saved message 113 to Redis
2025-05-07 22:58:32.003 +07:00 [INF] Saved message 113 to Redis
2025-05-07 22:58:32.004 +07:00 [INF] Added message 113 to conversation 1
2025-05-07 22:58:32.004 +07:00 [INF] Added message 113 to conversation 1
2025-05-07 22:58:32.006 +07:00 [INF] Saved message 112 to Redis
2025-05-07 22:58:32.006 +07:00 [INF] Saved message 112 to Redis
2025-05-07 22:58:32.006 +07:00 [INF] Added message 112 to conversation 1
2025-05-07 22:58:32.006 +07:00 [INF] Added message 112 to conversation 1
2025-05-07 22:58:32.007 +07:00 [INF] Saved message 110 to Redis
2025-05-07 22:58:32.007 +07:00 [INF] Saved message 110 to Redis
2025-05-07 22:58:32.008 +07:00 [INF] Added message 110 to conversation 1
2025-05-07 22:58:32.008 +07:00 [INF] Added message 110 to conversation 1
2025-05-07 22:58:32.009 +07:00 [INF] Saved message 109 to Redis
2025-05-07 22:58:32.009 +07:00 [INF] Saved message 109 to Redis
2025-05-07 22:58:32.009 +07:00 [INF] Added message 109 to conversation 1
2025-05-07 22:58:32.010 +07:00 [INF] Added message 109 to conversation 1
2025-05-07 22:58:32.011 +07:00 [INF] Saved message 108 to Redis
2025-05-07 22:58:32.011 +07:00 [INF] Saved message 108 to Redis
2025-05-07 22:58:32.011 +07:00 [INF] Added message 108 to conversation 1
2025-05-07 22:58:32.012 +07:00 [INF] Added message 108 to conversation 1
2025-05-07 22:58:32.014 +07:00 [INF] Saved message 107 to Redis
2025-05-07 22:58:32.014 +07:00 [INF] Saved message 107 to Redis
2025-05-07 22:58:32.015 +07:00 [INF] Added message 107 to conversation 1
2025-05-07 22:58:32.015 +07:00 [INF] Added message 107 to conversation 1
2025-05-07 22:58:32.016 +07:00 [INF] Saved message 106 to Redis
2025-05-07 22:58:32.016 +07:00 [INF] Saved message 106 to Redis
2025-05-07 22:58:32.016 +07:00 [INF] Added message 106 to conversation 1
2025-05-07 22:58:32.016 +07:00 [INF] Added message 106 to conversation 1
2025-05-07 22:58:32.017 +07:00 [INF] Saved message 105 to Redis
2025-05-07 22:58:32.017 +07:00 [INF] Saved message 105 to Redis
2025-05-07 22:58:32.018 +07:00 [INF] Added message 105 to conversation 1
2025-05-07 22:58:32.018 +07:00 [INF] Added message 105 to conversation 1
2025-05-07 22:58:32.019 +07:00 [INF] Saved message 104 to Redis
2025-05-07 22:58:32.019 +07:00 [INF] Saved message 104 to Redis
2025-05-07 22:58:32.020 +07:00 [INF] Added message 104 to conversation 1
2025-05-07 22:58:32.020 +07:00 [INF] Added message 104 to conversation 1
2025-05-07 22:58:32.021 +07:00 [INF] Saved message 103 to Redis
2025-05-07 22:58:32.021 +07:00 [INF] Saved message 103 to Redis
2025-05-07 22:58:32.022 +07:00 [INF] Added message 103 to conversation 1
2025-05-07 22:58:32.022 +07:00 [INF] Added message 103 to conversation 1
2025-05-07 22:58:32.023 +07:00 [INF] Saved message 102 to Redis
2025-05-07 22:58:32.023 +07:00 [INF] Saved message 102 to Redis
2025-05-07 22:58:32.023 +07:00 [INF] Added message 102 to conversation 1
2025-05-07 22:58:32.023 +07:00 [INF] Added message 102 to conversation 1
2025-05-07 22:58:32.024 +07:00 [INF] Saved message 101 to Redis
2025-05-07 22:58:32.024 +07:00 [INF] Saved message 101 to Redis
2025-05-07 22:58:32.025 +07:00 [INF] Added message 101 to conversation 1
2025-05-07 22:58:32.025 +07:00 [INF] Added message 101 to conversation 1
2025-05-07 22:58:32.026 +07:00 [INF] Saved message 100 to Redis
2025-05-07 22:58:32.026 +07:00 [INF] Saved message 100 to Redis
2025-05-07 22:58:32.026 +07:00 [INF] Added message 100 to conversation 1
2025-05-07 22:58:32.026 +07:00 [INF] Added message 100 to conversation 1
2025-05-07 22:58:32.054 +07:00 [INF] Saved message 99 to Redis
2025-05-07 22:58:32.056 +07:00 [INF] Saved message 99 to Redis
2025-05-07 22:58:32.056 +07:00 [INF] Added message 99 to conversation 1
2025-05-07 22:58:32.056 +07:00 [INF] Added message 99 to conversation 1
2025-05-07 22:58:32.057 +07:00 [INF] Saved message 98 to Redis
2025-05-07 22:58:32.057 +07:00 [INF] Saved message 98 to Redis
2025-05-07 22:58:32.058 +07:00 [INF] Added message 98 to conversation 1
2025-05-07 22:58:32.058 +07:00 [INF] Added message 98 to conversation 1
2025-05-07 22:58:32.061 +07:00 [INF] Saved message 95 to Redis
2025-05-07 22:58:32.061 +07:00 [INF] Saved message 95 to Redis
2025-05-07 22:58:32.061 +07:00 [INF] Added message 95 to conversation 1
2025-05-07 22:58:32.061 +07:00 [INF] Added message 95 to conversation 1
2025-05-07 22:58:32.064 +07:00 [INF] Saved message 94 to Redis
2025-05-07 22:58:32.064 +07:00 [INF] Saved message 94 to Redis
2025-05-07 22:58:32.065 +07:00 [INF] Added message 94 to conversation 1
2025-05-07 22:58:32.065 +07:00 [INF] Added message 94 to conversation 1
2025-05-07 22:58:32.066 +07:00 [INF] Saved message 93 to Redis
2025-05-07 22:58:32.066 +07:00 [INF] Saved message 93 to Redis
2025-05-07 22:58:32.067 +07:00 [INF] Added message 93 to conversation 1
2025-05-07 22:58:32.067 +07:00 [INF] Added message 93 to conversation 1
2025-05-07 22:58:32.071 +07:00 [INF] Saved message 92 to Redis
2025-05-07 22:58:32.071 +07:00 [INF] Saved message 92 to Redis
2025-05-07 22:58:32.072 +07:00 [INF] Added message 92 to conversation 1
2025-05-07 22:58:32.072 +07:00 [INF] Added message 92 to conversation 1
2025-05-07 22:58:32.074 +07:00 [INF] Saved message 91 to Redis
2025-05-07 22:58:32.074 +07:00 [INF] Saved message 91 to Redis
2025-05-07 22:58:32.075 +07:00 [INF] Added message 91 to conversation 1
2025-05-07 22:58:32.075 +07:00 [INF] Added message 91 to conversation 1
2025-05-07 22:58:32.076 +07:00 [INF] Saved message 90 to Redis
2025-05-07 22:58:32.076 +07:00 [INF] Saved message 90 to Redis
2025-05-07 22:58:32.076 +07:00 [INF] Added message 90 to conversation 1
2025-05-07 22:58:32.076 +07:00 [INF] Added message 90 to conversation 1
2025-05-07 22:58:32.077 +07:00 [INF] Saved message 87 to Redis
2025-05-07 22:58:32.077 +07:00 [INF] Saved message 87 to Redis
2025-05-07 22:58:32.078 +07:00 [INF] Added message 87 to conversation 1
2025-05-07 22:58:32.078 +07:00 [INF] Added message 87 to conversation 1
2025-05-07 22:58:32.080 +07:00 [INF] Saved message 86 to Redis
2025-05-07 22:58:32.080 +07:00 [INF] Saved message 86 to Redis
2025-05-07 22:58:32.080 +07:00 [INF] Added message 86 to conversation 1
2025-05-07 22:58:32.080 +07:00 [INF] Added message 86 to conversation 1
2025-05-07 22:58:32.082 +07:00 [INF] Saved message 85 to Redis
2025-05-07 22:58:32.082 +07:00 [INF] Saved message 85 to Redis
2025-05-07 22:58:32.082 +07:00 [INF] Added message 85 to conversation 1
2025-05-07 22:58:32.082 +07:00 [INF] Added message 85 to conversation 1
2025-05-07 22:58:32.083 +07:00 [INF] Saved message 84 to Redis
2025-05-07 22:58:32.084 +07:00 [INF] Saved message 84 to Redis
2025-05-07 22:58:32.084 +07:00 [INF] Added message 84 to conversation 1
2025-05-07 22:58:32.084 +07:00 [INF] Added message 84 to conversation 1
2025-05-07 22:58:32.085 +07:00 [INF] Saved message 83 to Redis
2025-05-07 22:58:32.085 +07:00 [INF] Saved message 83 to Redis
2025-05-07 22:58:32.085 +07:00 [INF] Added message 83 to conversation 1
2025-05-07 22:58:32.085 +07:00 [INF] Added message 83 to conversation 1
2025-05-07 22:58:32.086 +07:00 [INF] Saved message 82 to Redis
2025-05-07 22:58:32.086 +07:00 [INF] Saved message 82 to Redis
2025-05-07 22:58:32.087 +07:00 [INF] Added message 82 to conversation 1
2025-05-07 22:58:32.087 +07:00 [INF] Added message 82 to conversation 1
2025-05-07 22:58:32.088 +07:00 [INF] Saved message 81 to Redis
2025-05-07 22:58:32.088 +07:00 [INF] Saved message 81 to Redis
2025-05-07 22:58:32.088 +07:00 [INF] Added message 81 to conversation 1
2025-05-07 22:58:32.088 +07:00 [INF] Added message 81 to conversation 1
2025-05-07 22:58:32.089 +07:00 [INF] Saved message 80 to Redis
2025-05-07 22:58:32.089 +07:00 [INF] Saved message 80 to Redis
2025-05-07 22:58:32.090 +07:00 [INF] Added message 80 to conversation 1
2025-05-07 22:58:32.090 +07:00 [INF] Added message 80 to conversation 1
2025-05-07 22:58:32.091 +07:00 [INF] Saved message 79 to Redis
2025-05-07 22:58:32.091 +07:00 [INF] Saved message 79 to Redis
2025-05-07 22:58:32.091 +07:00 [INF] Added message 79 to conversation 1
2025-05-07 22:58:32.091 +07:00 [INF] Added message 79 to conversation 1
2025-05-07 22:58:32.092 +07:00 [INF] Saved message 78 to Redis
2025-05-07 22:58:32.092 +07:00 [INF] Saved message 78 to Redis
2025-05-07 22:58:32.092 +07:00 [INF] Added message 78 to conversation 1
2025-05-07 22:58:32.092 +07:00 [INF] Added message 78 to conversation 1
2025-05-07 22:58:32.093 +07:00 [INF] Saved message 77 to Redis
2025-05-07 22:58:32.093 +07:00 [INF] Saved message 77 to Redis
2025-05-07 22:58:32.094 +07:00 [INF] Added message 77 to conversation 1
2025-05-07 22:58:32.094 +07:00 [INF] Added message 77 to conversation 1
2025-05-07 22:58:32.095 +07:00 [INF] Saved message 76 to Redis
2025-05-07 22:58:32.095 +07:00 [INF] Saved message 76 to Redis
2025-05-07 22:58:32.095 +07:00 [INF] Added message 76 to conversation 1
2025-05-07 22:58:32.096 +07:00 [INF] Added message 76 to conversation 1
2025-05-07 22:58:32.097 +07:00 [INF] Saved message 75 to Redis
2025-05-07 22:58:32.097 +07:00 [INF] Saved message 75 to Redis
2025-05-07 22:58:32.098 +07:00 [INF] Added message 75 to conversation 1
2025-05-07 22:58:32.098 +07:00 [INF] Added message 75 to conversation 1
2025-05-07 22:58:32.099 +07:00 [INF] Saved message 74 to Redis
2025-05-07 22:58:32.099 +07:00 [INF] Saved message 74 to Redis
2025-05-07 22:58:32.099 +07:00 [INF] Added message 74 to conversation 1
2025-05-07 22:58:32.099 +07:00 [INF] Added message 74 to conversation 1
2025-05-07 22:58:32.100 +07:00 [INF] Saved message 73 to Redis
2025-05-07 22:58:32.100 +07:00 [INF] Saved message 73 to Redis
2025-05-07 22:58:32.100 +07:00 [INF] Added message 73 to conversation 1
2025-05-07 22:58:32.100 +07:00 [INF] Added message 73 to conversation 1
2025-05-07 22:58:32.101 +07:00 [INF] Saved message 72 to Redis
2025-05-07 22:58:32.101 +07:00 [INF] Saved message 72 to Redis
2025-05-07 22:58:32.102 +07:00 [INF] Added message 72 to conversation 1
2025-05-07 22:58:32.102 +07:00 [INF] Added message 72 to conversation 1
2025-05-07 22:58:32.102 +07:00 [INF] Saved message 71 to Redis
2025-05-07 22:58:32.102 +07:00 [INF] Saved message 71 to Redis
2025-05-07 22:58:32.103 +07:00 [INF] Added message 71 to conversation 1
2025-05-07 22:58:32.103 +07:00 [INF] Added message 71 to conversation 1
2025-05-07 22:58:32.104 +07:00 [INF] Saved message 68 to Redis
2025-05-07 22:58:32.104 +07:00 [INF] Saved message 68 to Redis
2025-05-07 22:58:32.104 +07:00 [INF] Added message 68 to conversation 1
2025-05-07 22:58:32.104 +07:00 [INF] Added message 68 to conversation 1
2025-05-07 22:58:32.105 +07:00 [INF] Saved message 64 to Redis
2025-05-07 22:58:32.105 +07:00 [INF] Saved message 64 to Redis
2025-05-07 22:58:32.106 +07:00 [INF] Added message 64 to conversation 1
2025-05-07 22:58:32.106 +07:00 [INF] Added message 64 to conversation 1
2025-05-07 22:58:32.106 +07:00 [INF] Saved message 62 to Redis
2025-05-07 22:58:32.106 +07:00 [INF] Saved message 62 to Redis
2025-05-07 22:58:32.107 +07:00 [INF] Added message 62 to conversation 1
2025-05-07 22:58:32.107 +07:00 [INF] Added message 62 to conversation 1
2025-05-07 22:58:32.108 +07:00 [INF] Saved message 61 to Redis
2025-05-07 22:58:32.108 +07:00 [INF] Saved message 61 to Redis
2025-05-07 22:58:32.108 +07:00 [INF] Added message 61 to conversation 1
2025-05-07 22:58:32.108 +07:00 [INF] Added message 61 to conversation 1
2025-05-07 22:58:32.109 +07:00 [INF] Saved message 60 to Redis
2025-05-07 22:58:32.109 +07:00 [INF] Saved message 60 to Redis
2025-05-07 22:58:32.109 +07:00 [INF] Added message 60 to conversation 1
2025-05-07 22:58:32.109 +07:00 [INF] Added message 60 to conversation 1
2025-05-07 22:58:32.110 +07:00 [INF] Saved message 59 to Redis
2025-05-07 22:58:32.110 +07:00 [INF] Saved message 59 to Redis
2025-05-07 22:58:32.111 +07:00 [INF] Added message 59 to conversation 1
2025-05-07 22:58:32.111 +07:00 [INF] Added message 59 to conversation 1
2025-05-07 22:58:32.111 +07:00 [INF] Saved message 57 to Redis
2025-05-07 22:58:32.111 +07:00 [INF] Saved message 57 to Redis
2025-05-07 22:58:32.112 +07:00 [INF] Added message 57 to conversation 1
2025-05-07 22:58:32.112 +07:00 [INF] Added message 57 to conversation 1
2025-05-07 22:58:32.114 +07:00 [INF] Saved message 55 to Redis
2025-05-07 22:58:32.114 +07:00 [INF] Saved message 55 to Redis
2025-05-07 22:58:32.114 +07:00 [INF] Added message 55 to conversation 1
2025-05-07 22:58:32.114 +07:00 [INF] Added message 55 to conversation 1
2025-05-07 22:58:32.115 +07:00 [INF] Saved message 54 to Redis
2025-05-07 22:58:32.115 +07:00 [INF] Saved message 54 to Redis
2025-05-07 22:58:32.116 +07:00 [INF] Added message 54 to conversation 1
2025-05-07 22:58:32.116 +07:00 [INF] Added message 54 to conversation 1
2025-05-07 22:58:32.116 +07:00 [INF] Saved message 51 to Redis
2025-05-07 22:58:32.116 +07:00 [INF] Saved message 51 to Redis
2025-05-07 22:58:32.117 +07:00 [INF] Added message 51 to conversation 1
2025-05-07 22:58:32.117 +07:00 [INF] Added message 51 to conversation 1
2025-05-07 22:58:32.118 +07:00 [INF] Saved message 49 to Redis
2025-05-07 22:58:32.118 +07:00 [INF] Saved message 49 to Redis
2025-05-07 22:58:32.118 +07:00 [INF] Added message 49 to conversation 1
2025-05-07 22:58:32.118 +07:00 [INF] Added message 49 to conversation 1
2025-05-07 22:58:32.120 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:58:32.122 +07:00 [INF] Saved message 142 to Redis
2025-05-07 22:58:32.122 +07:00 [INF] Added message 142 to conversation 2
2025-05-07 22:58:32.123 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:58:32.123 +07:00 [INF] Saved message 4 to Redis
2025-05-07 22:58:32.123 +07:00 [INF] Message 142 already exists in Redis
2025-05-07 22:58:32.124 +07:00 [INF] Message 4 already exists in Redis
2025-05-07 22:58:32.124 +07:00 [INF] Added message 4 to conversation 2
2025-05-07 22:58:32.126 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 22:58:32.126 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 23:07:43.983 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-07 23:07:43.996 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:44.023 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 39.131ms
2025-05-07 23:07:44.044 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-07 23:07:44.047 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:44.052 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:44.057 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:07:44.130 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 23:07:44.361 +07:00 [INF] Executed DbCommand (49ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 23:07:44.469 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 23:07:44.515 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 382.3908ms
2025-05-07 23:07:44.516 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:07:44.525 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 481.3736ms
2025-05-07 23:07:44.637 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 23:07:44.637 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:44.640 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:44.640 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:07:44.647 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 23:07:44.704 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 23:07:44.705 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:44.705 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.8986ms
2025-05-07 23:07:44.707 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 23:07:44.707 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:44.713 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:44.714 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:07:44.736 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:07:44.781 +07:00 [INF] Executed DbCommand (48ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 23:07:44.784 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:07:44.796 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 148.6745ms
2025-05-07 23:07:44.796 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:07:44.797 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 160.4051ms
2025-05-07 23:07:44.862 +07:00 [INF] Executed DbCommand (37ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 23:07:44.883 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 23:07:44.886 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 149.7619ms
2025-05-07 23:07:44.886 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:07:44.886 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 179.5459ms
2025-05-07 23:07:44.912 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-07 23:07:44.913 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:44.914 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:44.914 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 23:07:45.030 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 23:07:58.550 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-07 23:07:58.551 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:58.551 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.6889ms
2025-05-07 23:07:58.553 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-07 23:07:58.553 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:58.554 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:58.554 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:07:58.554 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 23:07:58.569 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 23:07:58.571 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 23:07:58.571 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 16.6188ms
2025-05-07 23:07:58.571 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:07:58.571 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 18.5019ms
2025-05-07 23:07:58.683 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-07 23:07:58.684 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:58.686 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:58.686 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:07:58.686 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 23:07:58.698 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 23:07:58.698 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:07:58.699 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 12.466ms
2025-05-07 23:07:58.699 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:07:58.699 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 15.5096ms
2025-05-07 23:07:58.764 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 23:07:58.764 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:58.764 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.369ms
2025-05-07 23:07:58.766 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 23:07:58.766 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:58.767 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:58.767 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:07:58.768 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:07:58.788 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[user_id], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-07 23:07:58.789 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 23:07:58.790 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 21.9455ms
2025-05-07 23:07:58.790 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:07:58.790 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 23.667ms
2025-05-07 23:07:58.866 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-07 23:07:58.867 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:58.867 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:07:58.867 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 23:07:59.061 +07:00 [INF] Executed DbCommand (45ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 23:07:59.095 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 23:08:00.666 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:08:00.666 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:08:00.667 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - 204 null null 0.4335ms
2025-05-07 23:08:00.669 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:08:00.669 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:08:00.669 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:08:00.670 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:08:00.675 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:08:00.716 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:08:00.718 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:08:00.809 +07:00 [INF] Executed DbCommand (67ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 23:08:00.946 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-07 23:08:01.005 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__user_id_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] IN (
    SELECT [u0].[value]
    FROM OPENJSON(@__user_id_0) WITH ([value] int '$') AS [u0]
)
2025-05-07 23:08:01.081 +07:00 [INF] Executed DbCommand (45ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-07 23:08:01.096 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN (
    SELECT [p].[id] AS [Id], [p].[user_id], [p].[conversation_id] AS [ConversationId], [p].[name] AS [Name], [p].[is_deleted] AS [IsDeleted], [p].[img_url]
    FROM [Participants] AS [p]
    WHERE [p].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 23:08:01.107 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 23:08:01.107 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 432.0609ms
2025-05-07 23:08:01.108 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:08:01.108 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 438.95ms
2025-05-07 23:08:01.243 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/16/2 - null null
2025-05-07 23:08:01.243 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:08:01.243 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/16/2 - 204 null null 0.6354ms
2025-05-07 23:08:01.245 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/16/2 - null null
2025-05-07 23:08:01.246 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:08:01.246 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:08:01.246 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:08:01.250 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 23:08:01.262 +07:00 [INF] Retrieved 0 messages from Redis for conversation 16
2025-05-07 23:08:01.282 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 23:08:01.314 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 23:08:01.315 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 23:08:01.316 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 65.8978ms
2025-05-07 23:08:01.316 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:08:01.316 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/16/2 - 404 null text/plain; charset=utf-8 70.2528ms
2025-05-07 23:08:01.329 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/16 - null null
2025-05-07 23:08:01.330 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:08:01.330 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/16 - 204 null null 0.37ms
2025-05-07 23:08:01.331 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/16 - null null
2025-05-07 23:08:01.331 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:08:01.332 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:08:01.332 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:08:01.334 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:08:01.351 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-07 23:08:01.354 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 23:08:01.356 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 21.3482ms
2025-05-07 23:08:01.356 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:08:01.356 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/16 - 200 null application/json; charset=utf-8 24.4555ms
2025-05-07 23:08:01.363 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/16 - null null
2025-05-07 23:08:01.363 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:08:01.364 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/16 - 204 null null 0.3097ms
2025-05-07 23:08:01.365 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/16 - null null
2025-05-07 23:08:01.366 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:08:01.366 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:08:01.366 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:08:01.368 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 23:08:01.378 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 23:08:01.380 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:08:01.383 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 14.1119ms
2025-05-07 23:08:01.383 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:08:01.383 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/16 - 200 null application/json; charset=utf-8 17.7954ms
2025-05-07 23:13:10.363 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:13:10.364 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:13:10.367 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - 204 null null 3.6711ms
2025-05-07 23:13:10.369 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:13:10.369 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:13:10.370 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:13:10.371 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:13:10.372 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:13:10.404 +07:00 [INF] Executed DbCommand (26ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:13:10.409 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:13:10.501 +07:00 [INF] Executed DbCommand (87ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 23:13:10.502 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 23:13:10.502 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 130.471ms
2025-05-07 23:13:10.502 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:13:10.502 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 133.5382ms
2025-05-07 23:13:10.633 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/16/2 - null null
2025-05-07 23:13:10.633 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:13:10.634 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/16/2 - 204 null null 0.4182ms
2025-05-07 23:13:10.641 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/16/2 - null null
2025-05-07 23:13:10.641 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:13:10.653 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:13:10.653 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:13:10.653 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 23:13:10.693 +07:00 [INF] Retrieved 0 messages from Redis for conversation 16
2025-05-07 23:13:10.710 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 23:13:10.725 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 23:13:10.725 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 23:13:10.726 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 72.2565ms
2025-05-07 23:13:10.726 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:13:10.726 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/16/2 - 404 null text/plain; charset=utf-8 84.8361ms
2025-05-07 23:13:10.743 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/16 - null null
2025-05-07 23:13:10.744 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:13:10.744 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/16 - 204 null null 0.6315ms
2025-05-07 23:13:10.757 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/16 - null null
2025-05-07 23:13:10.766 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:13:10.766 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:13:10.766 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:13:10.766 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:13:10.784 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-07 23:13:10.789 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 23:13:10.790 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 23.8576ms
2025-05-07 23:13:10.790 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:13:10.790 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/16 - 200 null application/json; charset=utf-8 33.3734ms
2025-05-07 23:13:10.799 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/16 - null null
2025-05-07 23:13:10.799 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:13:10.799 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/16 - 204 null null 0.2334ms
2025-05-07 23:13:10.801 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/16 - null null
2025-05-07 23:13:10.801 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:13:10.804 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:13:10.804 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:13:10.804 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 23:13:10.812 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 23:13:10.813 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:13:10.813 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.8769ms
2025-05-07 23:13:10.813 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:13:10.814 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/16 - 200 null application/json; charset=utf-8 12.9671ms
2025-05-07 23:13:15.696 +07:00 [INF] Handling message from user 2: da
2025-05-07 23:13:15.714 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 23:13:15.809 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 23:13:15.821 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 23:13:15.824 +07:00 [INF] Message saved to DB with ID: 153
2025-05-07 23:13:15.830 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 23:13:15.841 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 23:13:15.861 +07:00 [INF] Transaction committed for message: 153
2025-05-07 23:13:15.865 +07:00 [INF] Saved message 153 to Redis
2025-05-07 23:13:15.866 +07:00 [INF] Added message 153 to conversation 16
2025-05-07 23:13:15.882 +07:00 [INF] Published message to channel conversation:16
2025-05-07 23:25:29.916 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/3/2 - null null
2025-05-07 23:25:29.916 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:25:29.916 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/3/2 - 204 null null 0.2919ms
2025-05-07 23:25:29.918 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/3/2 - null null
2025-05-07 23:25:29.918 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:25:29.918 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:25:29.918 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:25:29.919 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 23:25:29.953 +07:00 [INF] Retrieved 6 messages from Redis for conversation 3
2025-05-07 23:25:29.956 +07:00 [INF] Retrieved 6 messages from Redis for conversation 3 and user 2
2025-05-07 23:25:29.957 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 23:25:29.960 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 41.8936ms
2025-05-07 23:25:29.961 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:25:29.961 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/3/2 - 200 null application/json; charset=utf-8 42.9028ms
2025-05-07 23:25:29.974 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/3 - null null
2025-05-07 23:25:29.974 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:25:29.975 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/3 - 204 null null 0.3813ms
2025-05-07 23:25:29.977 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/3 - null null
2025-05-07 23:25:29.978 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:25:29.978 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:25:29.979 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:25:29.979 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:25:30.012 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-07 23:25:30.013 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 23:25:30.014 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 34.8896ms
2025-05-07 23:25:30.014 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:25:30.014 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/3 - 200 null application/json; charset=utf-8 36.887ms
2025-05-07 23:25:30.019 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/3 - null null
2025-05-07 23:25:30.019 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:25:30.019 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/3 - 204 null null 0.2306ms
2025-05-07 23:25:30.020 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/3 - null null
2025-05-07 23:25:30.021 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:25:30.021 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:25:30.021 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:25:30.021 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 23:25:30.026 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 23:25:30.027 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:25:30.027 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.8666ms
2025-05-07 23:25:30.027 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:25:30.027 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/3 - 200 null application/json; charset=utf-8 6.6077ms
2025-05-07 23:25:39.401 +07:00 [INF] Handling message from user 2: sdfs
2025-05-07 23:25:39.409 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 23:25:39.424 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 23:25:39.438 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 23:25:39.439 +07:00 [INF] Message saved to DB with ID: 154
2025-05-07 23:25:39.441 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 23:25:39.448 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 23:25:39.450 +07:00 [INF] Transaction committed for message: 154
2025-05-07 23:25:39.452 +07:00 [INF] Saved message 154 to Redis
2025-05-07 23:25:39.452 +07:00 [INF] Added message 154 to conversation 3
2025-05-07 23:25:39.453 +07:00 [INF] Published message to channel conversation:3
2025-05-07 23:27:02.410 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:27:02.411 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:27:02.411 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - 204 null null 0.6978ms
2025-05-07 23:27:02.414 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:27:02.415 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:27:02.415 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:27:02.417 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:27:02.417 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:27:02.436 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:27:02.439 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:27:02.504 +07:00 [INF] Executed DbCommand (63ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 23:27:02.504 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 23:27:02.504 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 87.2725ms
2025-05-07 23:27:02.504 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:27:02.505 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 90.7443ms
2025-05-07 23:27:02.597 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/16/2 - null null
2025-05-07 23:27:02.597 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:27:02.598 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/16/2 - 204 null null 0.4153ms
2025-05-07 23:27:02.599 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/16/2 - null null
2025-05-07 23:27:02.599 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:27:02.599 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:27:02.599 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:27:02.599 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 23:27:02.601 +07:00 [INF] Retrieved 1 messages from Redis for conversation 16
2025-05-07 23:27:02.601 +07:00 [INF] Retrieved 1 messages from Redis for conversation 16 and user 2
2025-05-07 23:27:02.601 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 23:27:02.602 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.1856ms
2025-05-07 23:27:02.602 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:27:02.602 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/16/2 - 200 null application/json; charset=utf-8 2.997ms
2025-05-07 23:27:02.608 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/16 - null null
2025-05-07 23:27:02.608 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:27:02.609 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/16 - 204 null null 0.9665ms
2025-05-07 23:27:02.610 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/16 - null null
2025-05-07 23:27:02.611 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:27:02.611 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:27:02.611 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:27:02.611 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:27:02.617 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-07 23:27:02.617 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 23:27:02.618 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.5188ms
2025-05-07 23:27:02.618 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:27:02.618 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/16 - 200 null application/json; charset=utf-8 7.3384ms
2025-05-07 23:27:02.625 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/16 - null null
2025-05-07 23:27:02.626 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:27:02.627 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/16 - 204 null null 1.13ms
2025-05-07 23:27:02.628 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/16 - null null
2025-05-07 23:27:02.629 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:27:02.629 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:27:02.629 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:27:02.629 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 23:27:02.633 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 23:27:02.633 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:27:02.633 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.5463ms
2025-05-07 23:27:02.634 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:27:02.634 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/16 - 200 null application/json; charset=utf-8 5.2555ms
2025-05-07 23:27:38.541 +07:00 [INF] Handling message from user 2: sfsdf
2025-05-07 23:27:38.558 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 23:27:38.600 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 23:27:38.610 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 23:27:38.610 +07:00 [INF] Message saved to DB with ID: 155
2025-05-07 23:27:38.611 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 23:27:38.616 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 23:27:38.617 +07:00 [INF] Transaction committed for message: 155
2025-05-07 23:27:38.619 +07:00 [INF] Saved message 155 to Redis
2025-05-07 23:27:38.620 +07:00 [INF] Added message 155 to conversation 16
2025-05-07 23:27:38.621 +07:00 [INF] Published message to channel conversation:16
2025-05-07 23:41:19.379 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-07 23:41:19.381 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:19.384 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 4.8836ms
2025-05-07 23:41:19.386 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-07 23:41:19.386 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:19.387 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:19.389 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:41:19.391 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 23:41:19.464 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 23:41:19.474 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 23:41:19.476 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 84.4184ms
2025-05-07 23:41:19.476 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:41:19.476 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 90.3969ms
2025-05-07 23:41:19.572 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 23:41:19.573 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:19.574 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:19.574 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:41:19.574 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 23:41:19.591 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 23:41:19.592 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:41:19.592 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 18.1554ms
2025-05-07 23:41:19.592 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:41:19.592 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 20.3042ms
2025-05-07 23:41:19.639 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 23:41:19.639 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:19.639 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.3211ms
2025-05-07 23:41:19.641 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 23:41:19.641 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:19.641 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:19.641 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:41:19.642 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:41:19.644 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 23:41:19.645 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.3954ms
2025-05-07 23:41:19.645 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:41:19.645 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.1246ms
2025-05-07 23:41:19.769 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-07 23:41:19.771 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:19.771 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:19.771 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 23:41:19.867 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 23:41:29.539 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-07 23:41:29.539 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:29.539 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2211ms
2025-05-07 23:41:29.540 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-07 23:41:29.541 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:29.541 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:29.541 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:41:29.542 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 23:41:29.553 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 23:41:29.554 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 23:41:29.554 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 12.1111ms
2025-05-07 23:41:29.554 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:41:29.554 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 13.884ms
2025-05-07 23:41:29.664 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-07 23:41:29.664 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:29.664 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:29.664 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:41:29.664 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 23:41:29.676 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 23:41:29.676 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:41:29.677 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 12.1209ms
2025-05-07 23:41:29.677 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:41:29.677 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 12.9471ms
2025-05-07 23:41:29.731 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 23:41:29.733 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:29.734 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 2.4911ms
2025-05-07 23:41:29.736 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 23:41:29.736 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:29.736 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:29.737 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:41:29.737 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:41:29.739 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 23:41:29.739 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.3756ms
2025-05-07 23:41:29.739 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:41:29.739 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 3.2636ms
2025-05-07 23:41:29.828 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-07 23:41:29.828 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:29.829 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:29.829 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 23:41:29.836 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 23:41:29.847 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 23:41:33.057 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:41:33.057 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:33.058 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - 204 null null 0.8583ms
2025-05-07 23:41:33.062 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:41:33.062 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:33.062 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:41:33.062 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:41:33.063 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:41:33.089 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:41:33.095 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:41:33.173 +07:00 [INF] Executed DbCommand (68ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 23:41:33.180 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-07 23:41:33.196 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__user_id_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] IN (
    SELECT [u0].[value]
    FROM OPENJSON(@__user_id_0) WITH ([value] int '$') AS [u0]
)
2025-05-07 23:41:33.218 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-07 23:41:33.228 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN (
    SELECT [p].[id] AS [Id], [p].[user_id], [p].[conversation_id] AS [ConversationId], [p].[name] AS [Name], [p].[is_deleted] AS [IsDeleted], [p].[img_url]
    FROM [Participants] AS [p]
    WHERE [p].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 23:41:33.234 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 23:41:33.234 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 171.1675ms
2025-05-07 23:41:33.234 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:41:33.234 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 172.4713ms
2025-05-07 23:47:41.374 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-07 23:47:41.374 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:47:41.374 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.631ms
2025-05-07 23:47:41.376 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-07 23:47:41.378 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:47:41.378 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:47:41.378 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:47:41.379 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 23:47:41.406 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 23:47:41.406 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 23:47:41.407 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 27.9698ms
2025-05-07 23:47:41.407 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:47:41.407 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 31.1197ms
2025-05-07 23:47:41.520 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 23:47:41.520 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:47:41.520 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:47:41.520 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:47:41.520 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 23:47:41.534 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 23:47:41.534 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:47:41.534 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 13.551ms
2025-05-07 23:47:41.534 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:47:41.534 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 14.2833ms
2025-05-07 23:47:41.591 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 23:47:41.591 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:47:41.591 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.2623ms
2025-05-07 23:47:41.593 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 23:47:41.593 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:47:41.593 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:47:41.593 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:47:41.594 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:47:41.596 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 23:47:41.597 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.1543ms
2025-05-07 23:47:41.597 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:47:41.597 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.3011ms
2025-05-07 23:47:41.693 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-07 23:47:41.693 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:47:41.693 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:47:41.693 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 23:47:41.804 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 23:48:01.292 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-07 23:48:01.292 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:01.293 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.7972ms
2025-05-07 23:48:01.294 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-07 23:48:01.294 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:01.294 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:01.294 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:48:01.294 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 23:48:01.302 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 23:48:01.303 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 23:48:01.303 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 8.4615ms
2025-05-07 23:48:01.303 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:48:01.303 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 8.9216ms
2025-05-07 23:48:01.389 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-07 23:48:01.390 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:01.390 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:01.390 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:48:01.390 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 23:48:01.397 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 23:48:01.397 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:48:01.397 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 7.3552ms
2025-05-07 23:48:01.397 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:48:01.397 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 7.8618ms
2025-05-07 23:48:01.454 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 23:48:01.454 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:01.454 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3376ms
2025-05-07 23:48:01.455 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 23:48:01.456 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:01.456 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:01.456 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:48:01.456 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:48:01.458 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 23:48:01.459 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.0169ms
2025-05-07 23:48:01.459 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:48:01.459 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 3.307ms
2025-05-07 23:48:01.591 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-07 23:48:01.591 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:01.591 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:01.592 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 23:48:01.664 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 23:48:01.671 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 23:48:10.203 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:48:10.204 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:10.204 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - 204 null null 0.6753ms
2025-05-07 23:48:10.206 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:48:10.207 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:10.207 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:10.208 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:48:10.209 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:48:10.225 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:48:10.231 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:48:10.286 +07:00 [INF] Executed DbCommand (53ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 23:48:10.291 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-07 23:48:10.301 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__user_id_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] IN (
    SELECT [u0].[value]
    FROM OPENJSON(@__user_id_0) WITH ([value] int '$') AS [u0]
)
2025-05-07 23:48:10.317 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-07 23:48:10.324 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN (
    SELECT [p].[id] AS [Id], [p].[user_id], [p].[conversation_id] AS [ConversationId], [p].[name] AS [Name], [p].[is_deleted] AS [IsDeleted], [p].[img_url]
    FROM [Participants] AS [p]
    WHERE [p].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 23:48:10.327 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 23:48:10.328 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 118.4683ms
2025-05-07 23:48:10.328 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:48:10.328 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 121.2269ms
2025-05-07 23:48:10.436 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-07 23:48:10.436 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:10.436 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - 204 null null 0.1696ms
2025-05-07 23:48:10.438 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-07 23:48:10.438 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:10.438 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:10.438 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:48:10.439 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 23:48:10.442 +07:00 [INF] Retrieved 0 messages from Redis for conversation 18
2025-05-07 23:48:10.453 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-07 23:48:10.465 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-07 23:48:10.466 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-07 23:48:10.466 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 27.5799ms
2025-05-07 23:48:10.466 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:48:10.466 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - 404 null text/plain; charset=utf-8 28.3507ms
2025-05-07 23:48:10.479 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-07 23:48:10.479 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:10.480 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 0.6097ms
2025-05-07 23:48:10.481 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-07 23:48:10.482 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:10.482 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:10.482 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:48:10.482 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:48:10.489 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-07 23:48:10.489 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 23:48:10.490 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.5818ms
2025-05-07 23:48:10.490 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:48:10.490 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 8.7011ms
2025-05-07 23:48:10.498 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-07 23:48:10.498 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:10.498 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 0.2399ms
2025-05-07 23:48:10.500 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-07 23:48:10.500 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:10.500 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:48:10.500 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:48:10.500 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 23:48:10.504 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 23:48:10.504 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:48:10.505 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.7272ms
2025-05-07 23:48:10.505 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:48:10.505 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 5.1269ms
2025-05-07 23:48:14.366 +07:00 [INF] Handling message from user 2: sfsfd
2025-05-07 23:48:14.370 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-07 23:48:14.374 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 23:48:14.380 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-07 23:48:14.380 +07:00 [INF] Message saved to DB with ID: 156
2025-05-07 23:48:14.381 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-07 23:48:14.389 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-07 23:48:14.390 +07:00 [INF] Transaction committed for message: 156
2025-05-07 23:48:14.393 +07:00 [INF] Saved message 156 to Redis
2025-05-07 23:48:14.395 +07:00 [INF] Added message 156 to conversation 18
2025-05-07 23:48:14.396 +07:00 [INF] Published message to channel conversation:18
2025-05-07 23:49:23.094 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-07 23:49:23.094 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:23.094 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.8283ms
2025-05-07 23:49:23.097 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-07 23:49:23.097 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:23.097 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:23.097 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:49:23.097 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 23:49:23.110 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 23:49:23.112 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 23:49:23.113 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 15.7675ms
2025-05-07 23:49:23.114 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:49:23.115 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 18.4ms
2025-05-07 23:49:23.209 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-05-07 23:49:23.209 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:23.209 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:23.209 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:49:23.210 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 23:49:23.223 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 23:49:23.223 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:49:23.224 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.429ms
2025-05-07 23:49:23.224 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:49:23.224 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 15.0295ms
2025-05-07 23:49:23.286 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 23:49:23.286 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:23.286 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.1832ms
2025-05-07 23:49:23.287 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-05-07 23:49:23.287 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:23.287 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:23.287 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:49:23.287 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:49:23.288 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 23:49:23.289 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.1615ms
2025-05-07 23:49:23.289 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:49:23.289 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 1.6812ms
2025-05-07 23:49:23.417 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-07 23:49:23.417 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:23.417 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:23.417 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 23:49:23.503 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 23:49:42.907 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-07 23:49:42.907 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:42.907 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2223ms
2025-05-07 23:49:42.910 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-07 23:49:42.910 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:42.910 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:42.910 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:49:42.911 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-07 23:49:42.924 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-07 23:49:42.925 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-07 23:49:42.926 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 14.7858ms
2025-05-07 23:49:42.926 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-07 23:49:42.926 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 15.6924ms
2025-05-07 23:49:43.024 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-07 23:49:43.024 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:43.024 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:43.024 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:49:43.024 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-07 23:49:43.036 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-07 23:49:43.037 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:49:43.037 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 13.3794ms
2025-05-07 23:49:43.037 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-07 23:49:43.037 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 13.9231ms
2025-05-07 23:49:43.083 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 23:49:43.084 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:43.084 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1864ms
2025-05-07 23:49:43.085 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-07 23:49:43.085 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:43.085 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:43.085 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:49:43.085 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:49:43.086 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 23:49:43.087 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.3697ms
2025-05-07 23:49:43.088 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-07 23:49:43.088 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 2.8991ms
2025-05-07 23:49:43.224 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-07 23:49:43.224 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:43.224 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:43.224 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-07 23:49:43.238 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-07 23:49:43.247 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-07 23:49:45.104 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:49:45.105 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:45.105 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - 204 null null 0.189ms
2025-05-07 23:49:45.106 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:49:45.106 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:45.106 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:45.107 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:49:45.107 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:49:45.113 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:49:45.115 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:49:45.174 +07:00 [INF] Executed DbCommand (57ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 23:49:45.175 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 23:49:45.175 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 66.8543ms
2025-05-07 23:49:45.175 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:49:45.175 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 68.5129ms
2025-05-07 23:49:45.281 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-07 23:49:45.281 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:45.281 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - 204 null null 0.3964ms
2025-05-07 23:49:45.283 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-07 23:49:45.283 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:45.283 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:45.283 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:49:45.283 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 23:49:45.336 +07:00 [INF] Retrieved 1 messages from Redis for conversation 18
2025-05-07 23:49:45.337 +07:00 [INF] Retrieved 1 messages from Redis for conversation 18 and user 2
2025-05-07 23:49:45.337 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 23:49:45.337 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 54.2803ms
2025-05-07 23:49:45.338 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:49:45.338 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - 200 null application/json; charset=utf-8 54.773ms
2025-05-07 23:49:45.360 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-07 23:49:45.361 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:45.361 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 0.3786ms
2025-05-07 23:49:45.367 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-07 23:49:45.367 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:45.367 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:45.367 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:49:45.367 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:49:45.376 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-07 23:49:45.377 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 23:49:45.378 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.9908ms
2025-05-07 23:49:45.378 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:49:45.378 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 10.669ms
2025-05-07 23:49:45.392 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-07 23:49:45.392 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:45.393 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 1.0083ms
2025-05-07 23:49:45.400 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-07 23:49:45.400 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:45.400 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:49:45.400 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:49:45.400 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 23:49:45.415 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 23:49:45.417 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:49:45.418 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 17.5272ms
2025-05-07 23:49:45.418 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:49:45.418 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 18.4191ms
2025-05-07 23:50:06.885 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:50:06.885 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:50:06.886 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/open_conversation/2/3 - 204 null null 0.4811ms
2025-05-07 23:50:06.887 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-07 23:50:06.887 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:50:06.887 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:50:06.887 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:50:06.888 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:50:06.905 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:50:06.906 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-07 23:50:06.974 +07:00 [INF] Executed DbCommand (68ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-07 23:50:06.975 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-07 23:50:06.975 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 87.6859ms
2025-05-07 23:50:06.975 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-07 23:50:06.976 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 88.4719ms
2025-05-07 23:50:07.068 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-07 23:50:07.068 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:50:07.068 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/18/2 - 204 null null 0.2007ms
2025-05-07 23:50:07.070 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - null null
2025-05-07 23:50:07.070 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:50:07.070 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:50:07.070 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:50:07.070 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-07 23:50:07.071 +07:00 [INF] Retrieved 1 messages from Redis for conversation 18
2025-05-07 23:50:07.072 +07:00 [INF] Retrieved 1 messages from Redis for conversation 18 and user 2
2025-05-07 23:50:07.072 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-07 23:50:07.072 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 1.8739ms
2025-05-07 23:50:07.072 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-07 23:50:07.072 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/18/2 - 200 null application/json; charset=utf-8 2.2193ms
2025-05-07 23:50:07.077 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-07 23:50:07.077 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:50:07.077 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/18 - 204 null null 0.181ms
2025-05-07 23:50:07.079 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - null null
2025-05-07 23:50:07.079 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:50:07.079 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:50:07.079 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:50:07.079 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-07 23:50:07.085 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-07 23:50:07.085 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-07 23:50:07.085 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.9052ms
2025-05-07 23:50:07.085 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-07 23:50:07.086 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/18 - 200 null application/json; charset=utf-8 6.8823ms
2025-05-07 23:50:07.090 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-07 23:50:07.090 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:50:07.090 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/18 - 204 null null 0.1557ms
2025-05-07 23:50:07.092 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - null null
2025-05-07 23:50:07.092 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:50:07.092 +07:00 [INF] CORS policy execution successful.
2025-05-07 23:50:07.093 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:50:07.093 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-07 23:50:07.099 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-07 23:50:07.100 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-07 23:50:07.100 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.1484ms
2025-05-07 23:50:07.100 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-07 23:50:07.100 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/18 - 200 null application/json; charset=utf-8 8.0138ms
