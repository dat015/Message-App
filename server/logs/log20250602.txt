2025-06-02 14:02:35.796 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-02 14:02:36.120 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-02 14:02:36.202 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-02 14:02:36.209 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-02 14:02:36.210 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-02 14:02:36.210 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-02 14:02:36.210 +07:00 [INF] Hosting environment: Development
2025-06-02 14:02:36.210 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-02 14:04:17.452 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 14:04:17.484 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:17.496 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 46.5215ms
2025-06-02 14:04:17.500 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 58
2025-06-02 14:04:17.501 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:17.533 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:17.535 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-02 14:04:17.575 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 14:04:17.604 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 14:04:17.749 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 14:04:17.841 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 14:04:17.875 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 269.0348ms
2025-06-02 14:04:17.875 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 14:04:17.878 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 377.9028ms
2025-06-02 14:04:17.897 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-06-02 14:04:17.909 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:17.910 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:17.912 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 14:04:18.026 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 14:04:18.027 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:18.028 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:18.030 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 14:04:18.035 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 14:04:18.148 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 14:04:18.152 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:04:18.161 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 125.4611ms
2025-06-02 14:04:18.161 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 14:04:18.161 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 135.1482ms
2025-06-02 14:04:18.211 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 14:04:18.225 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 14:04:18.226 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 14:04:18.227 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 14:04:18.227 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 14:04:18.228 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 14:04:18.229 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 14:04:18.229 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 14:04:18.229 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 14:04:18.230 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 14:04:18.230 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 14:04:18.231 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 14:04:18.231 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 14:04:18.232 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 14:04:18.233 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 14:04:18.233 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 14:04:18.234 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 14:04:18.234 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 14:04:18.235 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 14:04:18.236 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 14:04:18.237 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 14:04:18.238 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 14:04:18.238 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 14:04:18.238 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 14:04:18.239 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 14:04:18.239 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 14:04:18.241 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 14:04:18.242 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 14:04:18.242 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 14:04:18.243 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 14:04:18.243 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 14:04:18.244 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 14:04:18.288 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 14:04:18.288 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:18.288 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.6241ms
2025-06-02 14:04:18.290 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 14:04:18.290 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:18.290 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:18.290 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 14:04:18.293 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 14:04:18.367 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 14:04:18.442 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 14:04:18.475 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 181.1746ms
2025-06-02 14:04:18.475 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 14:04:18.475 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 185.4794ms
2025-06-02 14:04:21.572 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/2 - null null
2025-06-02 14:04:21.572 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:21.572 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/2 - 204 null null 0.704ms
2025-06-02 14:04:21.574 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/2 - null null
2025-06-02 14:04:21.574 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:21.574 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:21.574 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:04:21.581 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 14:04:21.624 +07:00 [WRN] Message 0 has invalid data: id=0, conversation_id=53, sender_id=0, created_at="2025-06-01T14:40:02.7083553Z"
2025-06-02 14:04:21.632 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53
2025-06-02 14:04:21.634 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53 and user 2
2025-06-02 14:04:21.635 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 14:04:21.642 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 60.7107ms
2025-06-02 14:04:21.642 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:04:21.642 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 68.3179ms
2025-06-02 14:04:21.650 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-02 14:04:21.650 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:21.650 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.3667ms
2025-06-02 14:04:21.651 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-02 14:04:21.652 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:21.653 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:21.654 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:04:21.656 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 14:04:21.694 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 14:04:21.725 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 14:04:21.727 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 70.4719ms
2025-06-02 14:04:21.727 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:04:21.727 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 76.1328ms
2025-06-02 14:04:21.733 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:04:21.734 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:21.734 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.3138ms
2025-06-02 14:04:21.737 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:04:21.738 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:21.738 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:21.738 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:04:21.740 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:04:21.751 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:04:21.757 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:04:21.759 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 18.1813ms
2025-06-02 14:04:21.759 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:04:21.759 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 21.989ms
2025-06-02 14:04:23.221 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:04:23.221 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:23.222 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:23.222 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:04:23.222 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:04:23.232 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:04:23.234 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:04:23.234 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 11.6887ms
2025-06-02 14:04:23.234 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:04:23.235 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 13.6401ms
2025-06-02 14:04:32.023 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/2 - null null
2025-06-02 14:04:32.023 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:32.023 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/2 - 204 null null 0.4307ms
2025-06-02 14:04:32.025 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/2 - null null
2025-06-02 14:04:32.025 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:32.028 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:32.028 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:04:32.028 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 14:04:32.031 +07:00 [WRN] Message 417 not found in Redis
2025-06-02 14:04:32.031 +07:00 [WRN] Message 416 not found in Redis
2025-06-02 14:04:32.033 +07:00 [WRN] Message 415 not found in Redis
2025-06-02 14:04:32.033 +07:00 [INF] Retrieved 0 messages from Redis for conversation 51
2025-06-02 14:04:32.076 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-06-02 14:04:32.111 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__p_2='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64), @__clearedAt_1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_2) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0 AND [m].[created_at] > @__clearedAt_1
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-06-02 14:04:32.140 +07:00 [INF] Saved message 417 to Redis
2025-06-02 14:04:32.141 +07:00 [INF] Added message 417 to conversation 51
2025-06-02 14:04:32.142 +07:00 [INF] Saved message 416 to Redis
2025-06-02 14:04:32.143 +07:00 [INF] Added message 416 to conversation 51
2025-06-02 14:04:32.143 +07:00 [INF] Cached 2 messages to Redis for conversation 51
2025-06-02 14:04:32.143 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 14:04:32.143 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 115.0014ms
2025-06-02 14:04:32.143 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:04:32.144 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/2 - 200 null application/json; charset=utf-8 118.7299ms
2025-06-02 14:04:32.148 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-06-02 14:04:32.149 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:32.149 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - 204 null null 0.2922ms
2025-06-02 14:04:32.150 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-06-02 14:04:32.151 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:32.151 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:32.151 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:04:32.151 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 14:04:32.158 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 14:04:32.161 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 14:04:32.161 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.6824ms
2025-06-02 14:04:32.161 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:04:32.161 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - 200 null application/json; charset=utf-8 10.8565ms
2025-06-02 14:04:32.168 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - null null
2025-06-02 14:04:32.168 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:32.169 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - 204 null null 0.3588ms
2025-06-02 14:04:32.171 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - null null
2025-06-02 14:04:32.171 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:32.171 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:32.171 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:04:32.171 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:04:32.176 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:04:32.178 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:04:32.178 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.395ms
2025-06-02 14:04:32.178 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:04:32.178 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 7.2564ms
2025-06-02 14:04:33.365 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - null null
2025-06-02 14:04:33.365 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:33.365 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:04:33.365 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:04:33.365 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:04:33.372 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:04:33.374 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:04:33.375 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.1291ms
2025-06-02 14:04:33.375 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:04:33.375 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 10.5754ms
2025-06-02 14:06:13.107 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 14:06:13.107 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:13.107 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.4919ms
2025-06-02 14:06:13.109 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 58
2025-06-02 14:06:13.109 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:13.110 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:13.111 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 14:06:13.111 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 14:06:13.121 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 14:06:13.123 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 14:06:13.123 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 12.4829ms
2025-06-02 14:06:13.123 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 14:06:13.124 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 14.9329ms
2025-06-02 14:06:13.145 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-06-02 14:06:13.145 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:13.146 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:13.146 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 14:06:13.248 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 14:06:13.249 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:13.251 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:13.251 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 14:06:13.251 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 14:06:13.259 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 14:06:13.260 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:06:13.261 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.2625ms
2025-06-02 14:06:13.261 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 14:06:13.261 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 12.7889ms
2025-06-02 14:06:13.327 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 14:06:13.327 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 14:06:13.328 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 14:06:13.328 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 14:06:13.328 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 14:06:13.329 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 14:06:13.329 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 14:06:13.330 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 14:06:13.330 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 14:06:13.331 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 14:06:13.356 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 14:06:13.358 +07:00 [ERR] Connection id "0HND1KEOCDG3N", Request id "0HND1KEOCDG3N:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 14:06:13.361 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 115463.6326ms
2025-06-02 14:06:13.402 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 14:06:13.403 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:13.403 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.3464ms
2025-06-02 14:06:13.405 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 14:06:13.405 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:13.405 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:13.405 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 14:06:13.406 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 14:06:13.420 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 14:06:13.524 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 14:06:13.527 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 121.4015ms
2025-06-02 14:06:13.527 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 14:06:13.527 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 122.625ms
2025-06-02 14:06:18.124 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/2 - null null
2025-06-02 14:06:18.125 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:18.125 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/2 - 204 null null 0.3753ms
2025-06-02 14:06:18.126 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/2 - null null
2025-06-02 14:06:18.126 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:18.126 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:18.126 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:06:18.126 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 14:06:18.129 +07:00 [WRN] Message 0 has invalid data: id=0, conversation_id=53, sender_id=0, created_at="2025-06-01T14:40:02.7083553Z"
2025-06-02 14:06:18.132 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53
2025-06-02 14:06:18.132 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53 and user 2
2025-06-02 14:06:18.133 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 14:06:18.133 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 6.7718ms
2025-06-02 14:06:18.133 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:06:18.133 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 7.4207ms
2025-06-02 14:06:18.143 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-02 14:06:18.143 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:18.143 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.2944ms
2025-06-02 14:06:18.144 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-02 14:06:18.144 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:18.144 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:18.145 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:06:18.145 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 14:06:18.152 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 14:06:18.154 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 14:06:18.155 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.3201ms
2025-06-02 14:06:18.155 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:06:18.155 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 11.2011ms
2025-06-02 14:06:18.163 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:06:18.163 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:18.163 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.3286ms
2025-06-02 14:06:18.164 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:06:18.164 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:18.164 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:18.164 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:06:18.164 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:06:18.168 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:06:18.171 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:06:18.171 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.5312ms
2025-06-02 14:06:18.171 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:06:18.172 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 7.6341ms
2025-06-02 14:06:18.420 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-06-02 14:06:18.420 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:18.420 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:18.420 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 14:06:26.134 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:06:26.134 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:26.134 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2993ms
2025-06-02 14:06:26.135 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:06:26.136 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:26.136 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:26.136 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:06:26.136 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:06:26.141 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:06:26.143 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:06:26.144 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.9037ms
2025-06-02 14:06:26.144 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:06:26.144 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 8.5446ms
2025-06-02 14:06:33.441 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/2 - null null
2025-06-02 14:06:33.441 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:33.441 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/19/2 - 204 null null 0.335ms
2025-06-02 14:06:33.443 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/2 - null null
2025-06-02 14:06:33.443 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:33.443 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:33.444 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:06:33.444 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 14:06:33.453 +07:00 [WRN] Message 245 not found in Redis
2025-06-02 14:06:33.453 +07:00 [WRN] Message 244 not found in Redis
2025-06-02 14:06:33.453 +07:00 [WRN] Message 243 not found in Redis
2025-06-02 14:06:33.454 +07:00 [WRN] Message 242 not found in Redis
2025-06-02 14:06:33.454 +07:00 [WRN] Message 241 not found in Redis
2025-06-02 14:06:33.454 +07:00 [WRN] Message 240 not found in Redis
2025-06-02 14:06:33.455 +07:00 [WRN] Message 239 not found in Redis
2025-06-02 14:06:33.455 +07:00 [WRN] Message 238 not found in Redis
2025-06-02 14:06:33.455 +07:00 [WRN] Message 237 not found in Redis
2025-06-02 14:06:33.456 +07:00 [WRN] Message 231 not found in Redis
2025-06-02 14:06:33.456 +07:00 [WRN] Message 230 not found in Redis
2025-06-02 14:06:33.456 +07:00 [WRN] Message 229 not found in Redis
2025-06-02 14:06:33.457 +07:00 [WRN] Message 228 not found in Redis
2025-06-02 14:06:33.457 +07:00 [WRN] Message 227 not found in Redis
2025-06-02 14:06:33.457 +07:00 [WRN] Message 226 not found in Redis
2025-06-02 14:06:33.457 +07:00 [WRN] Message 225 not found in Redis
2025-06-02 14:06:33.458 +07:00 [WRN] Message 224 not found in Redis
2025-06-02 14:06:33.458 +07:00 [WRN] Message 223 not found in Redis
2025-06-02 14:06:33.458 +07:00 [WRN] Message 222 not found in Redis
2025-06-02 14:06:33.458 +07:00 [WRN] Message 221 not found in Redis
2025-06-02 14:06:33.458 +07:00 [WRN] Message 220 not found in Redis
2025-06-02 14:06:33.459 +07:00 [WRN] Message 219 not found in Redis
2025-06-02 14:06:33.459 +07:00 [WRN] Message 218 not found in Redis
2025-06-02 14:06:33.459 +07:00 [WRN] Message 217 not found in Redis
2025-06-02 14:06:33.459 +07:00 [WRN] Message 216 not found in Redis
2025-06-02 14:06:33.459 +07:00 [WRN] Message 215 not found in Redis
2025-06-02 14:06:33.460 +07:00 [WRN] Message 214 not found in Redis
2025-06-02 14:06:33.460 +07:00 [WRN] Message 213 not found in Redis
2025-06-02 14:06:33.460 +07:00 [WRN] Message 212 not found in Redis
2025-06-02 14:06:33.460 +07:00 [WRN] Message 211 not found in Redis
2025-06-02 14:06:33.461 +07:00 [WRN] Message 210 not found in Redis
2025-06-02 14:06:33.461 +07:00 [WRN] Message 209 not found in Redis
2025-06-02 14:06:33.461 +07:00 [WRN] Message 208 not found in Redis
2025-06-02 14:06:33.462 +07:00 [WRN] Message 207 not found in Redis
2025-06-02 14:06:33.462 +07:00 [WRN] Message 206 not found in Redis
2025-06-02 14:06:33.462 +07:00 [WRN] Message 205 not found in Redis
2025-06-02 14:06:33.462 +07:00 [WRN] Message 204 not found in Redis
2025-06-02 14:06:33.462 +07:00 [WRN] Message 203 not found in Redis
2025-06-02 14:06:33.463 +07:00 [WRN] Message 202 not found in Redis
2025-06-02 14:06:33.463 +07:00 [WRN] Message 201 not found in Redis
2025-06-02 14:06:33.463 +07:00 [WRN] Message 196 not found in Redis
2025-06-02 14:06:33.463 +07:00 [WRN] Message 194 not found in Redis
2025-06-02 14:06:33.463 +07:00 [WRN] Message 193 not found in Redis
2025-06-02 14:06:33.463 +07:00 [WRN] Message 192 not found in Redis
2025-06-02 14:06:33.464 +07:00 [WRN] Message 190 not found in Redis
2025-06-02 14:06:33.464 +07:00 [WRN] Message 189 not found in Redis
2025-06-02 14:06:33.464 +07:00 [WRN] Message 183 not found in Redis
2025-06-02 14:06:33.464 +07:00 [WRN] Message 182 not found in Redis
2025-06-02 14:06:33.464 +07:00 [WRN] Message 181 not found in Redis
2025-06-02 14:06:33.465 +07:00 [INF] Retrieved 48 messages from Redis for conversation 19
2025-06-02 14:06:33.465 +07:00 [INF] Retrieved 48 messages from Redis for conversation 19 and user 2
2025-06-02 14:06:33.465 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 14:06:33.465 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 21.3241ms
2025-06-02 14:06:33.465 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:06:33.465 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/19/2 - 200 null application/json; charset=utf-8 22.1708ms
2025-06-02 14:06:33.476 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-02 14:06:33.477 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:33.477 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/19 - 204 null null 0.2677ms
2025-06-02 14:06:33.478 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - null null
2025-06-02 14:06:33.478 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:33.478 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:33.478 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:06:33.478 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 14:06:33.486 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 14:06:33.486 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 14:06:33.486 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.7299ms
2025-06-02 14:06:33.486 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:06:33.487 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/19 - 200 null application/json; charset=utf-8 8.59ms
2025-06-02 14:06:33.492 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-02 14:06:33.492 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:33.493 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/19 - 204 null null 0.2652ms
2025-06-02 14:06:33.495 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-02 14:06:33.495 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:33.495 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:33.495 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:06:33.495 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:06:33.499 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:06:33.499 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:06:33.499 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.2846ms
2025-06-02 14:06:33.499 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:06:33.500 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 4.9814ms
2025-06-02 14:06:35.312 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - null null
2025-06-02 14:06:35.312 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:35.312 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:35.312 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:06:35.312 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:06:35.317 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:06:35.317 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:06:35.317 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.0726ms
2025-06-02 14:06:35.317 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:06:35.317 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/19 - 200 null application/json; charset=utf-8 5.7071ms
2025-06-02 14:06:43.360 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/2 - null null
2025-06-02 14:06:43.360 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:43.360 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/2 - 204 null null 0.2333ms
2025-06-02 14:06:43.362 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/2 - null null
2025-06-02 14:06:43.362 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:43.362 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:43.362 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:06:43.362 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 14:06:43.363 +07:00 [WRN] Message 415 not found in Redis
2025-06-02 14:06:43.363 +07:00 [INF] Retrieved 2 messages from Redis for conversation 51
2025-06-02 14:06:43.364 +07:00 [INF] Retrieved 2 messages from Redis for conversation 51 and user 2
2025-06-02 14:06:43.364 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 14:06:43.364 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 1.986ms
2025-06-02 14:06:43.364 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:06:43.364 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/2 - 200 null application/json; charset=utf-8 2.6281ms
2025-06-02 14:06:43.369 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-06-02 14:06:43.370 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:43.370 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - 204 null null 0.6709ms
2025-06-02 14:06:43.372 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-06-02 14:06:43.372 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:43.372 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:43.373 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:06:43.373 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 14:06:43.383 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 14:06:43.384 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 14:06:43.385 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 11.7355ms
2025-06-02 14:06:43.385 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:06:43.385 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - 200 null application/json; charset=utf-8 12.9419ms
2025-06-02 14:06:43.392 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - null null
2025-06-02 14:06:43.393 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:43.393 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - 204 null null 0.1741ms
2025-06-02 14:06:43.394 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - null null
2025-06-02 14:06:43.394 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:43.394 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:43.394 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:06:43.394 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:06:43.398 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:06:43.400 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:06:43.400 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.7095ms
2025-06-02 14:06:43.400 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:06:43.400 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 6.4592ms
2025-06-02 14:06:45.282 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - null null
2025-06-02 14:06:45.282 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:45.282 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:06:45.282 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:06:45.282 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:06:45.287 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:06:45.289 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:06:45.290 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.4521ms
2025-06-02 14:06:45.290 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:06:45.290 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 8.1291ms
2025-06-02 14:08:48.456 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 14:08:48.456 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:48.456 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2824ms
2025-06-02 14:08:48.457 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-06-02 14:08:48.457 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:48.457 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:48.457 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 14:08:48.457 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 14:08:48.469 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 14:08:48.472 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-06-02 14:08:48.472 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 14.7508ms
2025-06-02 14:08:48.472 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 14:08:48.472 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 400 null application/json; charset=utf-8 15.2998ms
2025-06-02 14:08:52.372 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 58
2025-06-02 14:08:52.372 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:52.372 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:52.373 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 14:08:52.373 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 14:08:52.375 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 14:08:52.376 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 14:08:52.376 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 3.5177ms
2025-06-02 14:08:52.376 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 14:08:52.377 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 4.276ms
2025-06-02 14:08:52.399 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-06-02 14:08:52.399 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:52.399 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:52.400 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 14:08:52.516 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 14:08:52.516 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:52.516 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:52.516 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 14:08:52.516 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 14:08:52.524 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 14:08:52.525 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:08:52.526 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.6668ms
2025-06-02 14:08:52.526 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 14:08:52.526 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 10.3842ms
2025-06-02 14:08:52.595 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 14:08:52.596 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 14:08:52.597 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 14:08:52.665 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 14:08:52.665 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:52.665 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.5033ms
2025-06-02 14:08:52.667 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 14:08:52.667 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:52.667 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:52.667 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 14:08:52.667 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 14:08:52.680 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 14:08:52.694 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 14:08:52.698 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 30.1334ms
2025-06-02 14:08:52.698 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 14:08:52.698 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 31.1004ms
2025-06-02 14:08:55.146 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/2 - null null
2025-06-02 14:08:55.146 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:55.146 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/2 - 204 null null 0.2316ms
2025-06-02 14:08:55.147 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/2 - null null
2025-06-02 14:08:55.147 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:55.147 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:55.148 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:08:55.148 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 14:08:55.150 +07:00 [WRN] Message 0 has invalid data: id=0, conversation_id=53, sender_id=0, created_at="2025-06-01T14:40:02.7083553Z"
2025-06-02 14:08:55.152 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53
2025-06-02 14:08:55.152 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53 and user 2
2025-06-02 14:08:55.152 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 14:08:55.153 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.8186ms
2025-06-02 14:08:55.153 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:08:55.153 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 5.5382ms
2025-06-02 14:08:55.163 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-02 14:08:55.163 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:55.163 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.1952ms
2025-06-02 14:08:55.165 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-02 14:08:55.166 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:55.166 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:55.166 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:08:55.166 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 14:08:55.172 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 14:08:55.175 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 14:08:55.176 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.3191ms
2025-06-02 14:08:55.177 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:08:55.177 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 11.7452ms
2025-06-02 14:08:55.187 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:08:55.187 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:55.187 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2283ms
2025-06-02 14:08:55.188 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:08:55.188 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:55.188 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:55.188 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:08:55.189 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:08:55.192 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:08:55.194 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:08:55.195 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.0694ms
2025-06-02 14:08:55.195 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:08:55.195 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 6.6962ms
2025-06-02 14:08:56.394 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:08:56.395 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:56.395 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:08:56.395 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:08:56.395 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:08:56.398 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:08:56.400 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:08:56.400 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.9073ms
2025-06-02 14:08:56.400 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:08:56.400 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 6.2147ms
2025-06-02 14:09:04.307 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/2 - null null
2025-06-02 14:09:04.307 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:04.307 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/51/2 - 204 null null 0.1783ms
2025-06-02 14:09:04.309 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/2 - null null
2025-06-02 14:09:04.309 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:04.309 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:04.309 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:09:04.309 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 14:09:04.311 +07:00 [WRN] Message 415 not found in Redis
2025-06-02 14:09:04.311 +07:00 [INF] Retrieved 2 messages from Redis for conversation 51
2025-06-02 14:09:04.311 +07:00 [INF] Retrieved 2 messages from Redis for conversation 51 and user 2
2025-06-02 14:09:04.311 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 14:09:04.312 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.0558ms
2025-06-02 14:09:04.312 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:09:04.312 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/51/2 - 200 null application/json; charset=utf-8 2.6397ms
2025-06-02 14:09:04.316 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-06-02 14:09:04.316 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:04.316 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/51 - 204 null null 0.1542ms
2025-06-02 14:09:04.319 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - null null
2025-06-02 14:09:04.320 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:04.320 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:04.320 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:09:04.320 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 14:09:04.323 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 14:09:04.325 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 14:09:04.326 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.7873ms
2025-06-02 14:09:04.326 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:09:04.326 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/51 - 200 null application/json; charset=utf-8 6.8473ms
2025-06-02 14:09:04.333 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - null null
2025-06-02 14:09:04.333 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:04.333 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/51 - 204 null null 0.1556ms
2025-06-02 14:09:04.335 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - null null
2025-06-02 14:09:04.335 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:04.335 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:04.335 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:09:04.335 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:09:04.337 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:09:04.338 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:09:04.338 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.1028ms
2025-06-02 14:09:04.338 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:09:04.338 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 3.688ms
2025-06-02 14:09:05.873 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - null null
2025-06-02 14:09:05.873 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:05.873 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:05.873 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:09:05.873 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:09:05.879 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:09:05.881 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:09:05.881 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.7462ms
2025-06-02 14:09:05.881 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:09:05.881 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/51 - 200 null application/json; charset=utf-8 8.2998ms
2025-06-02 14:09:45.595 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/2 - null null
2025-06-02 14:09:45.595 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:45.596 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/2 - 204 null null 0.2649ms
2025-06-02 14:09:45.597 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/2 - null null
2025-06-02 14:09:45.597 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:45.597 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:45.597 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:09:45.597 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 14:09:45.599 +07:00 [WRN] Message 0 has invalid data: id=0, conversation_id=53, sender_id=0, created_at="2025-06-01T14:40:02.7083553Z"
2025-06-02 14:09:45.601 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53
2025-06-02 14:09:45.601 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53 and user 2
2025-06-02 14:09:45.601 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 14:09:45.602 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.4856ms
2025-06-02 14:09:45.602 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:09:45.603 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 5.7702ms
2025-06-02 14:09:45.609 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-02 14:09:45.610 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:45.610 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.3533ms
2025-06-02 14:09:45.611 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-02 14:09:45.611 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:45.611 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:45.611 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:09:45.611 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 14:09:45.617 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 14:09:45.618 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 14:09:45.619 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.1722ms
2025-06-02 14:09:45.619 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:09:45.619 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 7.6378ms
2025-06-02 14:09:45.627 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:09:45.627 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:45.627 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2476ms
2025-06-02 14:09:45.629 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:09:45.629 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:45.629 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:45.629 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:09:45.629 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:09:45.632 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:09:45.634 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:09:45.634 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.9128ms
2025-06-02 14:09:45.634 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:09:45.634 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 5.3458ms
2025-06-02 14:09:46.817 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:09:46.817 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:46.817 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:09:46.817 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:09:46.817 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:09:46.819 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:09:46.822 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:09:46.822 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.1438ms
2025-06-02 14:09:46.822 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:09:46.822 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 5.6192ms
2025-06-02 14:10:00.881 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 14:10:00.881 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 222461.3508ms
2025-06-02 14:10:00.886 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 14:10:00.886 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 14:10:00.886 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 14:10:00.886 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 14:10:00.887 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 14:10:00.888 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 14:10:00.888 +07:00 [ERR] Connection id "0HND1KEOCDG3T", Request id "0HND1KEOCDG3T:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 14:10:00.888 +07:00 [ERR] Connection id "0HND1KEOCDG3P", Request id "0HND1KEOCDG3P:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 14:10:00.889 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 68489.6738ms
2025-06-02 14:10:00.889 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 227744.6194ms
2025-06-02 14:17:09.973 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-06-02 14:17:09.973 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:09.973 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2512ms
2025-06-02 14:17:09.974 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 58
2025-06-02 14:17:09.974 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:09.974 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:09.974 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 14:17:09.975 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 14:17:09.995 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 14:17:09.996 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 14:17:09.997 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 22.0335ms
2025-06-02 14:17:09.997 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 14:17:09.997 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 22.7433ms
2025-06-02 14:17:10.027 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-06-02 14:17:10.027 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:10.027 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:10.027 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 14:17:10.142 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 14:17:10.142 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:10.142 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:10.142 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 14:17:10.142 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 14:17:10.148 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 14:17:10.150 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:17:10.152 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.9563ms
2025-06-02 14:17:10.153 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 14:17:10.153 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 10.5988ms
2025-06-02 14:17:10.288 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 14:17:10.289 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 14:17:10.289 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 14:17:10.290 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 14:17:10.291 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 14:17:10.291 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 14:17:10.291 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 14:17:10.292 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 14:17:10.292 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 14:17:10.292 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 14:17:10.292 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 14:17:10.292 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 14:17:10.292 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 14:17:10.292 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 14:17:10.292 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 14:17:10.292 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 14:17:10.292 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 14:17:10.292 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 14:17:10.292 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 14:17:10.292 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 14:17:10.293 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 14:17:10.293 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 14:17:10.293 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 14:17:10.293 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 14:17:10.293 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 14:17:10.293 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 14:17:10.293 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 14:17:10.293 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 14:17:10.293 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 14:17:10.293 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 14:17:10.293 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 14:17:10.293 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 14:17:10.375 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 14:17:10.375 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:10.375 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 0.6097ms
2025-06-02 14:17:10.377 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 14:17:10.377 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:10.377 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:10.378 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 14:17:10.378 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 14:17:10.394 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 14:17:10.415 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 14:17:10.417 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 39.5195ms
2025-06-02 14:17:10.417 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 14:17:10.418 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 40.3936ms
2025-06-02 14:17:13.417 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/2 - null null
2025-06-02 14:17:13.417 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:13.417 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/2 - 204 null null 0.1812ms
2025-06-02 14:17:13.418 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/2 - null null
2025-06-02 14:17:13.418 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:13.418 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:13.418 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:17:13.419 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 14:17:13.420 +07:00 [WRN] Message 0 has invalid data: id=0, conversation_id=53, sender_id=0, created_at="2025-06-01T14:40:02.7083553Z"
2025-06-02 14:17:13.425 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53
2025-06-02 14:17:13.425 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53 and user 2
2025-06-02 14:17:13.425 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 14:17:13.425 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 6.0406ms
2025-06-02 14:17:13.425 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 14:17:13.425 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 6.9977ms
2025-06-02 14:17:13.434 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-02 14:17:13.434 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:13.434 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.1877ms
2025-06-02 14:17:13.436 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-02 14:17:13.436 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:13.436 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:13.436 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:17:13.436 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 14:17:13.446 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 14:17:13.448 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 14:17:13.449 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 12.1742ms
2025-06-02 14:17:13.449 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 14:17:13.449 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 13.3817ms
2025-06-02 14:17:13.457 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:17:13.457 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:13.457 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.302ms
2025-06-02 14:17:13.460 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:17:13.460 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:13.460 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:13.460 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:17:13.460 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:17:13.464 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:17:13.466 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:17:13.467 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.4506ms
2025-06-02 14:17:13.467 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:17:13.467 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 7.154ms
2025-06-02 14:17:14.864 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-06-02 14:17:14.864 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:14.864 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:14.864 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:17:14.864 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 14:17:14.870 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 14:17:14.873 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:17:14.874 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.5804ms
2025-06-02 14:17:14.874 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 14:17:14.874 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 10.0673ms
2025-06-02 14:17:38.965 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 14:17:38.965 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:38.965 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:17:38.965 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 14:17:38.965 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 14:17:38.974 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 14:17:38.976 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 14:17:38.976 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.9989ms
2025-06-02 14:17:38.976 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 14:17:38.977 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 11.5399ms
2025-06-02 14:18:59.189 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-02 14:18:59.296 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-02 14:18:59.387 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-02 14:18:59.394 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-02 14:18:59.395 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-02 14:18:59.395 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-02 14:18:59.395 +07:00 [INF] Hosting environment: Development
2025-06-02 14:18:59.395 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-02 14:19:07.601 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-02 14:19:07.714 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-02 14:19:07.752 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-02 14:19:07.760 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-02 14:19:07.761 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-02 14:19:07.761 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-02 14:19:07.761 +07:00 [INF] Hosting environment: Development
2025-06-02 14:19:07.761 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-02 14:19:11.254 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-06-02 14:19:11.272 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:19:11.288 +07:00 [INF] CORS policy execution successful.
2025-06-02 14:19:11.289 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-02 14:19:11.309 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 14:21:15.623 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 14:21:15.633 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 124377.6524ms
2025-06-02 14:22:09.869 +07:00 [INF] Application is shutting down...
2025-06-02 14:22:57.910 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-06-02 14:22:57.975 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-06-02 14:22:57.981 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-06-02 14:22:57.984 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-06-02 14:22:58.012 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-06-02 14:22:58.026 +07:00 [INF] Applying migration '20250510004939_UpdateStoryReactionForeignKeys'.
2025-06-02 14:22:58.139 +07:00 [ERR] Failed executing DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    [lastMessageTime] datetime2 NULL,
    [lastMessage] nvarchar(max) NULL,
    [lastMessageSender] nvarchar(max) NULL,
    [img_url] nvarchar(max) NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-06-02 14:27:40.192 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-06-02 14:27:40.247 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-06-02 14:27:40.251 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-06-02 14:27:40.254 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-06-02 14:27:40.275 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-06-02 14:27:40.287 +07:00 [INF] Applying migration '20250510004939_UpdateStoryReactionForeignKeys'.
2025-06-02 14:27:40.350 +07:00 [ERR] Failed executing DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    [lastMessageTime] datetime2 NULL,
    [lastMessage] nvarchar(max) NULL,
    [lastMessageSender] nvarchar(max) NULL,
    [img_url] nvarchar(max) NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-06-02 14:29:44.657 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-06-02 14:29:44.701 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-06-02 14:29:44.706 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-06-02 14:29:44.709 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-06-02 14:29:44.721 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-06-02 14:29:44.732 +07:00 [INF] Applying migration '20250510004939_UpdateStoryReactionForeignKeys'.
2025-06-02 14:29:44.801 +07:00 [ERR] Failed executing DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    [lastMessageTime] datetime2 NULL,
    [lastMessage] nvarchar(max) NULL,
    [lastMessageSender] nvarchar(max) NULL,
    [img_url] nvarchar(max) NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-06-02 14:30:36.239 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-06-02 14:30:36.308 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-06-02 14:30:36.323 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-06-02 14:31:37.704 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-06-02 14:31:37.747 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-06-02 14:31:37.752 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-06-02 14:31:37.753 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-06-02 14:31:37.765 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-06-02 14:31:37.776 +07:00 [INF] Applying migration '20250602072243_updateGroupSetting'.
2025-06-02 14:31:37.925 +07:00 [INF] Executed DbCommand (129ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var0 sysname;
SELECT @var0 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[GroupSettings]') AND [c].[name] = N'ImageUrl');
IF @var0 IS NOT NULL EXEC(N'ALTER TABLE [GroupSettings] DROP CONSTRAINT [' + @var0 + '];');
ALTER TABLE [GroupSettings] DROP COLUMN [ImageUrl];
2025-06-02 14:31:37.953 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var1 sysname;
SELECT @var1 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[GroupSettings]') AND [c].[name] = N'IsActive');
IF @var1 IS NOT NULL EXEC(N'ALTER TABLE [GroupSettings] DROP CONSTRAINT [' + @var1 + '];');
ALTER TABLE [GroupSettings] DROP COLUMN [IsActive];
2025-06-02 14:31:37.982 +07:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var2 sysname;
SELECT @var2 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[GroupSettings]') AND [c].[name] = N'Privacy');
IF @var2 IS NOT NULL EXEC(N'ALTER TABLE [GroupSettings] DROP CONSTRAINT [' + @var2 + '];');
ALTER TABLE [GroupSettings] DROP COLUMN [Privacy];
2025-06-02 14:31:37.990 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250602072243_updateGroupSetting', N'8.0.4');
2025-06-02 15:01:00.104 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-02 15:01:00.385 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-02 15:01:00.465 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-02 15:01:00.472 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-02 15:01:00.472 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-02 15:01:00.472 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-02 15:01:00.473 +07:00 [INF] Hosting environment: Development
2025-06-02 15:01:00.473 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-02 15:01:42.275 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 15:01:42.308 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-02 15:01:42.330 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 15:01:42.346 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 15:01:42.443 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 15:01:42.512 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 15:01:42.546 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 196.95ms
2025-06-02 15:01:42.546 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 15:01:42.550 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 276.6703ms
2025-06-02 15:01:43.346 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 15:01:43.357 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 15:01:43.777 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 15:01:43.780 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 15:01:43.783 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 15:01:43.836 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 15:01:43.846 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 15:01:43.847 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 15:01:43.847 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 15:01:43.848 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 15:01:43.848 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 15:01:43.849 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 15:01:43.849 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 15:01:43.850 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 15:01:43.850 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 15:01:43.851 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 15:01:43.851 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 15:01:43.852 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 15:01:43.852 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 15:01:43.853 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 15:01:43.853 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 15:01:43.853 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 15:01:43.854 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 15:01:43.854 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 15:01:43.854 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 15:01:43.855 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 15:01:43.855 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 15:01:43.856 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 15:01:43.856 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 15:01:43.857 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 15:01:43.857 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 15:01:43.858 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 15:01:43.859 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 15:01:43.860 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 15:01:43.860 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 15:01:43.861 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 15:01:43.862 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 15:01:43.864 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 15:01:43.868 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 15:01:43.879 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 95.0301ms
2025-06-02 15:01:43.879 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 15:01:43.879 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 102.1632ms
2025-06-02 15:01:44.493 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 15:01:44.493 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 15:01:44.498 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 15:01:44.552 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 15:01:44.576 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 15:01:44.615 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 117.3655ms
2025-06-02 15:01:44.615 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 15:01:44.615 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 122.4382ms
2025-06-02 15:01:49.226 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/53/2 - null null
2025-06-02 15:01:49.227 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 15:01:49.231 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 15:01:49.267 +07:00 [WRN] Message 0 has invalid data: id=0, conversation_id=53, sender_id=0, created_at="2025-06-01T14:40:02.7083553Z"
2025-06-02 15:01:49.273 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53
2025-06-02 15:01:49.275 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53 and user 2
2025-06-02 15:01:49.275 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 15:01:49.281 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 49.9999ms
2025-06-02 15:01:49.282 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 15:01:49.282 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 55.1646ms
2025-06-02 15:01:49.413 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-02 15:01:49.416 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 15:01:49.419 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 15:01:49.453 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 15:01:49.484 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 15:01:49.488 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 68.6816ms
2025-06-02 15:01:49.488 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 15:01:49.488 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 74.7482ms
2025-06-02 15:01:49.531 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/53 - null null
2025-06-02 15:01:49.532 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 15:01:49.534 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 15:01:49.548 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 15:01:49.552 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 15:01:49.554 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 19.4545ms
2025-06-02 15:01:49.554 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 15:01:49.554 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 23.0863ms
2025-06-02 15:01:51.739 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/53 - null null
2025-06-02 15:01:51.740 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 15:01:51.740 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 15:01:51.746 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 15:01:51.747 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 15:01:51.748 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.8472ms
2025-06-02 15:01:51.749 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 15:01:51.749 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 10.3845ms
2025-06-02 15:07:49.926 +07:00 [INF] Application is shutting down...
2025-06-02 15:08:19.938 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 15:08:19.939 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - 101 null null 396592.6655ms
2025-06-02 15:08:41.645 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-06-02 15:08:41.684 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-06-02 15:08:41.699 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-06-02 15:10:20.482 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-06-02 15:10:20.525 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-06-02 15:10:20.530 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-06-02 15:10:20.532 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-06-02 15:10:20.543 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-06-02 15:10:20.575 +07:00 [INF] Applying migration '20250602080821_updateGroupSetting_addAllowMemberRemove'.
2025-06-02 15:10:20.620 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [GroupSettings] ADD [AllowMemberRemove] bit NOT NULL DEFAULT CAST(0 AS bit);
2025-06-02 15:10:20.625 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250602080821_updateGroupSetting_addAllowMemberRemove', N'8.0.4');
2025-06-02 15:28:18.830 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-02 15:28:18.963 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-02 15:28:19.029 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-02 15:28:19.045 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-02 15:28:19.046 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-02 15:28:19.047 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-02 15:28:19.047 +07:00 [INF] Hosting environment: Development
2025-06-02 15:28:19.047 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-02 15:28:22.722 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 15:28:22.757 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-02 15:28:22.789 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 15:34:57.879 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/53 - null null
2025-06-02 15:34:57.881 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/53 - null null
2025-06-02 15:34:57.883 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 15:34:57.887 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/53 - 404 0 null 5.7156ms
2025-06-02 15:34:57.889 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://192.168.1.2:5053/api/GroupSetting/53, Response status code: 404
2025-06-02 15:34:57.899 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 15:34:57.975 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 15:34:58.013 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting - application/json 109
2025-06-02 15:34:58.017 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting - 404 0 null 3.9561ms
2025-06-02 15:34:58.017 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://192.168.1.2:5053/api/GroupSetting, Response status code: 404
2025-06-02 15:34:58.019 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 15:34:58.080 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 178.6164ms
2025-06-02 15:34:58.081 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 15:34:58.083 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 204.2805ms
2025-06-02 15:36:04.835 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/53 - null null
2025-06-02 15:36:04.838 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 15:36:04.839 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 15:36:04.846 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/53 - null null
2025-06-02 15:36:04.852 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/53 - 404 0 null 4.7778ms
2025-06-02 15:36:04.852 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://192.168.1.2:5053/api/GroupSetting/53, Response status code: 404
2025-06-02 15:36:04.927 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting - application/json 109
2025-06-02 15:36:04.928 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting - 404 0 null 0.5391ms
2025-06-02 15:36:04.928 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://192.168.1.2:5053/api/GroupSetting, Response status code: 404
2025-06-02 15:36:04.933 +07:00 [INF] Connection id "0HND1LTO04977", Request id "0HND1LTO04977:00000002": the application completed without reading the entire request body.
2025-06-02 15:36:04.976 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 15:36:04.983 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 15:36:04.984 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 144.5808ms
2025-06-02 15:36:04.984 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 15:36:04.984 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 149.8774ms
2025-06-02 15:37:08.523 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 15:37:08.525 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 15:37:08.586 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 15:37:08.589 +07:00 [ERR] Connection id "0HND1LTO04973", Request id "0HND1LTO04973:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 15:37:08.599 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - 101 null null 525878.0103ms
2025-06-02 15:43:14.985 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 15:43:14.991 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 15:43:15.007 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 15:43:15.110 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 15:43:15.226 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 15:43:15.239 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 231.4103ms
2025-06-02 15:43:15.240 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 15:43:15.240 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 255.851ms
2025-06-02 15:43:16.013 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 15:43:16.014 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 15:43:16.446 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 15:43:16.446 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 15:43:16.454 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 15:43:16.486 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 15:43:16.510 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 15:43:16.519 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 15:43:16.521 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 15:43:16.523 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 15:43:16.524 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 15:43:16.526 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 15:43:16.527 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 15:43:16.535 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 15:43:16.535 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 15:43:16.536 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 15:43:16.537 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 15:43:16.537 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 15:43:16.538 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 15:43:16.540 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 15:43:16.541 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 15:43:16.542 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 15:43:16.543 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 15:43:16.543 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 15:43:16.543 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 15:43:16.543 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 15:43:16.544 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 15:43:16.545 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 15:43:16.545 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 15:43:16.549 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 15:43:16.551 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 15:43:16.553 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 15:43:16.554 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 15:43:16.555 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 15:43:16.556 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 15:43:16.557 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 15:43:16.558 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 15:43:16.583 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 15:43:16.588 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 15:43:16.594 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 139.3702ms
2025-06-02 15:43:16.594 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 15:43:16.594 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 148.0972ms
2025-06-02 15:43:16.610 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 15:43:16.611 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 15:43:16.621 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 15:43:16.725 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 15:43:16.771 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 15:43:16.808 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 187.1015ms
2025-06-02 15:43:16.808 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 15:43:16.809 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 198.2631ms
2025-06-02 15:43:20.094 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/53/2 - null null
2025-06-02 15:43:20.095 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 15:43:20.104 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 15:43:20.208 +07:00 [WRN] Message 0 has invalid data: id=0, conversation_id=53, sender_id=0, created_at="2025-06-01T14:40:02.7083553Z"
2025-06-02 15:43:20.222 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53
2025-06-02 15:43:20.232 +07:00 [INF] Retrieved 16 messages from Redis for conversation 53 and user 2
2025-06-02 15:43:20.233 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 15:43:20.255 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 150.4168ms
2025-06-02 15:43:20.255 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 15:43:20.255 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 161.1896ms
2025-06-02 15:43:20.324 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/53 - null null
2025-06-02 15:43:20.329 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 15:43:20.334 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 15:43:20.410 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 15:43:20.485 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 15:43:20.489 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 155.279ms
2025-06-02 15:43:20.489 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 15:43:20.490 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 165.4714ms
2025-06-02 15:43:20.548 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/53 - null null
2025-06-02 15:43:20.549 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 15:43:20.549 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 15:43:20.555 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 15:43:20.559 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 15:43:20.560 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 10.6249ms
2025-06-02 15:43:20.560 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 15:43:20.560 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 12.2494ms
2025-06-02 15:43:22.211 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/53 - null null
2025-06-02 15:43:22.211 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 15:43:22.211 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 15:43:22.213 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 15:43:22.214 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/53 - null null
2025-06-02 15:43:22.215 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/GroupSetting/53 - 404 0 null 0.5892ms
2025-06-02 15:43:22.216 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://192.168.1.2:5053/api/GroupSetting/53, Response status code: 404
2025-06-02 15:43:22.217 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 15:43:22.218 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.6055ms
2025-06-02 15:43:22.219 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 15:43:22.219 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 7.8871ms
2025-06-02 15:43:22.267 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting - application/json 109
2025-06-02 15:43:22.267 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting - 404 0 null 0.5717ms
2025-06-02 15:43:22.268 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://192.168.1.2:5053/api/GroupSetting, Response status code: 404
2025-06-02 15:44:24.811 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 54
2025-06-02 15:44:24.812 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 15:44:24.820 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 15:44:25.046 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 15:44:25.096 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:44:25.103 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:44:25.105 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:44:25.107 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:44:25.109 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:44:25.256 +07:00 [INF] Executed DbCommand (58ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32), @p24='?' (Size = 4000), @p25='?' (DbType = Int32), @p26='?' (Size = 4000), @p27='?' (DbType = Boolean), @p28='?' (DbType = DateTime2), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2),
(@p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, 3)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 15:44:25.262 +07:00 [WRN] Client 6 not found
2025-06-02 15:44:25.262 +07:00 [WRN] Client 3 not found
2025-06-02 15:44:25.262 +07:00 [WRN] Client 5 not found
2025-06-02 15:44:25.264 +07:00 [INF] User 2 subscribed to channel conversation:54
2025-06-02 15:44:25.274 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 15:44:25.299 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 15:44:25.299 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 479.0817ms
2025-06-02 15:44:25.299 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 15:44:25.299 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 488.2577ms
2025-06-02 15:44:25.868 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting - application/json 109
2025-06-02 15:44:25.869 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting - 404 0 null 0.5098ms
2025-06-02 15:44:25.869 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://192.168.1.2:5053/api/GroupSetting, Response status code: 404
2025-06-02 15:44:26.049 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/54 - null null
2025-06-02 15:44:26.050 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 15:44:26.053 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 15:44:26.098 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 15:44:26.127 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 15:44:26.127 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 74.4224ms
2025-06-02 15:44:26.128 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 15:44:26.128 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/54 - 200 null application/json; charset=utf-8 78.7687ms
2025-06-02 15:46:05.087 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 52
2025-06-02 15:46:05.088 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 15:46:05.088 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 15:46:05.102 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 15:46:05.107 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:46:05.111 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:46:05.113 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:46:05.116 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:46:05.123 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 15:46:05.158 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32), @p24='?' (Size = 4000), @p25='?' (DbType = Int32), @p26='?' (Size = 4000), @p27='?' (DbType = Boolean), @p28='?' (DbType = DateTime2), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2),
(@p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, 3)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 15:46:05.160 +07:00 [WRN] Client 6 not found
2025-06-02 15:46:05.160 +07:00 [WRN] Client 3 not found
2025-06-02 15:46:05.160 +07:00 [WRN] Client 5 not found
2025-06-02 15:46:05.161 +07:00 [INF] User 2 subscribed to channel conversation:55
2025-06-02 15:46:05.163 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 15:46:05.166 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 15:46:05.167 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 79.046ms
2025-06-02 15:46:05.168 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 15:46:05.168 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 80.6916ms
2025-06-02 15:46:05.442 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/55 - null null
2025-06-02 15:46:05.442 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 15:46:05.442 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 15:46:05.454 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 15:46:05.462 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 15:46:05.463 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 20.07ms
2025-06-02 15:46:05.463 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 15:46:05.463 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/55 - 200 null application/json; charset=utf-8 21.0476ms
2025-06-02 15:54:31.969 +07:00 [INF] Application is shutting down...
2025-06-02 15:55:01.990 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 15:55:01.990 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - 101 null null 705977.4494ms
