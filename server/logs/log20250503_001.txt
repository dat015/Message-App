2025-05-03 22:28:15.202 +07:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-03 22:28:15.385 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-03 22:28:15.452 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-03 22:28:15.463 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-03 22:28:15.464 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-03 22:28:15.465 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-03 22:28:15.465 +07:00 [INF] Hosting environment: Development
2025-05-03 22:28:15.466 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-03 22:28:38.398 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:28:38.427 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:28:38.447 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:28:38.449 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-03 22:28:38.474 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:28:38.502 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:28:38.507 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:28:38.509 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:28:38.511 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:28:38.594 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:28:38.594 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:28:38.597 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 22:28:38.602 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 22:28:38.602 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:28:38.605 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:28:38.690 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:28:38.690 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:29:16.437 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-03 22:29:16.441 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:29:16.445 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 5.9577ms
2025-05-03 22:29:16.450 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 53
2025-05-03 22:29:16.455 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:29:16.457 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:29:16.459 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:29:16.479 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 22:29:16.556 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 22:29:16.644 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 22:29:16.685 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 201.3808ms
2025-05-03 22:29:16.688 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:29:16.693 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 242.6209ms
2025-05-03 22:29:16.864 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:29:16.864 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:29:16.869 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:29:16.871 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:29:16.873 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 8.8324ms
2025-05-03 22:29:16.879 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 14.9355ms
2025-05-03 22:29:16.880 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:29:16.885 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:29:16.887 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:29:16.890 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:29:16.896 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:29:16.939 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:29:16.948 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 49.3749ms
2025-05-03 22:29:16.949 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:29:16.951 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:29:16.953 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:29:16.954 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 74.5426ms
2025-05-03 22:29:16.956 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:29:16.959 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:29:16.960 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:29:16.966 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:29:16.968 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 5.3682ms
2025-05-03 22:29:16.969 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:29:16.971 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 21.4872ms
2025-05-03 22:29:17.008 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:29:17.011 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:29:17.012 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:29:17.013 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:29:17.088 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:30:02.736 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:30:02.736 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:30:02.740 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (1275068543): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 22:30:02.740 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 22:30:02.777 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 22:30:02.780 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 22:30:02.782 +07:00 [ERR] Connection id "0HNCAASML6TNR", Request id "0HNCAASML6TNR:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 22:30:02.782 +07:00 [ERR] Connection id "0HNCAASML6TNQ", Request id "0HNCAASML6TNQ:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (1275068543): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 22:30:02.792 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 84189.5709ms
2025-05-03 22:30:02.797 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 84199.8556ms
2025-05-03 22:30:46.513 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - application/json 57
2025-05-03 22:30:46.520 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:30:46.524 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 22:30:46.555 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 22:30:46.567 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 22:30:46.570 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 42.7881ms
2025-05-03 22:30:46.573 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:30:46.574 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - 200 null application/json; charset=utf-8 60.8049ms
2025-05-03 22:30:47.669 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 22:30:47.670 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 22:30:47.672 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:30:47.674 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:30:47.675 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:30:47.676 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:30:47.683 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:30:47.683 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:30:47.684 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.7523ms
2025-05-03 22:30:47.685 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 6.7771ms
2025-05-03 22:30:47.687 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:30:47.689 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:30:47.690 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 19.6752ms
2025-05-03 22:30:47.691 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 22.4926ms
2025-05-03 22:30:48.103 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 22:30:48.107 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:30:48.180 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:30:49.109 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - null null
2025-05-03 22:30:49.111 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:30:49.117 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 22:30:49.159 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 22:30:49.161 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 22:30:49.162 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 22:30:49.162 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 22:30:49.164 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 22:30:49.164 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 22:30:49.165 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 22:30:49.166 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 22:30:49.167 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 22:30:49.168 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 22:30:49.170 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 22:30:49.171 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 22:30:49.172 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 22:30:49.174 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 22:30:49.178 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 22:30:49.182 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 22:30:49.184 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 22:30:49.184 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 22:30:49.185 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 22:30:49.187 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 22:30:49.190 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 22:30:49.194 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 22:30:49.195 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 22:30:49.197 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 22:30:49.198 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 22:30:49.199 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 22:30:49.201 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 22:30:49.202 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 22:30:49.203 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 22:30:49.204 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 22:30:49.206 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 22:30:49.208 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 22:30:49.209 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 22:30:49.211 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 22:30:49.213 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 2
2025-05-03 22:30:49.214 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:30:49.218 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 98.9247ms
2025-05-03 22:30:49.219 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:30:49.220 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - 200 null application/json; charset=utf-8 111.8591ms
2025-05-03 22:30:49.311 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:30:49.316 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:30:49.321 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:30:49.367 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 22:30:49.388 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 22:30:49.392 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 68.316ms
2025-05-03 22:30:49.394 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:30:49.395 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 84.7208ms
2025-05-03 22:30:49.413 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:30:49.416 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:30:49.421 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 22:30:49.438 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 22:30:49.463 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 22:30:49.477 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 52.4643ms
2025-05-03 22:30:49.480 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:30:49.481 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 67.7127ms
2025-05-03 22:30:50.962 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 22:30:50.965 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:30:50.965 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - 204 null null 3.5374ms
2025-05-03 22:30:50.970 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 22:30:50.975 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:30:50.978 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:30:50.979 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:30:50.980 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 22:30:50.993 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 22:30:50.995 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 22:30:50.996 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 22:30:50.997 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 22:30:50.998 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 22:30:51.000 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 22:30:51.001 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 22:30:51.002 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 22:30:51.004 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 22:30:51.007 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 22:30:51.009 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 22:30:51.012 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 22:30:51.013 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 22:30:51.014 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 22:30:51.015 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 22:30:51.017 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 22:30:51.018 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 22:30:51.019 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 22:30:51.020 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 22:30:51.022 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 22:30:51.024 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 22:30:51.025 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 22:30:51.026 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 22:30:51.027 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 22:30:51.029 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 22:30:51.030 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 22:30:51.031 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 22:30:51.032 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 22:30:51.033 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 22:30:51.035 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 22:30:51.036 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 22:30:51.038 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 22:30:51.040 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 22:30:51.041 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 22:30:51.042 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 5
2025-05-03 22:30:51.043 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:30:51.045 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 63.5485ms
2025-05-03 22:30:51.046 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:30:51.048 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - 200 null application/json; charset=utf-8 77.542ms
2025-05-03 22:30:51.069 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:30:51.075 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:30:51.077 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 7.9023ms
2025-05-03 22:30:51.084 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:30:51.088 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:30:51.090 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:30:51.091 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:30:51.093 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:30:51.099 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 22:30:51.102 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 22:30:51.104 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.0955ms
2025-05-03 22:30:51.105 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:30:51.106 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 22.3393ms
2025-05-03 22:30:51.120 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:30:51.124 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:30:51.125 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 4.0714ms
2025-05-03 22:30:51.128 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:30:51.131 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:30:51.133 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:30:51.134 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:30:51.135 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 22:30:51.139 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 22:30:51.141 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 22:30:51.143 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.6794ms
2025-05-03 22:30:51.145 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:30:51.146 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 18.08ms
2025-05-03 22:31:02.823 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:31:02.826 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:31:02.827 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:31:02.828 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:31:02.875 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:31:16.507 +07:00 [INF] Application is shutting down...
2025-05-03 22:31:46.529 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:31:46.529 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:31:46.529 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:31:46.530 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:31:46.530 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:31:46.533 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 188136.7801ms
2025-05-03 22:31:46.534 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 58431.0444ms
2025-05-03 22:31:46.534 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 149526.4311ms
2025-05-03 22:31:46.535 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 43711.6587ms
2025-05-03 22:31:46.535 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 188033.4467ms
2025-05-03 22:31:55.997 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-03 22:31:56.122 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-03 22:31:56.161 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-03 22:31:56.171 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-03 22:31:56.173 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-03 22:31:56.174 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-03 22:31:56.175 +07:00 [INF] Hosting environment: Development
2025-05-03 22:31:56.176 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-03 22:31:56.196 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:31:56.196 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:31:56.218 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:31:56.218 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:31:56.230 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:31:56.230 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:31:56.232 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-03 22:31:56.251 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:31:56.251 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:31:56.355 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:31:56.355 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:31:58.914 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:31:58.921 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:31:58.925 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:31:58.930 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:31:58.982 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:31:59.132 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 22:31:59.135 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:31:59.167 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:32:00.989 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:32:00.996 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:32:00.998 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:32:00.999 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:32:01.014 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:32:16.910 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:32:16.910 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:32:16.910 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:32:16.910 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:32:16.913 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 20718.8137ms
2025-05-03 22:32:16.913 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 17998.8026ms
2025-05-03 22:32:16.914 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 15925.4789ms
2025-05-03 22:32:16.916 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 20721.8ms
2025-05-03 22:34:16.674 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-03 22:34:16.677 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:16.682 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 7.7053ms
2025-05-03 22:34:16.687 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 53
2025-05-03 22:34:16.689 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:16.691 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:16.692 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:34:16.723 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 22:34:16.814 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 22:34:16.936 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 22:34:16.986 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 257.098ms
2025-05-03 22:34:16.989 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:34:16.994 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 306.9679ms
2025-05-03 22:34:17.195 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:34:17.196 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:34:17.223 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:17.198 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:17.228 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 33.2906ms
2025-05-03 22:34:17.225 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 29.8477ms
2025-05-03 22:34:17.234 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:34:17.239 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:17.243 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:17.245 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:34:17.253 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:34:17.273 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:34:17.280 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 24.8541ms
2025-05-03 22:34:17.281 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:34:17.281 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:34:17.284 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:17.285 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 50.9401ms
2025-05-03 22:34:17.287 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:17.289 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:34:17.291 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:34:17.295 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:34:17.296 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:34:17.297 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 4.1744ms
2025-05-03 22:34:17.300 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:17.301 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:34:17.302 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:17.303 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 21.2556ms
2025-05-03 22:34:17.303 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:34:17.404 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:34:21.842 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 22:34:21.845 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:21.846 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - 204 null null 3.8658ms
2025-05-03 22:34:21.848 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 22:34:21.850 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:21.851 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:21.852 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:34:21.857 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 22:34:21.903 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 22:34:21.904 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 22:34:21.905 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 22:34:21.907 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 22:34:21.908 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 22:34:21.911 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 22:34:21.914 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 22:34:21.917 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 22:34:21.919 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 22:34:21.920 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 22:34:21.921 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 22:34:21.922 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 22:34:21.924 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 22:34:21.925 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 22:34:21.927 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 22:34:21.928 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 22:34:21.931 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 22:34:21.932 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 22:34:21.934 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 22:34:21.935 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 22:34:21.936 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 22:34:21.937 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 22:34:21.939 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 22:34:21.940 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 22:34:21.941 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 22:34:21.942 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 22:34:21.944 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 22:34:21.945 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 22:34:21.947 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 22:34:21.948 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 22:34:21.950 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 22:34:21.951 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 22:34:21.952 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 22:34:21.953 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 22:34:21.956 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 5
2025-05-03 22:34:21.958 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:34:21.963 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 104.6252ms
2025-05-03 22:34:21.965 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:34:21.966 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - 200 null application/json; charset=utf-8 118.332ms
2025-05-03 22:34:21.983 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:34:21.986 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:21.988 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 5.0951ms
2025-05-03 22:34:21.992 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:34:21.996 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:21.999 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:22.000 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:34:22.005 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:34:22.050 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 22:34:22.069 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 22:34:22.074 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 67.2636ms
2025-05-03 22:34:22.076 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:34:22.077 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 85.2822ms
2025-05-03 22:34:22.094 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:34:22.098 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:22.100 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 5.3477ms
2025-05-03 22:34:22.102 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:34:22.103 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:22.104 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:22.105 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:34:22.108 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 22:34:22.122 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 22:34:22.137 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 22:34:22.149 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 38.0423ms
2025-05-03 22:34:22.151 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:34:22.153 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 51.0167ms
2025-05-03 22:34:28.040 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:34:28.046 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:28.048 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:34:28.050 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:34:28.057 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:35:03.665 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:35:03.667 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 22:35:03.693 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 22:35:03.697 +07:00 [ERR] Connection id "0HNCAAUHJJSKR", Request id "0HNCAAUHJJSKR:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 22:35:03.707 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 184575.0787ms
2025-05-03 22:35:21.052 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:35:21.052 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:35:21.054 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 63757.4675ms
2025-05-03 22:35:21.055 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 53014.8616ms
2025-05-03 22:37:59.791 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - application/json 57
2025-05-03 22:37:59.795 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:37:59.797 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 22:37:59.835 +07:00 [INF] Executed DbCommand (26ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 22:37:59.839 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 22:37:59.841 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 41.1793ms
2025-05-03 22:37:59.842 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:37:59.843 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - 200 null application/json; charset=utf-8 51.7957ms
2025-05-03 22:38:00.973 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 22:38:00.975 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 22:38:00.987 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:38:00.994 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:38:01.032 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:38:01.020 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:38:01.051 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:38:01.059 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:38:01.077 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 34.6304ms
2025-05-03 22:38:01.081 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 26.6899ms
2025-05-03 22:38:01.086 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:38:01.090 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:38:01.091 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 116.3236ms
2025-05-03 22:38:01.096 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 123.09ms
2025-05-03 22:38:01.188 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 22:38:01.192 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:38:01.570 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:38:17.969 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-03 22:38:17.973 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:17.976 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 7.0658ms
2025-05-03 22:38:17.980 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 53
2025-05-03 22:38:17.982 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:17.984 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:17.986 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:38:17.987 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 22:38:18.001 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 22:38:18.004 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 22:38:18.007 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 18.3792ms
2025-05-03 22:38:18.009 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:38:18.010 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 29.9389ms
2025-05-03 22:38:18.220 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:38:18.222 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:38:18.246 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:18.255 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:18.257 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 36.5493ms
2025-05-03 22:38:18.258 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 35.554ms
2025-05-03 22:38:18.262 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:38:18.273 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:18.274 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:18.275 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:38:18.277 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:38:18.280 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:38:18.283 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.7003ms
2025-05-03 22:38:18.284 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:38:18.285 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:38:18.288 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:18.289 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 26.9976ms
2025-05-03 22:38:18.290 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:18.294 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:38:18.296 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:38:18.300 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:38:18.302 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 4.2929ms
2025-05-03 22:38:18.304 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:38:18.306 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 21.7416ms
2025-05-03 22:38:18.466 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:38:18.468 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:18.469 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:18.470 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:38:18.553 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:38:22.200 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 22:38:22.203 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:22.204 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - 204 null null 3.7721ms
2025-05-03 22:38:22.207 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 22:38:22.211 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:22.214 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:22.215 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:38:22.216 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 22:38:22.231 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 22:38:22.232 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 22:38:22.234 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 22:38:22.236 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 22:38:22.237 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 22:38:22.239 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 22:38:22.241 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 22:38:22.242 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 22:38:22.245 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 22:38:22.247 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 22:38:22.248 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 22:38:22.250 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 22:38:22.253 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 22:38:22.255 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 22:38:22.256 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 22:38:22.257 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 22:38:22.258 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 22:38:22.259 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 22:38:22.261 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 22:38:22.262 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 22:38:22.263 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 22:38:22.264 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 22:38:22.265 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 22:38:22.267 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 22:38:22.269 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 22:38:22.270 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 22:38:22.272 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 22:38:22.273 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 22:38:22.275 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 22:38:22.276 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 22:38:22.277 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 22:38:22.278 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 22:38:22.280 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 22:38:22.281 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 22:38:22.283 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 5
2025-05-03 22:38:22.285 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:38:22.287 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 68.3598ms
2025-05-03 22:38:22.288 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:38:22.289 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - 200 null application/json; charset=utf-8 81.9692ms
2025-05-03 22:38:22.307 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:38:22.310 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:22.310 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 3.1999ms
2025-05-03 22:38:22.313 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:38:22.315 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:22.315 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:22.317 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:38:22.318 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:38:22.336 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 22:38:22.341 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 22:38:22.342 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 22.2588ms
2025-05-03 22:38:22.343 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:38:22.343 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 30.468ms
2025-05-03 22:38:22.358 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:38:22.361 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:22.362 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 3.5919ms
2025-05-03 22:38:22.365 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:38:22.369 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:22.373 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:22.374 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:38:22.375 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 22:38:22.385 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 22:38:22.395 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 22:38:22.399 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 22.6016ms
2025-05-03 22:38:22.406 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:38:22.411 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 45.2714ms
2025-05-03 22:38:22.991 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - null null
2025-05-03 22:38:22.993 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:38:22.994 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 22:38:23.007 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 22:38:23.009 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 22:38:23.010 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 22:38:23.011 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 22:38:23.013 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 22:38:23.014 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 22:38:23.015 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 22:38:23.017 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 22:38:23.019 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 22:38:23.020 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 22:38:23.022 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 22:38:23.023 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 22:38:23.024 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 22:38:23.026 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 22:38:23.027 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 22:38:23.028 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 22:38:23.029 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 22:38:23.031 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 22:38:23.032 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 22:38:23.035 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 22:38:23.036 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 22:38:23.038 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 22:38:23.039 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 22:38:23.041 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 22:38:23.042 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 22:38:23.044 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 22:38:23.045 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 22:38:23.046 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 22:38:23.047 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 22:38:23.049 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 22:38:23.051 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 22:38:23.053 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 22:38:23.054 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 22:38:23.055 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 22:38:23.056 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 2
2025-05-03 22:38:23.058 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:38:23.059 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 62.4333ms
2025-05-03 22:38:23.060 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:38:23.061 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - 200 null application/json; charset=utf-8 70.4692ms
2025-05-03 22:38:23.121 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:38:23.126 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:38:23.127 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:38:23.146 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 22:38:23.149 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 22:38:23.156 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 25.8537ms
2025-05-03 22:38:23.157 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:38:23.159 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 38.8904ms
2025-05-03 22:38:23.184 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:38:23.187 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:38:23.188 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 22:38:23.196 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 22:38:23.198 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 22:38:23.200 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.5779ms
2025-05-03 22:38:23.201 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:38:23.203 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 18.7612ms
2025-05-03 22:38:29.492 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:38:29.502 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:29.504 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:38:29.507 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:38:29.529 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:38:57.135 +07:00 [INF] Application is shutting down...
2025-05-03 22:39:27.165 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:39:27.165 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:39:27.165 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:39:27.167 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 85979.0979ms
2025-05-03 22:39:27.167 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 68701.626ms
2025-05-03 22:39:27.169 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 57676.1488ms
2025-05-03 22:39:51.602 +07:00 [INF] Executed DbCommand (42ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-03 22:39:51.770 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-03 22:39:51.836 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-03 22:39:51.850 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-03 22:39:51.850 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-03 22:39:51.850 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-03 22:39:51.850 +07:00 [INF] Hosting environment: Development
2025-05-03 22:39:51.850 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-03 22:39:54.294 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:39:54.320 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:39:54.337 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:39:54.338 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-03 22:39:54.361 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:39:54.478 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:39:55.183 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:39:55.185 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:39:55.187 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:39:55.189 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:39:55.254 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:40:09.050 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 22:40:09.055 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:40:09.094 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:40:12.052 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:40:12.054 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 22:40:12.080 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 22:40:12.084 +07:00 [ERR] Connection id "0HNCAB3031E82", Request id "0HNCAB3031E82:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 22:40:12.089 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 3038.5436ms
2025-05-03 22:43:21.372 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - application/json 57
2025-05-03 22:43:21.377 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:43:21.399 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 22:43:21.478 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 22:43:21.545 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 22:43:21.570 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 169.1027ms
2025-05-03 22:43:21.570 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:43:21.572 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - 200 null application/json; charset=utf-8 200.1657ms
2025-05-03 22:43:22.744 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 22:43:22.745 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 22:43:22.746 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:43:22.746 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:43:22.752 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:43:22.752 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:43:22.771 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:43:22.771 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:43:22.775 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 22.6899ms
2025-05-03 22:43:22.775 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 22.5394ms
2025-05-03 22:43:22.775 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:43:22.775 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 29.9587ms
2025-05-03 22:43:22.775 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:43:22.775 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 31.7677ms
2025-05-03 22:43:22.936 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 22:43:22.936 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:43:23.311 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:43:25.699 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - null null
2025-05-03 22:43:25.700 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:43:25.704 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 22:43:25.732 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 22:43:25.732 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 22:43:25.733 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 22:43:25.733 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 22:43:25.733 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 22:43:25.733 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 22:43:25.734 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 22:43:25.734 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 22:43:25.734 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 22:43:25.734 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 22:43:25.734 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 22:43:25.735 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 22:43:25.735 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 22:43:25.735 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 22:43:25.735 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 22:43:25.736 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 22:43:25.736 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 22:43:25.736 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 22:43:25.736 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 22:43:25.737 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 22:43:25.737 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 22:43:25.737 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 22:43:25.737 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 22:43:25.738 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 22:43:25.738 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 22:43:25.738 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 22:43:25.739 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 22:43:25.739 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 22:43:25.739 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 22:43:25.739 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 22:43:25.739 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 22:43:25.739 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 22:43:25.740 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 22:43:25.740 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 22:43:25.741 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 2
2025-05-03 22:43:25.741 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:43:25.743 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 39.1504ms
2025-05-03 22:43:25.743 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:43:25.743 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - 200 null application/json; charset=utf-8 44.3104ms
2025-05-03 22:43:25.814 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:43:25.818 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:43:25.825 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:43:25.861 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 22:43:25.896 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 22:43:25.897 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 71.3969ms
2025-05-03 22:43:25.897 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:43:25.897 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 83.4381ms
2025-05-03 22:43:25.934 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:43:25.935 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:43:25.937 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 22:43:25.946 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 22:43:25.953 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 22:43:25.959 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 22.2229ms
2025-05-03 22:43:25.959 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:43:25.960 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 25.3212ms
2025-05-03 22:43:49.883 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:43:49.883 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 22:43:49.885 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 22:43:49.885 +07:00 [ERR] Connection id "0HNCAB3031E86", Request id "0HNCAB3031E86:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 22:43:49.887 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 26950.6734ms
2025-05-03 22:43:54.776 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:43:54.776 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 455
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 93
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 22:43:54.777 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 22:43:54.777 +07:00 [ERR] Connection id "0HNCAB3031E80", Request id "0HNCAB3031E80:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 455
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 93
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 22:43:54.778 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:43:54.778 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 240486.7187ms
2025-05-03 22:43:54.779 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 455
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 93
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 22:43:54.779 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 22:43:54.779 +07:00 [ERR] Connection id "0HNCAB3031E81", Request id "0HNCAB3031E81:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 455
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 93
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 22:43:54.780 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 239597.0078ms
2025-05-03 22:44:44.691 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - application/json 57
2025-05-03 22:44:44.692 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:44:44.693 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 22:44:44.710 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 22:44:44.711 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 22:44:44.712 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 18.9444ms
2025-05-03 22:44:44.712 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:44:44.712 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - 200 null application/json; charset=utf-8 20.379ms
2025-05-03 22:44:45.833 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 22:44:45.834 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:44:45.834 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:44:45.837 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:44:45.837 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 3.247ms
2025-05-03 22:44:45.837 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:44:45.837 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.3659ms
2025-05-03 22:44:45.838 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 22:44:45.838 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:44:45.838 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:44:45.839 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:44:45.840 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.4614ms
2025-05-03 22:44:45.840 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:44:45.840 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 2.182ms
2025-05-03 22:44:46.324 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 22:44:46.324 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:44:46.612 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:44:59.514 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-03 22:44:59.514 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:44:59.517 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.9462ms
2025-05-03 22:44:59.519 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 53
2025-05-03 22:44:59.519 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:44:59.519 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:44:59.519 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:44:59.520 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 22:44:59.535 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 22:44:59.536 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 22:44:59.536 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 16.8327ms
2025-05-03 22:44:59.537 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:44:59.537 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 17.8399ms
2025-05-03 22:44:59.758 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:44:59.758 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:44:59.758 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 0.7322ms
2025-05-03 22:44:59.760 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:44:59.760 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:44:59.760 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:44:59.761 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:44:59.761 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:44:59.761 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 0.4972ms
2025-05-03 22:44:59.761 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:44:59.761 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:44:59.763 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:44:59.763 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.0112ms
2025-05-03 22:44:59.763 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:44:59.763 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 2.9778ms
2025-05-03 22:44:59.764 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:44:59.764 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:44:59.765 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:44:59.765 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:44:59.765 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:44:59.766 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:44:59.766 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.1695ms
2025-05-03 22:44:59.766 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:44:59.766 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 1.9559ms
2025-05-03 22:44:59.864 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:44:59.865 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:44:59.865 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:44:59.865 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:44:59.882 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:45:04.670 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 22:45:04.670 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:45:04.671 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - 204 null null 0.3189ms
2025-05-03 22:45:04.672 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 22:45:04.672 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:45:04.673 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:45:04.673 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:45:04.673 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 22:45:04.681 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 22:45:04.682 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 22:45:04.682 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 22:45:04.682 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 22:45:04.682 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 22:45:04.683 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 22:45:04.683 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 22:45:04.683 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 22:45:04.683 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 22:45:04.684 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 22:45:04.684 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 22:45:04.684 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 22:45:04.684 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 22:45:04.685 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 22:45:04.685 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 22:45:04.685 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 22:45:04.685 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 22:45:04.686 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 22:45:04.686 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 22:45:04.686 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 22:45:04.687 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 22:45:04.687 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 22:45:04.687 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 22:45:04.687 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 22:45:04.688 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 22:45:04.688 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 22:45:04.688 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 22:45:04.688 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 22:45:04.689 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 22:45:04.689 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 22:45:04.689 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 22:45:04.689 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 22:45:04.690 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 22:45:04.690 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 22:45:04.690 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 5
2025-05-03 22:45:04.690 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:45:04.690 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 16.8196ms
2025-05-03 22:45:04.690 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:45:04.690 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - 200 null application/json; charset=utf-8 18.4291ms
2025-05-03 22:45:04.711 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:45:04.711 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:45:04.712 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 1.1306ms
2025-05-03 22:45:04.714 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:45:04.714 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:45:04.715 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:45:04.715 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:45:04.716 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:45:04.737 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 22:45:04.738 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 22:45:04.738 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 22.401ms
2025-05-03 22:45:04.738 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:45:04.739 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 24.9159ms
2025-05-03 22:45:04.762 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:45:04.763 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:45:04.765 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 2.6696ms
2025-05-03 22:45:04.766 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:45:04.766 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:45:04.768 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:45:04.768 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:45:04.768 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 22:45:04.775 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 22:45:04.777 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 22:45:04.777 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.3602ms
2025-05-03 22:45:04.778 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:45:04.778 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 11.8647ms
2025-05-03 22:45:12.366 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - null null
2025-05-03 22:45:12.366 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:45:12.366 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 22:45:12.373 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 22:45:12.374 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 22:45:12.374 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 22:45:12.374 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 22:45:12.374 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 22:45:12.374 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 22:45:12.375 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 22:45:12.375 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 22:45:12.375 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 22:45:12.375 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 22:45:12.375 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 22:45:12.376 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 22:45:12.376 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 22:45:12.376 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 22:45:12.376 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 22:45:12.377 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 22:45:12.377 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 22:45:12.377 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 22:45:12.377 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 22:45:12.378 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 22:45:12.378 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 22:45:12.378 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 22:45:12.379 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 22:45:12.379 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 22:45:12.379 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 22:45:12.379 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 22:45:12.379 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 22:45:12.379 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 22:45:12.380 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 22:45:12.380 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 22:45:12.380 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 22:45:12.380 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 22:45:12.381 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 22:45:12.381 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 22:45:12.381 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 2
2025-05-03 22:45:12.381 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:45:12.381 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 14.3887ms
2025-05-03 22:45:12.381 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:45:12.381 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - 200 null application/json; charset=utf-8 15.1401ms
2025-05-03 22:45:12.479 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:45:12.480 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:45:12.480 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:45:12.492 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 22:45:12.493 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 22:45:12.493 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 13.0903ms
2025-05-03 22:45:12.493 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:45:12.494 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 14.9347ms
2025-05-03 22:45:12.526 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:45:12.526 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:45:12.527 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 22:45:12.535 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 22:45:12.536 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 22:45:12.536 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.2241ms
2025-05-03 22:45:12.536 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:45:12.536 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 9.969ms
2025-05-03 22:45:17.311 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:45:17.312 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:45:17.312 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:45:17.312 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:45:17.339 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:45:26.515 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 22:45:26.516 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:45:26.566 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:46:48.715 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:46:48.715 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:46:48.715 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 22:46:48.715 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 22:46:48.718 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 22:46:48.719 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 22:46:48.719 +07:00 [ERR] Connection id "0HNCAB3031E8D", Request id "0HNCAB3031E8D:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 22:46:48.719 +07:00 [ERR] Connection id "0HNCAB3031E8L", Request id "0HNCAB3031E8L:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 22:46:48.723 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 82208.4266ms
2025-05-03 22:46:48.721 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 122397.723ms
2025-05-03 22:46:55.641 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:46:55.641 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 98329.9434ms
2025-05-03 22:46:55.641 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:46:55.641 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 115776.6617ms
2025-05-03 22:47:55.603 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - application/json 57
2025-05-03 22:47:55.617 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:47:55.623 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 22:47:55.702 +07:00 [INF] Executed DbCommand (36ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 22:47:55.720 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 22:47:55.722 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 98.6825ms
2025-05-03 22:47:55.722 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:47:55.722 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - 200 null application/json; charset=utf-8 120.0729ms
2025-05-03 22:47:56.897 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 22:47:56.898 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:47:56.898 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:47:56.903 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 22:47:56.903 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:47:56.904 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:47:56.904 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:47:56.904 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 6.1593ms
2025-05-03 22:47:56.904 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:47:56.905 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 7.3019ms
2025-05-03 22:47:56.906 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:47:56.906 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.6602ms
2025-05-03 22:47:56.907 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:47:56.907 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 3.6739ms
2025-05-03 22:47:57.422 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 22:47:57.425 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:47:57.507 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:48:08.133 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-03 22:48:08.135 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:08.136 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.4423ms
2025-05-03 22:48:08.137 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 53
2025-05-03 22:48:08.137 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:08.138 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:08.139 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:48:08.139 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 22:48:08.146 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 22:48:08.147 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 22:48:08.147 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 8.5255ms
2025-05-03 22:48:08.147 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:48:08.148 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 10.7897ms
2025-05-03 22:48:08.385 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:48:08.385 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:08.385 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 0.5417ms
2025-05-03 22:48:08.387 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:48:08.387 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:48:08.387 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:08.387 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:08.387 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 0.2513ms
2025-05-03 22:48:08.387 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:08.387 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:48:08.388 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:48:08.389 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:48:08.389 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.3333ms
2025-05-03 22:48:08.389 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:48:08.389 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 2.3585ms
2025-05-03 22:48:08.390 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:48:08.390 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:08.391 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:08.391 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:48:08.391 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:48:08.393 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:48:08.393 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.6388ms
2025-05-03 22:48:08.394 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:48:08.394 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 3.9718ms
2025-05-03 22:48:08.488 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:48:08.489 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:08.489 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:08.489 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:48:08.496 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:48:10.306 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 22:48:10.309 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:10.310 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - 204 null null 3.3335ms
2025-05-03 22:48:10.311 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 22:48:10.312 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:10.312 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:10.312 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:48:10.313 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 22:48:10.343 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 22:48:10.343 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 22:48:10.344 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 22:48:10.344 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 22:48:10.345 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 22:48:10.345 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 22:48:10.345 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 22:48:10.346 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 22:48:10.346 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 22:48:10.346 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 22:48:10.347 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 22:48:10.347 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 22:48:10.347 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 22:48:10.347 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 22:48:10.348 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 22:48:10.348 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 22:48:10.349 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 22:48:10.352 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 22:48:10.353 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 22:48:10.354 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 22:48:10.355 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 22:48:10.355 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 22:48:10.355 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 22:48:10.356 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 22:48:10.356 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 22:48:10.356 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 22:48:10.356 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 22:48:10.357 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 22:48:10.357 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 22:48:10.357 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 22:48:10.357 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 22:48:10.358 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 22:48:10.358 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 22:48:10.358 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 22:48:10.359 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 5
2025-05-03 22:48:10.359 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:48:10.359 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 46.452ms
2025-05-03 22:48:10.359 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:48:10.360 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - 200 null application/json; charset=utf-8 48.1697ms
2025-05-03 22:48:10.382 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:48:10.382 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:10.382 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 0.5315ms
2025-05-03 22:48:10.384 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:48:10.384 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:10.384 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:10.384 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:48:10.384 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:48:10.397 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 22:48:10.398 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 22:48:10.398 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 13.8077ms
2025-05-03 22:48:10.398 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:48:10.398 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 14.5901ms
2025-05-03 22:48:10.415 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:48:10.416 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:10.416 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 1.0985ms
2025-05-03 22:48:10.418 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:48:10.418 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:10.419 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:10.419 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:48:10.419 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 22:48:10.425 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 22:48:10.425 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 22:48:10.425 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.4651ms
2025-05-03 22:48:10.425 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:48:10.426 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 7.3064ms
2025-05-03 22:48:11.462 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - null null
2025-05-03 22:48:11.464 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:48:11.464 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 22:48:11.473 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 22:48:11.473 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 22:48:11.474 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 22:48:11.474 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 22:48:11.474 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 22:48:11.475 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 22:48:11.475 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 22:48:11.475 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 22:48:11.475 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 22:48:11.475 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 22:48:11.476 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 22:48:11.476 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 22:48:11.476 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 22:48:11.476 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 22:48:11.477 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 22:48:11.477 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 22:48:11.477 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 22:48:11.477 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 22:48:11.478 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 22:48:11.478 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 22:48:11.478 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 22:48:11.478 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 22:48:11.478 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 22:48:11.479 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 22:48:11.479 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 22:48:11.479 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 22:48:11.479 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 22:48:11.480 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 22:48:11.480 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 22:48:11.480 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 22:48:11.481 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 22:48:11.481 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 22:48:11.481 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 22:48:11.481 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 22:48:11.481 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 2
2025-05-03 22:48:11.482 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:48:11.482 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 17.6026ms
2025-05-03 22:48:11.482 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:48:11.482 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - 200 null application/json; charset=utf-8 20.454ms
2025-05-03 22:48:11.543 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:48:11.543 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:48:11.543 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:48:11.548 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 22:48:11.550 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 22:48:11.550 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.0516ms
2025-05-03 22:48:11.550 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:48:11.550 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 7.8446ms
2025-05-03 22:48:11.574 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:48:11.574 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:48:11.574 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 22:48:11.580 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 22:48:11.581 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 22:48:11.581 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.3294ms
2025-05-03 22:48:11.581 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:48:11.581 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 7.0708ms
2025-05-03 22:48:21.640 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:48:21.640 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:21.640 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:48:21.640 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:48:21.665 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:48:36.022 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 22:48:36.022 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:48:36.079 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:49:52.781 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:49:52.781 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 22:49:52.784 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 22:49:52.785 +07:00 [ERR] Connection id "0HNCAB3031E8P", Request id "0HNCAB3031E8P:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 22:49:52.786 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 115363.9832ms
2025-05-03 22:49:52.786 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:49:52.787 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 22:49:52.787 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 22:49:52.787 +07:00 [ERR] Connection id "0HNCAB3031E91", Request id "0HNCAB3031E91:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 22:49:52.788 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 76766.7387ms
2025-05-03 22:50:08.772 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:50:08.772 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 107132.2039ms
2025-05-03 22:50:08.772 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 22:50:08.772 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 120284.0915ms
2025-05-03 22:51:33.509 +07:00 [INF] Application is shutting down...
2025-05-03 22:51:50.483 +07:00 [INF] Executed DbCommand (35ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-03 22:51:50.623 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-03 22:51:50.685 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-03 22:51:50.694 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-03 22:51:50.695 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-03 22:51:50.695 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-03 22:51:50.695 +07:00 [INF] Hosting environment: Development
2025-05-03 22:51:50.695 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-03 22:51:52.591 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-03 22:51:52.612 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:51:52.618 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 29.1415ms
2025-05-03 22:51:52.623 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 53
2025-05-03 22:51:52.625 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:51:52.645 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:51:52.645 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-03 22:51:52.675 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:51:52.699 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 22:51:52.909 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 22:51:53.017 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 22:51:53.074 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 370.8688ms
2025-05-03 22:51:53.075 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:51:53.080 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 456.4288ms
2025-05-03 22:51:53.411 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:51:53.412 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:51:53.413 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 2.0609ms
2025-05-03 22:51:53.415 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:51:53.437 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:51:53.441 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:51:53.443 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:51:53.448 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:51:53.448 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:51:53.451 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 42.2245ms
2025-05-03 22:51:53.453 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:51:53.504 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:51:53.511 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 57.5908ms
2025-05-03 22:51:53.511 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:51:53.512 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 96.4089ms
2025-05-03 22:51:53.513 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 22:51:53.514 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:51:53.516 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:51:53.518 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:51:53.519 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:51:53.522 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:51:53.523 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 4.1319ms
2025-05-03 22:51:53.523 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:51:53.524 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 10.5071ms
2025-05-03 22:51:53.530 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:51:53.533 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:51:53.533 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:51:53.534 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:51:53.801 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:52:03.289 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 22:52:03.290 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:52:03.290 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - 204 null null 0.8095ms
2025-05-03 22:52:03.291 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 22:52:03.291 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:52:03.291 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:52:03.292 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:52:03.295 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 22:52:03.329 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 22:52:03.329 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 22:52:03.329 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 22:52:03.330 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 22:52:03.330 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 22:52:03.331 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 22:52:03.331 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 22:52:03.331 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 22:52:03.332 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 22:52:03.332 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 22:52:03.332 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 22:52:03.332 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 22:52:03.333 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 22:52:03.333 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 22:52:03.333 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 22:52:03.334 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 22:52:03.334 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 22:52:03.334 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 22:52:03.335 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 22:52:03.335 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 22:52:03.336 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 22:52:03.336 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 22:52:03.336 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 22:52:03.336 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 22:52:03.337 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 22:52:03.337 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 22:52:03.337 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 22:52:03.337 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 22:52:03.338 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 22:52:03.338 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 22:52:03.339 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 22:52:03.340 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 22:52:03.341 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 22:52:03.341 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 22:52:03.343 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 5
2025-05-03 22:52:03.343 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:52:03.347 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 52.0481ms
2025-05-03 22:52:03.348 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:52:03.348 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - 200 null application/json; charset=utf-8 56.6793ms
2025-05-03 22:52:03.369 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:52:03.369 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:52:03.369 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 0.4345ms
2025-05-03 22:52:03.370 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:52:03.371 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:52:03.372 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:52:03.373 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:52:03.377 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:52:03.433 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 22:52:03.463 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 22:52:03.466 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 88.5499ms
2025-05-03 22:52:03.466 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:52:03.466 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 95.9995ms
2025-05-03 22:52:03.511 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:52:03.511 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:52:03.512 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 0.369ms
2025-05-03 22:52:03.513 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:52:03.513 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:52:03.513 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:52:03.513 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:52:03.515 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 22:52:03.524 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 22:52:03.532 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 22:52:03.539 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 23.0872ms
2025-05-03 22:52:03.539 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:52:03.539 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 26.7091ms
2025-05-03 22:52:23.213 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - application/json 57
2025-05-03 22:52:23.218 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:52:23.218 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 22:52:23.258 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 22:52:23.261 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 22:52:23.261 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 42.9057ms
2025-05-03 22:52:23.262 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 22:52:23.262 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - 200 null application/json; charset=utf-8 48.7771ms
2025-05-03 22:52:24.438 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 22:52:24.439 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:52:24.440 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:52:24.441 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 22:52:24.442 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:52:24.442 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:52:24.444 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:52:24.445 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:52:24.445 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 4.7215ms
2025-05-03 22:52:24.445 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:52:24.445 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.6725ms
2025-05-03 22:52:24.445 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 7.3628ms
2025-05-03 22:52:24.445 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 22:52:24.446 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.0856ms
2025-05-03 22:52:24.895 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 22:52:24.897 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:52:24.972 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:52:25.990 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - null null
2025-05-03 22:52:25.991 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:52:25.991 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 22:52:25.997 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 22:52:25.998 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 22:52:25.998 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 22:52:25.998 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 22:52:25.999 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 22:52:25.999 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 22:52:25.999 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 22:52:26.000 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 22:52:26.000 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 22:52:26.000 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 22:52:26.000 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 22:52:26.001 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 22:52:26.001 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 22:52:26.001 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 22:52:26.001 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 22:52:26.002 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 22:52:26.002 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 22:52:26.002 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 22:52:26.002 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 22:52:26.002 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 22:52:26.003 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 22:52:26.003 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 22:52:26.003 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 22:52:26.003 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 22:52:26.003 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 22:52:26.003 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 22:52:26.004 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 22:52:26.004 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 22:52:26.004 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 22:52:26.004 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 22:52:26.004 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 22:52:26.005 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 22:52:26.005 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 22:52:26.005 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 22:52:26.005 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 2
2025-05-03 22:52:26.005 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 22:52:26.005 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 14.2527ms
2025-05-03 22:52:26.005 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 22:52:26.005 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - 200 null application/json; charset=utf-8 15.623ms
2025-05-03 22:52:26.049 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 22:52:26.049 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:52:26.049 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 22:52:26.058 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 22:52:26.058 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 22:52:26.058 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.0063ms
2025-05-03 22:52:26.059 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 22:52:26.059 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 9.9951ms
2025-05-03 22:52:26.081 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - null null
2025-05-03 22:52:26.082 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:52:26.082 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 22:52:26.086 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 22:52:26.087 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 22:52:26.087 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.9002ms
2025-05-03 22:52:26.087 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 22:52:26.087 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 6.3398ms
2025-05-03 22:52:33.073 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 22:52:33.074 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:52:33.075 +07:00 [INF] CORS policy execution successful.
2025-05-03 22:52:33.076 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:52:33.094 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 22:52:43.229 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 22:52:43.229 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 22:52:43.277 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 23:02:09.128 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-03 23:02:09.133 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:09.140 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 14.0567ms
2025-05-03 23:02:09.143 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 53
2025-05-03 23:02:09.144 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:09.147 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:09.152 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 23:02:09.158 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 23:02:09.434 +07:00 [INF] Executed DbCommand (51ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 23:02:09.443 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 23:02:09.444 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 285.4844ms
2025-05-03 23:02:09.444 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 23:02:09.445 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 301.8482ms
2025-05-03 23:02:09.650 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:02:09.650 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:09.650 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 0.4712ms
2025-05-03 23:02:09.651 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:02:09.652 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:09.652 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:02:09.652 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 0.3082ms
2025-05-03 23:02:09.652 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:09.652 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:09.653 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:02:09.653 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:02:09.659 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:02:09.659 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 5.7044ms
2025-05-03 23:02:09.659 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:02:09.659 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 7.5121ms
2025-05-03 23:02:09.667 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:02:09.668 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:09.668 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:09.668 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:02:09.668 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:02:09.669 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:02:09.669 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.3948ms
2025-05-03 23:02:09.670 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:02:09.670 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 2.2676ms
2025-05-03 23:02:09.719 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 23:02:09.719 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:09.719 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:09.720 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 23:02:09.878 +07:00 [INF] Executed DbCommand (26ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 23:02:12.415 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 23:02:12.415 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:12.415 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - 204 null null 0.3369ms
2025-05-03 23:02:12.417 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 23:02:12.418 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:12.418 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:12.418 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:02:12.418 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 23:02:12.431 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 23:02:12.432 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 23:02:12.432 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 23:02:12.432 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 23:02:12.432 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 23:02:12.433 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 23:02:12.433 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 23:02:12.433 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 23:02:12.433 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 23:02:12.433 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 23:02:12.434 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 23:02:12.434 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 23:02:12.434 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 23:02:12.434 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 23:02:12.434 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 23:02:12.435 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 23:02:12.435 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 23:02:12.435 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 23:02:12.435 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 23:02:12.435 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 23:02:12.435 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 23:02:12.436 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 23:02:12.436 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 23:02:12.436 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 23:02:12.436 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 23:02:12.436 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 23:02:12.436 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 23:02:12.437 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 23:02:12.437 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 23:02:12.437 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 23:02:12.437 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 23:02:12.438 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 23:02:12.438 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 23:02:12.438 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 23:02:12.438 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 5
2025-05-03 23:02:12.438 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:02:12.439 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 21.074ms
2025-05-03 23:02:12.440 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:02:12.440 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - 200 null application/json; charset=utf-8 22.7732ms
2025-05-03 23:02:12.464 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 23:02:12.464 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:12.464 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 0.3199ms
2025-05-03 23:02:12.465 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 23:02:12.466 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:12.466 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:12.466 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:02:12.466 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:02:12.478 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 23:02:12.478 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 23:02:12.479 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 12.1927ms
2025-05-03 23:02:12.479 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:02:12.479 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 13.5292ms
2025-05-03 23:02:12.493 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 23:02:12.494 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:12.494 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 0.3226ms
2025-05-03 23:02:12.495 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 23:02:12.495 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:12.495 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:12.495 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:02:12.495 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 23:02:12.500 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 23:02:12.500 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 23:02:12.501 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.6324ms
2025-05-03 23:02:12.501 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:02:12.501 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 6.306ms
2025-05-03 23:02:14.093 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - null null
2025-05-03 23:02:14.094 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:02:14.094 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 23:02:14.108 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 23:02:14.109 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 23:02:14.111 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 23:02:14.112 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 23:02:14.112 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 23:02:14.113 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 23:02:14.114 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 23:02:14.114 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 23:02:14.115 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 23:02:14.115 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 23:02:14.116 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 23:02:14.117 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 23:02:14.118 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 23:02:14.119 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 23:02:14.119 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 23:02:14.119 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 23:02:14.120 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 23:02:14.121 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 23:02:14.121 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 23:02:14.121 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 23:02:14.122 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 23:02:14.122 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 23:02:14.123 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 23:02:14.123 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 23:02:14.124 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 23:02:14.124 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 23:02:14.125 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 23:02:14.125 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 23:02:14.125 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 23:02:14.125 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 23:02:14.126 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 23:02:14.126 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 23:02:14.126 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 23:02:14.126 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 23:02:14.127 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 2
2025-05-03 23:02:14.127 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:02:14.127 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 32.9527ms
2025-05-03 23:02:14.127 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:02:14.127 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - 200 null application/json; charset=utf-8 34.7811ms
2025-05-03 23:02:14.221 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 23:02:14.222 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:02:14.222 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:02:14.227 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 23:02:14.227 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 23:02:14.228 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.5837ms
2025-05-03 23:02:14.228 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:02:14.228 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 6.8774ms
2025-05-03 23:02:14.298 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - null null
2025-05-03 23:02:14.299 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:02:14.299 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 23:02:14.301 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 23:02:14.302 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 23:02:14.302 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.4337ms
2025-05-03 23:02:14.302 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:02:14.302 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 4.5465ms
2025-05-03 23:02:15.115 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 23:02:15.115 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:15.116 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:02:15.116 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 23:02:15.133 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 23:04:04.923 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-03 23:04:04.923 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:04.923 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.7425ms
2025-05-03 23:04:04.925 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 53
2025-05-03 23:04:04.926 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:04.926 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:04.926 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 23:04:04.926 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 23:04:04.936 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 23:04:04.937 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 23:04:04.937 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 11.2178ms
2025-05-03 23:04:04.937 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 23:04:04.938 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 12.112ms
2025-05-03 23:04:05.177 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:04:05.178 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:05.178 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 0.2406ms
2025-05-03 23:04:05.180 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:04:05.180 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:05.181 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:05.181 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:04:05.181 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:04:05.182 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:04:05.182 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.3898ms
2025-05-03 23:04:05.183 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:04:05.183 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 2.9826ms
2025-05-03 23:04:05.185 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:04:05.185 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:05.186 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:05.186 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:04:05.186 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:04:05.188 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:04:05.188 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.6092ms
2025-05-03 23:04:05.188 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:04:05.188 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 3.1227ms
2025-05-03 23:04:05.258 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 23:04:05.259 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:05.259 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:05.263 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 23:04:05.426 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 23:04:07.571 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 23:04:07.572 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:07.572 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - 204 null null 0.2306ms
2025-05-03 23:04:07.573 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 23:04:07.573 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:07.573 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:07.574 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:04:07.574 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 23:04:07.582 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 23:04:07.582 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 23:04:07.582 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 23:04:07.583 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 23:04:07.583 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 23:04:07.583 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 23:04:07.583 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 23:04:07.583 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 23:04:07.584 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 23:04:07.584 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 23:04:07.584 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 23:04:07.584 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 23:04:07.584 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 23:04:07.584 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 23:04:07.585 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 23:04:07.585 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 23:04:07.585 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 23:04:07.585 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 23:04:07.585 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 23:04:07.586 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 23:04:07.586 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 23:04:07.586 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 23:04:07.586 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 23:04:07.586 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 23:04:07.586 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 23:04:07.587 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 23:04:07.587 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 23:04:07.587 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 23:04:07.587 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 23:04:07.587 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 23:04:07.588 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 23:04:07.588 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 23:04:07.588 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 23:04:07.588 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 23:04:07.588 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 5
2025-05-03 23:04:07.588 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:04:07.588 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 14.6296ms
2025-05-03 23:04:07.588 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:04:07.588 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - 200 null application/json; charset=utf-8 15.6659ms
2025-05-03 23:04:07.609 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 23:04:07.610 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:07.610 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 0.4234ms
2025-05-03 23:04:07.611 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 23:04:07.611 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:07.612 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:07.612 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:04:07.612 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:04:07.618 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 23:04:07.618 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 23:04:07.618 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.3553ms
2025-05-03 23:04:07.618 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:04:07.618 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 7.2468ms
2025-05-03 23:04:07.634 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 23:04:07.634 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:07.634 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 0.1704ms
2025-05-03 23:04:07.635 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 23:04:07.635 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:07.635 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:07.636 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:04:07.636 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 23:04:07.642 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 23:04:07.643 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 23:04:07.645 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.7042ms
2025-05-03 23:04:07.645 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:04:07.645 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 10.1061ms
2025-05-03 23:04:09.071 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 23:04:09.071 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:09.071 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:04:09.071 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 23:04:09.094 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 23:04:42.403 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:04:42.403 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:04:42.405 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 23:04:42.405 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 23:04:42.474 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 23:04:42.474 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 23:04:42.477 +07:00 [ERR] Connection id "0HNCAB9M58JKB", Request id "0HNCAB9M58JKB:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 23:04:42.477 +07:00 [ERR] Connection id "0HNCAB9M58JK6", Request id "0HNCAB9M58JK6:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 23:04:42.480 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 719251.6143ms
2025-05-03 23:04:42.481 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 737586.2414ms
2025-05-03 23:04:45.158 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:04:45.158 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:04:45.158 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:04:45.158 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:04:45.159 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 771628.7319ms
2025-05-03 23:04:45.158 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:04:45.158 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:04:45.159 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 155439.8286ms
2025-05-03 23:04:45.159 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 36087.9736ms
2025-05-03 23:04:45.159 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 732085.2073ms
2025-05-03 23:04:45.159 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 150043.5873ms
2025-05-03 23:04:45.159 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 39900.1265ms
2025-05-03 23:06:09.214 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-03 23:06:09.217 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:09.219 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 5.2754ms
2025-05-03 23:06:09.221 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 53
2025-05-03 23:06:09.222 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:09.223 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:09.224 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 23:06:09.232 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 23:06:09.373 +07:00 [INF] Executed DbCommand (102ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 23:06:09.406 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 23:06:09.408 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 175.6807ms
2025-05-03 23:06:09.408 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 23:06:09.408 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 187.1347ms
2025-05-03 23:06:09.624 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:06:09.625 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:09.626 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 1.4839ms
2025-05-03 23:06:09.626 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:06:09.626 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:09.626 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 0.1744ms
2025-05-03 23:06:09.627 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:06:09.629 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:09.629 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:09.629 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:06:09.629 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:06:09.634 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:06:09.635 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 5.3099ms
2025-05-03 23:06:09.635 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:06:09.635 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 7.315ms
2025-05-03 23:06:09.636 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:06:09.636 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:09.636 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:09.636 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:06:09.636 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:06:09.638 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:06:09.639 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.3813ms
2025-05-03 23:06:09.639 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:06:09.640 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 3.8667ms
2025-05-03 23:06:09.656 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 23:06:09.657 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:09.658 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:09.658 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 23:06:09.701 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 23:06:31.758 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - application/json 57
2025-05-03 23:06:31.762 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 23:06:31.762 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 23:06:31.811 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 23:06:31.815 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 23:06:31.816 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 53.7326ms
2025-05-03 23:06:31.816 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 23:06:31.816 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - 200 null application/json; charset=utf-8 58.3602ms
2025-05-03 23:06:32.923 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 23:06:32.924 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:06:32.924 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:06:32.926 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 23:06:32.927 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:06:32.927 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:06:32.927 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:06:32.927 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.945ms
2025-05-03 23:06:32.928 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:06:32.928 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.6162ms
2025-05-03 23:06:32.928 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:06:32.928 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.5418ms
2025-05-03 23:06:32.928 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:06:32.928 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 2.0124ms
2025-05-03 23:06:33.051 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 23:06:33.051 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 23:06:33.474 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 23:06:34.265 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - null null
2025-05-03 23:06:34.266 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:06:34.266 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 23:06:34.275 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 23:06:34.275 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 23:06:34.275 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 23:06:34.275 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 23:06:34.276 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 23:06:34.276 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 23:06:34.276 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 23:06:34.276 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 23:06:34.276 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 23:06:34.277 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 23:06:34.277 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 23:06:34.277 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 23:06:34.278 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 23:06:34.278 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 23:06:34.279 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 23:06:34.279 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 23:06:34.279 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 23:06:34.280 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 23:06:34.280 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 23:06:34.280 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 23:06:34.280 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 23:06:34.280 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 23:06:34.280 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 23:06:34.281 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 23:06:34.281 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 23:06:34.281 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 23:06:34.282 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 23:06:34.282 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 23:06:34.282 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 23:06:34.282 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 23:06:34.282 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 23:06:34.283 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 23:06:34.283 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 23:06:34.283 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 23:06:34.284 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 2
2025-05-03 23:06:34.284 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:06:34.284 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 18.2051ms
2025-05-03 23:06:34.284 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:06:34.284 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - 200 null application/json; charset=utf-8 19.0763ms
2025-05-03 23:06:34.353 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 23:06:34.353 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:06:34.354 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:06:34.371 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 23:06:34.372 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 23:06:34.372 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 18.7988ms
2025-05-03 23:06:34.373 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:06:34.373 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 19.4237ms
2025-05-03 23:06:34.406 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - null null
2025-05-03 23:06:34.407 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:06:34.407 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 23:06:34.414 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 23:06:34.415 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 23:06:34.415 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.3627ms
2025-05-03 23:06:34.415 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:06:34.415 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 8.881ms
2025-05-03 23:06:36.651 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 23:06:36.651 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:36.651 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - 204 null null 0.2347ms
2025-05-03 23:06:36.653 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 23:06:36.653 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:36.653 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:36.653 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:06:36.653 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 23:06:36.659 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 23:06:36.659 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 23:06:36.659 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 23:06:36.660 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 23:06:36.660 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 23:06:36.660 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 23:06:36.661 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 23:06:36.662 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 23:06:36.662 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 23:06:36.662 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 23:06:36.662 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 23:06:36.663 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 23:06:36.664 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 23:06:36.664 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 23:06:36.664 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 23:06:36.665 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 23:06:36.665 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 23:06:36.665 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 23:06:36.665 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 23:06:36.666 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 23:06:36.666 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 23:06:36.666 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 23:06:36.667 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 23:06:36.667 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 23:06:36.668 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 23:06:36.668 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 23:06:36.668 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 23:06:36.668 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 23:06:36.669 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 23:06:36.669 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 23:06:36.669 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 23:06:36.669 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 23:06:36.670 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 23:06:36.670 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 23:06:36.670 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 5
2025-05-03 23:06:36.670 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:06:36.670 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 17.3578ms
2025-05-03 23:06:36.670 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:06:36.670 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - 200 null application/json; charset=utf-8 17.8844ms
2025-05-03 23:06:36.691 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 23:06:36.691 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:36.692 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 0.223ms
2025-05-03 23:06:36.693 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 23:06:36.693 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:36.693 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:36.693 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:06:36.693 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:06:36.698 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 23:06:36.698 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 23:06:36.698 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.0595ms
2025-05-03 23:06:36.698 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:06:36.699 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 5.7833ms
2025-05-03 23:06:36.713 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 23:06:36.713 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:36.714 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 0.3349ms
2025-05-03 23:06:36.715 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 23:06:36.715 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:36.715 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:36.715 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:06:36.715 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 23:06:36.719 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 23:06:36.720 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 23:06:36.720 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.4486ms
2025-05-03 23:06:36.720 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:06:36.720 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 5.1288ms
2025-05-03 23:06:43.287 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 23:06:43.287 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:43.288 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:06:43.288 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 23:06:43.318 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 23:08:08.978 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 23:08:08.979 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 23:08:09.040 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 23:14:08.949 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:14:08.949 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:14:08.951 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 23:14:08.951 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-03 23:14:08.987 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 23:14:08.987 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-03 23:14:08.989 +07:00 [ERR] Connection id "0HNCAB9M58JL1", Request id "0HNCAB9M58JL1:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 23:14:08.989 +07:00 [ERR] Connection id "0HNCAB9M58JKS", Request id "0HNCAB9M58JKS:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-03 23:14:08.997 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 360019.4296ms
2025-05-03 23:14:09.001 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - 101 null null 455950.2366ms
2025-05-03 23:14:20.565 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:14:20.565 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 457278.5806ms
2025-05-03 23:14:20.566 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:14:20.566 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 490909.1933ms
2025-05-03 23:15:40.782 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-03 23:15:40.788 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:40.798 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 15.3163ms
2025-05-03 23:15:40.803 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 53
2025-05-03 23:15:40.805 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:40.807 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:40.811 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 23:15:40.814 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 23:15:41.181 +07:00 [INF] Executed DbCommand (80ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 23:15:41.208 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 23:15:41.215 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 399.9509ms
2025-05-03 23:15:41.215 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 23:15:41.217 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 414.1673ms
2025-05-03 23:15:41.432 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:15:41.432 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:41.433 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 0.2664ms
2025-05-03 23:15:41.435 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:15:41.435 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:41.435 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:15:41.435 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/5 - 204 null null 0.442ms
2025-05-03 23:15:41.436 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:41.436 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:41.436 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:15:41.436 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:15:41.445 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:15:41.445 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 8.4435ms
2025-05-03 23:15:41.445 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:15:41.445 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 9.9099ms
2025-05-03 23:15:41.447 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - null null
2025-05-03 23:15:41.447 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:41.447 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:41.447 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:15:41.448 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:15:41.449 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:15:41.450 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.678ms
2025-05-03 23:15:41.450 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:15:41.450 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 3.0851ms
2025-05-03 23:15:41.551 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 23:15:41.551 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:41.551 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:41.551 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 23:15:41.579 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 23:15:48.347 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 23:15:48.347 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:48.348 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1/5 - 204 null null 0.3834ms
2025-05-03 23:15:48.349 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - null null
2025-05-03 23:15:48.349 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:48.349 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:48.349 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:15:48.349 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 23:15:48.363 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 23:15:48.363 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 23:15:48.363 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 23:15:48.364 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 23:15:48.364 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 23:15:48.364 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 23:15:48.364 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 23:15:48.365 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 23:15:48.365 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 23:15:48.365 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 23:15:48.366 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 23:15:48.366 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 23:15:48.366 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 23:15:48.367 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 23:15:48.367 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 23:15:48.367 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 23:15:48.368 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 23:15:48.368 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 23:15:48.368 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 23:15:48.369 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 23:15:48.369 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 23:15:48.369 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 23:15:48.370 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 23:15:48.370 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 23:15:48.370 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 23:15:48.370 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 23:15:48.371 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 23:15:48.371 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 23:15:48.372 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 23:15:48.372 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 23:15:48.372 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 23:15:48.372 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 23:15:48.373 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 23:15:48.373 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 23:15:48.374 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 5
2025-05-03 23:15:48.374 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:15:48.375 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 25.3917ms
2025-05-03 23:15:48.375 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:15:48.375 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1/5 - 200 null application/json; charset=utf-8 26.1605ms
2025-05-03 23:15:48.400 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 23:15:48.400 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:48.400 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 0.3467ms
2025-05-03 23:15:48.401 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 23:15:48.401 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:48.401 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:48.402 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:15:48.402 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:15:48.424 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 23:15:48.425 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 23:15:48.425 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 23.0599ms
2025-05-03 23:15:48.425 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:15:48.425 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 24.1763ms
2025-05-03 23:15:48.442 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 23:15:48.442 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:48.442 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 0.1977ms
2025-05-03 23:15:48.443 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - null null
2025-05-03 23:15:48.443 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:48.443 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:15:48.443 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:15:48.443 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 23:15:48.449 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 23:15:48.452 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 23:15:48.452 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.7295ms
2025-05-03 23:15:48.452 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:15:48.452 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 9.6102ms
2025-05-03 23:16:02.701 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - application/json 57
2025-05-03 23:16:02.702 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 23:16:02.702 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-03 23:16:02.717 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-03 23:16:02.719 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-03 23:16:02.719 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 16.9031ms
2025-05-03 23:16:02.719 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-03 23:16:02.719 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.9:5053/api/Auth/login - 200 null application/json; charset=utf-8 18.1837ms
2025-05-03 23:16:03.855 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 23:16:03.856 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - null null
2025-05-03 23:16:03.857 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:16:03.857 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:16:03.857 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:16:03.857 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:16:03.858 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:16:03.859 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:16:03.859 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.8248ms
2025-05-03 23:16:03.859 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 2.3672ms
2025-05-03 23:16:03.859 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:16:03.859 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-03 23:16:03.859 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 3.3036ms
2025-05-03 23:16:03.859 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 4.4004ms
2025-05-03 23:16:04.299 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 23:16:04.300 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 23:16:04.362 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 23:16:05.417 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - null null
2025-05-03 23:16:05.417 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:16:05.417 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-03 23:16:05.423 +07:00 [WRN] Message 87 not found in Redis
2025-05-03 23:16:05.424 +07:00 [WRN] Message 86 not found in Redis
2025-05-03 23:16:05.424 +07:00 [WRN] Message 85 not found in Redis
2025-05-03 23:16:05.424 +07:00 [WRN] Message 84 not found in Redis
2025-05-03 23:16:05.424 +07:00 [WRN] Message 83 not found in Redis
2025-05-03 23:16:05.425 +07:00 [WRN] Message 82 not found in Redis
2025-05-03 23:16:05.425 +07:00 [WRN] Message 81 not found in Redis
2025-05-03 23:16:05.425 +07:00 [WRN] Message 80 not found in Redis
2025-05-03 23:16:05.425 +07:00 [WRN] Message 79 not found in Redis
2025-05-03 23:16:05.426 +07:00 [WRN] Message 78 not found in Redis
2025-05-03 23:16:05.426 +07:00 [WRN] Message 77 not found in Redis
2025-05-03 23:16:05.427 +07:00 [WRN] Message 76 not found in Redis
2025-05-03 23:16:05.428 +07:00 [WRN] Message 75 not found in Redis
2025-05-03 23:16:05.428 +07:00 [WRN] Message 74 not found in Redis
2025-05-03 23:16:05.428 +07:00 [WRN] Message 73 not found in Redis
2025-05-03 23:16:05.428 +07:00 [WRN] Message 72 not found in Redis
2025-05-03 23:16:05.429 +07:00 [WRN] Message 71 not found in Redis
2025-05-03 23:16:05.429 +07:00 [WRN] Message 68 not found in Redis
2025-05-03 23:16:05.429 +07:00 [WRN] Message 64 not found in Redis
2025-05-03 23:16:05.430 +07:00 [WRN] Message 62 not found in Redis
2025-05-03 23:16:05.430 +07:00 [WRN] Message 61 not found in Redis
2025-05-03 23:16:05.430 +07:00 [WRN] Message 60 not found in Redis
2025-05-03 23:16:05.431 +07:00 [WRN] Message 59 not found in Redis
2025-05-03 23:16:05.431 +07:00 [WRN] Message 57 not found in Redis
2025-05-03 23:16:05.431 +07:00 [WRN] Message 55 not found in Redis
2025-05-03 23:16:05.431 +07:00 [WRN] Message 54 not found in Redis
2025-05-03 23:16:05.432 +07:00 [WRN] Message 51 not found in Redis
2025-05-03 23:16:05.432 +07:00 [WRN] Message 49 not found in Redis
2025-05-03 23:16:05.432 +07:00 [WRN] Message 11 not found in Redis
2025-05-03 23:16:05.432 +07:00 [WRN] Message 8 not found in Redis
2025-05-03 23:16:05.433 +07:00 [WRN] Message 3 not found in Redis
2025-05-03 23:16:05.433 +07:00 [WRN] Message 2 not found in Redis
2025-05-03 23:16:05.433 +07:00 [WRN] Message 1 not found in Redis
2025-05-03 23:16:05.433 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1
2025-05-03 23:16:05.433 +07:00 [INF] Retrieved 19 messages from Redis for conversation 1 and user 2
2025-05-03 23:16:05.433 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-03 23:16:05.434 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 16.6714ms
2025-05-03 23:16:05.434 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-03 23:16:05.434 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Message/getMessages/1/2 - 200 null application/json; charset=utf-8 17.0633ms
2025-05-03 23:16:05.511 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - null null
2025-05-03 23:16:05.511 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:16:05.511 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-03 23:16:05.515 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-03 23:16:05.516 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-03 23:16:05.516 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 4.3569ms
2025-05-03 23:16:05.516 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-03 23:16:05.516 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 5.0955ms
2025-05-03 23:16:05.602 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - null null
2025-05-03 23:16:05.602 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:16:05.602 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-03 23:16:05.606 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-03 23:16:05.607 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-03 23:16:05.607 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.8109ms
2025-05-03 23:16:05.607 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-03 23:16:05.607 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.9:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 5.1236ms
2025-05-03 23:16:08.447 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.9:5053/ws/chat?userId=2 - null null
2025-05-03 23:16:08.447 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 23:16:08.487 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 23:16:21.623 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - null null
2025-05-03 23:16:21.624 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:16:21.624 +07:00 [INF] CORS policy execution successful.
2025-05-03 23:16:21.624 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-03 23:16:21.691 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-03 23:18:50.138 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:18:50.138 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 188586.8277ms
2025-05-03 23:18:50.138 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-03 23:18:50.138 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=5 - 101 null null 148514.667ms
