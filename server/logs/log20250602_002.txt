2025-06-02 19:08:22.818 +07:00 [INF] Executed DbCommand (35ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-02 19:08:23.035 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-02 19:08:23.127 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-02 19:08:23.139 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-02 19:08:23.140 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-02 19:08:23.140 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-02 19:08:23.140 +07:00 [INF] Hosting environment: Development
2025-06-02 19:08:23.140 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-02 19:08:40.264 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 19:08:40.312 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-02 19:08:40.407 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:08:40.424 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 19:08:40.547 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 19:08:40.614 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 19:08:40.653 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 226.4894ms
2025-06-02 19:08:40.654 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:08:40.658 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 394.9863ms
2025-06-02 19:08:40.927 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 19:08:40.934 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 19:08:40.937 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 19:08:40.938 +07:00 [WRN] Authorization header is missing or invalid.
2025-06-02 19:08:40.939 +07:00 [INF] Authorization failed for the request at filter 'server.Filters.AuthorizationJWT'.
2025-06-02 19:08:40.941 +07:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-06-02 19:08:40.953 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 15.5509ms
2025-06-02 19:08:40.953 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 19:08:40.953 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 401 null application/problem+json; charset=utf-8 26.2832ms
2025-06-02 19:08:41.017 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 19:08:41.022 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 19:08:41.027 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 19:08:41.073 +07:00 [ERR] Unexpected error during token validation: Value cannot be null. (Parameter 's')
2025-06-02 19:08:41.073 +07:00 [INF] Authorization failed for the request at filter 'server.Filters.AuthorizationJWT'.
2025-06-02 19:08:41.074 +07:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-06-02 19:08:41.074 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 47.3894ms
2025-06-02 19:08:41.074 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 19:08:41.074 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 500 null application/problem+json; charset=utf-8 57.444ms
2025-06-02 19:08:48.403 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 19:08:48.404 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 19:08:59.797 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - null null
2025-06-02 19:08:59.799 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - null null
2025-06-02 19:08:59.800 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-06-02 19:08:59.800 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-06-02 19:08:59.800 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - null null
2025-06-02 19:08:59.802 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-06-02 19:08:59.803 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - null null
2025-06-02 19:08:59.804 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 19:08:59.804 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 19:09:16.840 +07:00 [WRN] Authorization header is missing or invalid.
2025-06-02 19:09:16.840 +07:00 [INF] Authorization failed for the request at filter 'server.Filters.AuthorizationJWT'.
2025-06-02 19:09:16.840 +07:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-06-02 19:09:16.840 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 17035.9667ms
2025-06-02 19:09:16.840 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-06-02 19:09:16.840 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-06-02 19:09:16.841 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 19:09:16.841 +07:00 [WRN] Authorization header is missing or invalid.
2025-06-02 19:09:16.843 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - 401 null application/problem+json; charset=utf-8 17042.2671ms
2025-06-02 19:09:16.843 +07:00 [INF] Authorization failed for the request at filter 'server.Filters.AuthorizationJWT'.
2025-06-02 19:09:20.345 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 19:09:16.844 +07:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-06-02 19:09:20.350 +07:00 [WRN] Authorization header is missing or invalid.
2025-06-02 19:09:20.350 +07:00 [INF] Authorization failed for the request at filter 'server.Filters.AuthorizationJWT'.
2025-06-02 19:09:20.350 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 20544.9744ms
2025-06-02 19:09:20.350 +07:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-06-02 19:09:20.351 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-06-02 19:09:20.352 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - 401 null application/problem+json; charset=utf-8 20554.7654ms
2025-06-02 19:09:20.960 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 4118.9688ms
2025-06-02 19:09:20.960 +07:00 [WRN] Authorization header is missing or invalid.
2025-06-02 19:09:20.960 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-06-02 19:09:20.961 +07:00 [INF] Authorization failed for the request at filter 'server.Filters.AuthorizationJWT'.
2025-06-02 19:09:20.961 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - 401 null application/problem+json; charset=utf-8 21160.2496ms
2025-06-02 19:09:20.961 +07:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-06-02 19:09:20.961 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 616.4791ms
2025-06-02 19:09:20.961 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-06-02 19:09:20.962 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - 401 null application/problem+json; charset=utf-8 21158.8367ms
2025-06-02 19:10:07.552 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 19:10:07.562 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:10:07.563 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 19:10:07.707 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 19:10:07.711 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 19:10:07.712 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 148.9956ms
2025-06-02 19:10:07.712 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:10:07.712 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 160.9279ms
2025-06-02 19:10:07.980 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 19:10:07.981 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:10:07.981 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 19:10:07.994 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 19:10:07.995 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 19:10:07.996 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 14.3226ms
2025-06-02 19:10:07.996 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:10:07.996 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 15.9319ms
2025-06-02 19:10:09.065 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 19:10:09.069 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 19:10:09.070 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 19:10:09.071 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 19:10:09.071 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 19:10:16.188 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 19:10:16.188 +07:00 [WRN] Authorization header is missing or invalid.
2025-06-02 19:10:16.188 +07:00 [INF] Authorization failed for the request at filter 'server.Filters.AuthorizationJWT'.
2025-06-02 19:10:16.188 +07:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-06-02 19:10:16.189 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 7117.225ms
2025-06-02 19:10:16.189 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 19:10:16.189 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 401 null application/problem+json; charset=utf-8 7118.5446ms
2025-06-02 19:10:16.199 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 19:10:16.200 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 19:10:27.200 +07:00 [ERR] Unexpected error during token validation: Value cannot be null. (Parameter 's')
2025-06-02 19:10:27.201 +07:00 [INF] Authorization failed for the request at filter 'server.Filters.AuthorizationJWT'.
2025-06-02 19:10:27.201 +07:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-06-02 19:10:27.203 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 11002.7207ms
2025-06-02 19:10:27.203 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 19:10:27.203 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 500 null application/problem+json; charset=utf-8 11015.1952ms
2025-06-02 19:10:27.239 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 19:10:27.261 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 19:10:27.262 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 19:10:27.263 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 19:10:27.263 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 19:10:27.264 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 19:10:27.266 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 19:10:27.273 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 19:10:27.280 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 19:10:27.287 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 19:10:27.293 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 19:10:27.299 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 19:10:27.300 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 19:10:27.300 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 19:10:27.301 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 19:10:27.301 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 19:10:27.302 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 19:10:27.303 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 19:10:27.304 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 19:10:27.305 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 19:10:27.306 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 19:10:27.306 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 19:10:27.307 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 19:10:27.308 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 19:10:27.308 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 19:10:27.309 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 19:10:27.311 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 19:10:27.311 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 19:10:27.312 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 19:10:27.312 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 19:10:27.313 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 19:10:27.314 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 19:10:27.314 +07:00 [INF] User 2 subscribed to channel conversation:54
2025-06-02 19:10:27.315 +07:00 [INF] User 2 subscribed to channel conversation:55
2025-06-02 19:10:27.315 +07:00 [INF] User 2 subscribed to channel conversation:56
2025-06-02 19:10:27.316 +07:00 [INF] User 2 subscribed to channel conversation:57
2025-06-02 19:10:27.316 +07:00 [INF] User 2 subscribed to channel conversation:58
2025-06-02 19:10:27.317 +07:00 [INF] User 2 subscribed to channel conversation:59
2025-06-02 19:10:27.317 +07:00 [INF] User 2 subscribed to channel conversation:60
2025-06-02 19:10:27.318 +07:00 [INF] User 2 subscribed to channel conversation:61
2025-06-02 19:10:27.318 +07:00 [INF] User 2 subscribed to channel conversation:62
2025-06-02 19:10:27.319 +07:00 [INF] User 2 subscribed to channel conversation:63
2025-06-02 19:10:27.319 +07:00 [INF] User 2 subscribed to channel conversation:64
2025-06-02 19:10:27.320 +07:00 [INF] User 2 subscribed to channel conversation:65
2025-06-02 19:10:27.320 +07:00 [INF] User 2 subscribed to channel conversation:66
2025-06-02 19:10:27.321 +07:00 [INF] User 2 subscribed to channel conversation:67
2025-06-02 19:10:27.321 +07:00 [INF] User 2 subscribed to channel conversation:68
2025-06-02 19:10:27.322 +07:00 [INF] User 2 subscribed to channel conversation:69
2025-06-02 19:10:27.325 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:3
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:4
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:19
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:1
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:25
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:26
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:27
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:28
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:29
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:32
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:33
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:34
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:35
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:36
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:37
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:38
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:39
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:41
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:40
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:42
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:44
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:43
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:45
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:46
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:47
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:48
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:49
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:50
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:51
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:52
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:53
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:54
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:55
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:56
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:57
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:58
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:59
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:60
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:61
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:62
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:63
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:64
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:65
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:66
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:67
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:68
2025-06-02 19:10:27.326 +07:00 [INF] User 2 already subscribed to channel conversation:69
2025-06-02 19:12:51.661 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-06-02 19:12:51.770 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-06-02 19:12:51.885 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-06-02 19:12:51.891 +07:00 [INF] Now listening on: http://[::]:5053
2025-06-02 19:12:51.892 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-06-02 19:12:51.892 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-06-02 19:12:51.892 +07:00 [INF] Hosting environment: Development
2025-06-02 19:12:51.892 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-06-02 19:12:56.411 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 19:12:56.444 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-02 19:12:56.459 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 19:13:00.883 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 19:13:00.986 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:13:01.021 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 19:13:01.284 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 19:13:01.450 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 19:13:01.559 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 532.0799ms
2025-06-02 19:13:01.562 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:13:01.569 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 685.5736ms
2025-06-02 19:13:01.807 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 19:13:01.830 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 19:13:01.832 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 19:13:01.833 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 19:13:01.836 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 19:13:01.840 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 19:13:01.842 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 19:13:01.844 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 19:13:01.850 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 19:13:01.852 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 19:13:01.855 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 19:13:01.856 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 19:13:01.858 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 19:13:01.861 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 19:13:01.865 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 19:13:01.867 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 19:13:01.868 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 19:13:01.871 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 19:13:01.873 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 19:13:01.873 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 19:13:01.875 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 19:13:01.877 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 19:13:01.878 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 19:13:01.880 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 19:13:01.882 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 19:13:01.883 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 19:13:01.884 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 19:13:01.887 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 19:13:01.889 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 19:13:01.890 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 19:13:01.891 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 19:13:01.892 +07:00 [WRN] Authorization header is missing or invalid.
2025-06-02 19:13:01.893 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 19:13:01.894 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 19:13:01.895 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 19:13:01.896 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 19:13:01.897 +07:00 [INF] Authorization failed for the request at filter 'server.Filters.AuthorizationJWT'.
2025-06-02 19:13:01.899 +07:00 [INF] User 2 subscribed to channel conversation:54
2025-06-02 19:13:01.902 +07:00 [INF] User 2 subscribed to channel conversation:55
2025-06-02 19:13:01.904 +07:00 [INF] User 2 subscribed to channel conversation:56
2025-06-02 19:13:01.909 +07:00 [INF] User 2 subscribed to channel conversation:57
2025-06-02 19:13:01.909 +07:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-06-02 19:13:01.911 +07:00 [INF] User 2 subscribed to channel conversation:58
2025-06-02 19:13:01.914 +07:00 [INF] User 2 subscribed to channel conversation:59
2025-06-02 19:13:01.915 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 19:13:01.915 +07:00 [INF] User 2 subscribed to channel conversation:60
2025-06-02 19:13:01.918 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 19:13:01.922 +07:00 [INF] User 2 subscribed to channel conversation:61
2025-06-02 19:13:01.926 +07:00 [INF] User 2 subscribed to channel conversation:62
2025-06-02 19:13:01.931 +07:00 [INF] User 2 subscribed to channel conversation:63
2025-06-02 19:13:01.933 +07:00 [INF] User 2 subscribed to channel conversation:64
2025-06-02 19:13:01.939 +07:00 [INF] User 2 subscribed to channel conversation:65
2025-06-02 19:13:01.943 +07:00 [INF] User 2 subscribed to channel conversation:66
2025-06-02 19:13:01.948 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 19:13:01.948 +07:00 [INF] User 2 subscribed to channel conversation:67
2025-06-02 19:13:01.953 +07:00 [INF] User 2 subscribed to channel conversation:68
2025-06-02 19:13:01.958 +07:00 [INF] User 2 subscribed to channel conversation:69
2025-06-02 19:13:01.988 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 98.438ms
2025-06-02 19:13:01.989 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 19:13:01.989 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 401 null application/problem+json; charset=utf-8 139.3474ms
2025-06-02 19:13:02.507 +07:00 [INF] Executed DbCommand (64ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 19:13:02.902 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 19:13:02.997 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1049.056ms
2025-06-02 19:13:02.998 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 19:13:02.998 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 1082.8353ms
2025-06-02 19:16:59.100 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 19:16:59.105 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:16:59.105 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 19:16:59.151 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 19:16:59.156 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 19:16:59.157 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 52.0203ms
2025-06-02 19:16:59.158 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:16:59.158 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 58.1796ms
2025-06-02 19:17:00.352 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 19:17:00.354 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 19:17:00.516 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 19:17:00.519 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 19:17:00.519 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 19:17:00.520 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 19:17:00.523 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 19:17:00.523 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 19:17:00.524 +07:00 [WRN] Authorization header is missing or invalid.
2025-06-02 19:17:00.524 +07:00 [INF] Authorization failed for the request at filter 'server.Filters.AuthorizationJWT'.
2025-06-02 19:17:00.525 +07:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-06-02 19:17:00.525 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 1.3268ms
2025-06-02 19:17:00.525 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 19:17:00.525 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 401 null application/problem+json; charset=utf-8 4.9328ms
2025-06-02 19:17:00.545 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 19:17:00.631 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 19:17:00.817 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 298.3765ms
2025-06-02 19:17:00.818 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 19:17:00.819 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 302.7792ms
2025-06-02 19:17:46.992 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 19:17:46.994 +07:00 [INF] Executed endpoint '/ws/chat'
2025-06-02 19:17:46.995 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - 101 null null 46642.4853ms
2025-06-02 19:17:46.993 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadResult(ReadResult& result)
   at System.IO.Pipelines.Pipe.ReadAsync(CancellationToken token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-06-02 19:17:47.020 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-06-02 19:17:47.021 +07:00 [ERR] Connection id "0HND1PR7F9A9H", Request id "0HND1PR7F9A9H:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadResult(ReadResult& result)
   at System.IO.Pipelines.Pipe.ReadAsync(CancellationToken token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-06-02 19:17:47.023 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - 101 null null 290612.9939ms
2025-06-02 19:20:52.917 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 58
2025-06-02 19:20:52.919 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:20:52.920 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-06-02 19:20:52.954 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-06-02 19:20:52.955 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-06-02 19:20:52.956 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 35.7925ms
2025-06-02 19:20:52.956 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-06-02 19:20:52.956 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 39.8786ms
2025-06-02 19:20:54.063 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat?userId=2 - null null
2025-06-02 19:20:54.063 +07:00 [INF] Executing endpoint '/ws/chat'
2025-06-02 19:20:54.157 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 19:20:54.161 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-06-02 19:20:54.161 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-06-02 19:20:54.163 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-06-02 19:20:54.163 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-06-02 19:20:54.163 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-06-02 19:20:54.164 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-06-02 19:20:54.164 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-06-02 19:20:54.164 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-06-02 19:20:54.164 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-06-02 19:20:54.164 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-06-02 19:20:54.164 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-06-02 19:20:54.164 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-06-02 19:20:54.164 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-06-02 19:20:54.165 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-06-02 19:20:54.166 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-06-02 19:20:54.166 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-06-02 19:20:54.166 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-06-02 19:20:54.166 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-06-02 19:20:54.166 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-06-02 19:20:54.166 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-06-02 19:20:54.167 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-06-02 19:20:54.167 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-06-02 19:20:54.167 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-06-02 19:20:54.167 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-06-02 19:20:54.167 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-06-02 19:20:54.167 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-06-02 19:20:54.168 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-06-02 19:20:54.168 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-06-02 19:20:54.168 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-06-02 19:20:54.168 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-06-02 19:20:54.168 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-06-02 19:20:54.169 +07:00 [INF] User 2 subscribed to channel conversation:54
2025-06-02 19:20:54.169 +07:00 [INF] User 2 subscribed to channel conversation:55
2025-06-02 19:20:54.169 +07:00 [INF] User 2 subscribed to channel conversation:56
2025-06-02 19:20:54.169 +07:00 [INF] User 2 subscribed to channel conversation:57
2025-06-02 19:20:54.170 +07:00 [INF] User 2 subscribed to channel conversation:58
2025-06-02 19:20:54.170 +07:00 [INF] User 2 subscribed to channel conversation:59
2025-06-02 19:20:54.170 +07:00 [INF] User 2 subscribed to channel conversation:60
2025-06-02 19:20:54.170 +07:00 [INF] User 2 subscribed to channel conversation:61
2025-06-02 19:20:54.170 +07:00 [INF] User 2 subscribed to channel conversation:62
2025-06-02 19:20:54.171 +07:00 [INF] User 2 subscribed to channel conversation:63
2025-06-02 19:20:54.171 +07:00 [INF] User 2 subscribed to channel conversation:64
2025-06-02 19:20:54.171 +07:00 [INF] User 2 subscribed to channel conversation:65
2025-06-02 19:20:54.171 +07:00 [INF] User 2 subscribed to channel conversation:66
2025-06-02 19:20:54.171 +07:00 [INF] User 2 subscribed to channel conversation:67
2025-06-02 19:20:54.171 +07:00 [INF] User 2 subscribed to channel conversation:68
2025-06-02 19:20:54.171 +07:00 [INF] User 2 subscribed to channel conversation:69
2025-06-02 19:20:54.284 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-06-02 19:20:54.285 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 19:20:54.285 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 19:20:54.286 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - null null
2025-06-02 19:20:54.286 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 19:20:54.287 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-06-02 19:20:54.308 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-06-02 19:20:54.370 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-06-02 19:20:54.394 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 19:20:54.400 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 19:20:54.415 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 128.5061ms
2025-06-02 19:20:54.416 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-06-02 19:20:54.416 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 130.0639ms
2025-06-02 19:20:54.509 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 223.6668ms
2025-06-02 19:20:54.509 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-06-02 19:20:54.509 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 224.9086ms
2025-06-02 19:21:10.134 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/open_conversation/2/5 - null null
2025-06-02 19:21:10.134 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-06-02 19:21:10.146 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 19:21:10.236 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-06-02 19:21:10.242 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-06-02 19:21:10.399 +07:00 [INF] Executed DbCommand (88ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 19:21:10.400 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 19:21:10.400 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 251.8888ms
2025-06-02 19:21:10.400 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-06-02 19:21:10.401 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/open_conversation/2/5 - 200 null application/json; charset=utf-8 267.1219ms
2025-06-02 19:21:10.789 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/4/2 - null null
2025-06-02 19:21:10.791 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 19:21:10.801 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 19:21:10.841 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__conversationId_0='?' (DbType = Int64), @__user_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE CAST([p].[conversation_id] AS bigint) = @__conversationId_0 AND [p].[user_id] = @__user_id_1
2025-06-02 19:21:10.910 +07:00 [WRN] Message 177 not found in Redis
2025-06-02 19:21:10.910 +07:00 [WRN] Message 161 not found in Redis
2025-06-02 19:21:10.911 +07:00 [WRN] Message 160 not found in Redis
2025-06-02 19:21:10.911 +07:00 [WRN] Message 159 not found in Redis
2025-06-02 19:21:10.912 +07:00 [WRN] Message 135 not found in Redis
2025-06-02 19:21:10.912 +07:00 [WRN] Message 133 not found in Redis
2025-06-02 19:21:10.913 +07:00 [WRN] Message 132 not found in Redis
2025-06-02 19:21:10.913 +07:00 [WRN] Message 131 not found in Redis
2025-06-02 19:21:10.913 +07:00 [WRN] Message 130 not found in Redis
2025-06-02 19:21:10.914 +07:00 [WRN] Message 129 not found in Redis
2025-06-02 19:21:10.914 +07:00 [WRN] Message 128 not found in Redis
2025-06-02 19:21:10.915 +07:00 [WRN] Message 127 not found in Redis
2025-06-02 19:21:10.915 +07:00 [WRN] Message 126 not found in Redis
2025-06-02 19:21:10.915 +07:00 [WRN] Message 125 not found in Redis
2025-06-02 19:21:10.915 +07:00 [WRN] Message 124 not found in Redis
2025-06-02 19:21:10.916 +07:00 [WRN] Message 123 not found in Redis
2025-06-02 19:21:10.916 +07:00 [WRN] Message 122 not found in Redis
2025-06-02 19:21:10.916 +07:00 [WRN] Message 121 not found in Redis
2025-06-02 19:21:10.917 +07:00 [WRN] Message 120 not found in Redis
2025-06-02 19:21:10.918 +07:00 [WRN] Message 119 not found in Redis
2025-06-02 19:21:10.918 +07:00 [WRN] Message 118 not found in Redis
2025-06-02 19:21:10.919 +07:00 [WRN] Message 111 not found in Redis
2025-06-02 19:21:10.919 +07:00 [WRN] Message 97 not found in Redis
2025-06-02 19:21:10.919 +07:00 [WRN] Message 96 not found in Redis
2025-06-02 19:21:10.920 +07:00 [WRN] Message 89 not found in Redis
2025-06-02 19:21:10.920 +07:00 [WRN] Message 69 not found in Redis
2025-06-02 19:21:10.920 +07:00 [WRN] Message 67 not found in Redis
2025-06-02 19:21:10.921 +07:00 [WRN] Message 66 not found in Redis
2025-06-02 19:21:10.921 +07:00 [WRN] Message 63 not found in Redis
2025-06-02 19:21:10.922 +07:00 [WRN] Message 58 not found in Redis
2025-06-02 19:21:10.922 +07:00 [WRN] Message 56 not found in Redis
2025-06-02 19:21:10.923 +07:00 [WRN] Message 53 not found in Redis
2025-06-02 19:21:10.923 +07:00 [WRN] Message 52 not found in Redis
2025-06-02 19:21:10.924 +07:00 [WRN] Message 50 not found in Redis
2025-06-02 19:21:10.924 +07:00 [WRN] Message 47 not found in Redis
2025-06-02 19:21:10.924 +07:00 [WRN] Message 46 not found in Redis
2025-06-02 19:21:10.925 +07:00 [WRN] Message 45 not found in Redis
2025-06-02 19:21:10.925 +07:00 [WRN] Message 44 not found in Redis
2025-06-02 19:21:10.926 +07:00 [WRN] Message 43 not found in Redis
2025-06-02 19:21:10.926 +07:00 [WRN] Message 42 not found in Redis
2025-06-02 19:21:10.927 +07:00 [WRN] Message 41 not found in Redis
2025-06-02 19:21:10.928 +07:00 [WRN] Message 40 not found in Redis
2025-06-02 19:21:10.929 +07:00 [WRN] Message 39 not found in Redis
2025-06-02 19:21:10.930 +07:00 [WRN] Message 38 not found in Redis
2025-06-02 19:21:10.931 +07:00 [WRN] Message 37 not found in Redis
2025-06-02 19:21:10.931 +07:00 [WRN] Message 36 not found in Redis
2025-06-02 19:21:10.932 +07:00 [WRN] Message 35 not found in Redis
2025-06-02 19:21:10.932 +07:00 [WRN] Message 34 not found in Redis
2025-06-02 19:21:10.933 +07:00 [WRN] Message 33 not found in Redis
2025-06-02 19:21:10.933 +07:00 [WRN] Message 32 not found in Redis
2025-06-02 19:21:10.933 +07:00 [INF] Retrieved 3 messages from Redis for conversation 4
2025-06-02 19:21:10.937 +07:00 [INF] Retrieved 3 messages from Redis for conversation 4 and user 2
2025-06-02 19:21:10.938 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 19:21:10.945 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 143.2355ms
2025-06-02 19:21:10.945 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 19:21:10.945 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 155.965ms
2025-06-02 19:21:10.991 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/4 - null null
2025-06-02 19:21:10.991 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 19:21:10.997 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 19:21:11.066 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 19:21:11.132 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 19:21:11.139 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 141.4121ms
2025-06-02 19:21:11.139 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 19:21:11.139 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 148.334ms
2025-06-02 19:21:11.176 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/4 - null null
2025-06-02 19:21:11.176 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 19:21:11.182 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 19:21:11.199 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 19:21:11.201 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 19:21:11.205 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 22.6682ms
2025-06-02 19:21:11.205 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 19:21:11.206 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 29.975ms
2025-06-02 19:21:15.947 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/68/2 - null null
2025-06-02 19:21:15.951 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 19:21:15.951 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-06-02 19:21:15.954 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversationId_0='?' (DbType = Int64), @__user_id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE CAST([p].[conversation_id] AS bigint) = @__conversationId_0 AND [p].[user_id] = @__user_id_1
2025-06-02 19:21:15.959 +07:00 [INF] Retrieved 6 messages from Redis for conversation 68
2025-06-02 19:21:15.959 +07:00 [INF] Retrieved 6 messages from Redis for conversation 68 and user 2
2025-06-02 19:21:15.959 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-06-02 19:21:15.959 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 8.5661ms
2025-06-02 19:21:15.960 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-06-02 19:21:15.960 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/68/2 - 200 null application/json; charset=utf-8 12.97ms
2025-06-02 19:21:16.007 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/68 - null null
2025-06-02 19:21:16.008 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 19:21:16.008 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 19:21:16.013 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 19:21:16.016 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-06-02 19:21:16.016 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.133ms
2025-06-02 19:21:16.016 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-06-02 19:21:16.016 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/68 - 200 null application/json; charset=utf-8 9.0548ms
2025-06-02 19:21:16.058 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - null null
2025-06-02 19:21:16.060 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 19:21:16.060 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-06-02 19:21:16.063 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-06-02 19:21:16.065 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 19:21:16.065 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.1174ms
2025-06-02 19:21:16.065 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-06-02 19:21:16.065 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/68 - 200 null application/json; charset=utf-8 7.571ms
2025-06-02 19:21:19.097 +07:00 [INF] Handling message from user 2: hello
2025-06-02 19:21:19.108 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-06-02 19:21:19.201 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 19:21:19.225 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-06-02 19:21:19.237 +07:00 [INF] Message saved to DB with ID: 462
2025-06-02 19:21:19.240 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-06-02 19:21:19.251 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-06-02 19:21:19.263 +07:00 [INF] Transaction committed for message: 462
2025-06-02 19:21:19.270 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-06-02 19:21:19.276 +07:00 [INF] Saved message 462 to Redis
2025-06-02 19:21:19.278 +07:00 [INF] Added message 462 to conversation 68
2025-06-02 19:21:19.283 +07:00 [INF] Published message to channel conversation:68
2025-06-02 19:21:42.063 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - application/json 55
2025-06-02 19:21:42.065 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 19:21:42.069 +07:00 [INF] Route matched with {action = "CreateGroup", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroup(server.DTO.GroupDto) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 19:21:42.093 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-06-02 19:21:42.107 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 19:21:42.111 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 19:21:42.111 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 19:21:42.112 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 19:21:42.112 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 19:21:42.169 +07:00 [INF] Executed DbCommand (38ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = -1), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (Size = 4000), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (DbType = Int32), @p24='?' (Size = 4000), @p25='?' (DbType = Int32), @p26='?' (Size = 4000), @p27='?' (DbType = Boolean), @p28='?' (DbType = DateTime2), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1),
(@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, 2),
(@p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, 3)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-06-02 19:21:42.171 +07:00 [WRN] Client 6 not found
2025-06-02 19:21:42.171 +07:00 [WRN] Client 3 not found
2025-06-02 19:21:42.171 +07:00 [WRN] Client 5 not found
2025-06-02 19:21:42.173 +07:00 [INF] User 2 subscribed to channel conversation:70
2025-06-02 19:21:42.174 +07:00 [INF] Message 0 already exists in Redis
2025-06-02 19:21:42.178 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 19:21:42.178 +07:00 [INF] Executed action server.Controllers.ConversationController.CreateGroup (Message_app) in 109.5169ms
2025-06-02 19:21:42.178 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.CreateGroup (Message_app)'
2025-06-02 19:21:42.178 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Conversation/create_group - 200 null application/json; charset=utf-8 115.0946ms
2025-06-02 19:21:42.475 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/70 - null null
2025-06-02 19:21:42.476 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 19:21:42.478 +07:00 [INF] Route matched with {action = "GetConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-06-02 19:21:42.505 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversationId_0='?' (DbType = Int32), @__userId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[user_id], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversationId_0 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_1)
) AS [t]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-06-02 19:21:42.512 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-06-02 19:21:42.512 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversation (Message_app) in 34.4048ms
2025-06-02 19:21:42.512 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - application/json 108
2025-06-02 19:21:42.512 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversation (Message_app)'
2025-06-02 19:21:42.513 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversationDto/2/70 - 200 null application/json; charset=utf-8 37.1501ms
2025-06-02 19:21:42.513 +07:00 [INF] Executing endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 19:21:42.516 +07:00 [INF] Route matched with {action = "CreateGroupSetting", controller = "GroupSetting"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGroupSetting(server.DTO.GroupSettingDTO) on controller server.Controllers.GroupSettingController (Message_app).
2025-06-02 19:21:42.523 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__id_0
2025-06-02 19:21:42.530 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-06-02 19:21:42.554 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?' (DbType = Boolean), @p2='?' (DbType = Boolean), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime2), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [GroupSettings] ([AllowMemberEdit], [AllowMemberInvite], [AllowMemberRemove], [ConversationId], [CreatedAt], [CreatedBy])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-06-02 19:21:42.556 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-06-02 19:21:42.558 +07:00 [INF] Executed action server.Controllers.GroupSettingController.CreateGroupSetting (Message_app) in 41.9977ms
2025-06-02 19:21:42.558 +07:00 [INF] Executed endpoint 'server.Controllers.GroupSettingController.CreateGroupSetting (Message_app)'
2025-06-02 19:21:42.559 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/GroupSetting/create - 200 null application/json; charset=utf-8 46.1928ms
