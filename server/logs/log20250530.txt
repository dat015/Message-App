2025-05-30 08:53:26.044 +07:00 [INF] Executed DbCommand (71ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-30 08:53:26.346 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-30 08:53:26.437 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-30 08:53:26.445 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-30 08:53:26.445 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-30 08:53:26.446 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-30 08:53:26.446 +07:00 [INF] Hosting environment: Development
2025-05-30 08:53:26.446 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-30 08:53:32.092 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 08:53:32.113 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:53:32.120 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 30.3345ms
2025-05-30 08:53:32.123 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 08:53:32.123 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:53:32.150 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:53:32.151 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-30 08:53:32.175 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 08:53:32.193 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 08:53:32.350 +07:00 [INF] Executed DbCommand (60ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 08:53:32.432 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 08:53:32.466 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 269.8525ms
2025-05-30 08:53:32.467 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 08:53:32.471 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 348.1767ms
2025-05-30 08:53:32.518 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 08:53:32.523 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:53:32.524 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:53:32.527 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 08:53:32.653 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 08:53:32.653 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:53:32.655 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:53:32.656 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 08:53:32.661 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 08:53:32.795 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 08:53:32.797 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 08:53:32.804 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 142.1089ms
2025-05-30 08:53:32.804 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 08:53:32.804 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 151.5381ms
2025-05-30 08:53:32.899 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 08:53:32.912 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 08:53:32.913 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 08:53:32.914 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 08:53:32.914 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 08:53:32.915 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 08:53:32.915 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 08:53:32.916 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 08:53:32.917 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 08:53:32.917 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 08:53:32.918 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 08:53:32.918 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 08:53:32.919 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 08:53:32.919 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 08:53:32.920 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 08:53:32.920 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 08:53:32.921 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 08:53:32.921 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 08:53:32.922 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 08:53:32.922 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 08:53:32.923 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 08:53:32.923 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 08:53:32.923 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 08:53:32.924 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 08:53:32.924 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 08:53:32.932 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 08:53:32.933 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 08:53:32.981 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 08:53:32.981 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:53:32.981 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.5283ms
2025-05-30 08:53:32.983 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 08:53:32.983 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:53:32.983 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:53:32.983 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 08:53:32.986 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 08:53:33.080 +07:00 [INF] Executed DbCommand (53ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 08:53:33.226 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 08:53:33.237 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 250.6129ms
2025-05-30 08:53:33.237 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 08:53:33.237 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 254.5ms
2025-05-30 08:54:31.116 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - application/json 58
2025-05-30 08:54:31.120 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 08:54:31.120 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 08:54:31.145 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 08:54:31.147 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 08:54:31.147 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 26.6252ms
2025-05-30 08:54:31.147 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 08:54:31.147 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - 200 null application/json; charset=utf-8 31.0357ms
2025-05-30 08:54:32.569 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - null null
2025-05-30 08:54:32.571 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 08:54:32.574 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - null null
2025-05-30 08:54:32.580 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 08:54:32.580 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 08:54:32.600 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 08:54:32.602 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 08:54:32.603 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 22.7161ms
2025-05-30 08:54:32.603 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 08:54:32.603 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 29.2966ms
2025-05-30 08:54:32.806 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 08:54:32.807 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-30 08:54:32.808 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-30 08:54:32.809 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-30 08:54:32.809 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-30 08:54:32.810 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-30 08:54:32.810 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-30 08:54:32.810 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-30 08:54:32.811 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-30 08:54:32.812 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-30 08:54:32.812 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-30 08:54:32.813 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-30 08:54:32.814 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-30 08:54:32.814 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-30 08:54:32.814 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-30 08:54:32.815 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-30 08:54:32.815 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-30 08:54:32.815 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-30 08:54:32.816 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-30 08:54:32.816 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-30 08:54:32.816 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-30 08:54:32.817 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-30 08:54:32.817 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-30 08:54:32.817 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-30 08:54:32.820 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-30 08:54:32.820 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-30 08:54:32.821 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-30 08:54:32.821 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-30 08:54:32.821 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-30 08:54:32.821 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-30 08:54:32.822 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-30 08:54:32.822 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-05-30 08:54:32.824 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:3
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:4
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:19
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:1
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:25
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:26
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:27
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:28
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:29
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:32
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:33
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:34
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:35
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:36
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:37
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:38
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:39
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:41
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:40
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:42
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:44
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:43
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:45
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:46
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:47
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:48
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:49
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:50
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:51
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:52
2025-05-30 08:54:32.824 +07:00 [INF] User 2 already subscribed to channel conversation:53
2025-05-30 08:54:33.316 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - null null
2025-05-30 08:54:33.319 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 08:54:33.319 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 08:54:33.354 +07:00 [INF] Executed DbCommand (32ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 08:54:33.377 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 08:54:33.433 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 113.1538ms
2025-05-30 08:54:33.433 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 08:54:33.433 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 117.0538ms
2025-05-30 08:54:36.776 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - null null
2025-05-30 08:54:36.776 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 08:54:36.780 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 08:54:36.810 +07:00 [INF] Retrieved 7 messages from Redis for conversation 53
2025-05-30 08:54:36.813 +07:00 [INF] Retrieved 7 messages from Redis for conversation 53 and user 2
2025-05-30 08:54:36.813 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 08:54:36.819 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 39.0291ms
2025-05-30 08:54:36.819 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 08:54:36.819 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 43.5684ms
2025-05-30 08:54:36.899 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 08:54:36.900 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 08:54:36.903 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 08:54:36.942 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 08:54:36.974 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 08:54:36.976 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 72.6605ms
2025-05-30 08:54:36.976 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 08:54:36.976 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 77.1107ms
2025-05-30 08:54:37.015 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - null null
2025-05-30 08:54:37.016 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 08:54:37.018 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 08:54:37.030 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 08:54:37.032 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 08:54:37.034 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 15.6678ms
2025-05-30 08:54:37.034 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 08:54:37.034 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 18.6961ms
2025-05-30 08:54:40.453 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 08:54:40.453 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:54:40.454 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.501ms
2025-05-30 08:54:40.456 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 08:54:40.456 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:54:40.457 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:54:40.457 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 08:54:40.457 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 08:54:40.460 +07:00 [INF] Retrieved 7 messages from Redis for conversation 53
2025-05-30 08:54:40.460 +07:00 [INF] Retrieved 7 messages from Redis for conversation 53 and user 3
2025-05-30 08:54:40.461 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 08:54:40.462 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.9429ms
2025-05-30 08:54:40.462 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 08:54:40.462 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 6.559ms
2025-05-30 08:54:40.470 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 08:54:40.470 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:54:40.470 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.313ms
2025-05-30 08:54:40.471 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 08:54:40.471 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:54:40.471 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:54:40.472 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 08:54:40.472 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 08:54:40.474 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 08:54:40.476 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 08:54:40.478 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.1343ms
2025-05-30 08:54:40.478 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 08:54:40.478 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 6.9581ms
2025-05-30 08:54:40.486 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 08:54:40.486 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:54:40.486 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2468ms
2025-05-30 08:54:40.487 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 08:54:40.487 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:54:40.488 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:54:40.488 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 08:54:40.488 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 08:54:40.490 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 08:54:40.491 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 08:54:40.492 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.452ms
2025-05-30 08:54:40.492 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 08:54:40.492 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 4.9825ms
2025-05-30 08:55:22.412 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 08:55:22.414 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 08:55:22.436 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 08:55:22.437 +07:00 [ERR] Connection id "0HNCV3J40O2KH", Request id "0HNCV3J40O2KH:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 08:55:22.439 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 109921.0279ms
2025-05-30 08:55:29.813 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 08:55:29.814 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 08:55:29.818 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 08:55:29.819 +07:00 [ERR] Connection id "0HNCV3J40O2KJ", Request id "0HNCV3J40O2KJ:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 08:55:29.821 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - 101 null null 57251.7891ms
2025-05-30 08:56:51.769 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 08:56:51.772 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:56:51.776 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 7.222ms
2025-05-30 08:56:51.778 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 08:56:51.779 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:56:51.779 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:56:51.783 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 08:56:51.787 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 08:56:51.879 +07:00 [INF] Executed DbCommand (64ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 08:56:51.886 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 08:56:51.887 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 99.9717ms
2025-05-30 08:56:51.887 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 08:56:51.888 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 109.7213ms
2025-05-30 08:56:51.914 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 08:56:51.916 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:56:51.916 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:56:51.916 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 08:56:52.031 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 08:56:52.031 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:56:52.031 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:56:52.032 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 08:56:52.032 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 08:56:52.054 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 08:56:52.055 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 08:56:52.055 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 23.3035ms
2025-05-30 08:56:52.055 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 08:56:52.055 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 24.0734ms
2025-05-30 08:56:52.201 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 08:56:52.202 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 08:56:52.203 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 08:56:52.203 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 08:56:52.203 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 08:56:52.203 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 08:56:52.203 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 08:56:52.203 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 08:56:52.214 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 08:56:52.214 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 08:56:52.214 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 08:56:52.215 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 08:56:52.273 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 08:56:52.273 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:56:52.274 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.5974ms
2025-05-30 08:56:52.275 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 08:56:52.275 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:56:52.275 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:56:52.275 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 08:56:52.275 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 08:56:52.313 +07:00 [INF] Executed DbCommand (36ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 08:56:52.328 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 08:56:52.329 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 53.4931ms
2025-05-30 08:56:52.329 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 08:56:52.329 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 54.5655ms
2025-05-30 08:57:05.942 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - application/json 58
2025-05-30 08:57:05.943 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 08:57:05.943 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 08:57:05.954 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 08:57:05.956 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 08:57:05.956 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 13.5146ms
2025-05-30 08:57:05.956 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 08:57:05.957 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - 200 null application/json; charset=utf-8 14.4942ms
2025-05-30 08:57:06.794 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - null null
2025-05-30 08:57:06.794 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 08:57:07.239 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 08:57:07.240 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-30 08:57:07.240 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-30 08:57:07.240 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-30 08:57:07.240 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-30 08:57:07.240 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-30 08:57:07.240 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-30 08:57:07.240 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-30 08:57:07.241 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-30 08:57:07.242 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-30 08:57:07.242 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-30 08:57:07.242 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-30 08:57:07.242 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-30 08:57:07.242 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-30 08:57:07.242 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-30 08:57:07.242 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-30 08:57:07.242 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-30 08:57:07.242 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-30 08:57:07.242 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-05-30 08:57:07.249 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:3
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:4
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:19
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:1
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:25
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:26
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:27
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:28
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:29
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:32
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:33
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:34
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:35
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:36
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:37
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:38
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:39
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:41
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:40
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:42
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:44
2025-05-30 08:57:07.249 +07:00 [INF] User 2 already subscribed to channel conversation:43
2025-05-30 08:57:07.250 +07:00 [INF] User 2 already subscribed to channel conversation:45
2025-05-30 08:57:07.250 +07:00 [INF] User 2 already subscribed to channel conversation:46
2025-05-30 08:57:07.250 +07:00 [INF] User 2 already subscribed to channel conversation:47
2025-05-30 08:57:07.250 +07:00 [INF] User 2 already subscribed to channel conversation:48
2025-05-30 08:57:07.250 +07:00 [INF] User 2 already subscribed to channel conversation:49
2025-05-30 08:57:07.250 +07:00 [INF] User 2 already subscribed to channel conversation:50
2025-05-30 08:57:07.250 +07:00 [INF] User 2 already subscribed to channel conversation:51
2025-05-30 08:57:07.250 +07:00 [INF] User 2 already subscribed to channel conversation:52
2025-05-30 08:57:07.250 +07:00 [INF] User 2 already subscribed to channel conversation:53
2025-05-30 08:57:07.440 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - null null
2025-05-30 08:57:07.441 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 08:57:07.441 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 08:57:07.465 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 08:57:07.517 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 08:57:07.620 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 179.4984ms
2025-05-30 08:57:07.621 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 08:57:07.621 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 180.4311ms
2025-05-30 08:57:08.356 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - null null
2025-05-30 08:57:08.357 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 08:57:08.357 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 08:57:08.366 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 08:57:08.370 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 08:57:08.371 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 13.4127ms
2025-05-30 08:57:08.371 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 08:57:08.371 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 14.5954ms
2025-05-30 08:57:10.310 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 08:57:10.310 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:57:10.310 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.2899ms
2025-05-30 08:57:10.311 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 08:57:10.311 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:57:10.311 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:57:10.311 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 08:57:10.312 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 08:57:10.320 +07:00 [INF] Retrieved 7 messages from Redis for conversation 53
2025-05-30 08:57:10.320 +07:00 [INF] Retrieved 7 messages from Redis for conversation 53 and user 3
2025-05-30 08:57:10.320 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 08:57:10.321 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 8.9578ms
2025-05-30 08:57:10.321 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 08:57:10.321 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 10.0805ms
2025-05-30 08:57:10.331 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 08:57:10.331 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:57:10.332 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 1.0349ms
2025-05-30 08:57:10.334 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 08:57:10.334 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:57:10.334 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:57:10.334 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 08:57:10.334 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 08:57:10.343 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 08:57:10.346 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 08:57:10.346 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 11.6676ms
2025-05-30 08:57:10.346 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 08:57:10.346 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 12.5795ms
2025-05-30 08:57:10.355 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 08:57:10.355 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:57:10.355 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2228ms
2025-05-30 08:57:10.357 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 08:57:10.357 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:57:10.357 +07:00 [INF] CORS policy execution successful.
2025-05-30 08:57:10.357 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 08:57:10.357 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 08:57:10.362 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 08:57:10.363 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 08:57:10.364 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.374ms
2025-05-30 08:57:10.364 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 08:57:10.364 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 7.1314ms
2025-05-30 08:57:11.009 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - null null
2025-05-30 08:57:11.009 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 08:57:11.009 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 08:57:11.013 +07:00 [INF] Retrieved 7 messages from Redis for conversation 53
2025-05-30 08:57:11.013 +07:00 [INF] Retrieved 7 messages from Redis for conversation 53 and user 2
2025-05-30 08:57:11.013 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 08:57:11.014 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.0298ms
2025-05-30 08:57:11.014 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 08:57:11.014 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 5.2969ms
2025-05-30 08:57:11.092 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 08:57:11.093 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 08:57:11.093 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 08:57:11.099 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 08:57:11.100 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 08:57:11.100 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.6819ms
2025-05-30 08:57:11.100 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 08:57:11.100 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 8.2883ms
2025-05-30 08:57:11.156 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - null null
2025-05-30 08:57:11.156 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 08:57:11.157 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 08:57:11.161 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 08:57:11.162 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 08:57:11.163 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.9188ms
2025-05-30 08:57:11.163 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 08:57:11.163 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 6.6512ms
2025-05-30 08:59:20.273 +07:00 [INF] Handling message from user 3: hello
2025-05-30 08:59:20.365 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-30 08:59:20.619 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 08:59:20.705 +07:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-30 08:59:20.736 +07:00 [INF] Message saved to DB with ID: 427
2025-05-30 08:59:20.741 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 08:59:20.753 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-30 08:59:20.772 +07:00 [INF] Transaction committed for message: 427
2025-05-30 08:59:20.786 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 08:59:20.802 +07:00 [INF] Saved message 427 to Redis
2025-05-30 08:59:20.806 +07:00 [INF] Added message 427 to conversation 53
2025-05-30 08:59:20.818 +07:00 [INF] Published message to channel conversation:53
2025-05-30 09:02:15.359 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:02:15.360 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:15.360 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.5781ms
2025-05-30 09:02:15.361 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:02:15.361 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:15.361 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:15.361 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:02:15.362 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:02:15.398 +07:00 [INF] Executed DbCommand (34ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:02:15.399 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:02:15.400 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 37.8253ms
2025-05-30 09:02:15.400 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:02:15.400 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 38.8973ms
2025-05-30 09:02:15.421 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:02:15.421 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:15.422 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:15.422 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:02:15.525 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:02:15.525 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:15.525 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:15.525 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:02:15.527 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:02:15.536 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:02:15.536 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:02:15.536 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.3269ms
2025-05-30 09:02:15.536 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:02:15.536 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 11.345ms
2025-05-30 09:02:15.600 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:02:15.600 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:02:15.604 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:02:15.607 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:02:15.605 +07:00 [ERR] Connection id "0HNCV3J40O2KR", Request id "0HNCV3J40O2KR:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:02:15.608 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:02:15.608 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:02:15.608 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:02:15.608 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:02:15.609 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 323695.0056ms
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:02:15.609 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:02:15.612 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:02:15.612 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:02:15.671 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:02:15.671 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:15.671 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.5198ms
2025-05-30 09:02:15.673 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:02:15.673 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:15.673 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:15.674 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:02:15.674 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:02:15.691 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:02:15.705 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:02:15.707 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 33.0098ms
2025-05-30 09:02:15.707 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:02:15.707 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 33.7961ms
2025-05-30 09:02:17.999 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:02:17.999 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:18.000 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.4792ms
2025-05-30 09:02:18.001 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:02:18.001 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:18.001 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:18.001 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:02:18.001 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:02:18.004 +07:00 [INF] Retrieved 8 messages from Redis for conversation 53
2025-05-30 09:02:18.004 +07:00 [INF] Retrieved 8 messages from Redis for conversation 53 and user 3
2025-05-30 09:02:18.004 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:02:18.006 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.3841ms
2025-05-30 09:02:18.007 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:02:18.007 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 5.7214ms
2025-05-30 09:02:18.014 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:02:18.014 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:18.015 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.5116ms
2025-05-30 09:02:18.016 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:02:18.016 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:18.017 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:18.017 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:02:18.018 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:02:18.024 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:02:18.026 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:02:18.026 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.5273ms
2025-05-30 09:02:18.026 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:02:18.026 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 10.1495ms
2025-05-30 09:02:18.034 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:02:18.034 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:18.035 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2493ms
2025-05-30 09:02:18.036 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:02:18.036 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:18.036 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:18.036 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:02:18.037 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:02:18.041 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:02:18.044 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:02:18.044 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.0795ms
2025-05-30 09:02:18.044 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:02:18.045 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 8.7301ms
2025-05-30 09:02:20.688 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:02:20.688 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:20.689 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:02:20.690 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:02:20.694 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:02:20.694 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:02:20.695 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:02:20.695 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:02:20.695 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:02:20.695 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:02:20.695 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:02:20.695 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:02:20.695 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:02:20.695 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:02:20.695 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:02:20.696 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:02:20.696 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:02:20.696 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:02:20.696 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:02:20.696 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:02:20.696 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:02:20.696 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:02:20.697 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:02:20.697 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:02:20.697 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:02:20.697 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:02:20.697 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:02:20.697 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:02:20.697 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:05:39.350 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:05:39.350 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:05:39.357 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:05:39.357 +07:00 [ERR] Connection id "0HNCV3J40O2L5", Request id "0HNCV3J40O2L5:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:05:39.369 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 198681.3175ms
2025-05-30 09:05:39.374 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:05:39.374 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:05:39.375 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:05:39.375 +07:00 [ERR] Connection id "0HNCV3J40O2L4", Request id "0HNCV3J40O2L4:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:05:39.386 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 203964.9173ms
2025-05-30 09:05:57.237 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:05:57.237 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:57.237 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3253ms
2025-05-30 09:05:57.238 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:05:57.239 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:57.239 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:57.239 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:05:57.239 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:05:57.254 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:05:57.257 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:05:57.257 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 18.147ms
2025-05-30 09:05:57.258 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:05:57.258 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 19.6046ms
2025-05-30 09:05:57.288 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:05:57.289 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:57.289 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:57.289 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:05:57.438 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:05:57.438 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:57.438 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:57.438 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:05:57.438 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:05:57.449 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:05:57.449 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:05:57.449 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.0428ms
2025-05-30 09:05:57.449 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:05:57.449 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 11.9198ms
2025-05-30 09:05:57.538 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:05:57.539 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:05:57.540 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:05:57.540 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:05:57.540 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:05:57.540 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:05:57.540 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:05:57.540 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:05:57.540 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:05:57.540 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:05:57.540 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:05:57.540 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:05:57.543 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:05:57.543 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:05:57.544 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:05:57.544 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:05:57.544 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:05:57.544 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:05:57.544 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:05:57.544 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:05:57.544 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:05:57.544 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:05:57.544 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:05:57.544 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:05:57.545 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:05:57.545 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:05:57.545 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:05:57.545 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:05:57.545 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:05:57.545 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:05:57.545 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:05:57.545 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:05:57.545 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:05:57.545 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:05:57.545 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:05:57.545 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:05:57.545 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:05:57.627 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:05:57.627 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:57.627 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2298ms
2025-05-30 09:05:57.629 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:05:57.630 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:57.630 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:57.630 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:05:57.630 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:05:57.647 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:05:57.661 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:05:57.662 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 31.9137ms
2025-05-30 09:05:57.662 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:05:57.662 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 32.7604ms
2025-05-30 09:05:59.962 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:05:59.962 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:59.963 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 1.5531ms
2025-05-30 09:05:59.965 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:05:59.965 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:59.965 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:59.965 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:05:59.965 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:05:59.972 +07:00 [INF] Retrieved 8 messages from Redis for conversation 53
2025-05-30 09:05:59.972 +07:00 [INF] Retrieved 8 messages from Redis for conversation 53 and user 3
2025-05-30 09:05:59.972 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:05:59.974 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 8.6113ms
2025-05-30 09:05:59.974 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:05:59.974 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 9.3655ms
2025-05-30 09:05:59.989 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:05:59.989 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:59.989 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.2489ms
2025-05-30 09:05:59.991 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:05:59.991 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:59.991 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:05:59.991 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:05:59.991 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:06:00.002 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:06:00.003 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:06:00.004 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 12.5227ms
2025-05-30 09:06:00.004 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:06:00.004 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 13.3108ms
2025-05-30 09:06:00.023 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:06:00.023 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:06:00.023 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2086ms
2025-05-30 09:06:00.024 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:06:00.025 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:06:00.025 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:06:00.025 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:06:00.025 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:06:00.028 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:06:00.030 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:06:00.030 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.2852ms
2025-05-30 09:06:00.030 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:06:00.030 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 5.7888ms
2025-05-30 09:10:41.165 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:10:41.165 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:41.165 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2158ms
2025-05-30 09:10:41.166 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:10:41.166 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:41.166 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:41.167 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:10:41.167 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:10:41.385 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:10:41.386 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:10:41.386 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 219.0845ms
2025-05-30 09:10:41.386 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:10:41.386 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 220.1942ms
2025-05-30 09:10:41.417 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:10:41.417 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:41.417 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:41.417 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:10:41.525 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:10:41.525 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:41.525 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:41.526 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:10:41.526 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:10:41.529 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:10:41.529 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:10:41.530 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:10:41.530 +07:00 [ERR] Connection id "0HNCV3J40O2L7", Request id "0HNCV3J40O2L7:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:10:41.530 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 284241.7893ms
2025-05-30 09:10:41.541 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:10:41.541 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:10:41.542 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 15.8283ms
2025-05-30 09:10:41.542 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:10:41.542 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 16.5526ms
2025-05-30 09:10:41.543 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:10:41.544 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:10:41.547 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:10:41.548 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:10:41.677 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:10:41.677 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:41.677 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2517ms
2025-05-30 09:10:41.678 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:10:41.678 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:41.678 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:41.678 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:10:41.678 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:10:41.696 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:10:41.708 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:10:41.709 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 30.2439ms
2025-05-30 09:10:41.709 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:10:41.709 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 31.2158ms
2025-05-30 09:10:43.084 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:10:43.084 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:43.084 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.3019ms
2025-05-30 09:10:43.085 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:10:43.085 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:43.086 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:43.086 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:10:43.086 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:10:43.091 +07:00 [INF] Retrieved 8 messages from Redis for conversation 53
2025-05-30 09:10:43.091 +07:00 [INF] Retrieved 8 messages from Redis for conversation 53 and user 3
2025-05-30 09:10:43.091 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:10:43.092 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 5.1723ms
2025-05-30 09:10:43.092 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:10:43.092 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 6.691ms
2025-05-30 09:10:43.104 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:10:43.105 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:43.105 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.5415ms
2025-05-30 09:10:43.107 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:10:43.107 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:43.107 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:43.107 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:10:43.107 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:10:43.115 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:10:43.116 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:10:43.117 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.3471ms
2025-05-30 09:10:43.117 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:10:43.117 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 10.4526ms
2025-05-30 09:10:43.128 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:10:43.128 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:43.128 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.1998ms
2025-05-30 09:10:43.130 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:10:43.130 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:43.130 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:43.130 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:10:43.130 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:10:43.135 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:10:43.136 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:10:43.137 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.5971ms
2025-05-30 09:10:43.137 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:10:43.137 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 7.4864ms
2025-05-30 09:10:46.636 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:10:46.637 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:46.637 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:10:46.637 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:10:46.647 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:10:46.648 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:10:46.649 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:10:46.649 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:10:46.649 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:10:46.649 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:10:46.649 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:10:46.650 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:10:46.651 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:10:46.673 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:16:24.192 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:16:24.193 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:24.193 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2703ms
2025-05-30 09:16:24.194 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:16:24.194 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:24.194 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:24.194 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:16:24.197 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:16:24.226 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:16:24.230 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:16:24.230 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 33.507ms
2025-05-30 09:16:24.230 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:16:24.231 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 37.5666ms
2025-05-30 09:16:24.248 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:16:24.248 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:24.248 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:24.248 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:16:24.361 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:16:24.361 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:24.362 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:24.362 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:16:24.362 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:16:24.380 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:16:24.381 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:16:24.381 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 19.3542ms
2025-05-30 09:16:24.381 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:16:24.381 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 19.8384ms
2025-05-30 09:16:24.452 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:16:24.452 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:16:24.453 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:16:24.454 +07:00 [ERR] Connection id "0HNCV3J40O2LA", Request id "0HNCV3J40O2LA:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:16:24.455 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 337818.3557ms
2025-05-30 09:16:24.460 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:16:24.460 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:16:24.463 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:16:24.463 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:16:24.464 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:16:24.464 +07:00 [ERR] Connection id "0HNCV3J40O2L9", Request id "0HNCV3J40O2L9:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:16:24.466 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:16:24.467 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 343049.9622ms
2025-05-30 09:16:24.467 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:16:24.467 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:16:24.468 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:16:24.468 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:16:24.469 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:16:24.469 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:16:24.469 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:16:24.469 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:16:24.469 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:16:24.469 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:16:24.469 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:16:24.469 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:16:24.469 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:16:24.469 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:16:24.469 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:16:24.469 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:16:24.469 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:16:24.470 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:16:24.470 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:16:24.470 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:16:24.470 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:16:24.470 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:16:24.470 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:16:24.470 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:16:24.554 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:16:24.554 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:24.554 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.338ms
2025-05-30 09:16:24.556 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:16:24.556 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:24.556 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:24.556 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:16:24.556 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:16:24.571 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:16:24.594 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:16:24.595 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 39.0272ms
2025-05-30 09:16:24.595 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:16:24.595 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 39.6633ms
2025-05-30 09:16:26.165 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:16:26.165 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:26.165 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.2897ms
2025-05-30 09:16:26.167 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:16:26.167 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:26.167 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:26.167 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:16:26.167 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:16:26.172 +07:00 [INF] Retrieved 8 messages from Redis for conversation 53
2025-05-30 09:16:26.172 +07:00 [INF] Retrieved 8 messages from Redis for conversation 53 and user 3
2025-05-30 09:16:26.172 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:16:26.172 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 5.0336ms
2025-05-30 09:16:26.172 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:16:26.173 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 5.89ms
2025-05-30 09:16:26.181 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:16:26.181 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:26.181 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.2475ms
2025-05-30 09:16:26.182 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:16:26.183 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:26.183 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:26.183 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:16:26.183 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:16:26.200 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:16:26.202 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:16:26.202 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 19.2356ms
2025-05-30 09:16:26.202 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:16:26.202 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 20.1799ms
2025-05-30 09:16:26.211 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:16:26.212 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:26.212 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 1.4645ms
2025-05-30 09:16:26.214 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:16:26.214 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:26.214 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:26.214 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:16:26.214 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:16:26.222 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:16:26.224 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:16:26.224 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.3079ms
2025-05-30 09:16:26.224 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:16:26.224 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 10.2256ms
2025-05-30 09:16:29.572 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:16:29.572 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:29.572 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:29.573 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:16:29.591 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:16:29.592 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:29.592 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:29.593 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:16:29.593 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:16:29.593 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:16:29.596 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:16:29.596 +07:00 [ERR] Connection id "0HNCV3J40O2LC", Request id "0HNCV3J40O2LC:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:16:29.597 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 5349.9498ms
2025-05-30 09:16:29.625 +07:00 [INF] Executed DbCommand (37ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:16:29.625 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:16:29.626 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:16:29.626 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:16:34.613 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:16:34.614 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:34.614 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:34.614 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:16:34.618 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:16:34.618 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:16:34.621 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:16:34.621 +07:00 [ERR] Connection id "0HNCV3J40O2LE", Request id "0HNCV3J40O2LE:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:16:34.622 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 5030.9016ms
2025-05-30 09:16:34.648 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:16:34.649 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:16:34.650 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:16:39.632 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:16:39.632 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:39.633 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:16:39.633 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:16:39.636 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:16:39.636 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:16:39.637 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:16:39.637 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:16:39.637 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:16:39.637 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:16:39.637 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:16:39.637 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:16:39.637 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:17:01.041 +07:00 [INF] Handling message from user 2:  t chi cuc gi v ang bn
2025-05-30 09:17:01.075 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-30 09:17:01.094 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 09:17:01.123 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-30 09:17:01.124 +07:00 [INF] Message saved to DB with ID: 428
2025-05-30 09:17:01.126 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 09:17:01.139 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-30 09:17:01.140 +07:00 [INF] Transaction committed for message: 428
2025-05-30 09:17:01.144 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:17:01.150 +07:00 [INF] Saved message 428 to Redis
2025-05-30 09:17:01.152 +07:00 [INF] Added message 428 to conversation 53
2025-05-30 09:17:01.156 +07:00 [INF] Published message to channel conversation:53
2025-05-30 09:24:18.429 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:24:18.430 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:18.430 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3605ms
2025-05-30 09:24:18.431 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:24:18.431 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:18.431 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:18.431 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:24:18.431 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:24:18.548 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:24:18.549 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:24:18.549 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 117.6363ms
2025-05-30 09:24:18.549 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:24:18.549 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 118.2764ms
2025-05-30 09:24:18.558 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:24:18.558 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:18.558 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:18.558 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:24:18.669 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:24:18.669 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:18.669 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:18.670 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:24:18.670 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:24:18.677 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:24:18.677 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:24:18.680 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.6895ms
2025-05-30 09:24:18.680 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:24:18.680 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 11.3558ms
2025-05-30 09:24:18.759 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:24:18.759 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:24:18.759 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:24:18.759 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:24:18.759 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:24:18.759 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:24:18.759 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:24:18.759 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:24:18.759 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:24:18.760 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:24:18.764 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:24:18.765 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:24:18.765 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:24:18.766 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:24:18.847 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:24:18.847 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:18.847 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2598ms
2025-05-30 09:24:18.849 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:24:18.849 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:18.849 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:18.849 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:24:18.849 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:24:18.866 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:24:18.879 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:24:18.880 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 31.194ms
2025-05-30 09:24:18.880 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:24:18.881 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 32.165ms
2025-05-30 09:24:20.714 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:24:20.714 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:20.714 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.215ms
2025-05-30 09:24:20.715 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:24:20.716 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:20.716 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:20.716 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:24:20.716 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:24:20.729 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:24:20.729 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 3
2025-05-30 09:24:20.730 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:24:20.730 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 13.9928ms
2025-05-30 09:24:20.730 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:24:20.730 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 14.5604ms
2025-05-30 09:24:20.738 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:24:20.739 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:20.739 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.391ms
2025-05-30 09:24:20.741 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:24:20.742 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:20.742 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:20.742 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:24:20.743 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:24:20.749 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:24:20.751 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:24:20.752 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.1036ms
2025-05-30 09:24:20.752 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:24:20.752 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 10.6107ms
2025-05-30 09:24:20.763 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:24:20.763 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:20.763 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2092ms
2025-05-30 09:24:20.765 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:24:20.765 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:20.765 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:24:20.765 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:24:20.765 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:24:20.768 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:24:20.771 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:24:20.772 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.5354ms
2025-05-30 09:24:20.772 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:24:20.772 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 6.9441ms
2025-05-30 09:24:45.646 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:24:45.647 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:24:45.650 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:24:45.650 +07:00 [ERR] Connection id "0HNCV3J40O2KT", Request id "0HNCV3J40O2KT:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:24:45.651 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - 101 null null 1658857.2375ms
2025-05-30 09:25:01.981 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:25:01.981 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:25:01.981 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:25:01.981 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:25:01.982 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:25:01.983 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:25:01.983 +07:00 [ERR] Connection id "0HNCV3J40O2LG", Request id "0HNCV3J40O2LG:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:25:01.984 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 502351.4705ms
2025-05-30 09:25:01.984 +07:00 [ERR] Connection id "0HNCV3J40O2LD", Request id "0HNCV3J40O2LD:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:25:01.986 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:25:01.988 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 512414.8387ms
2025-05-30 09:25:01.987 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:25:01.988 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:25:01.988 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:25:01.990 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:25:01.990 +07:00 [ERR] Connection id "0HNCV3J40O2LI", Request id "0HNCV3J40O2LI:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:25:01.992 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:25:01.999 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 43441.0026ms
2025-05-30 09:25:01.999 +07:00 [ERR] Connection id "0HNCV3J40O2LF", Request id "0HNCV3J40O2LF:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:25:02.001 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 507387.9148ms
2025-05-30 09:26:25.712 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:26:25.716 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:25.720 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 7.7401ms
2025-05-30 09:26:25.722 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:26:25.723 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:25.725 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:25.726 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:26:25.731 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:26:25.834 +07:00 [INF] Executed DbCommand (65ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:26:25.851 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:26:25.852 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 120.5238ms
2025-05-30 09:26:25.852 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:26:25.852 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 130.1653ms
2025-05-30 09:26:25.882 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:26:25.883 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:25.883 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:25.883 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:26:26.023 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:26:26.023 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:26.023 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:26.023 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:26:26.023 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:26:26.065 +07:00 [INF] Executed DbCommand (37ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:26:26.065 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:26:26.065 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 42.0797ms
2025-05-30 09:26:26.066 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:26:26.066 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 42.8809ms
2025-05-30 09:26:26.216 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:26:26.217 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:26:26.218 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:26:26.218 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:26:26.218 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:26:26.220 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:26:26.220 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:26:26.221 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:26:26.323 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:26:26.323 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:26.323 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1726ms
2025-05-30 09:26:26.325 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:26:26.326 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:26.326 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:26.326 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:26:26.326 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:26:26.422 +07:00 [INF] Executed DbCommand (51ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:26:26.437 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:26:26.442 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 116.0508ms
2025-05-30 09:26:26.442 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:26:26.442 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 117.3809ms
2025-05-30 09:26:51.907 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - application/json 58
2025-05-30 09:26:51.911 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:26:51.911 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:26:51.937 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:26:51.940 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:26:51.941 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 29.5604ms
2025-05-30 09:26:51.941 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:26:51.941 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - 200 null application/json; charset=utf-8 33.9284ms
2025-05-30 09:26:53.233 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - null null
2025-05-30 09:26:53.233 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:26:53.233 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:26:53.248 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:26:53.252 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:26:53.252 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 19.0149ms
2025-05-30 09:26:53.252 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:26:53.253 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 20.0551ms
2025-05-30 09:26:53.402 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - null null
2025-05-30 09:26:53.402 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:26:53.403 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:26:53.442 +07:00 [INF] Executed DbCommand (35ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:26:53.498 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:26:53.526 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 122.4044ms
2025-05-30 09:26:53.526 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:26:53.526 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 124.1661ms
2025-05-30 09:26:53.960 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - null null
2025-05-30 09:26:53.960 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:26:54.049 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-30 09:26:54.050 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-30 09:26:54.051 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-30 09:26:54.051 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-30 09:26:54.051 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-30 09:26:54.051 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-05-30 09:26:54.053 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:3
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:4
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:19
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:1
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:25
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:26
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:27
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:28
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:29
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:32
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:33
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:34
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:35
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:36
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:37
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:38
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:39
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:41
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:40
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:42
2025-05-30 09:26:54.054 +07:00 [INF] User 2 already subscribed to channel conversation:44
2025-05-30 09:26:54.055 +07:00 [INF] User 2 already subscribed to channel conversation:43
2025-05-30 09:26:54.055 +07:00 [INF] User 2 already subscribed to channel conversation:45
2025-05-30 09:26:54.055 +07:00 [INF] User 2 already subscribed to channel conversation:46
2025-05-30 09:26:54.055 +07:00 [INF] User 2 already subscribed to channel conversation:47
2025-05-30 09:26:54.055 +07:00 [INF] User 2 already subscribed to channel conversation:48
2025-05-30 09:26:54.055 +07:00 [INF] User 2 already subscribed to channel conversation:49
2025-05-30 09:26:54.055 +07:00 [INF] User 2 already subscribed to channel conversation:50
2025-05-30 09:26:54.055 +07:00 [INF] User 2 already subscribed to channel conversation:51
2025-05-30 09:26:54.055 +07:00 [INF] User 2 already subscribed to channel conversation:52
2025-05-30 09:26:54.055 +07:00 [INF] User 2 already subscribed to channel conversation:53
2025-05-30 09:26:58.715 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:26:58.716 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:58.716 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.9935ms
2025-05-30 09:26:58.717 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:26:58.717 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:58.717 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:58.717 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:26:58.717 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:26:58.722 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:26:58.724 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 3
2025-05-30 09:26:58.725 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:26:58.727 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 9.193ms
2025-05-30 09:26:58.727 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:26:58.727 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 9.8968ms
2025-05-30 09:26:58.741 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:26:58.741 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:58.741 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.279ms
2025-05-30 09:26:58.742 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:26:58.743 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:58.743 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:58.743 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:26:58.743 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:26:58.763 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:26:58.771 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:26:58.771 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 27.9436ms
2025-05-30 09:26:58.771 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:26:58.771 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 28.9928ms
2025-05-30 09:26:58.786 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:26:58.786 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:58.786 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2014ms
2025-05-30 09:26:58.788 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:26:58.788 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:58.788 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:26:58.788 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:26:58.789 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:26:58.799 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:26:58.803 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:26:58.804 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 15.2427ms
2025-05-30 09:26:58.804 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:26:58.804 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 16.6134ms
2025-05-30 09:27:00.619 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - null null
2025-05-30 09:27:00.621 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:27:00.621 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:27:00.624 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:27:00.624 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 2
2025-05-30 09:27:00.625 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:27:00.637 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 15.9643ms
2025-05-30 09:27:00.637 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:27:00.637 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 18.0008ms
2025-05-30 09:27:00.707 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:27:00.707 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:27:00.708 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:27:00.710 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:27:00.715 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:27:00.716 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.0903ms
2025-05-30 09:27:00.716 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:27:00.716 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 8.7949ms
2025-05-30 09:27:00.757 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:27:00.757 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:27:00.757 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:27:00.759 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:27:00.760 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:27:00.760 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.1187ms
2025-05-30 09:27:00.760 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:27:00.760 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 3.5969ms
2025-05-30 09:28:48.194 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:28:48.194 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:48.195 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.4003ms
2025-05-30 09:28:48.195 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:28:48.196 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:48.196 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:48.196 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:28:48.196 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:28:48.222 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:28:48.223 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:28:48.224 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 27.5412ms
2025-05-30 09:28:48.224 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:28:48.224 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 28.2501ms
2025-05-30 09:28:48.256 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:28:48.256 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:48.256 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:48.257 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:28:48.378 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:28:48.378 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:48.378 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:48.378 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:28:48.378 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:28:48.390 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:28:48.390 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:28:48.390 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 12.3604ms
2025-05-30 09:28:48.390 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:28:48.391 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 13.0999ms
2025-05-30 09:28:48.479 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:28:48.480 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:28:48.481 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:28:48.481 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:28:48.481 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:28:48.481 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:28:48.486 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:28:48.486 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:28:48.567 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:28:48.568 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:48.568 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2787ms
2025-05-30 09:28:48.570 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:28:48.570 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:48.570 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:48.571 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:28:48.572 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:28:48.590 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:28:48.605 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:28:48.606 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 34.102ms
2025-05-30 09:28:48.607 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:28:48.607 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 37.1743ms
2025-05-30 09:28:51.411 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:28:51.411 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:51.411 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.2256ms
2025-05-30 09:28:51.413 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:28:51.413 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:51.413 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:51.413 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:28:51.413 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:28:51.418 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:28:51.418 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 3
2025-05-30 09:28:51.418 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:28:51.418 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.8562ms
2025-05-30 09:28:51.419 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:28:51.419 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 6.3363ms
2025-05-30 09:28:51.428 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:28:51.428 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:51.428 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.2069ms
2025-05-30 09:28:51.429 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:28:51.430 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:51.430 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:51.430 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:28:51.430 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:28:51.443 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:28:51.446 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:28:51.446 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 16.3366ms
2025-05-30 09:28:51.447 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:28:51.447 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 17.6692ms
2025-05-30 09:28:51.457 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:28:51.457 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:51.457 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2391ms
2025-05-30 09:28:51.458 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:28:51.458 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:51.458 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:28:51.458 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:28:51.459 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:28:51.464 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:28:51.466 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:28:51.466 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.4529ms
2025-05-30 09:28:51.466 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:28:51.466 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 7.8868ms
2025-05-30 09:30:32.271 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:30:32.271 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:32.272 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3404ms
2025-05-30 09:30:32.273 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:30:32.273 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:32.273 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:32.273 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:30:32.273 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:30:32.288 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:30:32.290 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:30:32.292 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 18.7645ms
2025-05-30 09:30:32.292 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:30:32.293 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 19.9753ms
2025-05-30 09:30:32.317 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:30:32.317 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:32.317 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:32.318 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:30:32.453 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:30:32.453 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:32.453 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:32.455 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:30:32.455 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:30:32.477 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:30:32.477 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:30:32.477 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 22.1242ms
2025-05-30 09:30:32.477 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:30:32.477 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 24.7856ms
2025-05-30 09:30:32.558 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:30:32.566 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:30:32.566 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:30:32.567 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:30:32.569 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:30:32.571 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:30:32.572 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:30:32.572 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:30:32.572 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:30:32.573 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:30:32.573 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:30:32.573 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:30:32.573 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:30:32.573 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:30:32.573 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:30:32.573 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:30:32.573 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:30:32.573 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:30:32.573 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:30:32.573 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:30:32.573 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:30:32.559 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:30:32.574 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:30:32.569 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:30:32.574 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:30:32.576 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:30:32.576 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:30:32.576 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:30:32.576 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:30:32.576 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:30:32.576 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:30:32.576 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:30:32.578 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:30:32.578 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:30:32.577 +07:00 [ERR] Connection id "0HNCV3J40O2LK", Request id "0HNCV3J40O2LK:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:30:32.577 +07:00 [ERR] Connection id "0HNCV3J40O2LT", Request id "0HNCV3J40O2LT:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:30:32.581 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 246698.8333ms
2025-05-30 09:30:32.582 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 104325.7811ms
2025-05-30 09:30:32.663 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:30:32.663 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:32.664 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2584ms
2025-05-30 09:30:32.665 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:30:32.665 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:32.666 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:32.666 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:30:32.666 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:30:32.690 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:30:32.705 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:30:32.707 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 41.4613ms
2025-05-30 09:30:32.707 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:30:32.708 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 42.4406ms
2025-05-30 09:30:35.677 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:30:35.677 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:35.677 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.2285ms
2025-05-30 09:30:35.678 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:30:35.679 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:35.679 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:35.679 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:30:35.679 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:30:35.682 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:30:35.682 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 3
2025-05-30 09:30:35.683 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:30:35.683 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 3.5605ms
2025-05-30 09:30:35.683 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:30:35.683 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 4.6046ms
2025-05-30 09:30:35.691 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:30:35.691 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:35.691 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.163ms
2025-05-30 09:30:35.693 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:30:35.693 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:35.693 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:35.693 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:30:35.693 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:30:35.703 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:30:35.707 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:30:35.708 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 14.4713ms
2025-05-30 09:30:35.708 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:30:35.708 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 15.1521ms
2025-05-30 09:30:35.721 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:30:35.721 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:35.721 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.4345ms
2025-05-30 09:30:35.723 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:30:35.723 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:35.723 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:35.723 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:30:35.723 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:30:35.728 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:30:35.730 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:30:35.730 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.8382ms
2025-05-30 09:30:35.730 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:30:35.730 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 7.3697ms
2025-05-30 09:30:37.671 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:30:37.671 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:37.671 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:37.671 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:30:37.681 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:30:37.681 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:30:37.682 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:30:37.696 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:30:37.696 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:37.696 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:37.697 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:30:37.700 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:30:37.701 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:30:37.702 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:30:37.702 +07:00 [ERR] Connection id "0HNCV3J40O2M2", Request id "0HNCV3J40O2M2:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:30:37.703 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:30:37.704 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 32.4997ms
2025-05-30 09:30:37.707 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:30:37.707 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:30:37.707 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:30:37.707 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:30:37.707 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:30:37.707 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:30:37.707 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:30:37.707 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:30:37.707 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:30:37.707 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:30:37.707 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:30:37.708 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:30:37.708 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:30:37.708 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:30:37.708 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:30:37.708 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:30:37.708 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:30:37.708 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:30:37.708 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:30:37.708 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:30:37.708 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:30:37.708 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:30:37.708 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:30:37.708 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:30:42.712 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:30:42.713 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:42.713 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:30:42.713 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:30:42.721 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:30:42.722 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:30:42.723 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:30:42.723 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:30:42.723 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:30:44.313 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:30:44.313 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:30:44.313 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:30:44.314 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:30:44.313 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:30:44.314 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:30:44.314 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:30:44.314 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:30:44.314 +07:00 [ERR] Connection id "0HNCV3J40O2M4", Request id "0HNCV3J40O2M4:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:30:44.314 +07:00 [ERR] Connection id "0HNCV3J40O2M3", Request id "0HNCV3J40O2M3:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:30:44.314 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:30:44.316 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1603.4227ms
2025-05-30 09:30:44.329 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 6633.2187ms
2025-05-30 09:30:44.329 +07:00 [ERR] Connection id "0HNCV3J40O2M0", Request id "0HNCV3J40O2M0:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:30:44.340 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 12023.4054ms
2025-05-30 09:30:47.132 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:30:47.133 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:30:47.140 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:30:47.140 +07:00 [ERR] Connection id "0HNCV3J40O2LO", Request id "0HNCV3J40O2LO:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:30:47.141 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - 101 null null 233181.0804ms
2025-05-30 09:32:08.726 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:32:08.727 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:08.727 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.7772ms
2025-05-30 09:32:08.729 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:32:08.730 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:08.730 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:08.730 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:32:08.730 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:32:08.762 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:32:08.763 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:32:08.763 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 33.5592ms
2025-05-30 09:32:08.763 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:32:08.764 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 34.4939ms
2025-05-30 09:32:08.777 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:32:08.777 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:08.777 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:08.778 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:32:08.902 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:32:08.902 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:08.902 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:08.902 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:32:08.902 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:32:08.911 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:32:08.911 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:32:08.911 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.149ms
2025-05-30 09:32:08.911 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:32:08.912 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 9.4459ms
2025-05-30 09:32:09.070 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:32:09.071 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:32:09.071 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:32:09.071 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:32:09.071 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:32:09.071 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:32:09.072 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:32:09.076 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:32:09.077 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:32:09.151 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:32:09.151 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:09.151 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.1789ms
2025-05-30 09:32:09.153 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:32:09.153 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:09.153 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:09.153 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:32:09.153 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:32:09.170 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:32:09.184 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:32:09.187 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 33.8158ms
2025-05-30 09:32:09.187 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:32:09.188 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 34.5381ms
2025-05-30 09:32:18.854 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - application/json 58
2025-05-30 09:32:18.854 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:32:18.854 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:32:18.857 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:32:18.858 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:32:18.858 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 3.9795ms
2025-05-30 09:32:18.858 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:32:18.858 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - 200 null application/json; charset=utf-8 4.5365ms
2025-05-30 09:32:20.083 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - null null
2025-05-30 09:32:20.084 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:32:20.288 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - null null
2025-05-30 09:32:20.288 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:32:20.288 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:32:20.304 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:32:20.333 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - null null
2025-05-30 09:32:20.333 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:32:20.333 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:32:20.351 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:32:20.352 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 63.5488ms
2025-05-30 09:32:20.352 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:32:20.352 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 64.0441ms
2025-05-30 09:32:20.401 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-30 09:32:20.401 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-30 09:32:20.402 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-05-30 09:32:20.404 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:3
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:4
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:19
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:1
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:25
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:26
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:27
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:28
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:29
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:32
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:33
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:34
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:35
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:36
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:37
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:38
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:39
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:41
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:40
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:42
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:44
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:43
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:45
2025-05-30 09:32:20.404 +07:00 [INF] User 2 already subscribed to channel conversation:46
2025-05-30 09:32:20.405 +07:00 [INF] User 2 already subscribed to channel conversation:47
2025-05-30 09:32:20.405 +07:00 [INF] User 2 already subscribed to channel conversation:48
2025-05-30 09:32:20.405 +07:00 [INF] User 2 already subscribed to channel conversation:49
2025-05-30 09:32:20.405 +07:00 [INF] User 2 already subscribed to channel conversation:50
2025-05-30 09:32:20.405 +07:00 [INF] User 2 already subscribed to channel conversation:51
2025-05-30 09:32:20.405 +07:00 [INF] User 2 already subscribed to channel conversation:52
2025-05-30 09:32:20.405 +07:00 [INF] User 2 already subscribed to channel conversation:53
2025-05-30 09:32:20.410 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:32:20.428 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:32:20.594 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 260.3222ms
2025-05-30 09:32:20.594 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:32:20.594 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 260.6988ms
2025-05-30 09:32:23.564 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:32:23.564 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:23.564 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.1802ms
2025-05-30 09:32:23.565 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:32:23.565 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:23.565 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:23.566 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:32:23.566 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:32:23.572 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:32:23.573 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 3
2025-05-30 09:32:23.573 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:32:23.573 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 7.1581ms
2025-05-30 09:32:23.573 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:32:23.573 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 7.711ms
2025-05-30 09:32:23.581 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:32:23.581 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:23.581 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.3039ms
2025-05-30 09:32:23.584 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:32:23.584 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:23.584 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:23.584 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:32:23.585 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:32:23.597 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:32:23.599 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:32:23.600 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 14.7735ms
2025-05-30 09:32:23.600 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:32:23.600 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 16.3225ms
2025-05-30 09:32:23.608 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:32:23.609 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:23.609 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.223ms
2025-05-30 09:32:23.610 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:32:23.610 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:23.610 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:32:23.610 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:32:23.611 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:32:23.616 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:32:23.618 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:32:23.618 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.3991ms
2025-05-30 09:32:23.618 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:32:23.618 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 7.9052ms
2025-05-30 09:32:24.152 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - null null
2025-05-30 09:32:24.152 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:32:24.152 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:32:24.166 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:32:24.166 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 2
2025-05-30 09:32:24.166 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:32:24.166 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 14.0941ms
2025-05-30 09:32:24.166 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:32:24.166 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 14.4573ms
2025-05-30 09:32:24.223 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:32:24.223 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:32:24.223 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:32:24.231 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:32:24.233 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:32:24.234 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.0203ms
2025-05-30 09:32:24.234 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:32:24.234 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 10.4215ms
2025-05-30 09:32:24.266 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:32:24.267 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:32:24.267 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:32:24.275 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:32:24.278 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:32:24.278 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 11.4078ms
2025-05-30 09:32:24.278 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:32:24.278 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 11.8882ms
2025-05-30 09:36:31.631 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:36:31.631 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:31.632 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2338ms
2025-05-30 09:36:31.633 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:36:31.634 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:31.635 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:31.635 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:36:31.635 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:36:31.848 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:36:31.850 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:36:31.851 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 215.4299ms
2025-05-30 09:36:31.851 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:36:31.851 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 217.9406ms
2025-05-30 09:36:31.876 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:36:31.878 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:31.878 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:31.879 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:36:31.987 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:36:31.987 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:31.987 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:31.987 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:36:31.987 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:36:32.001 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:36:32.002 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:36:32.002 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 14.8803ms
2025-05-30 09:36:32.002 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:36:32.002 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 15.2701ms
2025-05-30 09:36:32.078 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:36:32.082 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:36:32.083 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:36:32.083 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:36:32.084 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:36:32.084 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:36:32.084 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:36:32.084 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:36:32.084 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:36:32.085 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:36:32.085 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:36:32.085 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:36:32.085 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:36:32.085 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:36:32.085 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:36:32.085 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:36:32.085 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:36:32.085 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:36:32.085 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:36:32.086 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:36:32.086 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:36:32.086 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:36:32.086 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:36:32.086 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:36:32.086 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:36:32.087 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:36:32.079 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:36:32.087 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:36:32.090 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:36:32.088 +07:00 [ERR] Connection id "0HNCV3J40O2M6", Request id "0HNCV3J40O2M6:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:36:32.091 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 263313.9243ms
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:36:32.091 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:36:32.171 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:36:32.171 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:32.171 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2455ms
2025-05-30 09:36:32.172 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:36:32.172 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:32.172 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:32.172 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:36:32.173 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:36:32.188 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:36:32.200 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:36:32.201 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 28.5497ms
2025-05-30 09:36:32.201 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:36:32.201 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 29.3354ms
2025-05-30 09:36:34.770 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:36:34.770 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:34.770 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.2996ms
2025-05-30 09:36:34.779 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:36:34.779 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:34.779 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:34.780 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:36:34.780 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:36:34.791 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:36:34.791 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 3
2025-05-30 09:36:34.791 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:36:34.793 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 13.0232ms
2025-05-30 09:36:34.793 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:36:34.793 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 13.9568ms
2025-05-30 09:36:34.804 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:36:34.804 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:34.804 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.3693ms
2025-05-30 09:36:34.806 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:36:34.806 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:34.806 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:34.806 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:36:34.806 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:36:34.812 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:36:34.815 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:36:34.816 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.8368ms
2025-05-30 09:36:34.816 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:36:34.816 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 10.4486ms
2025-05-30 09:36:34.826 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:36:34.826 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:34.826 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.3531ms
2025-05-30 09:36:34.828 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:36:34.828 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:34.829 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:34.829 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:36:34.829 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:36:34.834 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:36:34.836 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:36:34.836 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.5563ms
2025-05-30 09:36:34.836 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:36:34.836 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 8.0499ms
2025-05-30 09:36:37.182 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:36:37.183 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:37.183 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:36:37.183 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:36:37.187 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:36:37.187 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:36:37.188 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:37:17.142 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:37:17.143 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadResult(ReadResult& result)
   at System.IO.Pipelines.Pipe.ReadAsync(CancellationToken token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:37:17.157 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:37:17.157 +07:00 [ERR] Connection id "0HNCV3J40O2M8", Request id "0HNCV3J40O2M8:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadResult(ReadResult& result)
   at System.IO.Pipelines.Pipe.ReadAsync(CancellationToken token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:37:17.159 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - 101 null null 297075.5332ms
2025-05-30 09:37:20.359 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:37:20.359 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:37:20.360 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:37:20.360 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:37:20.360 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:37:20.360 +07:00 [ERR] Connection id "0HNCV3J40O2MG", Request id "0HNCV3J40O2MG:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:37:20.360 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:37:20.361 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 43178.9139ms
2025-05-30 09:37:20.361 +07:00 [ERR] Connection id "0HNCV3J40O2MF", Request id "0HNCV3J40O2MF:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:37:20.362 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 48486.1349ms
2025-05-30 09:38:29.977 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:38:29.977 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:29.977 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2501ms
2025-05-30 09:38:29.988 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:38:29.989 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:29.989 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:29.989 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:38:29.989 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:38:30.007 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:38:30.009 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:38:30.009 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 20.5787ms
2025-05-30 09:38:30.010 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:38:30.010 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 21.2024ms
2025-05-30 09:38:30.027 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:38:30.027 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:30.027 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:30.027 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:38:30.140 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:38:30.140 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:30.140 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:30.140 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:38:30.140 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:38:30.150 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:38:30.150 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:38:30.150 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 9.7845ms
2025-05-30 09:38:30.150 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:38:30.150 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 10.2029ms
2025-05-30 09:38:30.161 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:38:30.162 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:38:30.166 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:38:30.166 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:38:30.166 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:38:30.166 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:38:30.167 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:38:30.384 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:38:30.384 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:30.385 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 1.4458ms
2025-05-30 09:38:30.389 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:38:30.389 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:30.389 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:30.389 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:38:30.390 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:38:30.471 +07:00 [INF] Executed DbCommand (33ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:38:30.485 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:38:30.486 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 96.01ms
2025-05-30 09:38:30.486 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:38:30.486 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 97.5934ms
2025-05-30 09:38:53.982 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - application/json 58
2025-05-30 09:38:53.983 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:38:53.984 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:38:54.009 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:38:54.010 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:38:54.010 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 26.016ms
2025-05-30 09:38:54.010 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:38:54.010 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - 200 null application/json; charset=utf-8 27.8978ms
2025-05-30 09:38:55.449 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - null null
2025-05-30 09:38:55.450 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:38:55.467 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - null null
2025-05-30 09:38:55.467 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:38:55.467 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:38:55.468 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - null null
2025-05-30 09:38:55.468 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:38:55.468 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:38:55.527 +07:00 [INF] Executed DbCommand (58ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:38:55.546 +07:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:38:55.546 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-30 09:38:55.547 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-05-30 09:38:55.550 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:3
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:4
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:19
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:1
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:25
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:26
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:27
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:28
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:29
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:32
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:33
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:34
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:35
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:36
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:37
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:38
2025-05-30 09:38:55.550 +07:00 [INF] User 2 already subscribed to channel conversation:39
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:41
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:40
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:42
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:44
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:43
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:45
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:46
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:47
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:48
2025-05-30 09:38:55.551 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:49
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:50
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:51
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:52
2025-05-30 09:38:55.551 +07:00 [INF] User 2 already subscribed to channel conversation:53
2025-05-30 09:38:55.551 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 83.8973ms
2025-05-30 09:38:55.551 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:38:55.554 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 87.1315ms
2025-05-30 09:38:55.579 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:38:55.611 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 142.7868ms
2025-05-30 09:38:55.611 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:38:55.611 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 143.1626ms
2025-05-30 09:38:58.708 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - null null
2025-05-30 09:38:58.708 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:38:58.708 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:38:58.712 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:38:58.713 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 2
2025-05-30 09:38:58.713 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:38:58.721 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 13.4912ms
2025-05-30 09:38:58.722 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:38:58.722 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 14.1831ms
2025-05-30 09:38:58.793 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:38:58.793 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:38:58.793 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:38:58.800 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:38:58.807 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:38:58.808 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 14.1841ms
2025-05-30 09:38:58.808 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:38:58.808 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 14.68ms
2025-05-30 09:38:58.858 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:38:58.859 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:38:58.859 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:38:58.862 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:38:58.863 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:38:58.865 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.8798ms
2025-05-30 09:38:58.865 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:38:58.867 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 6.5721ms
2025-05-30 09:38:58.999 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:38:58.999 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:58.999 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.3022ms
2025-05-30 09:38:59.000 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:38:59.000 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:59.000 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:59.000 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:38:59.001 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:38:59.006 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:38:59.006 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 3
2025-05-30 09:38:59.006 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:38:59.006 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 5.6651ms
2025-05-30 09:38:59.006 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:38:59.006 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 6.1786ms
2025-05-30 09:38:59.017 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:38:59.017 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:59.018 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.2415ms
2025-05-30 09:38:59.019 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:38:59.019 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:59.019 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:59.019 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:38:59.019 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:38:59.022 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:38:59.023 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:38:59.024 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 4.4399ms
2025-05-30 09:38:59.024 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:38:59.024 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 5.0995ms
2025-05-30 09:38:59.034 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:38:59.034 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:59.034 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.3045ms
2025-05-30 09:38:59.035 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:38:59.036 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:59.036 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:38:59.037 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:38:59.037 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:38:59.039 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:38:59.040 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:38:59.040 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 2.9232ms
2025-05-30 09:38:59.040 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:38:59.040 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 4.7573ms
2025-05-30 09:42:02.841 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:42:02.842 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:42:02.876 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:42:02.877 +07:00 [ERR] Connection id "0HNCV3J40O2MK", Request id "0HNCV3J40O2MK:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:42:02.882 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - 101 null null 187432.5936ms
2025-05-30 09:42:06.189 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:42:06.190 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:42:06.191 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:42:06.191 +07:00 [ERR] Connection id "0HNCV3J40O2MI", Request id "0HNCV3J40O2MI:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:42:06.193 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 216165.7183ms
2025-05-30 09:43:15.342 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:43:15.342 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:15.343 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 1.0396ms
2025-05-30 09:43:15.346 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:43:15.346 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:15.346 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:15.346 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:43:15.347 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:43:15.567 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:43:15.568 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:43:15.569 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 221.9284ms
2025-05-30 09:43:15.569 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:43:15.569 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 223.1544ms
2025-05-30 09:43:15.596 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:43:15.596 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:15.596 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:15.596 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:43:15.734 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:43:15.734 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:15.734 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:15.734 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:43:15.734 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:43:15.746 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:43:15.746 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:43:15.747 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 12.4187ms
2025-05-30 09:43:15.747 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:43:15.747 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 12.8028ms
2025-05-30 09:43:15.901 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:43:15.902 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:43:15.903 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:43:15.903 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:43:15.903 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:43:15.905 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:43:15.905 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:43:15.905 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:43:15.906 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:43:15.995 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:43:15.996 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:15.996 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3303ms
2025-05-30 09:43:15.999 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:43:15.999 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:15.999 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:15.999 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:43:15.999 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:43:16.022 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:43:16.036 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:43:16.038 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 39.0358ms
2025-05-30 09:43:16.038 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:43:16.038 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 39.6107ms
2025-05-30 09:43:44.741 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - application/json 58
2025-05-30 09:43:44.741 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:43:44.742 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:43:44.749 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:43:44.750 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:43:44.750 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 8.3261ms
2025-05-30 09:43:44.750 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:43:44.750 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - 200 null application/json; charset=utf-8 8.9156ms
2025-05-30 09:43:45.959 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - null null
2025-05-30 09:43:45.959 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:43:46.264 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - null null
2025-05-30 09:43:46.264 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - null null
2025-05-30 09:43:46.264 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:43:46.264 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:43:46.265 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:43:46.265 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:43:46.287 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:43:46.294 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:43:46.299 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:43:46.299 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 34.3776ms
2025-05-30 09:43:46.299 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:43:46.299 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 34.8829ms
2025-05-30 09:43:46.314 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-30 09:43:46.315 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-30 09:43:46.316 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-30 09:43:46.316 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-30 09:43:46.316 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-30 09:43:46.316 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-30 09:43:46.316 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-30 09:43:46.316 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-30 09:43:46.316 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-05-30 09:43:46.318 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:3
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:4
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:19
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:1
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:25
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:26
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:27
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:28
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:29
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:32
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:33
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:34
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:35
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:36
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:37
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:38
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:39
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:41
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:40
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:42
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:44
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:43
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:45
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:46
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:47
2025-05-30 09:43:46.318 +07:00 [INF] User 2 already subscribed to channel conversation:48
2025-05-30 09:43:46.319 +07:00 [INF] User 2 already subscribed to channel conversation:49
2025-05-30 09:43:46.319 +07:00 [INF] User 2 already subscribed to channel conversation:50
2025-05-30 09:43:46.319 +07:00 [INF] User 2 already subscribed to channel conversation:51
2025-05-30 09:43:46.319 +07:00 [INF] User 2 already subscribed to channel conversation:52
2025-05-30 09:43:46.319 +07:00 [INF] User 2 already subscribed to channel conversation:53
2025-05-30 09:43:46.338 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:43:46.423 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 158.1126ms
2025-05-30 09:43:46.423 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:43:46.423 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 158.5344ms
2025-05-30 09:43:48.725 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:43:48.725 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:48.725 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.1539ms
2025-05-30 09:43:48.726 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:43:48.727 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:48.727 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:48.732 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:43:48.732 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:43:48.746 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:43:48.747 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 3
2025-05-30 09:43:48.747 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:43:48.747 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 15.2779ms
2025-05-30 09:43:48.747 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:43:48.747 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 20.7616ms
2025-05-30 09:43:48.756 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:43:48.756 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:48.756 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.2312ms
2025-05-30 09:43:48.758 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:43:48.758 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:48.758 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:48.758 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:43:48.758 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:43:48.767 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:43:48.771 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:43:48.772 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 13.3616ms
2025-05-30 09:43:48.772 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:43:48.772 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 13.8093ms
2025-05-30 09:43:48.782 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:43:48.782 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:48.782 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.1766ms
2025-05-30 09:43:48.784 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:43:48.784 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:48.784 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:43:48.784 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:43:48.784 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:43:48.795 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:43:48.796 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:43:48.796 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 11.5081ms
2025-05-30 09:43:48.796 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:43:48.796 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 12.2911ms
2025-05-30 09:43:49.452 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - null null
2025-05-30 09:43:49.453 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:43:49.453 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:43:49.456 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:43:49.457 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 2
2025-05-30 09:43:49.457 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:43:49.457 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.6067ms
2025-05-30 09:43:49.457 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:43:49.458 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 5.1216ms
2025-05-30 09:43:49.521 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:43:49.521 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:43:49.521 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:43:49.525 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:43:49.527 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:43:49.528 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.3643ms
2025-05-30 09:43:49.528 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:43:49.528 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 6.8127ms
2025-05-30 09:43:49.597 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:43:49.597 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:43:49.597 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:43:49.599 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:43:49.600 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:43:49.600 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.045ms
2025-05-30 09:43:49.600 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:43:49.600 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 3.4545ms
2025-05-30 09:49:17.482 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:49:17.517 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:49:17.689 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:49:17.710 +07:00 [ERR] Connection id "0HNCV3J40O2MU", Request id "0HNCV3J40O2MU:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:49:17.765 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - 101 null null 331797.9673ms
2025-05-30 09:51:17.942 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - application/json 58
2025-05-30 09:51:18.403 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:51:18.428 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:51:19.056 +07:00 [INF] Executed DbCommand (99ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:51:19.105 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:51:19.114 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 684.2461ms
2025-05-30 09:51:19.114 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:51:19.115 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - 200 null application/json; charset=utf-8 1173.314ms
2025-05-30 09:51:20.016 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - null null
2025-05-30 09:51:20.016 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:51:20.418 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - null null
2025-05-30 09:51:20.419 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:51:20.419 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:51:20.488 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:51:20.493 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-30 09:51:20.493 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-30 09:51:20.493 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-30 09:51:20.494 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-30 09:51:20.494 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-30 09:51:20.494 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-30 09:51:20.494 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-30 09:51:20.494 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-30 09:51:20.494 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-30 09:51:20.494 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-30 09:51:20.494 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-30 09:51:20.494 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-30 09:51:20.494 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-30 09:51:20.495 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-30 09:51:20.495 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-30 09:51:20.495 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-30 09:51:20.495 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-30 09:51:20.495 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-30 09:51:20.495 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-30 09:51:20.495 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-30 09:51:20.495 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-30 09:51:20.495 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-30 09:51:20.495 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-30 09:51:20.495 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-30 09:51:20.501 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-30 09:51:20.501 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-30 09:51:20.502 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-30 09:51:20.502 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-30 09:51:20.502 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-30 09:51:20.502 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-30 09:51:20.502 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-05-30 09:51:20.514 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:51:20.515 +07:00 [INF] User 2 already subscribed to channel conversation:3
2025-05-30 09:51:20.515 +07:00 [INF] User 2 already subscribed to channel conversation:4
2025-05-30 09:51:20.515 +07:00 [INF] User 2 already subscribed to channel conversation:19
2025-05-30 09:51:20.515 +07:00 [INF] User 2 already subscribed to channel conversation:1
2025-05-30 09:51:20.515 +07:00 [INF] User 2 already subscribed to channel conversation:25
2025-05-30 09:51:20.515 +07:00 [INF] User 2 already subscribed to channel conversation:26
2025-05-30 09:51:20.515 +07:00 [INF] User 2 already subscribed to channel conversation:27
2025-05-30 09:51:20.515 +07:00 [INF] User 2 already subscribed to channel conversation:28
2025-05-30 09:51:20.517 +07:00 [INF] User 2 already subscribed to channel conversation:29
2025-05-30 09:51:20.517 +07:00 [INF] User 2 already subscribed to channel conversation:32
2025-05-30 09:51:20.538 +07:00 [INF] User 2 already subscribed to channel conversation:33
2025-05-30 09:51:20.538 +07:00 [INF] User 2 already subscribed to channel conversation:34
2025-05-30 09:51:20.538 +07:00 [INF] User 2 already subscribed to channel conversation:35
2025-05-30 09:51:20.538 +07:00 [INF] User 2 already subscribed to channel conversation:36
2025-05-30 09:51:20.539 +07:00 [INF] User 2 already subscribed to channel conversation:37
2025-05-30 09:51:20.539 +07:00 [INF] User 2 already subscribed to channel conversation:38
2025-05-30 09:51:20.539 +07:00 [INF] User 2 already subscribed to channel conversation:39
2025-05-30 09:51:20.539 +07:00 [INF] User 2 already subscribed to channel conversation:41
2025-05-30 09:51:20.539 +07:00 [INF] User 2 already subscribed to channel conversation:40
2025-05-30 09:51:20.539 +07:00 [INF] User 2 already subscribed to channel conversation:42
2025-05-30 09:51:20.539 +07:00 [INF] User 2 already subscribed to channel conversation:44
2025-05-30 09:51:20.539 +07:00 [INF] User 2 already subscribed to channel conversation:43
2025-05-30 09:51:20.539 +07:00 [INF] User 2 already subscribed to channel conversation:45
2025-05-30 09:51:20.539 +07:00 [INF] User 2 already subscribed to channel conversation:46
2025-05-30 09:51:20.539 +07:00 [INF] User 2 already subscribed to channel conversation:47
2025-05-30 09:51:20.539 +07:00 [INF] User 2 already subscribed to channel conversation:48
2025-05-30 09:51:20.541 +07:00 [INF] Executed DbCommand (55ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:51:20.550 +07:00 [INF] User 2 already subscribed to channel conversation:49
2025-05-30 09:51:20.550 +07:00 [INF] User 2 already subscribed to channel conversation:50
2025-05-30 09:51:20.550 +07:00 [INF] User 2 already subscribed to channel conversation:51
2025-05-30 09:51:20.550 +07:00 [INF] User 2 already subscribed to channel conversation:52
2025-05-30 09:51:20.562 +07:00 [INF] User 2 already subscribed to channel conversation:53
2025-05-30 09:51:20.565 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:51:20.592 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - null null
2025-05-30 09:51:20.592 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:51:20.592 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:51:20.593 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 173.7653ms
2025-05-30 09:51:20.593 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:51:20.593 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 175.0119ms
2025-05-30 09:51:20.677 +07:00 [INF] Executed DbCommand (62ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:51:20.839 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:51:20.877 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 284.7668ms
2025-05-30 09:51:20.877 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:51:20.878 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 285.797ms
2025-05-30 09:51:31.307 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:51:31.307 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:31.308 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 1.0731ms
2025-05-30 09:51:31.346 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:51:31.347 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:31.347 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:31.347 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:51:31.347 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:51:31.375 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:51:31.376 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:51:31.376 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 29.2535ms
2025-05-30 09:51:31.376 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:51:31.378 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 31.1499ms
2025-05-30 09:51:31.412 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:51:31.412 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:31.412 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:31.413 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:51:31.559 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:51:31.559 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:31.560 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:31.560 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:51:31.560 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:51:31.579 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:51:31.579 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:51:31.579 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 19.3138ms
2025-05-30 09:51:31.579 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:51:31.580 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 20.9109ms
2025-05-30 09:51:31.760 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:51:31.762 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:51:31.763 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:51:31.763 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:51:31.763 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:51:31.763 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:51:31.763 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:51:31.763 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:51:31.763 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:51:31.763 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:51:31.763 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:51:31.766 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:51:31.766 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:51:31.766 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:51:31.766 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:51:31.766 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:51:31.766 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:51:31.766 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:51:31.766 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:51:31.766 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:51:31.766 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:51:31.766 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:51:31.767 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:51:31.767 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:51:31.767 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:51:31.775 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:51:31.776 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:51:31.776 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:51:31.776 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:51:31.776 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:51:31.776 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:51:31.776 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:51:31.776 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:51:31.776 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:51:31.777 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:51:32.253 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:51:32.253 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:32.253 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.4343ms
2025-05-30 09:51:32.255 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:51:32.255 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:32.255 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:32.256 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:51:32.256 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:51:32.273 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:51:32.290 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:51:32.296 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 40.2972ms
2025-05-30 09:51:32.296 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:51:32.296 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 41.3664ms
2025-05-30 09:51:34.772 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:51:34.772 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:34.773 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.2387ms
2025-05-30 09:51:34.774 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:51:34.775 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:34.776 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:34.777 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:51:34.778 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:51:34.797 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:51:34.800 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 3
2025-05-30 09:51:34.802 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:51:34.805 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 25.8958ms
2025-05-30 09:51:34.805 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:51:34.805 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 30.7884ms
2025-05-30 09:51:34.813 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:51:34.813 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:34.814 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.1805ms
2025-05-30 09:51:34.815 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:51:34.815 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:34.815 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:34.815 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:51:34.815 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:51:34.843 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:51:34.852 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:51:34.853 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 37.8325ms
2025-05-30 09:51:34.853 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:51:34.854 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 38.7822ms
2025-05-30 09:51:34.862 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:51:34.862 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:34.862 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2551ms
2025-05-30 09:51:34.865 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:51:34.865 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:34.865 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:51:34.865 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:51:34.865 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:51:34.876 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:51:34.879 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:51:34.880 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 14.0587ms
2025-05-30 09:51:34.880 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:51:34.880 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 15.1694ms
2025-05-30 09:51:35.400 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - null null
2025-05-30 09:51:35.400 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:51:35.400 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:51:35.440 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53
2025-05-30 09:51:35.441 +07:00 [INF] Retrieved 9 messages from Redis for conversation 53 and user 2
2025-05-30 09:51:35.441 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:51:35.442 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 41.6461ms
2025-05-30 09:51:35.442 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:51:35.442 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 42.4535ms
2025-05-30 09:51:35.520 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:51:35.521 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:51:35.521 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:51:35.537 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:51:35.542 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:51:35.545 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 23.5775ms
2025-05-30 09:51:35.545 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:51:35.545 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 24.3295ms
2025-05-30 09:51:35.665 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:51:35.665 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:51:35.665 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:51:35.673 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:51:35.677 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:51:35.682 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 15.6246ms
2025-05-30 09:51:35.682 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:51:35.682 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 17.2672ms
2025-05-30 09:52:00.060 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:52:00.063 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:52:00.074 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:52:00.075 +07:00 [ERR] Connection id "0HNCV3J40O2MS", Request id "0HNCV3J40O2MS:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:52:00.078 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 524482.6073ms
2025-05-30 09:52:10.686 +07:00 [INF] Handling message from user 3:  t chi cuc gi v ang bn
2025-05-30 09:52:10.730 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-30 09:52:10.806 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 09:52:10.858 +07:00 [INF] Executed DbCommand (52ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-30 09:52:10.862 +07:00 [INF] Message saved to DB with ID: 429
2025-05-30 09:52:10.865 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 09:52:10.875 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-30 09:52:10.876 +07:00 [INF] Transaction committed for message: 429
2025-05-30 09:52:10.880 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:52:10.885 +07:00 [INF] Saved message 429 to Redis
2025-05-30 09:52:10.886 +07:00 [INF] Added message 429 to conversation 53
2025-05-30 09:52:10.887 +07:00 [INF] Published message to channel conversation:53
2025-05-30 09:52:47.657 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:52:47.661 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:52:47.663 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:52:47.663 +07:00 [ERR] Connection id "0HNCV3J40O2NA", Request id "0HNCV3J40O2NA:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:52:47.665 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 76253.1628ms
2025-05-30 09:52:47.736 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - null null
2025-05-30 09:52:47.737 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:52:47.737 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:52:47.737 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:52:47.754 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:52:47.757 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:52:47.758 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:52:47.759 +07:00 [ERR] Connection id "0HNCV3J40O2N6", Request id "0HNCV3J40O2N6:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:52:47.760 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - 101 null null 87743.8585ms
2025-05-30 09:52:47.777 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:52:47.777 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> System.ObjectDisposedException: Cannot access a disposed object.
Object name: 'HttpRequestStream'.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestPipeReader.<ValidateState>g__ThrowObjectDisposedException|14_0()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.CloseAsyncPrivate(WebSocketCloseStatus closeStatus, String statusDescription, CancellationToken cancellationToken)
   at server.Services.WebSocketService.webSocket.HandleBootup(Client client, MessageDTO message) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 301
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 240
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:52:47.791 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:52:47.791 +07:00 [ERR] Connection id "0HNCV3J40O2NF", Request id "0HNCV3J40O2NF:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> System.ObjectDisposedException: Cannot access a disposed object.
Object name: 'HttpRequestStream'.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestPipeReader.<ValidateState>g__ThrowObjectDisposedException|14_0()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.CloseAsyncPrivate(WebSocketCloseStatus closeStatus, String statusDescription, CancellationToken cancellationToken)
   at server.Services.WebSocketService.webSocket.HandleBootup(Client client, MessageDTO message) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 301
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 240
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:52:47.796 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=2 - 101 null null 60.0627ms
2025-05-30 09:52:50.189 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - null null
2025-05-30 09:52:50.189 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:52:50.215 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:52:50.215 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> System.ObjectDisposedException: Cannot write to the response body, the response has completed.
Object name: 'HttpResponseStream'.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponsePipeWriter.<ValidateState>g__ThrowObjectDisposedException|15_0()
   at System.Net.WebSockets.ManagedWebSocket.SendFrameLockAcquiredNonCancelableAsync(MessageOpcode opcode, Boolean endOfMessage, Boolean disableCompression, ReadOnlyMemory`1 payloadBuffer)
   at System.Net.WebSockets.ManagedWebSocket.SendCloseFrameAsync(WebSocketCloseStatus closeStatus, String closeStatusDescription, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.CloseAsyncPrivate(WebSocketCloseStatus closeStatus, String statusDescription, CancellationToken cancellationToken)
   at server.Services.WebSocketService.webSocket.HandleBootup(Client client, MessageDTO message) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 301
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 240
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:52:50.227 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:52:50.227 +07:00 [ERR] Connection id "0HNCV3J40O2NG", Request id "0HNCV3J40O2NG:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> System.ObjectDisposedException: Cannot write to the response body, the response has completed.
Object name: 'HttpResponseStream'.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponsePipeWriter.<ValidateState>g__ThrowObjectDisposedException|15_0()
   at System.Net.WebSockets.ManagedWebSocket.SendFrameLockAcquiredNonCancelableAsync(MessageOpcode opcode, Boolean endOfMessage, Boolean disableCompression, ReadOnlyMemory`1 payloadBuffer)
   at System.Net.WebSockets.ManagedWebSocket.SendCloseFrameAsync(WebSocketCloseStatus closeStatus, String closeStatusDescription, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.CloseAsyncPrivate(WebSocketCloseStatus closeStatus, String statusDescription, CancellationToken cancellationToken)
   at server.Services.WebSocketService.webSocket.HandleBootup(Client client, MessageDTO message) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 301
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 240
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:52:50.234 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - 101 null null 44.6806ms
2025-05-30 09:52:52.655 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:52:52.655 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:52:52.655 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:52:52.655 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:52:52.664 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:52:52.665 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:52:52.665 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:52:52.665 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:52:52.665 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:52:52.665 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:52:52.665 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:52:52.665 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:52:52.665 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:52:52.665 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:52:52.665 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:52:52.665 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:52:52.665 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:52:52.665 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:52:52.666 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:52:52.666 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:52:52.666 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:52:52.666 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:52:52.666 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:52:52.666 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:52:52.666 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:52:52.666 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:52:52.666 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:52:52.666 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:52:52.666 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:52:52.802 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - null null
2025-05-30 09:52:52.802 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:52:52.821 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-30 09:52:52.822 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-30 09:52:52.823 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-30 09:52:52.823 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-30 09:52:52.823 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-30 09:52:52.823 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-30 09:52:52.823 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-30 09:52:52.823 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-30 09:52:52.823 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-30 09:52:52.823 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-30 09:52:52.823 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-30 09:52:52.823 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-30 09:52:52.823 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-30 09:52:52.823 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-30 09:52:52.824 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-30 09:52:52.824 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-30 09:52:52.824 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-30 09:52:52.824 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-05-30 09:53:18.215 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 09:53:18.215 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:18.215 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.1901ms
2025-05-30 09:53:18.216 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 09:53:18.216 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:18.216 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:18.217 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:53:18.217 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 09:53:18.228 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 09:53:18.229 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 09:53:18.229 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 12.2415ms
2025-05-30 09:53:18.229 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 09:53:18.229 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 12.7852ms
2025-05-30 09:53:18.255 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:53:18.256 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:18.256 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:18.257 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:53:18.399 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 09:53:18.399 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:18.399 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:18.399 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:53:18.399 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 09:53:18.410 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 09:53:18.410 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:53:18.411 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 11.9862ms
2025-05-30 09:53:18.411 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 09:53:18.411 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 12.4978ms
2025-05-30 09:53:18.484 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:53:18.484 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:53:18.485 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:53:18.486 +07:00 [ERR] Connection id "0HNCV3J40O2NH", Request id "0HNCV3J40O2NH:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:53:18.488 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 25832.7575ms
2025-05-30 09:53:18.491 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:53:18.491 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:53:18.491 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:53:18.491 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:53:18.491 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:53:18.491 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:53:18.492 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:53:18.496 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 09:53:18.496 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 09:53:18.582 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:53:18.582 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:18.582 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.4241ms
2025-05-30 09:53:18.584 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 09:53:18.584 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:18.584 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:18.584 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:53:18.584 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:53:18.601 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 09:53:18.617 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:53:18.618 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 33.9591ms
2025-05-30 09:53:18.618 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 09:53:18.619 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 34.7515ms
2025-05-30 09:53:23.378 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:53:23.378 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:23.378 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.1851ms
2025-05-30 09:53:23.380 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 09:53:23.380 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:23.380 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:23.380 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:53:23.380 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 09:53:23.385 +07:00 [INF] Retrieved 10 messages from Redis for conversation 53
2025-05-30 09:53:23.385 +07:00 [INF] Retrieved 10 messages from Redis for conversation 53 and user 3
2025-05-30 09:53:23.385 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 09:53:23.385 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 5.0747ms
2025-05-30 09:53:23.386 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 09:53:23.386 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 5.9648ms
2025-05-30 09:53:23.397 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:53:23.398 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:23.398 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.392ms
2025-05-30 09:53:23.400 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 09:53:23.400 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:23.400 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:23.400 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:53:23.400 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 09:53:23.417 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 09:53:23.419 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 09:53:23.420 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 19.0154ms
2025-05-30 09:53:23.421 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 09:53:23.421 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 21.401ms
2025-05-30 09:53:23.434 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:53:23.435 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:23.435 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.3065ms
2025-05-30 09:53:23.436 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 09:53:23.436 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:23.436 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:23.436 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:53:23.436 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 09:53:23.445 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 09:53:23.448 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 09:53:23.448 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 11.806ms
2025-05-30 09:53:23.448 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 09:53:23.448 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 12.4357ms
2025-05-30 09:53:23.641 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 09:53:23.641 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:23.641 +07:00 [INF] CORS policy execution successful.
2025-05-30 09:53:23.641 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 09:53:23.717 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:53:23.717 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 09:53:23.717 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 09:53:23.717 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 09:53:23.717 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 09:53:23.718 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 09:54:00.631 +07:00 [INF] Handling message from user 2:  t chi cuc gi
2025-05-30 09:54:00.637 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-30 09:54:00.649 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 09:54:00.664 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-30 09:54:00.665 +07:00 [INF] Message saved to DB with ID: 430
2025-05-30 09:54:00.667 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 09:54:00.678 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-30 09:54:00.681 +07:00 [INF] Transaction committed for message: 430
2025-05-30 09:54:00.691 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 09:54:00.697 +07:00 [INF] Saved message 430 to Redis
2025-05-30 09:54:00.698 +07:00 [INF] Added message 430 to conversation 53
2025-05-30 09:54:00.699 +07:00 [INF] Published message to channel conversation:53
2025-05-30 09:54:10.897 +07:00 [INF] Application is shutting down...
2025-05-30 09:54:18.315 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:54:18.316 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadResult(ReadResult& result)
   at System.IO.Pipelines.Pipe.ReadAsync(CancellationToken token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:54:18.326 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:54:18.326 +07:00 [ERR] Connection id "0HNCV3J40O2NI", Request id "0HNCV3J40O2NI:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadResult(ReadResult& result)
   at System.IO.Pipelines.Pipe.ReadAsync(CancellationToken token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:54:18.337 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - 101 null null 85534.9573ms
2025-05-30 09:54:23.794 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:54:23.794 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 09:54:23.795 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:54:23.796 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:54:23.795 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 09:54:23.797 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 09:54:23.796 +07:00 [ERR] Connection id "0HNCV3J40O2NK", Request id "0HNCV3J40O2NK:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:54:23.799 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 65543.2607ms
2025-05-30 09:54:23.798 +07:00 [ERR] Connection id "0HNCV3J40O2NL", Request id "0HNCV3J40O2NL:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 09:54:23.801 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 60160.2792ms
2025-05-30 09:58:45.010 +07:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-30 09:58:45.185 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-30 09:58:45.306 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-30 09:58:45.316 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-30 09:58:45.316 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-30 09:58:45.316 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-30 09:58:45.316 +07:00 [INF] Hosting environment: Development
2025-05-30 09:58:45.317 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-30 10:00:23.390 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 10:00:23.433 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:23.445 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 58.2403ms
2025-05-30 10:00:23.451 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 10:00:23.452 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:23.490 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:23.491 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-30 10:00:23.522 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:00:23.546 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 10:00:23.874 +07:00 [INF] Executed DbCommand (143ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 10:00:23.962 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 10:00:24.006 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 458.4636ms
2025-05-30 10:00:24.007 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:00:24.013 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 562.5286ms
2025-05-30 10:00:24.039 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 10:00:24.047 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:24.048 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:24.050 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:00:24.207 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 10:00:24.208 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:24.210 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:24.214 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:00:24.224 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 10:00:24.370 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 10:00:24.373 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:00:24.386 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 162.2503ms
2025-05-30 10:00:24.386 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:00:24.387 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 179.9991ms
2025-05-30 10:00:24.407 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:00:24.416 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 10:00:24.418 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:24.419 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 2.4886ms
2025-05-30 10:00:24.422 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 10:00:24.423 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:24.424 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:24.424 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:00:24.429 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:00:24.430 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 10:00:24.435 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 10:00:24.436 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 10:00:24.437 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 10:00:24.441 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 10:00:24.441 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 10:00:24.442 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 10:00:24.442 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 10:00:24.443 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 10:00:24.444 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 10:00:24.444 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 10:00:24.445 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 10:00:24.445 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 10:00:24.445 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 10:00:24.446 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 10:00:24.446 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 10:00:24.446 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 10:00:24.447 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 10:00:24.447 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 10:00:24.449 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 10:00:24.466 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 10:00:24.467 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 10:00:24.468 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 10:00:24.469 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 10:00:24.502 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 10:00:24.503 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 10:00:24.504 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 10:00:24.504 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 10:00:24.504 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 10:00:24.504 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 10:00:24.504 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 10:00:24.605 +07:00 [INF] Executed DbCommand (33ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 10:00:24.634 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:00:24.648 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 218.0646ms
2025-05-30 10:00:24.648 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:00:24.648 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 226.2552ms
2025-05-30 10:00:39.087 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - application/json 58
2025-05-30 10:00:39.091 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:00:39.091 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 10:00:39.119 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 10:00:39.120 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 10:00:39.121 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 29.5302ms
2025-05-30 10:00:39.121 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:00:39.121 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - 200 null application/json; charset=utf-8 34.2231ms
2025-05-30 10:00:39.877 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - null null
2025-05-30 10:00:39.880 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:00:40.333 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - null null
2025-05-30 10:00:40.334 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:00:40.335 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 10:00:40.393 +07:00 [INF] Executed DbCommand (54ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 10:00:40.397 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:00:40.398 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 62.8648ms
2025-05-30 10:00:40.399 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:00:40.399 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 65.9978ms
2025-05-30 10:00:40.437 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:00:40.439 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-30 10:00:40.439 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-30 10:00:40.441 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-30 10:00:40.442 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-30 10:00:40.442 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-30 10:00:40.442 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-30 10:00:40.444 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-30 10:00:40.445 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-30 10:00:40.445 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-30 10:00:40.445 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-30 10:00:40.446 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-30 10:00:40.446 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-30 10:00:40.446 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-30 10:00:40.447 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-30 10:00:40.447 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-30 10:00:40.447 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-30 10:00:40.450 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-30 10:00:40.453 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-30 10:00:40.453 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-30 10:00:40.454 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-30 10:00:40.454 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-30 10:00:40.455 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-30 10:00:40.455 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-30 10:00:40.458 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-30 10:00:40.458 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-30 10:00:40.459 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-30 10:00:40.460 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-30 10:00:40.461 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-30 10:00:40.461 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-30 10:00:40.462 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-30 10:00:40.462 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-05-30 10:00:40.465 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:00:40.467 +07:00 [INF] User 2 already subscribed to channel conversation:3
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:4
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:19
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:1
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:25
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:26
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:27
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:28
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:29
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:32
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:33
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:34
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:35
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:36
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:37
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:38
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:39
2025-05-30 10:00:40.468 +07:00 [INF] User 2 already subscribed to channel conversation:41
2025-05-30 10:00:40.469 +07:00 [INF] User 2 already subscribed to channel conversation:40
2025-05-30 10:00:40.469 +07:00 [INF] User 2 already subscribed to channel conversation:42
2025-05-30 10:00:40.469 +07:00 [INF] User 2 already subscribed to channel conversation:44
2025-05-30 10:00:40.469 +07:00 [INF] User 2 already subscribed to channel conversation:43
2025-05-30 10:00:40.469 +07:00 [INF] User 2 already subscribed to channel conversation:45
2025-05-30 10:00:40.469 +07:00 [INF] User 2 already subscribed to channel conversation:46
2025-05-30 10:00:40.469 +07:00 [INF] User 2 already subscribed to channel conversation:47
2025-05-30 10:00:40.469 +07:00 [INF] User 2 already subscribed to channel conversation:48
2025-05-30 10:00:40.469 +07:00 [INF] User 2 already subscribed to channel conversation:49
2025-05-30 10:00:40.469 +07:00 [INF] User 2 already subscribed to channel conversation:50
2025-05-30 10:00:40.469 +07:00 [INF] User 2 already subscribed to channel conversation:51
2025-05-30 10:00:40.469 +07:00 [INF] User 2 already subscribed to channel conversation:52
2025-05-30 10:00:40.469 +07:00 [INF] User 2 already subscribed to channel conversation:53
2025-05-30 10:00:40.519 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - null null
2025-05-30 10:00:40.521 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:00:40.522 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:00:40.548 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 10:00:40.589 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:00:40.619 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 96.8486ms
2025-05-30 10:00:40.619 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:00:40.619 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 100.7857ms
2025-05-30 10:00:43.534 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 10:00:43.534 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:43.545 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 11.1162ms
2025-05-30 10:00:43.547 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 10:00:43.548 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:43.549 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:43.550 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:00:43.554 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 10:00:43.600 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53
2025-05-30 10:00:43.602 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53 and user 3
2025-05-30 10:00:43.602 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:00:43.608 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 54.2652ms
2025-05-30 10:00:43.608 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:00:43.608 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 60.6945ms
2025-05-30 10:00:43.618 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:00:43.619 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:43.619 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.4476ms
2025-05-30 10:00:43.621 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:00:43.621 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:43.621 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:43.621 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:00:43.627 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:00:43.687 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 10:00:43.732 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 10:00:43.735 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 107.2984ms
2025-05-30 10:00:43.735 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:00:43.735 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 114.4886ms
2025-05-30 10:00:43.741 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:00:43.741 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:43.741 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2151ms
2025-05-30 10:00:43.743 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:00:43.743 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:43.743 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:00:43.743 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:00:43.750 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 10:00:43.763 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 10:00:43.766 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:00:43.768 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 17.442ms
2025-05-30 10:00:43.768 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:00:43.769 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 26.1035ms
2025-05-30 10:00:44.097 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - null null
2025-05-30 10:00:44.100 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:00:44.100 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 10:00:44.107 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53
2025-05-30 10:00:44.108 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53 and user 2
2025-05-30 10:00:44.108 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:00:44.108 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 7.9672ms
2025-05-30 10:00:44.108 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:00:44.108 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 10.862ms
2025-05-30 10:00:44.219 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:00:44.219 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:00:44.220 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:00:44.231 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 10:00:44.240 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 10:00:44.241 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 21.0385ms
2025-05-30 10:00:44.241 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:00:44.241 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 22.5051ms
2025-05-30 10:00:44.275 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:00:44.277 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:00:44.277 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 10:00:44.286 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 10:00:44.289 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:00:44.289 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 12.4514ms
2025-05-30 10:00:44.289 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:00:44.290 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 14.4347ms
2025-05-30 10:00:49.576 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - null null
2025-05-30 10:00:49.576 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:00:49.576 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 10:00:49.586 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53
2025-05-30 10:00:49.587 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53 and user 2
2025-05-30 10:00:49.587 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:00:49.588 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 11.8348ms
2025-05-30 10:00:49.588 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:00:49.589 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 13.0891ms
2025-05-30 10:00:49.620 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:00:49.622 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:00:49.622 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:00:49.631 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 10:00:49.636 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 10:00:49.636 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 14.2408ms
2025-05-30 10:00:49.636 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:00:49.636 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 16.2739ms
2025-05-30 10:00:49.677 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:00:49.677 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:00:49.678 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 10:00:49.682 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 10:00:49.685 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:00:49.685 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.79ms
2025-05-30 10:00:49.685 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:00:49.686 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 8.4586ms
2025-05-30 10:02:26.129 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:02:26.131 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:02:26.181 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:02:26.182 +07:00 [ERR] Connection id "0HNCV4OFF8A02", Request id "0HNCV4OFF8A02:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:02:26.185 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - 101 null null 106308.6524ms
2025-05-30 10:03:56.884 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 10:03:56.884 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:03:56.884 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.4397ms
2025-05-30 10:03:56.885 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 10:03:56.885 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:03:56.886 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:03:56.886 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:03:56.886 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 10:03:56.906 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 10:03:56.907 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 10:03:56.908 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 21.8519ms
2025-05-30 10:03:56.908 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:03:56.908 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 22.7407ms
2025-05-30 10:03:56.936 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 10:03:56.936 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:03:56.936 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:03:56.936 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:03:57.037 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 10:03:57.038 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:03:57.038 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:03:57.038 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:03:57.038 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 10:03:57.068 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 10:03:57.068 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:03:57.068 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 30.1207ms
2025-05-30 10:03:57.068 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:03:57.069 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 31.1257ms
2025-05-30 10:03:57.129 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:03:57.130 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:03:57.131 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:03:57.131 +07:00 [ERR] Connection id "0HNCV4OFF8A00", Request id "0HNCV4OFF8A00:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:03:57.132 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 213092.9638ms
2025-05-30 10:03:57.144 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 10:03:57.145 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 10:03:57.146 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 10:03:57.146 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 10:03:57.146 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 10:03:57.146 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 10:03:57.146 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 10:03:57.146 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 10:03:57.146 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 10:03:57.149 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 10:03:57.149 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 10:03:57.150 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 10:03:57.193 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 10:03:57.193 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:03:57.193 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3475ms
2025-05-30 10:03:57.194 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 10:03:57.195 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:03:57.195 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:03:57.195 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:03:57.195 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:03:57.220 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 10:03:57.241 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:03:57.243 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 48.1375ms
2025-05-30 10:03:57.243 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:03:57.243 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 49.0636ms
2025-05-30 10:04:02.210 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 10:04:02.210 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:04:02.210 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:04:02.211 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:04:02.214 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:04:02.214 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:04:02.215 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:04:02.215 +07:00 [ERR] Connection id "0HNCV4OFF8A0C", Request id "0HNCV4OFF8A0C:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:04:02.218 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 5281.9529ms
2025-05-30 10:04:02.231 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:04:02.232 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 10:04:02.232 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 10:04:02.232 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 10:04:02.232 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 10:04:02.232 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 10:04:02.233 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 10:04:02.233 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 10:04:02.233 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 10:04:02.233 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 10:04:02.233 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 10:04:02.233 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 10:04:02.233 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 10:04:02.233 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 10:04:02.233 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 10:04:02.233 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 10:04:02.234 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 10:04:02.234 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 10:04:02.234 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 10:04:02.234 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 10:04:02.235 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 10:04:02.235 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 10:04:02.235 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 10:04:02.235 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 10:04:02.235 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 10:04:07.229 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 10:04:07.230 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:04:07.230 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:04:07.231 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:04:07.240 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 10:04:07.241 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 10:04:16.625 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - application/json 58
2025-05-30 10:04:16.625 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:04:16.625 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 10:04:16.653 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 10:04:16.655 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 10:04:16.658 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 32.7661ms
2025-05-30 10:04:16.659 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:04:16.659 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - 200 null application/json; charset=utf-8 33.9437ms
2025-05-30 10:04:17.789 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - null null
2025-05-30 10:04:17.790 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:04:17.918 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - null null
2025-05-30 10:04:17.918 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:04:17.919 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 10:04:17.920 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - null null
2025-05-30 10:04:17.922 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:04:17.922 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:04:17.945 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 10:04:17.950 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:04:17.950 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 31.2684ms
2025-05-30 10:04:17.950 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:04:17.950 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 32.6169ms
2025-05-30 10:04:17.956 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 10:04:17.974 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:04:17.975 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-30 10:04:17.975 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-30 10:04:17.975 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-30 10:04:17.975 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-30 10:04:17.975 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-30 10:04:17.975 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-30 10:04:17.975 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-30 10:04:17.975 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-30 10:04:17.975 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-30 10:04:17.975 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-30 10:04:17.975 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-30 10:04:17.976 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-30 10:04:17.978 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-30 10:04:17.978 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-30 10:04:17.978 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-05-30 10:04:17.981 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:04:17.981 +07:00 [INF] User 2 already subscribed to channel conversation:3
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:4
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:19
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:1
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:25
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:26
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:27
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:28
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:29
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:32
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:33
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:34
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:35
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:36
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:37
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:38
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:39
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:41
2025-05-30 10:04:17.982 +07:00 [INF] User 2 already subscribed to channel conversation:40
2025-05-30 10:04:17.983 +07:00 [INF] User 2 already subscribed to channel conversation:42
2025-05-30 10:04:17.983 +07:00 [INF] User 2 already subscribed to channel conversation:44
2025-05-30 10:04:17.983 +07:00 [INF] User 2 already subscribed to channel conversation:43
2025-05-30 10:04:17.983 +07:00 [INF] User 2 already subscribed to channel conversation:45
2025-05-30 10:04:17.983 +07:00 [INF] User 2 already subscribed to channel conversation:46
2025-05-30 10:04:17.983 +07:00 [INF] User 2 already subscribed to channel conversation:47
2025-05-30 10:04:17.983 +07:00 [INF] User 2 already subscribed to channel conversation:48
2025-05-30 10:04:17.991 +07:00 [INF] User 2 already subscribed to channel conversation:49
2025-05-30 10:04:17.991 +07:00 [INF] User 2 already subscribed to channel conversation:50
2025-05-30 10:04:17.992 +07:00 [INF] User 2 already subscribed to channel conversation:51
2025-05-30 10:04:17.992 +07:00 [INF] User 2 already subscribed to channel conversation:52
2025-05-30 10:04:17.992 +07:00 [INF] User 2 already subscribed to channel conversation:53
2025-05-30 10:04:18.011 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:04:18.047 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 125.419ms
2025-05-30 10:04:18.048 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:04:18.048 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 127.9819ms
2025-05-30 10:04:21.192 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - null null
2025-05-30 10:04:21.192 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:04:21.193 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 10:04:21.197 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53
2025-05-30 10:04:21.197 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53 and user 2
2025-05-30 10:04:21.197 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:04:21.198 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 5.1059ms
2025-05-30 10:04:21.198 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:04:21.198 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 6.2061ms
2025-05-30 10:04:21.258 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:04:21.260 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:04:21.260 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:04:21.269 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 10:04:21.274 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 10:04:21.275 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 14.8315ms
2025-05-30 10:04:21.275 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:04:21.276 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 17.5435ms
2025-05-30 10:04:21.344 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:04:21.345 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:04:21.345 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 10:04:21.362 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 10:04:21.379 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:04:21.381 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 35.0793ms
2025-05-30 10:04:21.381 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:04:21.381 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 37.2629ms
2025-05-30 10:04:22.649 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 10:04:22.649 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:04:22.649 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.3195ms
2025-05-30 10:04:22.652 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 10:04:22.652 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:04:22.652 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:04:22.653 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:04:22.653 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 10:04:22.663 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53
2025-05-30 10:04:22.663 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53 and user 3
2025-05-30 10:04:22.663 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:04:22.663 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 10.6083ms
2025-05-30 10:04:22.663 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:04:22.663 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 12.613ms
2025-05-30 10:04:22.674 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:04:22.674 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:04:22.674 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.2643ms
2025-05-30 10:04:22.676 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:04:22.676 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:04:22.676 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:04:22.676 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:04:22.677 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:04:22.680 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 10:04:22.683 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 10:04:22.683 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.5119ms
2025-05-30 10:04:22.683 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:04:22.683 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 7.4002ms
2025-05-30 10:04:22.696 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:04:22.697 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:04:22.697 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.5412ms
2025-05-30 10:04:22.699 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:04:22.699 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:04:22.699 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:04:22.699 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:04:22.699 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 10:04:22.701 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 10:04:22.703 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:04:22.703 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.8033ms
2025-05-30 10:04:22.703 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:04:22.703 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 4.5233ms
2025-05-30 10:05:50.963 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 10:05:50.963 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:50.963 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.4442ms
2025-05-30 10:05:50.965 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 10:05:50.965 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:50.965 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:50.966 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:05:50.966 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 10:05:50.993 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 10:05:50.994 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 10:05:50.994 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 28.2687ms
2025-05-30 10:05:50.995 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:05:50.995 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 30.187ms
2025-05-30 10:05:51.017 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 10:05:51.017 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:51.017 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:51.017 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:05:51.113 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 10:05:51.113 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:51.113 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:51.113 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:05:51.113 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 10:05:51.125 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 10:05:51.126 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:05:51.126 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 12.4356ms
2025-05-30 10:05:51.126 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:05:51.126 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 13.0378ms
2025-05-30 10:05:51.201 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:05:51.201 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:05:51.202 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:05:51.203 +07:00 [ERR] Connection id "0HNCV4OFF8A0E", Request id "0HNCV4OFF8A0E:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:05:51.204 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 103974.8551ms
2025-05-30 10:05:51.209 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:05:51.211 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 10:05:51.211 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 10:05:51.211 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 10:05:51.212 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 10:05:51.214 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 10:05:51.214 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 10:05:51.215 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 10:05:51.272 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 10:05:51.273 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:51.273 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.5411ms
2025-05-30 10:05:51.275 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 10:05:51.275 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:51.275 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:51.275 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:05:51.276 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:05:51.293 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 10:05:51.340 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:05:51.341 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 65.6402ms
2025-05-30 10:05:51.341 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:05:51.342 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 66.618ms
2025-05-30 10:05:55.698 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 10:05:55.698 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:55.698 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.3488ms
2025-05-30 10:05:55.700 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 10:05:55.700 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:55.700 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:55.700 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:05:55.701 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 10:05:55.707 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53
2025-05-30 10:05:55.707 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53 and user 3
2025-05-30 10:05:55.708 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:05:55.708 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 7.1379ms
2025-05-30 10:05:55.708 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:05:55.709 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 8.9782ms
2025-05-30 10:05:55.724 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:05:55.724 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:55.724 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.7373ms
2025-05-30 10:05:55.727 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:05:55.727 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:55.727 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:55.727 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:05:55.727 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:05:55.737 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 10:05:55.739 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 10:05:55.741 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 12.888ms
2025-05-30 10:05:55.741 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:05:55.741 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 14.1941ms
2025-05-30 10:05:55.750 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:05:55.750 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:55.751 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2834ms
2025-05-30 10:05:55.752 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:05:55.752 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:55.752 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:55.752 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:05:55.753 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 10:05:55.757 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 10:05:55.762 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:05:55.762 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.2434ms
2025-05-30 10:05:55.762 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:05:55.762 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 9.9739ms
2025-05-30 10:05:56.275 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 10:05:56.275 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:56.275 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:05:56.275 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:05:56.290 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:05:56.291 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:05:56.292 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:05:56.293 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 10:05:56.295 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 10:05:56.296 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 10:05:56.296 +07:00 [ERR] Connection id "0HNCV4OFF8A0N", Request id "0HNCV4OFF8A0N:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:05:56.300 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 5283.0177ms
2025-05-30 10:06:01.305 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 10:06:01.305 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:06:01.306 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:06:01.306 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:06:01.312 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 10:06:01.313 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 10:06:01.314 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 10:06:01.314 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 10:06:01.314 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 10:06:01.314 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 10:06:01.314 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 10:06:01.314 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 10:06:01.314 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 10:06:01.314 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 10:06:01.314 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 10:06:16.849 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:06:16.849 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:06:16.852 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:06:16.852 +07:00 [ERR] Connection id "0HNCV4OFF8A0G", Request id "0HNCV4OFF8A0G:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:06:16.855 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - 101 null null 119066.4273ms
2025-05-30 10:06:21.994 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:06:21.994 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:06:21.995 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:06:21.995 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:06:21.995 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:06:21.995 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:06:21.996 +07:00 [ERR] Connection id "0HNCV4OFF8A0D", Request id "0HNCV4OFF8A0D:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:06:21.996 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:06:21.996 +07:00 [ERR] Connection id "0HNCV4OFF8A0O", Request id "0HNCV4OFF8A0O:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:06:21.998 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 139788.4445ms
2025-05-30 10:06:21.999 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:06:22.001 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 25726.3748ms
2025-05-30 10:06:22.003 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:06:22.006 +07:00 [ERR] Connection id "0HNCV4OFF8A0P", Request id "0HNCV4OFF8A0P:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:06:22.007 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 20702.5121ms
2025-05-30 10:07:30.527 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 10:07:30.528 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:30.528 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2908ms
2025-05-30 10:07:30.529 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 10:07:30.529 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:30.529 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:30.529 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:07:30.529 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 10:07:30.570 +07:00 [INF] Executed DbCommand (40ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 10:07:30.571 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 10:07:30.572 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 42.2051ms
2025-05-30 10:07:30.572 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:07:30.572 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 42.7341ms
2025-05-30 10:07:30.605 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 10:07:30.605 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:30.605 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:30.605 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:07:30.731 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 10:07:30.731 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:30.731 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:30.731 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:07:30.731 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 10:07:30.741 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 10:07:30.742 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:07:30.742 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.6579ms
2025-05-30 10:07:30.742 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:07:30.742 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 11.4922ms
2025-05-30 10:07:30.893 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:07:30.894 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 10:07:30.894 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 10:07:30.894 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 10:07:30.894 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 10:07:30.894 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 10:07:30.894 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 10:07:30.894 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 10:07:30.894 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 10:07:30.894 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 10:07:30.894 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 10:07:30.895 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 10:07:30.903 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:07:30.903 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 10:07:30.903 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 10:07:30.903 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 10:07:30.904 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 10:07:30.978 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 10:07:30.979 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:30.979 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3717ms
2025-05-30 10:07:30.980 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 10:07:30.980 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:30.980 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:30.980 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:07:30.980 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:07:30.998 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 10:07:31.010 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:07:31.011 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 30.9738ms
2025-05-30 10:07:31.011 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:07:31.012 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 31.7176ms
2025-05-30 10:07:43.666 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - application/json 58
2025-05-30 10:07:43.667 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:07:43.668 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 10:07:43.687 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 10:07:43.688 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 10:07:43.688 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 20.2623ms
2025-05-30 10:07:43.688 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:07:43.688 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.243:5053/api/Auth/login - 200 null application/json; charset=utf-8 22.0022ms
2025-05-30 10:07:44.921 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - null null
2025-05-30 10:07:44.921 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:07:44.921 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 10:07:44.929 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 10:07:44.932 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:07:44.932 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.9249ms
2025-05-30 10:07:44.932 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:07:44.932 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 11.4865ms
2025-05-30 10:07:44.936 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - null null
2025-05-30 10:07:44.936 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:07:44.936 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:07:44.952 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 10:07:44.975 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:07:44.998 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 61.7171ms
2025-05-30 10:07:44.998 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:07:44.999 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 62.9087ms
2025-05-30 10:07:45.493 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - null null
2025-05-30 10:07:45.493 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:07:45.591 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-30 10:07:45.593 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-30 10:07:45.594 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-05-30 10:07:45.596 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:07:45.596 +07:00 [INF] User 2 already subscribed to channel conversation:3
2025-05-30 10:07:45.596 +07:00 [INF] User 2 already subscribed to channel conversation:4
2025-05-30 10:07:45.596 +07:00 [INF] User 2 already subscribed to channel conversation:19
2025-05-30 10:07:45.596 +07:00 [INF] User 2 already subscribed to channel conversation:1
2025-05-30 10:07:45.596 +07:00 [INF] User 2 already subscribed to channel conversation:25
2025-05-30 10:07:45.596 +07:00 [INF] User 2 already subscribed to channel conversation:26
2025-05-30 10:07:45.596 +07:00 [INF] User 2 already subscribed to channel conversation:27
2025-05-30 10:07:45.596 +07:00 [INF] User 2 already subscribed to channel conversation:28
2025-05-30 10:07:45.596 +07:00 [INF] User 2 already subscribed to channel conversation:29
2025-05-30 10:07:45.596 +07:00 [INF] User 2 already subscribed to channel conversation:32
2025-05-30 10:07:45.596 +07:00 [INF] User 2 already subscribed to channel conversation:33
2025-05-30 10:07:45.596 +07:00 [INF] User 2 already subscribed to channel conversation:34
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:35
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:36
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:37
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:38
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:39
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:41
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:40
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:42
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:44
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:43
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:45
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:46
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:47
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:48
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:49
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:50
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:51
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:52
2025-05-30 10:07:45.597 +07:00 [INF] User 2 already subscribed to channel conversation:53
2025-05-30 10:07:48.235 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - null null
2025-05-30 10:07:48.236 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:07:48.236 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 10:07:48.241 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53
2025-05-30 10:07:48.241 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53 and user 2
2025-05-30 10:07:48.241 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:07:48.242 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 5.4749ms
2025-05-30 10:07:48.242 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:07:48.242 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Message/getMessages/53/2 - 200 null application/json; charset=utf-8 6.4894ms
2025-05-30 10:07:48.313 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:07:48.313 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:07:48.313 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:07:48.318 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 10:07:48.323 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 10:07:48.323 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.4335ms
2025-05-30 10:07:48.323 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:07:48.323 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 10.922ms
2025-05-30 10:07:48.373 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:07:48.374 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:07:48.374 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 10:07:48.379 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 10:07:48.382 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:07:48.383 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.8966ms
2025-05-30 10:07:48.383 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:07:48.383 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 9.5444ms
2025-05-30 10:07:49.507 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 10:07:49.507 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:49.507 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.2554ms
2025-05-30 10:07:49.508 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 10:07:49.509 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:49.509 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:49.509 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:07:49.509 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 10:07:49.513 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53
2025-05-30 10:07:49.514 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53 and user 3
2025-05-30 10:07:49.514 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:07:49.514 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 5.1341ms
2025-05-30 10:07:49.514 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:07:49.514 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 5.7212ms
2025-05-30 10:07:49.527 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:07:49.527 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:49.527 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.2169ms
2025-05-30 10:07:49.530 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:07:49.530 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:49.530 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:49.530 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:07:49.530 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:07:49.536 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 10:07:49.538 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 10:07:49.538 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.9212ms
2025-05-30 10:07:49.538 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:07:49.538 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 8.7697ms
2025-05-30 10:07:49.549 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:07:49.549 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:49.550 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2135ms
2025-05-30 10:07:49.551 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:07:49.552 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:49.552 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:07:49.552 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:07:49.552 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 10:07:49.556 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 10:07:49.558 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:07:49.559 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.2782ms
2025-05-30 10:07:49.559 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:07:49.559 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 7.457ms
2025-05-30 10:10:17.695 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 10:10:17.695 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:17.695 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.3477ms
2025-05-30 10:10:17.696 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 10:10:17.696 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:17.697 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:17.697 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:10:17.697 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 10:10:17.720 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 10:10:17.722 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 10:10:17.724 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 26.9449ms
2025-05-30 10:10:17.724 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:10:17.724 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 28.0175ms
2025-05-30 10:10:17.754 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 10:10:17.754 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:17.754 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:17.754 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:10:17.856 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 10:10:17.857 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:17.857 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:17.857 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:10:17.857 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 10:10:17.867 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 10:10:17.868 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:10:17.868 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.7018ms
2025-05-30 10:10:17.868 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:10:17.868 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 11.3458ms
2025-05-30 10:10:17.947 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 10:10:17.948 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 10:10:17.949 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 10:10:17.949 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 10:10:17.949 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 10:10:17.949 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 10:10:17.949 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 10:10:17.949 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 10:10:17.949 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 10:10:17.949 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 10:10:17.949 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 10:10:17.949 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 10:10:17.954 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:10:17.954 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 10:10:17.954 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 10:10:17.954 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 10:10:17.954 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 10:10:17.954 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 10:10:17.954 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 10:10:17.954 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 10:10:17.954 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 10:10:17.954 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 10:10:17.954 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 10:10:17.954 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 10:10:17.954 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 10:10:17.955 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 10:10:17.955 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 10:10:17.955 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 10:10:17.955 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 10:10:17.955 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 10:10:17.955 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 10:10:17.955 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 10:10:17.955 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 10:10:17.955 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 10:10:17.955 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 10:10:17.955 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 10:10:17.955 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 10:10:18.028 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 10:10:18.028 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:18.029 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2321ms
2025-05-30 10:10:18.030 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 10:10:18.030 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:18.030 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:18.031 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:10:18.031 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:10:18.051 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 10:10:18.066 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:10:18.069 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 38.0874ms
2025-05-30 10:10:18.069 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:10:18.069 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 39.091ms
2025-05-30 10:10:21.433 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 10:10:21.433 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:21.434 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.2236ms
2025-05-30 10:10:21.435 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 10:10:21.435 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:21.435 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:21.435 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:10:21.435 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 10:10:21.439 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53
2025-05-30 10:10:21.440 +07:00 [INF] Retrieved 11 messages from Redis for conversation 53 and user 3
2025-05-30 10:10:21.440 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:10:21.440 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.7512ms
2025-05-30 10:10:21.440 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:10:21.440 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 5.3089ms
2025-05-30 10:10:21.448 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:10:21.449 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:21.449 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.2561ms
2025-05-30 10:10:21.450 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:10:21.450 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:21.450 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:21.450 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:10:21.451 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:10:21.460 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 10:10:21.463 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 10:10:21.464 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 12.9927ms
2025-05-30 10:10:21.464 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:10:21.464 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 13.7405ms
2025-05-30 10:10:21.472 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:10:21.472 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:21.472 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2161ms
2025-05-30 10:10:21.474 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:10:21.474 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:21.474 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:10:21.474 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:10:21.474 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 10:10:21.480 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 10:10:21.482 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:10:21.482 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.4512ms
2025-05-30 10:10:21.482 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:10:21.482 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 8.4849ms
2025-05-30 10:10:27.263 +07:00 [INF] Handling message from user 2:  t chi cuc gi v ang bn
2025-05-30 10:10:27.263 +07:00 [INF] Handling message from user 2:  t chi cuc gi v ang bn
2025-05-30 10:10:27.334 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-30 10:10:27.354 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-30 10:10:27.572 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 10:10:27.573 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 10:10:27.625 +07:00 [INF] Executed DbCommand (44ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-30 10:10:27.626 +07:00 [INF] Executed DbCommand (46ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-30 10:10:27.669 +07:00 [INF] Message saved to DB with ID: 432
2025-05-30 10:10:27.669 +07:00 [INF] Message saved to DB with ID: 431
2025-05-30 10:10:27.677 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 10:10:27.677 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 10:10:27.693 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-30 10:10:27.709 +07:00 [INF] Executed DbCommand (32ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-30 10:10:27.713 +07:00 [INF] Transaction committed for message: 431
2025-05-30 10:10:27.713 +07:00 [INF] Transaction committed for message: 432
2025-05-30 10:10:27.725 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:10:27.725 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:10:27.747 +07:00 [INF] Saved message 431 to Redis
2025-05-30 10:10:27.747 +07:00 [INF] Saved message 432 to Redis
2025-05-30 10:10:27.752 +07:00 [INF] Added message 431 to conversation 53
2025-05-30 10:10:27.752 +07:00 [INF] Added message 432 to conversation 53
2025-05-30 10:10:27.762 +07:00 [INF] Published message to channel conversation:53
2025-05-30 10:10:27.762 +07:00 [INF] Published message to channel conversation:53
2025-05-30 10:10:37.873 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:10:37.874 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:10:37.896 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:10:37.897 +07:00 [ERR] Connection id "0HNCV4OFF8A0V", Request id "0HNCV4OFF8A0V:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:10:37.904 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - 101 null null 172411.2288ms
2025-05-30 10:10:42.939 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - null null
2025-05-30 10:10:42.939 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:10:43.000 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:10:43.001 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-30 10:10:43.002 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-30 10:10:43.003 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-30 10:10:43.004 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-30 10:10:43.004 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-30 10:10:43.004 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-30 10:10:43.004 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:46
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:47
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:48
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:49
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:50
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:51
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:52
2025-05-30 10:10:43.005 +07:00 [INF] User 2 subscribed to channel conversation:53
2025-05-30 10:10:49.737 +07:00 [INF] Handling message from user 2:  t chi cuc gi v ang bn
2025-05-30 10:10:49.756 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-30 10:10:49.779 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 10:10:49.786 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-30 10:10:49.787 +07:00 [INF] Message saved to DB with ID: 433
2025-05-30 10:10:49.787 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 10:10:49.792 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-30 10:10:49.794 +07:00 [INF] Transaction committed for message: 433
2025-05-30 10:10:49.797 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:10:49.801 +07:00 [INF] Saved message 433 to Redis
2025-05-30 10:10:49.801 +07:00 [INF] Added message 433 to conversation 53
2025-05-30 10:10:49.802 +07:00 [INF] Published message to channel conversation:53
2025-05-30 10:13:07.456 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-30 10:13:07.456 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:07.456 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.2406ms
2025-05-30 10:13:07.457 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-30 10:13:07.457 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:07.457 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:07.457 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:13:07.457 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-30 10:13:07.473 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-30 10:13:07.474 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-30 10:13:07.475 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 17.4298ms
2025-05-30 10:13:07.476 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-30 10:13:07.477 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 19.6807ms
2025-05-30 10:13:07.514 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-30 10:13:07.514 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:07.515 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:07.515 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-30 10:13:07.618 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-30 10:13:07.618 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:07.618 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:07.618 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:13:07.618 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-30 10:13:07.630 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-30 10:13:07.630 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:13:07.630 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 12.0516ms
2025-05-30 10:13:07.630 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-30 10:13:07.631 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 12.9506ms
2025-05-30 10:13:07.709 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:13:07.709 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-30 10:13:07.709 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-30 10:13:07.709 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-30 10:13:07.710 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-30 10:13:07.710 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-30 10:13:07.710 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-30 10:13:07.710 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-30 10:13:07.711 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-30 10:13:07.711 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-30 10:13:07.711 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-30 10:13:07.711 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-30 10:13:07.711 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-30 10:13:07.711 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-30 10:13:07.711 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-30 10:13:07.711 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-30 10:13:07.711 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-30 10:13:07.712 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-30 10:13:07.712 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-30 10:13:07.712 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-30 10:13:07.712 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-30 10:13:07.712 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-30 10:13:07.712 +07:00 [INF] User 3 subscribed to channel conversation:50
2025-05-30 10:13:07.712 +07:00 [INF] User 3 subscribed to channel conversation:51
2025-05-30 10:13:07.712 +07:00 [INF] User 3 subscribed to channel conversation:53
2025-05-30 10:13:07.717 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:13:07.718 +07:00 [INF] User 3 already subscribed to channel conversation:1
2025-05-30 10:13:07.718 +07:00 [INF] User 3 already subscribed to channel conversation:2
2025-05-30 10:13:07.718 +07:00 [INF] User 3 already subscribed to channel conversation:9
2025-05-30 10:13:07.718 +07:00 [INF] User 3 already subscribed to channel conversation:19
2025-05-30 10:13:07.718 +07:00 [INF] User 3 already subscribed to channel conversation:25
2025-05-30 10:13:07.718 +07:00 [INF] User 3 already subscribed to channel conversation:26
2025-05-30 10:13:07.718 +07:00 [INF] User 3 already subscribed to channel conversation:27
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:28
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:29
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:32
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:34
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:35
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:36
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:37
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:38
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:39
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:40
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:42
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:43
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:44
2025-05-30 10:13:07.719 +07:00 [INF] User 3 already subscribed to channel conversation:45
2025-05-30 10:13:07.720 +07:00 [INF] User 3 already subscribed to channel conversation:50
2025-05-30 10:13:07.720 +07:00 [INF] User 3 already subscribed to channel conversation:51
2025-05-30 10:13:07.720 +07:00 [INF] User 3 already subscribed to channel conversation:53
2025-05-30 10:13:07.793 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 10:13:07.793 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:07.793 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 1.7365ms
2025-05-30 10:13:07.795 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-30 10:13:07.795 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:07.795 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:07.795 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:13:07.795 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:13:07.813 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-30 10:13:07.829 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:13:07.831 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 35.9552ms
2025-05-30 10:13:07.831 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-30 10:13:07.831 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 36.8501ms
2025-05-30 10:13:10.322 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 10:13:10.322 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:10.322 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/53/3 - 204 null null 0.2879ms
2025-05-30 10:13:10.324 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - null null
2025-05-30 10:13:10.324 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:10.324 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:10.324 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:13:10.324 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-30 10:13:10.330 +07:00 [INF] Retrieved 14 messages from Redis for conversation 53
2025-05-30 10:13:10.330 +07:00 [INF] Retrieved 14 messages from Redis for conversation 53 and user 3
2025-05-30 10:13:10.330 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-30 10:13:10.330 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 6.4188ms
2025-05-30 10:13:10.331 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-30 10:13:10.331 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/53/3 - 200 null application/json; charset=utf-8 7.1879ms
2025-05-30 10:13:10.345 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:13:10.346 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:10.346 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/53 - 204 null null 0.5666ms
2025-05-30 10:13:10.348 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - null null
2025-05-30 10:13:10.348 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:10.348 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:10.348 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:13:10.349 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-30 10:13:10.357 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-30 10:13:10.361 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-30 10:13:10.362 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 13.0214ms
2025-05-30 10:13:10.362 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-30 10:13:10.362 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/53 - 200 null application/json; charset=utf-8 13.821ms
2025-05-30 10:13:10.373 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:13:10.373 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:10.374 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/53 - 204 null null 0.2205ms
2025-05-30 10:13:10.375 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - null null
2025-05-30 10:13:10.375 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:10.375 +07:00 [INF] CORS policy execution successful.
2025-05-30 10:13:10.375 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:13:10.375 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-30 10:13:10.380 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-30 10:13:10.383 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-30 10:13:10.383 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.8229ms
2025-05-30 10:13:10.383 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-30 10:13:10.383 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/53 - 200 null application/json; charset=utf-8 8.6338ms
2025-05-30 10:13:16.615 +07:00 [INF] Handling message from user 2:  t chi cuc gi v ang bn
2025-05-30 10:13:16.629 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-30 10:13:16.636 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 10:13:16.644 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-30 10:13:16.645 +07:00 [INF] Message saved to DB with ID: 434
2025-05-30 10:13:16.646 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-30 10:13:16.660 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-30 10:13:16.661 +07:00 [INF] Transaction committed for message: 434
2025-05-30 10:13:16.666 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-30 10:13:16.674 +07:00 [INF] Saved message 434 to Redis
2025-05-30 10:13:16.675 +07:00 [INF] Added message 434 to conversation 53
2025-05-30 10:13:16.675 +07:00 [INF] Published message to channel conversation:53
2025-05-30 10:28:38.017 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:28:38.020 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:28:38.062 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:28:38.052 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:54:37.513 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:28:38.052 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:54:37.514 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:28:38.063 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:54:37.514 +07:00 [ERR] Connection id "0HNCV4OFF8A14", Request id "0HNCV4OFF8A14:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:54:37.597 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:54:37.596 +07:00 [ERR] Connection id "0HNCV4OFF8A17", Request id "0HNCV4OFF8A17:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:54:37.643 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 2659888.6683ms
2025-05-30 10:54:37.642 +07:00 [ERR] Connection id "0HNCV4OFF8A0R", Request id "0HNCV4OFF8A0R:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:54:37.774 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 2490260.1755ms
2025-05-30 10:54:37.813 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 2827208.4581ms
2025-05-30 10:54:37.862 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-30 10:54:37.862 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-30 10:54:38.583 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-30 10:54:38.584 +07:00 [ERR] Connection id "0HNCV4OFF8A15", Request id "0HNCV4OFF8A15:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-30 10:54:39.459 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.243:5053/ws/chat?userId=2 - 101 null null 2636522.1207ms
