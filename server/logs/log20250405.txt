2025-04-05 07:48:06.213 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-04-05 07:48:06.336 +07:00 [INF] Now listening on: http://localhost:5053
2025-04-05 07:48:06.338 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-04-05 07:48:06.339 +07:00 [INF] Hosting environment: Development
2025-04-05 07:48:06.339 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-04-05 07:48:07.014 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/index.html - null null
2025-04-05 07:48:07.138 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/index.html - 200 null text/html;charset=utf-8 126.1055ms
2025-04-05 07:48:07.142 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/index.js - null null
2025-04-05 07:48:07.143 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/_framework/aspnetcore-browser-refresh.js - null null
2025-04-05 07:48:07.144 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/index.js - 200 null application/javascript;charset=utf-8 3.1976ms
2025-04-05 07:48:07.145 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/_framework/aspnetcore-browser-refresh.js - 200 13732 application/javascript; charset=utf-8 2.335ms
2025-04-05 07:48:07.980 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/v1/swagger.json - null null
2025-04-05 07:48:08.080 +07:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Failed to generate Operation for action - server.Controllers.MessageController.UploadFile (Message_app). See inner exception
 ---> Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Error reading parameter(s) for action server.Controllers.MessageController.UploadFile (Message_app) as [FromForm] attribute used with IFormFile. Please refer to https://github.com/domaindrivendev/Swashbuckle.AspNetCore#handle-forms-and-file-uploads for more information
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateParametersAsync(ApiDescription apiDescription, SchemaRepository schemaRespository, Func`3 parameterGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateParametersAsync(ApiDescription apiDescription, SchemaRepository schemaRespository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository, Func`3 parametersGenerator, Func`3 bodyGenerator, Func`3 applyFilters)
   --- End of inner exception stack trace ---
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository, Func`3 parametersGenerator, Func`3 bodyGenerator, Func`3 applyFilters)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository, Func`3 operationsGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 07:48:08.090 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 109.7061ms
2025-04-05 07:48:27.362 +07:00 [INF] Application is shutting down...
2025-04-05 07:49:44.203 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-04-05 07:49:44.287 +07:00 [INF] Now listening on: http://localhost:5053
2025-04-05 07:49:44.290 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-04-05 07:49:44.292 +07:00 [INF] Hosting environment: Development
2025-04-05 07:49:44.292 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-04-05 08:11:14.984 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:11:15.054 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:11:15.068 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 87.7466ms
2025-04-05 08:11:15.076 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:11:15.081 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:11:15.109 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:11:15.149 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:11:16.418 +07:00 [INF] Executed DbCommand (68ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:11:16.524 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:11:16.569 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 1415.7309ms
2025-04-05 08:11:16.572 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:11:16.578 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 1502.4675ms
2025-04-05 08:11:16.782 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - null null
2025-04-05 08:11:16.785 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:11:16.787 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - 204 null null 5.2608ms
2025-04-05 08:11:16.796 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - application/json null
2025-04-05 08:11:16.803 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:11:16.805 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:11:16.815 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:11:17.259 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:11:17.278 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:11:17.283 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 465.7022ms
2025-04-05 08:11:17.285 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:11:17.286 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - 200 null application/json; charset=utf-8 490.7064ms
2025-04-05 08:11:19.188 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:11:19.194 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:11:19.195 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:11:19.295 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:11:19.297 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:11:19.298 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 3.3653ms
2025-04-05 08:11:19.301 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:11:19.302 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:11:19.303 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:11:19.306 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:11:19.336 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:11:19.345 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 35.6846ms
2025-04-05 08:11:19.346 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:11:19.348 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 46.9247ms
2025-04-05 08:11:19.365 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:11:19.367 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:11:19.367 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:11:19.370 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 4.7556ms
2025-04-05 08:11:19.372 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:11:19.375 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:11:19.377 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:11:19.382 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:11:19.406 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:11:19.412 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:11:19.414 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 29.2945ms
2025-04-05 08:11:19.415 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:11:19.416 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 43.7842ms
2025-04-05 08:11:19.430 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:11:19.432 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:11:19.433 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 2.4852ms
2025-04-05 08:11:19.435 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:11:19.436 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:11:19.438 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:11:19.441 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:11:19.453 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:11:19.461 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:11:19.469 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 26.2039ms
2025-04-05 08:11:19.471 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:11:19.472 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 37.0754ms
2025-04-05 08:13:27.098 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:13:27.099 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 127911.116ms
2025-04-05 08:13:40.761 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:13:40.764 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:13:40.765 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 3.8064ms
2025-04-05 08:13:40.767 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 56
2025-04-05 08:13:40.768 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:13:40.770 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:13:40.771 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:13:40.790 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:13:40.792 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-04-05 08:13:40.793 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 20.2337ms
2025-04-05 08:13:40.795 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:13:40.796 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 400 null application/json; charset=utf-8 29.7578ms
2025-04-05 08:13:48.442 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:13:48.445 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:13:48.447 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 5.0255ms
2025-04-05 08:13:48.452 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:13:48.454 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:13:48.455 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:13:48.456 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:13:48.462 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:13:48.465 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:13:48.466 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 9.2504ms
2025-04-05 08:13:48.467 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:13:48.468 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 16.4468ms
2025-04-05 08:13:48.640 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - null null
2025-04-05 08:13:48.642 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:13:48.642 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - 204 null null 1.9352ms
2025-04-05 08:13:48.646 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - application/json null
2025-04-05 08:13:48.649 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:13:48.650 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:13:48.651 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:13:48.666 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:13:48.668 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:13:48.669 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 16.4025ms
2025-04-05 08:13:48.670 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:13:48.671 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - 200 null application/json; charset=utf-8 25.0618ms
2025-04-05 08:13:51.244 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:13:51.248 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:13:51.249 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:13:51.334 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:13:51.334 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:13:51.335 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:13:51.338 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 4.057ms
2025-04-05 08:13:51.340 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:13:51.342 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:13:51.343 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:13:51.344 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:13:51.350 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:13:51.351 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.7476ms
2025-04-05 08:13:51.352 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:13:51.353 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 12.7269ms
2025-04-05 08:13:51.370 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:13:51.372 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:13:51.373 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 2.528ms
2025-04-05 08:13:51.376 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:13:51.377 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:13:51.378 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:13:51.379 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:13:51.385 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:13:51.386 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:13:51.387 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.3006ms
2025-04-05 08:13:51.388 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:13:51.389 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 13.62ms
2025-04-05 08:13:51.406 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:13:51.407 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:13:51.408 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 2.005ms
2025-04-05 08:13:51.411 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:13:51.413 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:13:51.413 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:13:51.414 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:13:51.419 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:13:51.421 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:13:51.423 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.6064ms
2025-04-05 08:13:51.424 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:13:51.424 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 13.794ms
2025-04-05 08:14:18.826 +07:00 [INF] Handling message: 🙃
2025-04-05 08:14:18.944 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 08:14:18.984 +07:00 [INF] Executed DbCommand (35ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 08:14:19.002 +07:00 [INF] Message saved to DB: 113
2025-04-05 08:14:19.007 +07:00 [INF] Transaction committed for message: 113
2025-04-05 08:14:19.011 +07:00 [INF] Message saved to Redis: {"Message":{"id":113,"content":"\uD83D\uDE43","sender_id":6,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T01:14:18.840702Z","conversation_id":1},"Attachment":null}
2025-04-05 08:15:12.654 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:15:12.656 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:15:12.657 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.6718ms
2025-04-05 08:15:12.658 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:15:12.661 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:15:12.662 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:15:12.664 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:15:12.682 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:15:12.684 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:15:12.687 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 20.8857ms
2025-04-05 08:15:12.688 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:15:12.690 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 31.0271ms
2025-04-05 08:15:12.882 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/7 - null null
2025-04-05 08:15:12.884 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:15:12.885 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/7 - 204 null null 2.6061ms
2025-04-05 08:15:12.887 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/7 - application/json null
2025-04-05 08:15:12.889 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:15:12.890 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:15:12.891 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:15:12.903 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:15:12.905 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:15:12.906 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 13.7192ms
2025-04-05 08:15:12.907 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:15:12.907 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/7 - 200 null application/json; charset=utf-8 20.0679ms
2025-04-05 08:15:14.848 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:15:14.851 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:15:14.853 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:15:14.941 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:15:14.948 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:15:14.955 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:15:14.956 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 8.0939ms
2025-04-05 08:15:14.961 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:15:14.966 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:15:14.967 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:15:14.968 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:15:14.975 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:15:14.979 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 7.0821ms
2025-04-05 08:15:14.980 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:15:14.983 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 21.3298ms
2025-04-05 08:15:15.003 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:15:15.005 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:15:15.006 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 2.7143ms
2025-04-05 08:15:15.008 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:15:15.009 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:15:15.010 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:15:15.011 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:15:15.016 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:15:15.017 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:15:15.018 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.9743ms
2025-04-05 08:15:15.019 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:15:15.020 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 12.4088ms
2025-04-05 08:15:15.035 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:15:15.038 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:15:15.039 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 3.8531ms
2025-04-05 08:15:15.041 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:15:15.043 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:15:15.043 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:15:15.044 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:15:15.048 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:15:15.050 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:15:15.052 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.7549ms
2025-04-05 08:15:15.053 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:15:15.054 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 12.3576ms
2025-04-05 08:15:49.002 +07:00 [INF] Handling message: 😂
2025-04-05 08:15:49.007 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 08:15:49.026 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 08:15:49.028 +07:00 [INF] Message saved to DB: 114
2025-04-05 08:15:49.029 +07:00 [INF] Transaction committed for message: 114
2025-04-05 08:15:49.031 +07:00 [INF] Message saved to Redis: {"Message":{"id":114,"content":"\uD83D\uDE02","sender_id":7,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T01:15:49.006317Z","conversation_id":1},"Attachment":null}
2025-04-05 08:22:05.892 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:22:05.893 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 494648.2356ms
2025-04-05 08:22:08.576 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:22:08.577 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 413728.8446ms
2025-04-05 08:22:20.830 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:22:20.831 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:20.832 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 1.9581ms
2025-04-05 08:22:20.834 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:22:20.835 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:20.836 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:22:20.837 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:22:20.946 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:22:20.948 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:22:20.950 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 111.4024ms
2025-04-05 08:22:20.951 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:22:20.952 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 118.2078ms
2025-04-05 08:22:21.137 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - null null
2025-04-05 08:22:21.138 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:21.138 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - 204 null null 1.8486ms
2025-04-05 08:22:21.140 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - application/json null
2025-04-05 08:22:21.143 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:21.145 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:22:21.145 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:22:21.159 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:22:21.161 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:22:21.162 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 15.7936ms
2025-04-05 08:22:21.163 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:22:21.164 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - 200 null application/json; charset=utf-8 23.9367ms
2025-04-05 08:22:36.415 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:22:36.418 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:36.418 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 3.147ms
2025-04-05 08:22:36.421 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:22:36.423 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:36.424 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:22:36.429 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:22:36.437 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:22:36.440 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:22:36.447 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 13.7471ms
2025-04-05 08:22:36.449 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:22:36.450 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 28.9302ms
2025-04-05 08:22:36.684 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - null null
2025-04-05 08:22:36.685 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:36.686 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - 204 null null 2.8162ms
2025-04-05 08:22:36.689 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - application/json null
2025-04-05 08:22:36.690 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:36.691 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:22:36.693 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:22:36.698 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:22:36.700 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:22:36.701 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 6.4043ms
2025-04-05 08:22:36.704 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:22:36.705 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - 200 null application/json; charset=utf-8 16.2486ms
2025-04-05 08:22:39.173 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:22:39.177 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.177 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:22:39.275 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:22:39.275 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:22:39.278 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.280 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 5.3477ms
2025-04-05 08:22:39.283 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:22:39.284 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.285 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:22:39.286 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:22:39.288 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:22:39.289 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.0283ms
2025-04-05 08:22:39.290 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:22:39.291 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 7.9221ms
2025-04-05 08:22:39.310 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:22:39.314 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.315 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 4.9033ms
2025-04-05 08:22:39.319 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:22:39.321 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.322 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:22:39.323 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:22:39.328 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:22:39.331 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:22:39.332 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.3044ms
2025-04-05 08:22:39.334 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:22:39.334 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 15.8212ms
2025-04-05 08:22:39.351 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:22:39.352 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.353 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 2.0356ms
2025-04-05 08:22:39.355 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:22:39.356 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.356 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:22:39.357 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:22:39.363 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:22:39.365 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:22:39.367 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.9907ms
2025-04-05 08:22:39.368 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:22:39.368 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 13.7839ms
2025-04-05 08:22:39.729 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:22:39.732 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.733 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:22:39.831 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:22:39.835 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:22:39.837 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.838 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 2.3909ms
2025-04-05 08:22:39.840 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:22:39.841 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.842 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:22:39.843 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:22:39.847 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:22:39.848 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.4123ms
2025-04-05 08:22:39.849 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:22:39.849 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 9.8928ms
2025-04-05 08:22:39.869 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:22:39.870 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.871 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 2.339ms
2025-04-05 08:22:39.873 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:22:39.874 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.875 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:22:39.877 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:22:39.881 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:22:39.883 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:22:39.884 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 4.5626ms
2025-04-05 08:22:39.885 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:22:39.887 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 13.9801ms
2025-04-05 08:22:39.903 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:22:39.904 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.905 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 2.1804ms
2025-04-05 08:22:39.908 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:22:39.910 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:22:39.911 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:22:39.913 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:22:39.916 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:22:39.918 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:22:39.919 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.7697ms
2025-04-05 08:22:39.921 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:22:39.922 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 13.957ms
2025-04-05 08:22:46.336 +07:00 [INF] Handling message: d
2025-04-05 08:22:46.345 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 08:22:46.354 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 08:22:46.356 +07:00 [INF] Message saved to DB: 115
2025-04-05 08:22:46.358 +07:00 [INF] Transaction committed for message: 115
2025-04-05 08:22:46.361 +07:00 [INF] Message saved to Redis: {"Message":{"id":115,"content":"d","sender_id":6,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T01:22:46.3445089Z","conversation_id":1},"Attachment":null}
2025-04-05 08:24:55.702 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:24:55.703 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 136529.602ms
2025-04-05 08:24:57.479 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:24:57.481 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 137751.6054ms
2025-04-05 08:25:16.849 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:25:16.851 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:16.852 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.7688ms
2025-04-05 08:25:16.854 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:25:16.856 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:16.865 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:25:16.869 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:25:16.892 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:25:16.895 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:25:16.897 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 24.4745ms
2025-04-05 08:25:16.898 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:25:16.899 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 45.2073ms
2025-04-05 08:25:17.094 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - null null
2025-04-05 08:25:17.097 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:17.099 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - 204 null null 4.4864ms
2025-04-05 08:25:17.101 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - application/json null
2025-04-05 08:25:17.102 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:17.103 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:25:17.103 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:25:17.113 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:25:17.116 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:25:17.117 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 12.8328ms
2025-04-05 08:25:17.118 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:25:17.120 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - 200 null application/json; charset=utf-8 19.3145ms
2025-04-05 08:25:29.231 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:25:29.232 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:29.233 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.8905ms
2025-04-05 08:25:29.235 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:25:29.237 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:29.237 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:25:29.238 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:25:29.242 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:25:29.244 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:25:29.245 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 5.1994ms
2025-04-05 08:25:29.246 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:25:29.247 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 12.0222ms
2025-04-05 08:25:29.448 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/7 - null null
2025-04-05 08:25:29.452 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:29.453 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/7 - 204 null null 4.8586ms
2025-04-05 08:25:29.456 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/7 - application/json null
2025-04-05 08:25:29.458 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:29.459 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:25:29.460 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:25:29.466 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:25:29.469 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:25:29.470 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 8.9798ms
2025-04-05 08:25:29.471 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:25:29.472 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/7 - 200 null application/json; charset=utf-8 15.1251ms
2025-04-05 08:25:32.212 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:25:32.216 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:32.217 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:25:32.315 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:25:32.320 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:25:32.324 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:32.325 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 5.7242ms
2025-04-05 08:25:32.328 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:25:32.330 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:32.331 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:25:32.332 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:25:32.336 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:25:32.337 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.7637ms
2025-04-05 08:25:32.338 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:25:32.338 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 10.5028ms
2025-04-05 08:25:32.491 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:25:32.492 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:32.493 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 1.9114ms
2025-04-05 08:25:32.495 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:25:32.496 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:32.497 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:25:32.498 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:25:32.503 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:25:32.505 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:25:32.506 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.1366ms
2025-04-05 08:25:32.507 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:25:32.508 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 12.7565ms
2025-04-05 08:25:32.523 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:25:32.524 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:32.524 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 1.7029ms
2025-04-05 08:25:32.526 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:25:32.527 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:32.528 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:25:32.529 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:25:32.534 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:25:32.535 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:25:32.537 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.7978ms
2025-04-05 08:25:32.538 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:25:32.539 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 12.5676ms
2025-04-05 08:25:34.750 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:25:34.752 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:34.752 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:25:34.840 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:25:34.844 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:25:34.846 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:34.848 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 3.874ms
2025-04-05 08:25:34.851 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:25:34.853 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:34.856 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:25:34.857 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:25:34.859 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:25:34.861 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.4847ms
2025-04-05 08:25:34.862 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:25:34.862 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 11.0209ms
2025-04-05 08:25:34.971 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:25:34.974 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:34.975 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 4.2162ms
2025-04-05 08:25:34.978 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:25:34.982 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:34.984 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:25:34.985 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:25:34.989 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:25:34.992 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:25:34.993 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.0012ms
2025-04-05 08:25:34.994 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:25:34.995 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 16.8672ms
2025-04-05 08:25:35.013 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:25:35.015 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:35.015 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 2.5066ms
2025-04-05 08:25:35.017 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:25:35.018 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:25:35.019 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:25:35.020 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:25:35.023 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:25:35.024 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:25:35.025 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.3587ms
2025-04-05 08:25:35.026 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:25:35.027 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 9.9424ms
2025-04-05 08:25:45.976 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:25:45.977 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 13764.8749ms
2025-04-05 08:25:47.331 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:25:47.331 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 12581.7831ms
2025-04-05 08:26:41.153 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:26:41.155 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:26:41.155 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.2686ms
2025-04-05 08:26:41.157 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:26:41.159 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:26:41.160 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:26:41.160 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:26:41.175 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:26:41.176 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:26:41.177 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 15.7113ms
2025-04-05 08:26:41.178 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:26:41.179 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 21.4559ms
2025-04-05 08:26:41.355 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - null null
2025-04-05 08:26:41.356 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:26:41.357 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - 204 null null 2.1ms
2025-04-05 08:26:41.359 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - application/json null
2025-04-05 08:26:41.360 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:26:41.361 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:26:41.362 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:26:41.373 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:26:41.375 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:26:41.376 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 13.3771ms
2025-04-05 08:26:41.377 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:26:41.378 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - 200 null application/json; charset=utf-8 19.4613ms
2025-04-05 08:26:44.648 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:26:44.653 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:26:44.655 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:26:44.740 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:26:44.741 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:26:44.743 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:26:44.744 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 2.801ms
2025-04-05 08:26:44.745 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:26:44.746 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:26:44.747 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:26:44.747 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:26:44.750 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:26:44.751 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.3058ms
2025-04-05 08:26:44.752 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:26:44.753 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 7.7593ms
2025-04-05 08:26:44.770 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:26:44.772 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:26:44.772 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 2.2172ms
2025-04-05 08:26:44.774 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:26:44.775 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:26:44.776 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:26:44.777 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:26:44.781 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:26:44.782 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:26:44.783 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.2504ms
2025-04-05 08:26:44.784 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:26:44.786 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 11.6465ms
2025-04-05 08:26:44.802 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:26:44.803 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:26:44.804 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 2.2449ms
2025-04-05 08:26:44.806 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:26:44.807 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:26:44.807 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:26:44.808 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:26:44.813 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:26:44.814 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:26:44.815 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.1603ms
2025-04-05 08:26:44.817 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:26:44.818 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 12.4413ms
2025-04-05 08:29:18.576 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:29:18.577 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 153929.2603ms
2025-04-05 08:29:41.406 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:29:41.409 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:29:41.409 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.9011ms
2025-04-05 08:29:41.412 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:29:41.415 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:29:41.415 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:29:41.416 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:29:41.429 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:29:41.431 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:29:41.432 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 14.8505ms
2025-04-05 08:29:41.433 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:29:41.434 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 21.9251ms
2025-04-05 08:29:41.627 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - null null
2025-04-05 08:29:41.628 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:29:41.629 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - 204 null null 2.0783ms
2025-04-05 08:29:41.632 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - application/json null
2025-04-05 08:29:41.634 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:29:41.634 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:29:41.635 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:29:41.648 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:29:41.650 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:29:41.651 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 13.3657ms
2025-04-05 08:29:41.652 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:29:41.654 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - 200 null application/json; charset=utf-8 21.7183ms
2025-04-05 08:30:01.873 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:30:01.875 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:01.876 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.3709ms
2025-04-05 08:30:01.878 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:30:01.880 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:01.881 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:30:01.885 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:30:01.897 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:30:01.901 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:30:01.906 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 12.5098ms
2025-04-05 08:30:01.909 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:30:01.912 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 33.8244ms
2025-04-05 08:30:02.122 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/7 - null null
2025-04-05 08:30:02.124 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:02.124 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/7 - 204 null null 2.5388ms
2025-04-05 08:30:02.127 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/7 - application/json null
2025-04-05 08:30:02.130 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:02.131 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:30:02.132 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:30:02.135 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:30:02.140 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:30:02.141 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 7.8679ms
2025-04-05 08:30:02.142 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:30:02.143 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/7 - 200 null application/json; charset=utf-8 16.174ms
2025-04-05 08:30:03.221 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:30:03.226 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:03.227 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:30:03.325 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:30:03.327 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:30:03.331 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:03.332 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 4.7724ms
2025-04-05 08:30:03.335 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:30:03.337 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:03.338 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:30:03.339 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:30:03.341 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:30:03.342 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.3117ms
2025-04-05 08:30:03.343 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:30:03.344 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 9.4264ms
2025-04-05 08:30:03.363 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:30:03.366 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:03.367 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 3.0912ms
2025-04-05 08:30:03.369 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:30:03.370 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:03.372 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:30:03.374 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:30:03.378 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:30:03.380 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:30:03.381 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.1968ms
2025-04-05 08:30:03.382 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:30:03.383 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 13.9957ms
2025-04-05 08:30:03.397 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:30:03.398 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:03.399 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 2.1906ms
2025-04-05 08:30:03.401 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:30:03.402 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:03.403 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:30:03.404 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:30:03.409 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:30:03.410 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:30:03.411 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.9407ms
2025-04-05 08:30:03.412 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:30:03.413 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 11.7634ms
2025-04-05 08:30:04.660 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:30:04.663 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:04.664 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:30:04.759 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:30:04.764 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:30:04.766 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:04.766 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 2.1207ms
2025-04-05 08:30:04.768 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:30:04.769 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:04.771 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:30:04.773 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:30:04.776 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:30:04.777 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.4928ms
2025-04-05 08:30:04.778 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:30:04.780 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 11.5217ms
2025-04-05 08:30:04.800 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:30:04.802 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:04.802 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 2.6599ms
2025-04-05 08:30:04.806 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:30:04.807 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:04.808 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:30:04.809 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:30:04.811 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:30:04.813 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:30:04.814 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 3.8089ms
2025-04-05 08:30:04.815 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:30:04.816 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 10.262ms
2025-04-05 08:30:04.831 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:30:04.833 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:04.833 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 2.162ms
2025-04-05 08:30:04.835 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:30:04.836 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:30:04.838 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:30:04.840 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:30:04.843 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:30:04.845 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:30:04.846 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.23ms
2025-04-05 08:30:04.848 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:30:04.848 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 13.3328ms
2025-04-05 08:30:10.164 +07:00 [INF] Handling message: da
2025-04-05 08:30:10.167 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 08:30:10.176 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 08:30:10.177 +07:00 [INF] Message saved to DB: 116
2025-04-05 08:30:10.178 +07:00 [INF] Transaction committed for message: 116
2025-04-05 08:30:10.180 +07:00 [INF] Message saved to Redis: {"Message":{"id":116,"content":"da","sender_id":7,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T01:30:10.1665424Z","conversation_id":1},"Attachment":null}
2025-04-05 08:30:15.511 +07:00 [INF] Handling message: ok
2025-04-05 08:30:15.514 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 08:30:15.515 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 08:30:15.518 +07:00 [INF] Message saved to DB: 117
2025-04-05 08:30:15.521 +07:00 [INF] Transaction committed for message: 117
2025-04-05 08:30:15.523 +07:00 [INF] Message saved to Redis: {"Message":{"id":117,"content":"ok","sender_id":6,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T01:30:15.5139652Z","conversation_id":1},"Attachment":null}
2025-04-05 08:30:55.686 +07:00 [INF] Handling message: FILE
2025-04-05 08:30:55.689 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 08:30:55.705 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 08:30:55.708 +07:00 [INF] Message saved to DB: 118
2025-04-05 08:30:55.710 +07:00 [INF] Processing attachment with ID 0
2025-04-05 08:30:55.724 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM [Attachments] AS [a]
WHERE [a].[id] = @__p_0
2025-04-05 08:30:55.726 +07:00 [WRN] Attachment with ID 0 not found!
2025-04-05 08:31:11.252 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:31:11.256 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:31:11.257 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:31:11.334 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:31:11.335 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:31:11.336 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:31:11.338 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 3.9635ms
2025-04-05 08:31:11.341 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:31:11.342 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:31:11.342 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:31:11.343 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:31:11.345 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:31:11.346 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.1352ms
2025-04-05 08:31:11.347 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:31:11.347 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 6.7125ms
2025-04-05 08:31:11.366 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:31:11.367 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:31:11.368 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 2.3197ms
2025-04-05 08:31:11.369 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:31:11.372 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:31:11.372 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:31:11.373 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:31:11.377 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:31:11.378 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:31:11.379 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 4.7389ms
2025-04-05 08:31:11.381 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:31:11.381 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 11.7815ms
2025-04-05 08:31:11.396 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:31:11.397 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:31:11.397 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 1.74ms
2025-04-05 08:31:11.399 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:31:11.401 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:31:11.401 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:31:11.402 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:31:11.407 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:31:11.410 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:31:11.411 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.565ms
2025-04-05 08:31:11.412 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:31:11.412 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 12.894ms
2025-04-05 08:32:58.669 +07:00 [INF] Handling message: dksf
2025-04-05 08:32:58.673 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 08:32:58.688 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 08:32:58.691 +07:00 [INF] Message saved to DB: 119
2025-04-05 08:32:58.694 +07:00 [INF] Transaction committed for message: 119
2025-04-05 08:32:58.695 +07:00 [INF] Message saved to Redis: {"Message":{"id":119,"content":"dksf","sender_id":6,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T01:32:58.6727021Z","conversation_id":1},"Attachment":null}
2025-04-05 08:33:06.659 +07:00 [INF] Handling message: s
2025-04-05 08:33:06.663 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 08:33:06.665 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 08:33:06.667 +07:00 [INF] Message saved to DB: 120
2025-04-05 08:33:06.670 +07:00 [INF] Transaction committed for message: 120
2025-04-05 08:33:06.673 +07:00 [INF] Message saved to Redis: {"Message":{"id":120,"content":"s","sender_id":6,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T01:33:06.6634706Z","conversation_id":1},"Attachment":null}
2025-04-05 08:33:49.759 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:33:49.763 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:33:49.764 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:33:49.843 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:33:49.846 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:33:49.846 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:33:49.847 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 3.5185ms
2025-04-05 08:33:49.851 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:33:49.853 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:33:49.854 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:33:49.855 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:33:49.857 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:33:49.858 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.3948ms
2025-04-05 08:33:49.860 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:33:49.861 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 10.314ms
2025-04-05 08:33:49.881 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:33:49.884 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:33:49.885 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 3.7412ms
2025-04-05 08:33:49.887 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:33:49.888 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:33:49.889 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:33:49.890 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:33:49.894 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:33:49.896 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:33:49.898 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.4325ms
2025-04-05 08:33:49.899 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:33:49.900 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 13.4812ms
2025-04-05 08:33:49.914 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:33:49.916 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:33:49.917 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 2.4747ms
2025-04-05 08:33:49.919 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:33:49.921 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:33:49.921 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:33:49.922 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:33:49.926 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:33:49.929 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:33:49.931 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.846ms
2025-04-05 08:33:49.932 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:33:49.933 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 14.2962ms
2025-04-05 08:37:33.004 +07:00 [INF] Handling message: ư
2025-04-05 08:37:33.012 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 08:37:33.026 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 08:37:33.028 +07:00 [INF] Message saved to DB: 121
2025-04-05 08:37:33.030 +07:00 [INF] Transaction committed for message: 121
2025-04-05 08:37:33.032 +07:00 [INF] Message saved to Redis: {"Message":{"id":121,"content":"\u01B0","sender_id":6,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T01:37:33.0109718Z","conversation_id":1},"Attachment":null}
2025-04-05 08:39:13.879 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:39:13.879 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:39:13.879 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:39:13.881 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 550659.9534ms
2025-04-05 08:39:13.883 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 324123.5059ms
2025-04-05 08:39:13.885 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 482632.3724ms
2025-04-05 08:41:13.606 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:41:13.608 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 668947.5443ms
2025-04-05 08:42:08.883 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:42:08.886 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:08.887 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 3.6146ms
2025-04-05 08:42:08.891 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:42:08.894 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:08.895 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:42:08.896 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:42:08.913 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:42:08.916 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:42:08.920 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 23.2181ms
2025-04-05 08:42:08.924 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:42:08.925 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 34.002ms
2025-04-05 08:42:09.151 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - null null
2025-04-05 08:42:09.153 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:09.153 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - 204 null null 2.4138ms
2025-04-05 08:42:09.156 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - application/json null
2025-04-05 08:42:09.159 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:09.159 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:42:09.160 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:42:09.184 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:42:09.186 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:42:09.191 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 29.0211ms
2025-04-05 08:42:09.194 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:42:09.196 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - 200 null application/json; charset=utf-8 40.3576ms
2025-04-05 08:42:19.346 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:42:19.348 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:19.349 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.9162ms
2025-04-05 08:42:19.352 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:42:19.354 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:19.355 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:42:19.357 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:42:19.361 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:42:19.363 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:42:19.364 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 5.4669ms
2025-04-05 08:42:19.366 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:42:19.367 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 15.2847ms
2025-04-05 08:42:19.553 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/7 - null null
2025-04-05 08:42:19.555 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:19.555 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/7 - 204 null null 2.1924ms
2025-04-05 08:42:19.559 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/7 - application/json null
2025-04-05 08:42:19.561 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:19.562 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:42:19.563 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:42:19.566 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:42:19.568 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:42:19.569 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 4.8747ms
2025-04-05 08:42:19.570 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:42:19.571 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/7 - 200 null application/json; charset=utf-8 11.9353ms
2025-04-05 08:42:23.888 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:42:23.893 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:23.895 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:42:24.000 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:42:24.002 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:42:24.005 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:24.006 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 3.4003ms
2025-04-05 08:42:24.009 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:42:24.010 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:24.011 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:42:24.012 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:42:24.014 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:42:24.015 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.3816ms
2025-04-05 08:42:24.016 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:42:24.017 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 8.2216ms
2025-04-05 08:42:24.035 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:42:24.037 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:24.039 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 3.5194ms
2025-04-05 08:42:24.042 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:42:24.044 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:24.045 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:42:24.046 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:42:24.050 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:42:24.052 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:42:24.053 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.4241ms
2025-04-05 08:42:24.053 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:42:24.054 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 12.4333ms
2025-04-05 08:42:24.069 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:42:24.070 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:24.071 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 1.9626ms
2025-04-05 08:42:24.073 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:42:24.075 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:24.076 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:42:24.077 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:42:24.082 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:42:24.083 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:42:24.084 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.9117ms
2025-04-05 08:42:24.085 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:42:24.086 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 13.033ms
2025-04-05 08:42:25.095 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:42:25.100 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:25.101 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:42:25.204 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:42:25.209 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:42:25.212 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:25.213 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 4.2644ms
2025-04-05 08:42:25.216 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:42:25.217 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:25.218 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:42:25.219 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:42:25.221 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:42:25.223 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.8819ms
2025-04-05 08:42:25.225 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:42:25.226 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 10.0536ms
2025-04-05 08:42:25.243 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:42:25.246 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:25.246 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 3.4652ms
2025-04-05 08:42:25.248 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:42:25.252 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:25.253 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:42:25.254 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:42:25.256 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:42:25.258 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:42:25.260 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.1799ms
2025-04-05 08:42:25.261 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:42:25.262 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 14.0203ms
2025-04-05 08:42:25.277 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:42:25.279 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:25.280 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 2.9125ms
2025-04-05 08:42:25.282 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:42:25.283 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:42:25.284 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:42:25.284 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:42:25.287 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:42:25.288 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:42:25.289 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.9317ms
2025-04-05 08:42:25.291 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:42:25.293 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 11.2452ms
2025-04-05 08:42:29.271 +07:00 [INF] Handling message: ewr
2025-04-05 08:42:29.275 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 08:42:29.284 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 08:42:29.286 +07:00 [INF] Message saved to DB: 122
2025-04-05 08:42:29.287 +07:00 [INF] Transaction committed for message: 122
2025-04-05 08:42:29.288 +07:00 [INF] Message saved to Redis: {"Message":{"id":122,"content":"ewr","sender_id":6,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T01:42:29.2751399Z","conversation_id":1},"Attachment":null}
2025-04-05 08:45:51.614 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:45:51.616 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:45:51.617 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 3.1108ms
2025-04-05 08:45:51.620 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:45:51.623 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:45:51.624 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:45:51.625 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:45:51.639 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:45:51.641 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:45:51.643 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 16.8125ms
2025-04-05 08:45:51.644 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:45:51.646 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 26.0009ms
2025-04-05 08:45:51.835 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - null null
2025-04-05 08:45:51.836 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:45:51.837 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - 204 null null 2.3088ms
2025-04-05 08:45:51.839 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - application/json null
2025-04-05 08:45:51.841 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:45:51.842 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:45:51.843 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:45:51.854 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:45:51.855 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:45:51.857 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 12.8576ms
2025-04-05 08:45:51.858 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:45:51.859 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - 200 null application/json; charset=utf-8 19.595ms
2025-04-05 08:46:06.099 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:46:06.101 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:06.102 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.9181ms
2025-04-05 08:46:06.104 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:46:06.107 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:06.107 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:46:06.108 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:46:06.121 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:46:06.123 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:46:06.124 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 15.3128ms
2025-04-05 08:46:06.125 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:46:06.126 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 21.3446ms
2025-04-05 08:46:06.318 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/7 - null null
2025-04-05 08:46:06.321 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:06.321 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/7 - 204 null null 2.7999ms
2025-04-05 08:46:06.323 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/7 - application/json null
2025-04-05 08:46:06.324 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:06.325 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:46:06.327 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:46:06.341 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:46:06.342 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:46:06.343 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 14.0275ms
2025-04-05 08:46:06.344 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:46:06.346 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/7 - 200 null application/json; charset=utf-8 22.7305ms
2025-04-05 08:46:09.926 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:46:09.932 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:09.934 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:46:10.020 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:46:10.021 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:46:10.024 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:10.026 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 5.5215ms
2025-04-05 08:46:10.028 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:46:10.030 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:10.031 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:46:10.032 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:46:10.033 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:46:10.034 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 1.6462ms
2025-04-05 08:46:10.035 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:46:10.036 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 8.3248ms
2025-04-05 08:46:10.054 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:46:10.056 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:10.056 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 2.2714ms
2025-04-05 08:46:10.061 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:46:10.069 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:10.071 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:46:10.072 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:46:10.077 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:46:10.080 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:46:10.082 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.8432ms
2025-04-05 08:46:10.083 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:46:10.084 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 22.6564ms
2025-04-05 08:46:10.101 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:46:10.102 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:10.103 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 1.9279ms
2025-04-05 08:46:10.105 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:46:10.107 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:10.107 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:46:10.108 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:46:10.114 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:46:10.116 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:46:10.117 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.4889ms
2025-04-05 08:46:10.118 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:46:10.119 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 13.0629ms
2025-04-05 08:46:11.837 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:46:11.840 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:11.841 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:46:11.925 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:46:11.926 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:11.926 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 1.6959ms
2025-04-05 08:46:11.925 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:46:11.930 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:46:11.934 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:11.934 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:46:11.935 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:46:11.937 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:46:11.938 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.4653ms
2025-04-05 08:46:11.940 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:46:11.941 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 10.6893ms
2025-04-05 08:46:11.958 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:46:11.960 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:11.961 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 2.0975ms
2025-04-05 08:46:11.967 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:46:11.970 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:11.971 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:46:11.971 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:46:11.973 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:46:11.975 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:46:11.976 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 3.2667ms
2025-04-05 08:46:11.977 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:46:11.978 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 11.2382ms
2025-04-05 08:46:11.992 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:46:11.994 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:11.994 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 1.7426ms
2025-04-05 08:46:11.996 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:46:11.999 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:46:12.000 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:46:12.001 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:46:12.003 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:46:12.004 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:46:12.005 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.3379ms
2025-04-05 08:46:12.006 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:46:12.007 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 10.3499ms
2025-04-05 08:46:21.351 +07:00 [INF] Handling message: 🙃😊
2025-04-05 08:46:21.357 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 08:46:21.365 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 08:46:21.370 +07:00 [INF] Message saved to DB: 123
2025-04-05 08:46:21.373 +07:00 [INF] Transaction committed for message: 123
2025-04-05 08:46:21.374 +07:00 [INF] Message saved to Redis: {"Message":{"id":123,"content":"\uD83D\uDE43\uD83D\uDE0A","sender_id":7,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T01:46:21.3563887Z","conversation_id":1},"Attachment":null}
2025-04-05 08:48:20.067 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:48:20.067 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:48:20.070 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 130143.4254ms
2025-04-05 08:48:20.071 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 356183.0616ms
2025-04-05 08:48:26.797 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:48:26.798 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 08:48:26.799 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 134961.4752ms
2025-04-05 08:48:26.801 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 361705.4434ms
2025-04-05 08:49:10.557 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:49:10.561 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:10.562 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 4.4822ms
2025-04-05 08:49:10.564 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:49:10.567 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:10.568 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:49:10.569 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:49:10.582 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:49:10.584 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:49:10.585 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 14.0169ms
2025-04-05 08:49:10.587 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:49:10.588 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 23.3338ms
2025-04-05 08:49:10.810 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - null null
2025-04-05 08:49:10.813 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:10.813 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/6 - 204 null null 3.1676ms
2025-04-05 08:49:10.822 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - application/json null
2025-04-05 08:49:10.826 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:10.827 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:49:10.829 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:49:10.848 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:49:10.853 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:49:10.854 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 23.3179ms
2025-04-05 08:49:10.856 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:49:10.857 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/6 - 200 null application/json; charset=utf-8 35.4627ms
2025-04-05 08:49:23.518 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 08:49:23.520 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:23.521 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.5923ms
2025-04-05 08:49:23.523 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 08:49:23.524 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:23.525 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:49:23.526 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 08:49:23.539 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 08:49:23.541 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 08:49:23.542 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 15.5856ms
2025-04-05 08:49:23.543 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 08:49:23.544 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 20.7378ms
2025-04-05 08:49:23.729 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/7 - null null
2025-04-05 08:49:23.731 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:23.732 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/7 - 204 null null 2.6182ms
2025-04-05 08:49:23.734 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/7 - application/json null
2025-04-05 08:49:23.737 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:23.738 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:49:23.738 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:49:23.748 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:49:23.753 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:49:23.756 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 16.1245ms
2025-04-05 08:49:23.758 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 08:49:23.759 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/7 - 200 null application/json; charset=utf-8 25.0337ms
2025-04-05 08:49:26.689 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:49:26.692 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:26.694 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:49:26.799 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:49:26.799 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:49:26.807 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:26.807 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 8.1562ms
2025-04-05 08:49:26.811 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:49:26.813 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:26.813 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:49:26.814 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:49:26.816 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:49:26.817 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.1028ms
2025-04-05 08:49:26.821 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:49:26.822 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 10.6159ms
2025-04-05 08:49:26.840 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:49:26.843 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:26.844 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 4.3776ms
2025-04-05 08:49:26.849 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:49:26.856 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:26.857 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:49:26.858 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:49:26.864 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:49:26.866 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:49:26.867 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.6644ms
2025-04-05 08:49:26.868 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:49:26.869 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 20.621ms
2025-04-05 08:49:26.884 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:49:26.886 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:26.886 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 2.7667ms
2025-04-05 08:49:26.889 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:49:26.891 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:26.891 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:49:26.892 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:49:26.896 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:49:26.898 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:49:26.899 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.8331ms
2025-04-05 08:49:26.899 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:49:26.900 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 11.3663ms
2025-04-05 08:49:27.472 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws - null null
2025-04-05 08:49:27.475 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:27.476 +07:00 [INF] Executing endpoint '/ws'
2025-04-05 08:49:27.583 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 08:49:27.587 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - null null
2025-04-05 08:49:27.589 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:27.590 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/1 - 204 null null 3.404ms
2025-04-05 08:49:27.593 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - application/json null
2025-04-05 08:49:27.595 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:27.595 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:49:27.596 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 08:49:27.598 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 08:49:27.599 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.0744ms
2025-04-05 08:49:27.601 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 08:49:27.602 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 9.3979ms
2025-04-05 08:49:27.621 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 08:49:27.625 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:27.626 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/1 - 204 null null 4.407ms
2025-04-05 08:49:27.628 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - application/json null
2025-04-05 08:49:27.629 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:27.630 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:49:27.631 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 08:49:27.633 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 08:49:27.636 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 08:49:27.637 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.2246ms
2025-04-05 08:49:27.638 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 08:49:27.639 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 11.2807ms
2025-04-05 08:49:27.655 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - null null
2025-04-05 08:49:27.657 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:27.658 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/1 - 204 null null 3.449ms
2025-04-05 08:49:27.662 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - application/json null
2025-04-05 08:49:27.663 +07:00 [INF] CORS policy execution successful.
2025-04-05 08:49:27.664 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:49:27.665 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 08:49:27.669 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 08:49:27.671 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType7`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 08:49:27.673 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.2225ms
2025-04-05 08:49:27.674 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 08:49:27.675 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 13.5216ms
2025-04-05 08:49:31.959 +07:00 [INF] Handling message: ,
2025-04-05 08:49:31.963 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 08:49:31.969 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 08:49:31.973 +07:00 [INF] Message saved to DB: 124
2025-04-05 08:49:31.975 +07:00 [INF] Transaction committed for message: 124
2025-04-05 08:49:31.976 +07:00 [INF] Message saved to Redis: {"Message":{"id":124,"content":",","sender_id":6,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T01:49:31.9624843Z","conversation_id":1},"Attachment":null}
2025-04-05 09:30:11.836 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 09:30:11.842 +07:00 [INF] Executed endpoint '/ws'
2025-04-05 09:30:11.850 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 75
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 09:30:11.851 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 75
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 09:30:12.768 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 09:30:12.789 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 09:30:12.802 +07:00 [ERR] Connection id "0HNBJRR1H4LJM", Request id "0HNBJRR1H4LJM:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 75
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 09:30:12.820 +07:00 [ERR] Connection id "0HNBJRR1H4LJL", Request id "0HNBJRR1H4LJL:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 75
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 09:30:12.880 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 2445407.4069ms
2025-04-05 09:30:12.921 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws - 101 null null 2446231.7069ms
2025-04-05 10:01:16.003 +07:00 [INF] Application is shutting down...
2025-04-05 10:19:04.722 +07:00 [INF] Executed DbCommand (41ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-04-05 10:19:04.902 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-04-05 10:19:04.992 +07:00 [INF] Now listening on: http://localhost:5053
2025-04-05 10:19:04.997 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-04-05 10:19:04.998 +07:00 [INF] Hosting environment: Development
2025-04-05 10:19:05.016 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-04-05 10:20:01.443 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 10:20:01.499 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:20:01.514 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 74.6721ms
2025-04-05 10:20:01.523 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 10:20:01.533 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:20:01.564 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:20:01.567 +07:00 [WRN] Failed to determine the https port for redirect.
2025-04-05 10:20:01.620 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 10:20:01.666 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 10:20:01.974 +07:00 [ERR] Failed executing DbCommand (47ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 10:20:02.045 +07:00 [ERR] An exception occurred while iterating over the results of a query for context type 'server.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'bio'.
Invalid column name 'interests'.
Invalid column name 'location'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:a097d906-5a96-407b-8897-b6b3c8f19baa
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'bio'.
Invalid column name 'interests'.
Invalid column name 'location'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:a097d906-5a96-407b-8897-b6b3c8f19baa
Error Number:207,State:1,Class:16
2025-04-05 10:20:02.080 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 402.4215ms
2025-04-05 10:20:02.084 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 10:20:02.090 +07:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'bio'.
Invalid column name 'interests'.
Invalid column name 'location'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at server.Services.UserService.UserSV.FindUserAsync(String email, String password) in C:\Users\Thao\source\Flutter\Message_app\server\Services\UserService\UserSV.cs:line 144
   at server.Services.AuthService.AuthSV.VerifyUser(LoginDTO model) in C:\Users\Thao\source\Flutter\Message_app\server\Services\AuthService\AuthSV.cs:line 53
   at Message_app.Controllers.AuthController.Login(LoginDTO model) in C:\Users\Thao\source\Flutter\Message_app\server\Controllers\AuthController.cs:line 47
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
ClientConnectionId:a097d906-5a96-407b-8897-b6b3c8f19baa
Error Number:207,State:1,Class:16
2025-04-05 10:20:02.164 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 500 null text/plain; charset=utf-8 641.2089ms
2025-04-05 10:21:30.000 +07:00 [INF] Application is shutting down...
2025-04-05 10:21:48.532 +07:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-04-05 10:21:48.719 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-04-05 10:21:48.804 +07:00 [INF] Now listening on: http://localhost:5053
2025-04-05 10:21:48.806 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-04-05 10:21:48.807 +07:00 [INF] Hosting environment: Development
2025-04-05 10:21:48.807 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-04-05 10:21:48.947 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/index.html - null null
2025-04-05 10:21:49.067 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/index.html - 200 null text/html;charset=utf-8 121.674ms
2025-04-05 10:21:49.081 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/index.js - null null
2025-04-05 10:21:49.087 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/index.js - 200 null application/javascript;charset=utf-8 10.66ms
2025-04-05 10:21:49.999 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/v1/swagger.json - null null
2025-04-05 10:21:50.081 +07:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Failed to generate Operation for action - server.Controllers.MessageController.UploadFile (Message_app). See inner exception
 ---> Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Error reading parameter(s) for action server.Controllers.MessageController.UploadFile (Message_app) as [FromForm] attribute used with IFormFile. Please refer to https://github.com/domaindrivendev/Swashbuckle.AspNetCore#handle-forms-and-file-uploads for more information
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateParametersAsync(ApiDescription apiDescription, SchemaRepository schemaRespository, Func`3 parameterGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateParametersAsync(ApiDescription apiDescription, SchemaRepository schemaRespository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository, Func`3 parametersGenerator, Func`3 bodyGenerator, Func`3 applyFilters)
   --- End of inner exception stack trace ---
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository, Func`3 parametersGenerator, Func`3 bodyGenerator, Func`3 applyFilters)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository, Func`3 operationsGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 10:21:50.105 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 105.8892ms
2025-04-05 10:21:58.557 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 10:21:58.558 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:21:58.559 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.9884ms
2025-04-05 10:21:58.561 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 10:21:58.562 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:21:58.581 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:21:58.582 +07:00 [WRN] Failed to determine the https port for redirect.
2025-04-05 10:21:58.662 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 10:21:58.679 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 10:22:46.615 +07:00 [ERR] Failed executing DbCommand (29ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 10:22:46.626 +07:00 [ERR] An exception occurred while iterating over the results of a query for context type 'server.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'bio'.
Invalid column name 'interests'.
Invalid column name 'location'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:fb6a1d95-582b-45e6-b62b-643aa52516d4
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'bio'.
Invalid column name 'interests'.
Invalid column name 'location'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:fb6a1d95-582b-45e6-b62b-643aa52516d4
Error Number:207,State:1,Class:16
2025-04-05 10:22:46.702 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 48019.8926ms
2025-04-05 10:22:46.704 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 10:22:46.706 +07:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'bio'.
Invalid column name 'interests'.
Invalid column name 'location'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at server.Services.UserService.UserSV.FindUserAsync(String email, String password) in c:\Users\Thao\source\Flutter\Message_app\server\Services\UserService\UserSV.cs:line 144
   at server.Services.AuthService.AuthSV.VerifyUser(LoginDTO model) in c:\Users\Thao\source\Flutter\Message_app\server\Services\AuthService\AuthSV.cs:line 53
   at Message_app.Controllers.AuthController.Login(LoginDTO model) in c:\Users\Thao\source\Flutter\Message_app\server\Controllers\AuthController.cs:line 47
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
ClientConnectionId:fb6a1d95-582b-45e6-b62b-643aa52516d4
Error Number:207,State:1,Class:16
2025-04-05 10:22:46.732 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 500 null text/plain; charset=utf-8 48171.041ms
2025-04-05 10:23:49.510 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:23:49.567 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-04-05 10:23:49.570 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:23:49.572 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-04-05 10:23:49.595 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-04-05 10:23:49.607 +07:00 [INF] Applying migration '20250316134208_InitialCreate'.
2025-04-05 10:23:49.696 +07:00 [ERR] Failed executing DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-04-05 10:28:37.917 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:28:37.982 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-04-05 10:28:37.985 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:28:37.988 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-04-05 10:28:38.015 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-04-05 10:28:38.029 +07:00 [INF] Applying migration '20250316134208_InitialCreate'.
2025-04-05 10:28:38.094 +07:00 [ERR] Failed executing DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-04-05 10:29:11.619 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:29:11.665 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-04-05 10:29:11.669 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:29:11.672 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-04-05 10:29:11.690 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-04-05 10:29:11.701 +07:00 [INF] Applying migration '20250405032510_AddUserExtraFields'.
2025-04-05 10:29:11.728 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250405032510_AddUserExtraFields', N'8.0.4');
2025-04-05 10:33:45.103 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:33:45.160 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-04-05 10:33:45.164 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:33:45.166 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-04-05 10:33:45.192 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-04-05 10:33:45.204 +07:00 [INF] Applying migration '20250405033033_AddUserExtraFields1'.
2025-04-05 10:34:39.680 +07:00 [INF] Executed DbCommand (187ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [Message_app_db_1];
2025-04-05 10:34:39.784 +07:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [Message_app_db_1] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-04-05 10:34:39.799 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:34:39.848 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [__EFMigrationsHistory] (
    [MigrationId] nvarchar(150) NOT NULL,
    [ProductVersion] nvarchar(32) NOT NULL,
    CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
);
2025-04-05 10:34:39.851 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:34:39.861 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-04-05 10:34:39.875 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-04-05 10:34:39.888 +07:00 [INF] Applying migration '20250405033430_init'.
2025-04-05 10:34:39.946 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-04-05 10:34:39.953 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role] (
    [id] int NOT NULL IDENTITY,
    [role_name] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Role] PRIMARY KEY ([id])
);
2025-04-05 10:34:39.959 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [id] int NOT NULL IDENTITY,
    [username] nvarchar(200) NOT NULL,
    [password] nvarchar(max) NOT NULL,
    [passwordSalt] nvarchar(max) NOT NULL,
    [email] nvarchar(max) NOT NULL,
    [avatar_url] nvarchar(max) NOT NULL,
    [birthday] date NOT NULL,
    [created_at] datetime2 NOT NULL,
    [gender] bit NOT NULL,
    [interests] nvarchar(500) NOT NULL,
    [location] nvarchar(100) NOT NULL,
    [bio] nvarchar(500) NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([id])
);
2025-04-05 10:34:39.967 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [FriendRequests] (
    [Id] int NOT NULL IDENTITY,
    [SenderId] int NOT NULL,
    [ReceiverId] int NOT NULL,
    [Status] nvarchar(20) NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    CONSTRAINT [PK_FriendRequests] PRIMARY KEY ([Id]),
    CONSTRAINT [CK_FriendRequest_SenderReceiver] CHECK ([SenderId] != [ReceiverId]),
    CONSTRAINT [FK_FriendRequests_Users_ReceiverId] FOREIGN KEY ([ReceiverId]) REFERENCES [Users] ([id]) ON DELETE NO ACTION,
    CONSTRAINT [FK_FriendRequests_Users_SenderId] FOREIGN KEY ([SenderId]) REFERENCES [Users] ([id]) ON DELETE NO ACTION
);
2025-04-05 10:34:39.973 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Friends] (
    [Id] int NOT NULL IDENTITY,
    [UserId1] int NOT NULL,
    [UserId2] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    CONSTRAINT [PK_Friends] PRIMARY KEY ([Id]),
    CONSTRAINT [CK_Friends_User1User2] CHECK ([UserId1] != [UserId2]),
    CONSTRAINT [FK_Friends_Users_UserId1] FOREIGN KEY ([UserId1]) REFERENCES [Users] ([id]) ON DELETE NO ACTION,
    CONSTRAINT [FK_Friends_Users_UserId2] FOREIGN KEY ([UserId2]) REFERENCES [Users] ([id]) ON DELETE NO ACTION
);
2025-04-05 10:34:39.981 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [GroupSettings] (
    [Id] int NOT NULL IDENTITY,
    [ConversationId] int NOT NULL,
    [Privacy] bit NOT NULL,
    [AllowMemberInvite] bit NOT NULL,
    [AllowMemberEdit] bit NOT NULL,
    [CreatedBy] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [IsActive] bit NOT NULL,
    [ImageUrl] nvarchar(255) NOT NULL,
    CONSTRAINT [PK_GroupSettings] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_GroupSettings_Conversations_ConversationId] FOREIGN KEY ([ConversationId]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_GroupSettings_Users_CreatedBy] FOREIGN KEY ([CreatedBy]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-04-05 10:34:39.996 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Messages] (
    [id] int NOT NULL IDENTITY,
    [content] nvarchar(500) NOT NULL,
    [sender_id] int NOT NULL,
    [is_read] bit NOT NULL,
    [type] nvarchar(max) NULL,
    [isFile] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    [conversation_id] int NOT NULL,
    CONSTRAINT [PK_Messages] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Messages_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Messages_Users_sender_id] FOREIGN KEY ([sender_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-04-05 10:34:40.001 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [MessageStatus] (
    [id] int NOT NULL IDENTITY,
    [message_id] int NOT NULL,
    [receiver_id] int NOT NULL,
    [status] nvarchar(50) NOT NULL,
    [updated_at] datetime2 NOT NULL,
    [Userid] int NULL,
    CONSTRAINT [PK_MessageStatus] PRIMARY KEY ([id]),
    CONSTRAINT [FK_MessageStatus_Users_Userid] FOREIGN KEY ([Userid]) REFERENCES [Users] ([id])
);
2025-04-05 10:34:40.013 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Notifications] (
    [id] int NOT NULL IDENTITY,
    [related_type] nvarchar(max) NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [user_id] int NOT NULL,
    [is_seen] bit NOT NULL,
    [related_id] int NOT NULL,
    CONSTRAINT [PK_Notifications] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Notifications_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-04-05 10:34:40.020 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [OTPs] (
    [Id] int NOT NULL IDENTITY,
    [UserId] int NOT NULL,
    [OTPCode] nvarchar(6) NOT NULL,
    [ExpiryDate] datetime2 NOT NULL,
    [IsUsed] bit NOT NULL,
    CONSTRAINT [PK_OTPs] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_OTPs_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-04-05 10:34:40.025 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Participants] (
    [id] int NOT NULL IDENTITY,
    [conversation_id] int NOT NULL,
    [user_id] int NOT NULL,
    [joined_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_Participants] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Participants_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Participants_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-04-05 10:34:40.030 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role_of_User] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [role_id] int NOT NULL,
    CONSTRAINT [PK_Role_of_User] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Role_of_User_Role_role_id] FOREIGN KEY ([role_id]) REFERENCES [Role] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Role_of_User_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-04-05 10:34:40.036 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Stories] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [expires_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Stories] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Stories_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-04-05 10:34:40.042 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Attachments] (
    [id] int NOT NULL IDENTITY,
    [file_url] nvarchar(255) NOT NULL,
    [FileSize] real NOT NULL,
    [file_type] nvarchar(50) NOT NULL,
    [uploaded_at] datetime2 NOT NULL,
    [is_temporary] bit NOT NULL,
    [message_id] int NULL,
    CONSTRAINT [PK_Attachments] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Attachments_Messages_message_id] FOREIGN KEY ([message_id]) REFERENCES [Messages] ([id])
);
2025-04-05 10:34:40.071 +07:00 [ERR] Failed executing DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [StoryReactions] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [story_id] int NOT NULL,
    [reaction_type] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_StoryReactions] PRIMARY KEY ([id]),
    CONSTRAINT [FK_StoryReactions_Stories_story_id] FOREIGN KEY ([story_id]) REFERENCES [Stories] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_StoryReactions_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-04-05 10:39:09.206 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:39:09.253 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-04-05 10:39:09.256 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:39:09.258 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-04-05 10:39:09.276 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-04-05 10:39:09.288 +07:00 [INF] Applying migration '20250405033430_init'.
2025-04-05 10:39:09.359 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-04-05 10:39:09.363 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role] (
    [id] int NOT NULL IDENTITY,
    [role_name] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Role] PRIMARY KEY ([id])
);
2025-04-05 10:39:09.367 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [id] int NOT NULL IDENTITY,
    [username] nvarchar(200) NOT NULL,
    [password] nvarchar(max) NOT NULL,
    [passwordSalt] nvarchar(max) NOT NULL,
    [email] nvarchar(max) NOT NULL,
    [avatar_url] nvarchar(max) NOT NULL,
    [birthday] date NOT NULL,
    [created_at] datetime2 NOT NULL,
    [gender] bit NOT NULL,
    [interests] nvarchar(500) NOT NULL,
    [location] nvarchar(100) NOT NULL,
    [bio] nvarchar(500) NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([id])
);
2025-04-05 10:39:09.382 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [FriendRequests] (
    [Id] int NOT NULL IDENTITY,
    [SenderId] int NOT NULL,
    [ReceiverId] int NOT NULL,
    [Status] nvarchar(20) NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    CONSTRAINT [PK_FriendRequests] PRIMARY KEY ([Id]),
    CONSTRAINT [CK_FriendRequest_SenderReceiver] CHECK ([SenderId] != [ReceiverId]),
    CONSTRAINT [FK_FriendRequests_Users_ReceiverId] FOREIGN KEY ([ReceiverId]) REFERENCES [Users] ([id]),
    CONSTRAINT [FK_FriendRequests_Users_SenderId] FOREIGN KEY ([SenderId]) REFERENCES [Users] ([id])
);
2025-04-05 10:39:09.393 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Friends] (
    [Id] int NOT NULL IDENTITY,
    [UserId1] int NOT NULL,
    [UserId2] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    CONSTRAINT [PK_Friends] PRIMARY KEY ([Id]),
    CONSTRAINT [CK_Friends_User1User2] CHECK ([UserId1] != [UserId2]),
    CONSTRAINT [FK_Friends_Users_UserId1] FOREIGN KEY ([UserId1]) REFERENCES [Users] ([id]),
    CONSTRAINT [FK_Friends_Users_UserId2] FOREIGN KEY ([UserId2]) REFERENCES [Users] ([id])
);
2025-04-05 10:39:09.403 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [GroupSettings] (
    [Id] int NOT NULL IDENTITY,
    [ConversationId] int NOT NULL,
    [Privacy] bit NOT NULL,
    [AllowMemberInvite] bit NOT NULL,
    [AllowMemberEdit] bit NOT NULL,
    [CreatedBy] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [IsActive] bit NOT NULL,
    [ImageUrl] nvarchar(255) NOT NULL,
    CONSTRAINT [PK_GroupSettings] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_GroupSettings_Conversations_ConversationId] FOREIGN KEY ([ConversationId]) REFERENCES [Conversations] ([id]),
    CONSTRAINT [FK_GroupSettings_Users_CreatedBy] FOREIGN KEY ([CreatedBy]) REFERENCES [Users] ([id])
);
2025-04-05 10:39:09.413 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Messages] (
    [id] int NOT NULL IDENTITY,
    [content] nvarchar(500) NOT NULL,
    [sender_id] int NOT NULL,
    [is_read] bit NOT NULL,
    [type] nvarchar(max) NULL,
    [isFile] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    [conversation_id] int NOT NULL,
    CONSTRAINT [PK_Messages] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Messages_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]),
    CONSTRAINT [FK_Messages_Users_sender_id] FOREIGN KEY ([sender_id]) REFERENCES [Users] ([id])
);
2025-04-05 10:39:09.419 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [MessageStatus] (
    [id] int NOT NULL IDENTITY,
    [message_id] int NOT NULL,
    [receiver_id] int NOT NULL,
    [status] nvarchar(50) NOT NULL,
    [updated_at] datetime2 NOT NULL,
    [Userid] int NULL,
    CONSTRAINT [PK_MessageStatus] PRIMARY KEY ([id]),
    CONSTRAINT [FK_MessageStatus_Users_Userid] FOREIGN KEY ([Userid]) REFERENCES [Users] ([id])
);
2025-04-05 10:39:09.424 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Notifications] (
    [id] int NOT NULL IDENTITY,
    [related_type] nvarchar(max) NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [user_id] int NOT NULL,
    [is_seen] bit NOT NULL,
    [related_id] int NOT NULL,
    CONSTRAINT [PK_Notifications] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Notifications_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id])
);
2025-04-05 10:39:09.430 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [OTPs] (
    [Id] int NOT NULL IDENTITY,
    [UserId] int NOT NULL,
    [OTPCode] nvarchar(6) NOT NULL,
    [ExpiryDate] datetime2 NOT NULL,
    [IsUsed] bit NOT NULL,
    CONSTRAINT [PK_OTPs] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_OTPs_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([id])
);
2025-04-05 10:39:09.436 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Participants] (
    [id] int NOT NULL IDENTITY,
    [conversation_id] int NOT NULL,
    [user_id] int NOT NULL,
    [joined_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_Participants] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Participants_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]),
    CONSTRAINT [FK_Participants_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id])
);
2025-04-05 10:39:09.442 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role_of_User] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [role_id] int NOT NULL,
    CONSTRAINT [PK_Role_of_User] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Role_of_User_Role_role_id] FOREIGN KEY ([role_id]) REFERENCES [Role] ([id]),
    CONSTRAINT [FK_Role_of_User_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id])
);
2025-04-05 10:39:09.446 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Stories] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [expires_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Stories] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Stories_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id])
);
2025-04-05 10:39:09.451 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Attachments] (
    [id] int NOT NULL IDENTITY,
    [file_url] nvarchar(255) NOT NULL,
    [FileSize] real NOT NULL,
    [file_type] nvarchar(50) NOT NULL,
    [uploaded_at] datetime2 NOT NULL,
    [is_temporary] bit NOT NULL,
    [message_id] int NULL,
    CONSTRAINT [PK_Attachments] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Attachments_Messages_message_id] FOREIGN KEY ([message_id]) REFERENCES [Messages] ([id])
);
2025-04-05 10:39:09.456 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [StoryReactions] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [story_id] int NOT NULL,
    [reaction_type] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_StoryReactions] PRIMARY KEY ([id]),
    CONSTRAINT [FK_StoryReactions_Stories_story_id] FOREIGN KEY ([story_id]) REFERENCES [Stories] ([id]),
    CONSTRAINT [FK_StoryReactions_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id])
);
2025-04-05 10:39:09.464 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [StoryViewers] (
    [id] int NOT NULL IDENTITY,
    [story_id] int NOT NULL,
    [user_id] int NOT NULL,
    [viewed_at] datetime2 NOT NULL,
    CONSTRAINT [PK_StoryViewers] PRIMARY KEY ([id]),
    CONSTRAINT [FK_StoryViewers_Stories_story_id] FOREIGN KEY ([story_id]) REFERENCES [Stories] ([id]),
    CONSTRAINT [FK_StoryViewers_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id])
);
2025-04-05 10:39:09.470 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Attachments_message_id] ON [Attachments] ([message_id]);
2025-04-05 10:39:09.474 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_FriendRequests_ReceiverId] ON [FriendRequests] ([ReceiverId]);
2025-04-05 10:39:09.478 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_FriendRequests_SenderId] ON [FriendRequests] ([SenderId]);
2025-04-05 10:39:09.481 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX [IX_Friends_UserId1_UserId2] ON [Friends] ([UserId1], [UserId2]);
2025-04-05 10:39:09.484 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Friends_UserId2] ON [Friends] ([UserId2]);
2025-04-05 10:39:09.488 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_GroupSettings_ConversationId] ON [GroupSettings] ([ConversationId]);
2025-04-05 10:39:09.491 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_GroupSettings_CreatedBy] ON [GroupSettings] ([CreatedBy]);
2025-04-05 10:39:09.496 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Messages_conversation_id] ON [Messages] ([conversation_id]);
2025-04-05 10:39:09.499 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Messages_sender_id] ON [Messages] ([sender_id]);
2025-04-05 10:39:09.503 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_MessageStatus_Userid] ON [MessageStatus] ([Userid]);
2025-04-05 10:39:09.506 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Notifications_user_id] ON [Notifications] ([user_id]);
2025-04-05 10:39:09.510 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_OTPs_UserId] ON [OTPs] ([UserId]);
2025-04-05 10:39:09.514 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Participants_conversation_id] ON [Participants] ([conversation_id]);
2025-04-05 10:39:09.517 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Participants_user_id] ON [Participants] ([user_id]);
2025-04-05 10:39:09.519 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Role_of_User_role_id] ON [Role_of_User] ([role_id]);
2025-04-05 10:39:09.520 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Role_of_User_user_id] ON [Role_of_User] ([user_id]);
2025-04-05 10:39:09.523 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Stories_user_id] ON [Stories] ([user_id]);
2025-04-05 10:39:09.526 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_StoryReactions_story_id] ON [StoryReactions] ([story_id]);
2025-04-05 10:39:09.529 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_StoryReactions_user_id] ON [StoryReactions] ([user_id]);
2025-04-05 10:39:09.532 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_StoryViewers_story_id] ON [StoryViewers] ([story_id]);
2025-04-05 10:39:09.534 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_StoryViewers_user_id] ON [StoryViewers] ([user_id]);
2025-04-05 10:39:09.580 +07:00 [INF] Executed DbCommand (38ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250405033430_init', N'8.0.4');
2025-04-05 10:40:31.612 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-04-05 10:40:31.733 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-04-05 10:40:31.773 +07:00 [INF] Now listening on: http://localhost:5053
2025-04-05 10:40:31.777 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-04-05 10:40:31.779 +07:00 [INF] Hosting environment: Development
2025-04-05 10:40:31.780 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-04-05 10:40:38.181 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 10:40:38.205 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:40:38.213 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 32.6932ms
2025-04-05 10:40:38.222 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 10:40:38.228 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:40:38.245 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:40:38.247 +07:00 [WRN] Failed to determine the https port for redirect.
2025-04-05 10:40:38.266 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 10:40:38.286 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 10:40:38.415 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 10:40:38.428 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-04-05 10:40:38.443 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 151.4277ms
2025-04-05 10:40:38.448 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 10:40:38.454 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 400 null application/json; charset=utf-8 232.3285ms
2025-04-05 10:40:40.808 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 10:40:40.815 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:40:40.821 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:40:40.825 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 10:40:40.832 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 10:40:40.906 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 10:40:40.910 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-04-05 10:40:40.912 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 75.1094ms
2025-04-05 10:40:40.913 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 10:40:40.914 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 400 null application/json; charset=utf-8 105.6744ms
2025-04-05 10:41:43.228 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/register - null null
2025-04-05 10:41:43.234 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:41:43.238 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/register - 204 null null 9.8749ms
2025-04-05 10:41:43.243 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/register - application/json 164
2025-04-05 10:41:43.250 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:41:43.251 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:41:43.255 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Register (Message_app)'
2025-04-05 10:41:43.260 +07:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(server.DTO.UserDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 10:41:43.460 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 500), @p2='?' (DbType = Date), @p3='?' (DbType = DateTime2), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 500), @p7='?' (Size = 100), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 200)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([avatar_url], [bio], [birthday], [created_at], [email], [gender], [interests], [location], [password], [passwordSalt], [username])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-04-05 10:41:43.484 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'server.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'bio', table 'Message_app_db_1.dbo.Users'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:929c42af-0bab-4e56-8756-72b471bac464
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'bio', table 'Message_app_db_1.dbo.Users'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:929c42af-0bab-4e56-8756-72b471bac464
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-04-05 10:41:43.506 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Register (Message_app) in 239.1335ms
2025-04-05 10:41:43.510 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Register (Message_app)'
2025-04-05 10:41:43.513 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Exception: An error occurred while saving the entity changes. See the inner exception for details.
   at server.Services.UserService.UserSV.AddUserAsync(UserDTO model) in C:\Users\Thao\source\Flutter\Message_app\server\Services\UserService\UserSV.cs:line 80
   at Message_app.Controllers.AuthController.Register(UserDTO model) in C:\Users\Thao\source\Flutter\Message_app\server\Controllers\AuthController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 10:41:43.547 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/register - 500 null text/plain; charset=utf-8 304.4487ms
2025-04-05 10:43:28.849 +07:00 [INF] Application is shutting down...
2025-04-05 10:43:48.724 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:43:48.772 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-04-05 10:43:48.778 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-04-05 10:43:48.783 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-04-05 10:43:48.805 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-04-05 10:43:48.818 +07:00 [INF] Applying migration '20250405034341_updateUserTable'.
2025-04-05 10:43:49.035 +07:00 [INF] Executed DbCommand (174ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var0 sysname;
SELECT @var0 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Users]') AND [c].[name] = N'location');
IF @var0 IS NOT NULL EXEC(N'ALTER TABLE [Users] DROP CONSTRAINT [' + @var0 + '];');
ALTER TABLE [Users] ALTER COLUMN [location] nvarchar(100) NULL;
2025-04-05 10:43:49.065 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var1 sysname;
SELECT @var1 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Users]') AND [c].[name] = N'interests');
IF @var1 IS NOT NULL EXEC(N'ALTER TABLE [Users] DROP CONSTRAINT [' + @var1 + '];');
ALTER TABLE [Users] ALTER COLUMN [interests] nvarchar(500) NULL;
2025-04-05 10:43:49.094 +07:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var2 sysname;
SELECT @var2 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Users]') AND [c].[name] = N'bio');
IF @var2 IS NOT NULL EXEC(N'ALTER TABLE [Users] DROP CONSTRAINT [' + @var2 + '];');
ALTER TABLE [Users] ALTER COLUMN [bio] nvarchar(500) NULL;
2025-04-05 10:43:49.102 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250405034341_updateUserTable', N'8.0.4');
2025-04-05 10:43:54.909 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-04-05 10:43:55.016 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-04-05 10:43:55.056 +07:00 [INF] Now listening on: http://localhost:5053
2025-04-05 10:43:55.059 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-04-05 10:43:55.060 +07:00 [INF] Hosting environment: Development
2025-04-05 10:43:55.061 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-04-05 10:43:57.200 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/register - null null
2025-04-05 10:43:57.201 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/register - null null
2025-04-05 10:43:57.222 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:43:57.222 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:43:57.228 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/register - 204 null null 29.3732ms
2025-04-05 10:43:57.228 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/register - 204 null null 29.3662ms
2025-04-05 10:43:57.237 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/register - application/json 164
2025-04-05 10:43:57.239 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/register - application/json 164
2025-04-05 10:43:57.242 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:43:57.243 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:43:57.256 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:43:57.256 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:43:57.258 +07:00 [WRN] Failed to determine the https port for redirect.
2025-04-05 10:43:57.277 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Register (Message_app)'
2025-04-05 10:43:57.277 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Register (Message_app)'
2025-04-05 10:43:57.296 +07:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(server.DTO.UserDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 10:43:57.296 +07:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(server.DTO.UserDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 10:43:57.574 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 500), @p2='?' (DbType = Date), @p3='?' (DbType = DateTime2), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 500), @p7='?' (Size = 100), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 200)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([avatar_url], [bio], [birthday], [created_at], [email], [gender], [interests], [location], [password], [passwordSalt], [username])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-04-05 10:43:57.574 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 500), @p2='?' (DbType = Date), @p3='?' (DbType = DateTime2), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 500), @p7='?' (Size = 100), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 200)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([avatar_url], [bio], [birthday], [created_at], [email], [gender], [interests], [location], [password], [passwordSalt], [username])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-04-05 10:43:57.605 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.User'.
2025-04-05 10:43:57.605 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.User'.
2025-04-05 10:43:57.650 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Register (Message_app) in 346.2572ms
2025-04-05 10:43:57.650 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Register (Message_app) in 348.3775ms
2025-04-05 10:43:57.655 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Register (Message_app)'
2025-04-05 10:43:57.656 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Register (Message_app)'
2025-04-05 10:43:57.660 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/register - 200 null application/json; charset=utf-8 421.1726ms
2025-04-05 10:43:57.660 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/register - 200 null application/json; charset=utf-8 422.8751ms
2025-04-05 10:44:09.294 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 10:44:09.302 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:09.303 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 9.1134ms
2025-04-05 10:44:09.308 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 10:44:09.310 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:09.313 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:09.320 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 10:44:09.327 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 10:44:09.469 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 10:44:09.495 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 10:44:09.499 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 168.6358ms
2025-04-05 10:44:09.502 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 10:44:09.505 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 197.411ms
2025-04-05 10:44:09.679 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-04-05 10:44:09.686 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:09.689 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/2 - 204 null null 9.9861ms
2025-04-05 10:44:09.701 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - null null
2025-04-05 10:44:09.710 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:09.712 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:09.719 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 10:44:09.726 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 10:44:09.800 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 10:44:09.804 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 10:44:09.807 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 77.2626ms
2025-04-05 10:44:09.808 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 10:44:09.809 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 107.6673ms
2025-04-05 10:44:15.699 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - null null
2025-04-05 10:44:15.703 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:15.704 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:15.705 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:44:15.722 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 10:44:15.754 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 10:44:15.758 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 10:44:15.768 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 42.9276ms
2025-04-05 10:44:15.769 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:44:15.771 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 72.3693ms
2025-04-05 10:44:19.494 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - null null
2025-04-05 10:44:19.504 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:19.509 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:19.511 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:44:19.517 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 10:44:19.527 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 10:44:19.535 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 10:44:19.539 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 18.5106ms
2025-04-05 10:44:19.541 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:44:19.543 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 49.5528ms
2025-04-05 10:44:40.732 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - null null
2025-04-05 10:44:40.735 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:40.736 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:40.737 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:44:40.738 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 10:44:40.761 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 10:44:40.767 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 10:44:40.772 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 32.8746ms
2025-04-05 10:44:40.774 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:44:40.776 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 43.1203ms
2025-04-05 10:44:44.834 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - null null
2025-04-05 10:44:44.836 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:44.837 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:44:44.838 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:44:44.839 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 10:44:44.852 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 10:44:44.855 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 10:44:44.857 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 15.3875ms
2025-04-05 10:44:44.859 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:44:44.860 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 26.7281ms
2025-04-05 10:45:18.817 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - null null
2025-04-05 10:45:18.820 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:45:18.821 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:45:18.821 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:45:18.821 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 10:45:18.839 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 10:45:18.846 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 10:45:18.847 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 19.892ms
2025-04-05 10:45:18.848 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:45:18.848 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 31.8206ms
2025-04-05 10:46:19.654 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - null null
2025-04-05 10:46:19.659 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:46:19.660 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:46:19.661 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:46:19.662 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 10:46:19.681 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 10:46:19.688 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 10:46:19.691 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 27.9244ms
2025-04-05 10:46:19.694 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:46:19.695 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 41.234ms
2025-04-05 10:46:50.668 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/friends/search?username=thanhdat&senderId=2 - null null
2025-04-05 10:46:50.673 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:46:50.675 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/friends/search?username=thanhdat&senderId=2 - 204 null null 7.0463ms
2025-04-05 10:46:50.682 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/search?username=thanhdat&senderId=2 - null null
2025-04-05 10:46:50.684 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:46:50.685 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:46:50.688 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.SearchUsers (Message_app)'
2025-04-05 10:46:50.694 +07:00 [INF] Route matched with {action = "SearchUsers", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SearchUsers(System.String, Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 10:46:50.718 +07:00 [WRN] The query uses a row limiting operator ('Skip'/'Take') without an 'OrderBy' operator. This may lead to unpredictable results. If the 'Distinct' operator is used after 'OrderBy', then make sure to use the 'OrderBy' operator after 'Distinct' as the ordering would otherwise get erased.
2025-04-05 10:46:50.747 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__p_2='?' (DbType = Int32), @__usernameQuery_0_contains='?' (Size = 200), @__currentUserId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_2) [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[username] LIKE @__usernameQuery_0_contains ESCAPE N'\' AND [u].[id] <> @__currentUserId_1
2025-04-05 10:46:50.751 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 10:46:50.756 +07:00 [INF] Executed action server.Controllers.FriendsController.SearchUsers (Message_app) in 60.6188ms
2025-04-05 10:46:50.757 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.SearchUsers (Message_app)'
2025-04-05 10:46:50.758 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/search?username=thanhdat&senderId=2 - 200 null application/json; charset=utf-8 76.3732ms
2025-04-05 10:47:17.652 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - null null
2025-04-05 10:47:17.659 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:47:17.660 +07:00 [INF] CORS policy execution successful.
2025-04-05 10:47:17.661 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:47:17.667 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 10:47:17.709 +07:00 [INF] Executed DbCommand (35ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 10:47:17.717 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 10:47:17.718 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 46.5224ms
2025-04-05 10:47:17.719 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 10:47:17.720 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 68.8978ms
2025-04-05 14:40:21.034 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/register - null null
2025-04-05 14:40:21.038 +07:00 [INF] CORS policy execution successful.
2025-04-05 14:40:21.039 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/register - 204 null null 5.0167ms
2025-04-05 14:40:21.042 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/register - application/json 165
2025-04-05 14:40:21.045 +07:00 [INF] CORS policy execution successful.
2025-04-05 14:40:21.046 +07:00 [INF] CORS policy execution successful.
2025-04-05 14:40:21.046 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Register (Message_app)'
2025-04-05 14:40:21.050 +07:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(server.DTO.UserDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 14:40:21.185 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 500), @p2='?' (DbType = Date), @p3='?' (DbType = DateTime2), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 500), @p7='?' (Size = 100), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 200)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([avatar_url], [bio], [birthday], [created_at], [email], [gender], [interests], [location], [password], [passwordSalt], [username])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-04-05 14:40:21.189 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.User'.
2025-04-05 14:40:21.190 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Register (Message_app) in 136.8731ms
2025-04-05 14:40:21.191 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Register (Message_app)'
2025-04-05 14:40:21.192 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/register - 200 null application/json; charset=utf-8 150.0581ms
2025-04-05 14:40:40.246 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-04-05 14:40:40.249 +07:00 [INF] CORS policy execution successful.
2025-04-05 14:40:40.251 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 5.7252ms
2025-04-05 14:40:40.257 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-04-05 14:40:40.261 +07:00 [INF] CORS policy execution successful.
2025-04-05 14:40:40.262 +07:00 [INF] CORS policy execution successful.
2025-04-05 14:40:40.270 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 14:40:40.274 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 14:40:40.285 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 14:40:40.293 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 14:40:40.296 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 20.6186ms
2025-04-05 14:40:40.300 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 14:40:40.301 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 43.7475ms
2025-04-05 14:40:40.469 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/4 - null null
2025-04-05 14:40:40.474 +07:00 [INF] CORS policy execution successful.
2025-04-05 14:40:40.475 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/4 - 204 null null 5.4394ms
2025-04-05 14:40:40.478 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/4 - null null
2025-04-05 14:40:40.479 +07:00 [INF] CORS policy execution successful.
2025-04-05 14:40:40.480 +07:00 [INF] CORS policy execution successful.
2025-04-05 14:40:40.481 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 14:40:40.486 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 14:40:40.508 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 14:40:40.510 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 14:40:40.513 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 26.0703ms
2025-04-05 14:40:40.514 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 14:40:40.517 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/4 - 200 null application/json; charset=utf-8 39.5699ms
2025-04-05 14:40:42.786 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/4 - null null
2025-04-05 14:40:42.791 +07:00 [INF] CORS policy execution successful.
2025-04-05 14:40:42.792 +07:00 [INF] CORS policy execution successful.
2025-04-05 14:40:42.792 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 14:40:42.793 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 14:40:42.810 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 14:40:42.813 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 14:40:42.817 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 22.3373ms
2025-04-05 14:40:42.819 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 14:40:42.822 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/requests/received/4 - 200 null application/json; charset=utf-8 35.7332ms
2025-04-05 16:06:53.470 +07:00 [INF] Application is shutting down...
2025-04-05 16:07:00.457 +07:00 [INF] Executed DbCommand (57ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-04-05 16:07:00.601 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-04-05 16:07:00.689 +07:00 [INF] Now listening on: http://localhost:5053
2025-04-05 16:07:00.691 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-04-05 16:07:00.692 +07:00 [INF] Hosting environment: Development
2025-04-05 16:07:00.693 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-04-05 16:07:03.133 +07:00 [INF] Application is shutting down...
2025-04-05 16:07:22.675 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-04-05 16:07:22.816 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-04-05 16:07:22.850 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-04-05 16:07:22.858 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-04-05 16:07:22.859 +07:00 [INF] Hosting environment: Development
2025-04-05 16:07:22.860 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-04-05 16:07:25.068 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 57
2025-04-05 16:07:25.097 +07:00 [WRN] Failed to determine the https port for redirect.
2025-04-05 16:07:25.120 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:07:25.141 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 16:07:25.295 +07:00 [INF] Executed DbCommand (36ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 16:07:25.372 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 16:07:25.411 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 265.3378ms
2025-04-05 16:07:25.413 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:07:25.417 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 350.9797ms
2025-04-05 16:07:25.986 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-04-05 16:07:25.995 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:07:26.001 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:07:26.102 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:07:26.104 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:07:26.106 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 103.2182ms
2025-04-05 16:07:26.107 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:07:26.108 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 122.2021ms
2025-04-05 16:08:44.963 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - null null
2025-04-05 16:08:44.981 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:08:44.993 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 16:08:45.084 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 16:08:45.092 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:08:45.130 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 130.3893ms
2025-04-05 16:08:45.135 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:08:45.143 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 178.5728ms
2025-04-05 16:09:09.418 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - null null
2025-04-05 16:09:09.431 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:09:09.435 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 16:09:09.471 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 16:09:09.484 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:09:09.491 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 49.0934ms
2025-04-05 16:09:09.497 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:09:09.501 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 83.211ms
2025-04-05 16:09:10.465 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - null null
2025-04-05 16:09:10.469 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:09:10.470 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 16:09:10.474 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 16:09:10.476 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:09:10.477 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 5.1207ms
2025-04-05 16:09:10.478 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:09:10.478 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 13.0449ms
2025-04-05 16:09:11.224 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - null null
2025-04-05 16:09:11.230 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:09:11.231 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 16:09:11.244 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 16:09:11.252 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:09:11.259 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 22.8547ms
2025-04-05 16:09:11.263 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:09:11.267 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 42.4607ms
2025-04-05 16:09:11.507 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - null null
2025-04-05 16:09:11.520 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:09:11.526 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 16:09:11.535 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 16:09:11.541 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:09:11.544 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 12.7415ms
2025-04-05 16:09:11.549 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:09:11.553 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 45.8184ms
2025-04-05 16:10:25.414 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/register - application/json 167
2025-04-05 16:10:25.424 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Register (Message_app)'
2025-04-05 16:10:25.438 +07:00 [INF] Route matched with {action = "Register", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(server.DTO.UserDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 16:10:25.665 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 500), @p2='?' (DbType = Date), @p3='?' (DbType = DateTime2), @p4='?' (Size = 4000), @p5='?' (DbType = Boolean), @p6='?' (Size = 500), @p7='?' (Size = 100), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 200)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([avatar_url], [bio], [birthday], [created_at], [email], [gender], [interests], [location], [password], [passwordSalt], [username])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-04-05 16:10:25.717 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.User'.
2025-04-05 16:10:25.721 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Register (Message_app) in 271.8422ms
2025-04-05 16:10:25.725 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Register (Message_app)'
2025-04-05 16:10:25.727 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/register - 200 null application/json; charset=utf-8 312.7931ms
2025-04-05 16:17:22.502 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 57
2025-04-05 16:17:22.510 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:17:22.516 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 16:17:22.564 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 16:17:22.576 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 16:17:22.581 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 52.1149ms
2025-04-05 16:17:22.588 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:17:22.592 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 90.182ms
2025-04-05 16:17:23.060 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-04-05 16:17:23.069 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:17:23.076 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:17:23.103 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:17:23.118 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:17:23.127 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 44.5666ms
2025-04-05 16:17:23.130 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:17:23.133 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 73.1043ms
2025-04-05 16:17:51.607 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - null null
2025-04-05 16:17:51.623 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:17:51.626 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 16:17:51.648 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 16:17:51.657 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:17:51.661 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 27.4124ms
2025-04-05 16:17:51.666 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:17:51.669 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/2 - 200 null application/json; charset=utf-8 62.3569ms
2025-04-05 16:18:10.023 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 57
2025-04-05 16:18:10.030 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:18:10.036 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 16:18:10.048 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 16:18:10.055 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 16:18:10.057 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 15.3116ms
2025-04-05 16:18:10.087 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:18:10.091 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 68.6402ms
2025-04-05 16:18:10.302 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-04-05 16:18:10.306 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:18:10.309 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:18:10.329 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:18:10.390 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:18:10.395 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 80.3454ms
2025-04-05 16:18:10.406 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:18:10.414 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 112.5476ms
2025-04-05 16:18:12.525 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:18:12.531 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:18:12.575 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:18:12.575 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:18:12.586 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:18:12.593 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:18:12.603 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:18:12.678 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:18:12.685 +07:00 [ERR] Connection id "0HNBK4542BGUT", Request id "0HNBK4542BGUT:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:18:12.709 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 183.2664ms
2025-04-05 16:18:12.749 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:18:12.773 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 92.3243ms
2025-04-05 16:18:12.779 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:18:12.781 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 206.1618ms
2025-04-05 16:18:12.833 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:18:12.840 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:18:12.848 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:18:12.888 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:18:12.893 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:18:12.895 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 39.6966ms
2025-04-05 16:18:12.898 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:18:12.900 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 66.4023ms
2025-04-05 16:18:12.929 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:18:12.934 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:18:12.945 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:18:12.968 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:18:12.992 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:18:13.006 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 56.7234ms
2025-04-05 16:18:13.009 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:18:13.014 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 85.0866ms
2025-04-05 16:18:17.756 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:18:17.763 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:18:17.771 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:18:17.775 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:18:17.802 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:18:17.806 +07:00 [ERR] Connection id "0HNBK4542BGV1", Request id "0HNBK4542BGV1:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:18:17.829 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 72.2938ms
2025-04-05 16:18:22.863 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:18:22.870 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:18:22.877 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:18:22.881 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:18:22.900 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:18:22.907 +07:00 [ERR] Connection id "0HNBK4542BGV2", Request id "0HNBK4542BGV2:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:18:22.918 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 55.2709ms
2025-04-05 16:18:27.956 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:18:27.962 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:18:27.973 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:18:27.978 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:18:28.000 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:18:28.007 +07:00 [ERR] Connection id "0HNBK4542BGV3", Request id "0HNBK4542BGV3:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:18:28.034 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 77.278ms
2025-04-05 16:18:33.060 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:18:33.066 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:18:33.070 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:18:33.074 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:18:33.105 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:18:33.120 +07:00 [ERR] Connection id "0HNBK4542BGV4", Request id "0HNBK4542BGV4:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:18:33.141 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 81.2093ms
2025-04-05 16:18:38.183 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:18:38.191 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:18:38.196 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:18:38.208 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:18:38.228 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:18:38.230 +07:00 [ERR] Connection id "0HNBK4542BGV5", Request id "0HNBK4542BGV5:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:18:38.240 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 56.3364ms
2025-04-05 16:18:43.268 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:18:43.273 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:18:43.275 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:18:43.277 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:18:43.281 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:18:43.282 +07:00 [ERR] Connection id "0HNBK4542BGV6", Request id "0HNBK4542BGV6:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:18:43.285 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 17.7211ms
2025-04-05 16:18:48.342 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:18:48.346 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:18:48.347 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:18:48.349 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:18:48.356 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:18:48.358 +07:00 [ERR] Connection id "0HNBK4542BGV7", Request id "0HNBK4542BGV7:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:18:48.360 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 18.4999ms
2025-04-05 16:19:17.806 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 57
2025-04-05 16:19:17.810 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:19:17.811 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 16:19:17.826 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 16:19:17.830 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 16:19:17.831 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 15.3795ms
2025-04-05 16:19:17.831 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:19:17.833 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 26.288ms
2025-04-05 16:19:18.397 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/4 - null null
2025-04-05 16:19:18.399 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:19:18.400 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:19:18.407 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:19:18.410 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:19:18.411 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 10.0995ms
2025-04-05 16:19:18.412 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:19:18.414 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/4 - 200 null application/json; charset=utf-8 16.548ms
2025-04-05 16:19:21.128 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:19:21.131 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:19:21.133 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:19:21.135 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:19:21.136 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:19:21.136 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:19:21.138 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:19:21.144 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:19:21.146 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:19:21.147 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 5.7486ms
2025-04-05 16:19:21.147 +07:00 [ERR] Connection id "0HNBK4542BGVA", Request id "0HNBK4542BGVA:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:19:21.147 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:19:21.151 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 22.8454ms
2025-04-05 16:19:21.151 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 19.6707ms
2025-04-05 16:19:21.351 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:19:21.353 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:19:21.353 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:19:21.358 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:19:21.359 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:19:21.360 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.5935ms
2025-04-05 16:19:21.362 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:19:21.363 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 11.9593ms
2025-04-05 16:19:21.390 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:19:21.392 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:19:21.393 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:19:21.397 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:19:21.399 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:19:21.400 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.9617ms
2025-04-05 16:19:21.401 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:19:21.402 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 11.3644ms
2025-04-05 16:19:26.285 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:19:26.289 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:19:26.290 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:19:26.290 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:19:26.294 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:19:26.294 +07:00 [ERR] Connection id "0HNBK4542BGVE", Request id "0HNBK4542BGVE:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:19:26.297 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 12.21ms
2025-04-05 16:19:31.322 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:19:31.323 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:19:31.324 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:19:31.325 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:19:31.328 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:19:31.329 +07:00 [ERR] Connection id "0HNBK4542BGVF", Request id "0HNBK4542BGVF:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:19:31.334 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 12.8966ms
2025-04-05 16:19:36.358 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:19:36.361 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:19:36.362 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:19:36.363 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:19:36.367 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:19:36.368 +07:00 [ERR] Connection id "0HNBK4542BGVG", Request id "0HNBK4542BGVG:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:19:36.372 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 13.6303ms
2025-04-05 16:19:41.394 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:19:41.398 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:19:41.399 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:19:41.401 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:19:41.407 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:19:41.409 +07:00 [ERR] Connection id "0HNBK4542BGVH", Request id "0HNBK4542BGVH:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:19:41.422 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 27.9544ms
2025-04-05 16:19:46.453 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:19:46.457 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:19:46.458 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:19:46.459 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:19:46.464 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:19:46.465 +07:00 [ERR] Connection id "0HNBK4542BGVI", Request id "0HNBK4542BGVI:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:19:46.469 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 16.3056ms
2025-04-05 16:19:51.496 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:19:51.502 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:19:51.506 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:19:51.510 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:19:51.525 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:19:51.528 +07:00 [ERR] Connection id "0HNBK4542BGVJ", Request id "0HNBK4542BGVJ:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:19:51.532 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 36.0588ms
2025-04-05 16:19:56.579 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:19:56.605 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:19:56.608 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:19:56.619 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:19:56.648 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:19:56.650 +07:00 [ERR] Connection id "0HNBK4542BGVK", Request id "0HNBK4542BGVK:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:19:56.667 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 88.0381ms
2025-04-05 16:20:01.698 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:20:01.705 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:20:01.707 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:20:01.711 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:20:01.752 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:20:01.768 +07:00 [ERR] Connection id "0HNBK4542BGVL", Request id "0HNBK4542BGVL:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:20:01.801 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 102.9933ms
2025-04-05 16:20:06.886 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:20:06.894 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:20:06.899 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:20:06.912 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:20:06.929 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:20:06.936 +07:00 [ERR] Connection id "0HNBK4542BGVM", Request id "0HNBK4542BGVM:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:20:06.953 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 67.5889ms
2025-04-05 16:20:11.990 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:20:12.006 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:20:12.017 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:20:12.045 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:20:12.077 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:20:12.079 +07:00 [ERR] Connection id "0HNBK4542BGVN", Request id "0HNBK4542BGVN:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:20:12.089 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 98.9799ms
2025-04-05 16:20:18.158 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:20:18.162 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:20:18.165 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:20:18.176 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:20:18.186 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:20:18.189 +07:00 [ERR] Connection id "0HNBK4542BGVO", Request id "0HNBK4542BGVO:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:20:18.205 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 46.3702ms
2025-04-05 16:20:23.241 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:20:23.246 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:20:23.256 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:20:23.260 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:20:23.279 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:20:23.281 +07:00 [ERR] Connection id "0HNBK4542BGVP", Request id "0HNBK4542BGVP:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:20:23.300 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 59.0227ms
2025-04-05 16:20:28.333 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:20:28.336 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:20:28.338 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:20:28.359 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:20:28.373 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:20:28.375 +07:00 [ERR] Connection id "0HNBK4542BGVQ", Request id "0HNBK4542BGVQ:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:20:28.397 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 64.4248ms
2025-04-05 16:20:33.429 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:20:33.436 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:20:33.438 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:20:33.444 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:20:33.461 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:20:33.463 +07:00 [ERR] Connection id "0HNBK4542BGVR", Request id "0HNBK4542BGVR:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:20:33.467 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 37.607ms
2025-04-05 16:20:38.504 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:20:38.507 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:20:38.507 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:20:38.508 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:20:38.511 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:20:38.511 +07:00 [ERR] Connection id "0HNBK4542BGVS", Request id "0HNBK4542BGVS:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:20:38.526 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 21.7769ms
2025-04-05 16:20:43.557 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:20:43.560 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:20:43.561 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:20:43.562 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:20:43.566 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:20:43.567 +07:00 [ERR] Connection id "0HNBK4542BGVT", Request id "0HNBK4542BGVT:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:20:43.570 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 13.1075ms
2025-04-05 16:20:48.600 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:20:48.618 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:20:48.622 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:20:48.626 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:20:48.644 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:20:48.648 +07:00 [ERR] Connection id "0HNBK4542BGVU", Request id "0HNBK4542BGVU:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:20:48.756 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 156.7018ms
2025-04-05 16:20:53.821 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:20:53.827 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:20:53.836 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:20:53.846 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:20:53.863 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:20:53.867 +07:00 [ERR] Connection id "0HNBK4542BGVV", Request id "0HNBK4542BGVV:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:20:53.882 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 60.3361ms
2025-04-05 16:20:58.914 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:20:58.917 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:20:58.918 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:20:58.925 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:20:58.941 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:20:58.943 +07:00 [ERR] Connection id "0HNBK4542BH00", Request id "0HNBK4542BH00:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:20:58.968 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 53.8112ms
2025-04-05 16:21:04.037 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:21:04.044 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:21:04.048 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:21:04.055 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:21:04.072 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:21:04.073 +07:00 [ERR] Connection id "0HNBK4542BH01", Request id "0HNBK4542BH01:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:21:04.086 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 49.2971ms
2025-04-05 16:21:09.149 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:21:09.156 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:21:09.161 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:21:09.171 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:21:09.202 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:21:09.205 +07:00 [ERR] Connection id "0HNBK4542BH02", Request id "0HNBK4542BH02:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:21:09.222 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 72.8745ms
2025-04-05 16:21:14.260 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:21:14.282 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:21:14.286 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:21:14.296 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:21:14.319 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:21:14.321 +07:00 [ERR] Connection id "0HNBK4542BH03", Request id "0HNBK4542BH03:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:21:14.337 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 77.2862ms
2025-04-05 16:21:19.378 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:21:19.468 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:21:19.471 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:21:19.579 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:21:19.598 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:21:19.603 +07:00 [ERR] Connection id "0HNBK4542BH04", Request id "0HNBK4542BH04:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:21:19.620 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 242.5503ms
2025-04-05 16:21:25.674 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:21:25.676 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:21:25.677 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:21:25.678 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:21:25.681 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:21:25.681 +07:00 [ERR] Connection id "0HNBK4542BH05", Request id "0HNBK4542BH05:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:21:25.684 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 10.1035ms
2025-04-05 16:21:30.713 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:21:30.716 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:21:30.717 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:21:30.718 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:21:30.721 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:21:30.722 +07:00 [ERR] Connection id "0HNBK4542BH06", Request id "0HNBK4542BH06:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:21:30.730 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 16.7654ms
2025-04-05 16:21:35.782 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:21:35.783 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:21:35.784 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:21:35.784 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:21:35.786 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:21:35.787 +07:00 [ERR] Connection id "0HNBK4542BH07", Request id "0HNBK4542BH07:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:21:35.790 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 8.1371ms
2025-04-05 16:21:40.819 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:21:40.833 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:21:40.838 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:21:40.841 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:21:40.847 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:21:40.848 +07:00 [ERR] Connection id "0HNBK4542BH08", Request id "0HNBK4542BH08:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:21:40.860 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 40.8506ms
2025-04-05 16:21:41.923 +07:00 [INF] Application is shutting down...
2025-04-05 16:21:48.966 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-04-05 16:21:49.069 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-04-05 16:21:49.107 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-04-05 16:21:49.110 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-04-05 16:21:49.111 +07:00 [INF] Hosting environment: Development
2025-04-05 16:21:49.111 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-04-05 16:21:50.983 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:21:51.009 +07:00 [WRN] Failed to determine the https port for redirect.
2025-04-05 16:21:51.023 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:21:51.033 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:21:51.035 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:21:51.063 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:21:51.066 +07:00 [ERR] Connection id "0HNBK4D655R68", Request id "0HNBK4D655R68:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:21:51.070 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 89.0733ms
2025-04-05 16:21:56.101 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:21:56.110 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:21:56.112 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:21:56.114 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:21:56.117 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:21:56.118 +07:00 [ERR] Connection id "0HNBK4D655R69", Request id "0HNBK4D655R69:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:21:56.121 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 20.2002ms
2025-04-05 16:22:01.152 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:22:01.157 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:22:01.158 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:22:01.159 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:22:01.161 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:22:01.162 +07:00 [ERR] Connection id "0HNBK4D655R6A", Request id "0HNBK4D655R6A:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:22:01.165 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 12.4491ms
2025-04-05 16:22:06.194 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:22:06.200 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:22:06.201 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:22:06.204 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:22:06.213 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:22:06.215 +07:00 [ERR] Connection id "0HNBK4D655R6B", Request id "0HNBK4D655R6B:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:22:06.220 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 25.366ms
2025-04-05 16:22:11.250 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:22:11.255 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:22:11.256 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:22:11.257 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:22:11.264 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:22:11.265 +07:00 [ERR] Connection id "0HNBK4D655R6C", Request id "0HNBK4D655R6C:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:22:11.270 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 20.185ms
2025-04-05 16:22:16.319 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:22:16.464 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:22:16.469 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:22:16.487 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:22:16.521 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:22:16.523 +07:00 [ERR] Connection id "0HNBK4D655R6D", Request id "0HNBK4D655R6D:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:22:16.537 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 218.1208ms
2025-04-05 16:22:21.573 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:22:21.581 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:22:21.584 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:22:21.588 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:22:21.606 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:22:21.609 +07:00 [ERR] Connection id "0HNBK4D655R6E", Request id "0HNBK4D655R6E:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:22:21.630 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 56.57ms
2025-04-05 16:22:27.688 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:22:27.693 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:22:27.697 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:22:27.701 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:22:27.739 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:22:27.743 +07:00 [ERR] Connection id "0HNBK4D655R6F", Request id "0HNBK4D655R6F:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:22:27.762 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 72.2258ms
2025-04-05 16:22:32.795 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:22:32.801 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:22:32.805 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:22:32.815 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:22:32.842 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:22:32.856 +07:00 [ERR] Connection id "0HNBK4D655R6G", Request id "0HNBK4D655R6G:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:22:32.956 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 161.2965ms
2025-04-05 16:22:38.013 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:22:38.020 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:22:38.024 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:22:38.034 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:22:38.048 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:22:38.050 +07:00 [ERR] Connection id "0HNBK4D655R6H", Request id "0HNBK4D655R6H:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:22:38.066 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 52.6053ms
2025-04-05 16:22:44.108 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:22:44.109 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:22:44.110 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:22:44.112 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:22:44.115 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:22:44.116 +07:00 [ERR] Connection id "0HNBK4D655R6I", Request id "0HNBK4D655R6I:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:22:44.119 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 11.6494ms
2025-04-05 16:22:49.145 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:22:49.148 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:22:49.149 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:22:49.151 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:22:49.157 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:22:49.158 +07:00 [ERR] Connection id "0HNBK4D655R6J", Request id "0HNBK4D655R6J:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:22:49.165 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 20.156ms
2025-04-05 16:22:54.200 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:22:54.202 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:22:54.204 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:22:54.205 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:22:54.212 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:22:54.214 +07:00 [ERR] Connection id "0HNBK4D655R6K", Request id "0HNBK4D655R6K:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_Connection(StringValues value)
   at Microsoft.AspNetCore.WebSockets.HandshakeHelpers.GenerateResponseHeaders(Boolean isHttp1, IHeaderDictionary requestHeaders, String subProtocol, IHeaderDictionary responseHeaders)
   at Microsoft.AspNetCore.WebSockets.WebSocketMiddleware.WebSocketHandshake.AcceptAsync(WebSocketAcceptContext acceptContext)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 63
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 86
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:22:54.219 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 18.5149ms
2025-04-05 16:22:57.910 +07:00 [INF] Application is shutting down...
2025-04-05 16:23:02.771 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-04-05 16:23:02.882 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-04-05 16:23:02.924 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-04-05 16:23:02.928 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-04-05 16:23:02.930 +07:00 [INF] Hosting environment: Development
2025-04-05 16:23:02.930 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-04-05 16:23:04.282 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:23:04.308 +07:00 [WRN] Failed to determine the https port for redirect.
2025-04-05 16:23:04.323 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:23:04.445 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:23:04.480 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[is_read], [m].[sender_id], [m].[type]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-04-05 16:23:24.868 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 57
2025-04-05 16:23:24.875 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:23:24.893 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 16:23:24.959 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 16:23:25.020 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 16:23:25.040 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 142.576ms
2025-04-05 16:23:25.042 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:23:25.047 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 178.5948ms
2025-04-05 16:23:25.347 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/4 - null null
2025-04-05 16:23:25.354 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:23:25.359 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:23:25.403 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:23:25.413 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:23:25.416 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 55.1548ms
2025-04-05 16:23:25.416 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:23:25.417 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/4 - 200 null application/json; charset=utf-8 70.3968ms
2025-04-05 16:23:26.881 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:23:26.889 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:23:26.905 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:23:26.910 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:23:26.918 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:23:26.919 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:23:26.942 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:23:26.950 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 29.4063ms
2025-04-05 16:23:26.951 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:23:26.952 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 46.9834ms
2025-04-05 16:23:26.990 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:23:26.995 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:23:26.998 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:23:27.010 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:23:27.013 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:23:27.014 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 14.2964ms
2025-04-05 16:23:27.015 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:23:27.015 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 25.1342ms
2025-04-05 16:23:27.036 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:23:27.038 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:23:27.041 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:23:27.049 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:23:27.055 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:23:27.060 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 18.404ms
2025-04-05 16:23:27.062 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:23:27.063 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 26.6564ms
2025-04-05 16:23:28.786 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:23:28.788 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:23:28.810 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:23:28.816 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/2 - null null
2025-04-05 16:23:28.818 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:23:28.818 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:23:28.857 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE [m].[conversation_id] = @__conversation_id_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-04-05 16:23:28.860 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-04-05 16:23:28.862 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 42.3034ms
2025-04-05 16:23:28.862 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:23:28.863 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/2 - 404 null text/plain; charset=utf-8 47.2524ms
2025-04-05 16:23:28.887 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/2 - null null
2025-04-05 16:23:28.889 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:23:28.890 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:23:28.894 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:23:28.896 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:23:28.897 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.3966ms
2025-04-05 16:23:28.898 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:23:28.899 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/2 - 200 null application/json; charset=utf-8 11.7899ms
2025-04-05 16:23:28.921 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/2 - null null
2025-04-05 16:23:28.924 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:23:28.925 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:23:28.929 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:23:28.931 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:23:28.932 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.5697ms
2025-04-05 16:23:28.932 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:23:28.934 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/2 - 200 null application/json; charset=utf-8 12.6985ms
2025-04-05 16:23:31.696 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:23:31.699 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:23:31.719 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:23:31.720 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:23:31.720 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:23:31.722 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:23:31.725 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:23:31.727 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[is_read], [m].[sender_id], [m].[type]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-04-05 16:23:31.728 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 6.9636ms
2025-04-05 16:23:31.730 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:23:31.731 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 12.215ms
2025-04-05 16:23:31.755 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:23:31.757 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:23:31.758 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:23:31.761 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:23:31.764 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:23:31.765 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.4023ms
2025-04-05 16:23:31.766 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:23:31.767 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 12.1455ms
2025-04-05 16:23:31.781 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:23:31.782 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:23:31.783 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:23:31.785 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:23:31.787 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:23:31.787 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.6153ms
2025-04-05 16:23:31.788 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:23:31.789 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 8.3114ms
2025-04-05 16:23:38.586 +07:00 [INF] Handling message: chào
2025-04-05 16:23:38.664 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 16:23:38.672 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 16:23:38.688 +07:00 [INF] Message saved to DB: 1
2025-04-05 16:23:38.694 +07:00 [INF] Transaction committed for message: 1
2025-04-05 16:23:38.696 +07:00 [INF] Message saved to Redis: {"Message":{"id":1,"content":"ch\u00E0o","sender_id":4,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T09:23:38.6023127Z","conversation_id":1},"Attachment":null}
2025-04-05 16:23:47.279 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:23:47.285 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:23:47.293 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:23:47.295 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:23:47.296 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:23:47.298 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:23:47.298 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:23:47.299 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 2.2679ms
2025-04-05 16:23:47.301 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:23:47.302 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 8.7413ms
2025-04-05 16:23:47.331 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:23:47.333 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:23:47.333 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:23:47.336 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:23:47.338 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:23:47.338 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 4.191ms
2025-04-05 16:23:47.339 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:23:47.340 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 8.5742ms
2025-04-05 16:23:47.363 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:23:47.365 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:23:47.366 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:23:47.368 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:23:47.370 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:23:47.370 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.8019ms
2025-04-05 16:23:47.371 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:23:47.372 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 8.1741ms
2025-04-05 16:25:02.548 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:25:02.548 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:25:02.548 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:25:02.549 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:25:02.549 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:25:02.555 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:25:02.575 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:25:02.594 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:25:02.621 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:25:02.626 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:25:02.678 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:25:02.695 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:25:02.727 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:25:02.781 +07:00 [ERR] Connection id "0HNBK4DS06MV1", Request id "0HNBK4DS06MV1:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:25:02.778 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:25:02.779 +07:00 [ERR] Connection id "0HNBK4DS06MVD", Request id "0HNBK4DS06MVD:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:25:02.779 +07:00 [ERR] Connection id "0HNBK4DS06MUU", Request id "0HNBK4DS06MUU:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:25:02.753 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:25:02.792 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 95910.6478ms
2025-04-05 16:25:02.792 +07:00 [ERR] Connection id "0HNBK4DS06MV9", Request id "0HNBK4DS06MV9:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:25:02.802 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 75522.7564ms
2025-04-05 16:25:02.808 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 118527.7866ms
2025-04-05 16:25:02.808 +07:00 [ERR] Connection id "0HNBK4DS06MV5", Request id "0HNBK4DS06MV5:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:25:02.821 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 91124.4135ms
2025-04-05 16:25:02.838 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 94052.2426ms
2025-04-05 16:26:15.482 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 57
2025-04-05 16:26:15.486 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:26:15.488 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 16:26:15.525 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 16:26:15.532 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 16:26:15.535 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 44.2981ms
2025-04-05 16:26:15.540 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:26:15.542 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 60.0588ms
2025-04-05 16:26:16.037 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/4 - null null
2025-04-05 16:26:16.051 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:26:16.055 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:26:16.074 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:26:16.081 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:26:16.085 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 22.1899ms
2025-04-05 16:26:16.089 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:26:16.091 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/4 - 200 null application/json; charset=utf-8 54.6213ms
2025-04-05 16:26:20.062 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:26:20.066 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:26:20.189 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:26:20.197 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:26:20.198 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:26:20.200 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:26:20.222 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:26:20.243 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 28.1479ms
2025-04-05 16:26:20.247 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:26:20.261 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 72.6216ms
2025-04-05 16:26:20.330 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:26:20.335 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:26:20.336 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:26:20.345 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:26:20.349 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:26:20.352 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 12.463ms
2025-04-05 16:26:20.355 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:26:20.357 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 26.3682ms
2025-04-05 16:26:20.384 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:26:20.387 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:26:20.392 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:26:20.399 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:26:20.405 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:26:20.407 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 13.0686ms
2025-04-05 16:26:20.409 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:26:20.411 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 26.8243ms
2025-04-05 16:26:27.977 +07:00 [INF] Handling message: hello
2025-04-05 16:26:27.987 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 16:26:27.997 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 16:26:28.007 +07:00 [INF] Message saved to DB: 2
2025-04-05 16:26:28.010 +07:00 [INF] Transaction committed for message: 2
2025-04-05 16:26:28.014 +07:00 [INF] Message saved to Redis: {"Message":{"id":2,"content":"hello","sender_id":4,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T09:26:27.985166Z","conversation_id":1},"Attachment":null}
2025-04-05 16:26:45.918 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Message/uploadFile - multipart/form-data; boundary=--dio-boundary-3284375977 3166478
2025-04-05 16:26:45.937 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-04-05 16:26:45.967 +07:00 [INF] Route matched with {action = "UploadFile", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UploadFile(Microsoft.AspNetCore.Http.IFormFile) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:27:00.123 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (DbType = Single), @p1='?' (Size = 50), @p2='?' (Size = 255), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Attachments] ([FileSize], [file_type], [file_url], [is_temporary], [message_id], [uploaded_at])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-04-05 16:27:00.139 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType13`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:27:00.148 +07:00 [INF] Executed action server.Controllers.MessageController.UploadFile (Message_app) in 14167.6527ms
2025-04-05 16:27:00.154 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-04-05 16:27:00.167 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Message/uploadFile - 200 null application/json; charset=utf-8 14248.5016ms
2025-04-05 16:27:00.267 +07:00 [INF] Handling message: FILE
2025-04-05 16:27:00.289 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 16:27:00.295 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 16:27:00.301 +07:00 [INF] Message saved to DB: 3
2025-04-05 16:27:00.305 +07:00 [INF] Processing attachment with ID 1
2025-04-05 16:27:00.320 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM [Attachments] AS [a]
WHERE [a].[id] = @__p_0
2025-04-05 16:27:00.346 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 16:27:00.364 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@p6='?' (DbType = Int32), @p0='?' (DbType = Single), @p1='?' (Size = 50), @p2='?' (Size = 255), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2), @p14='?' (DbType = Int32), @p7='?' (Size = 500), @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime2), @p10='?' (DbType = Boolean), @p11='?' (DbType = Boolean), @p12='?' (DbType = Int32), @p13='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Attachments] SET [FileSize] = @p0, [file_type] = @p1, [file_url] = @p2, [is_temporary] = @p3, [message_id] = @p4, [uploaded_at] = @p5
OUTPUT 1
WHERE [id] = @p6;
UPDATE [Messages] SET [content] = @p7, [conversation_id] = @p8, [created_at] = @p9, [isFile] = @p10, [is_read] = @p11, [sender_id] = @p12, [type] = @p13
OUTPUT 1
WHERE [id] = @p14;
2025-04-05 16:27:00.373 +07:00 [INF] Transaction committed for message: 3
2025-04-05 16:27:00.377 +07:00 [INF] Message saved to Redis: {"Message":{"id":3,"content":"FILE","sender_id":4,"is_read":false,"type":"message","isFile":true,"created_at":"2025-04-05T09:27:00.2867731Z","conversation_id":1},"Attachment":{"id":1,"file_url":"https://res.cloudinary.com/ddai7zukq/image/upload/v1743845218/message_images/message_image_f37b71f2-c399-4413-9e59-2d78b2237692.jpg","FileSize":3.019621,"file_type":"application/octet-stream","uploaded_at":"2025-04-05T09:27:00.0750646","is_temporary":false,"message_id":3}}
2025-04-05 16:27:08.658 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/2 - null null
2025-04-05 16:27:08.664 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:27:08.665 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:27:08.684 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE [m].[conversation_id] = @__conversation_id_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-04-05 16:27:08.688 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-04-05 16:27:08.689 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 21.8316ms
2025-04-05 16:27:08.689 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:27:08.690 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/2 - 404 null text/plain; charset=utf-8 32.0508ms
2025-04-05 16:27:08.721 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/2 - null null
2025-04-05 16:27:08.726 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:27:08.727 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:27:08.733 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:27:08.737 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:27:08.738 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.5633ms
2025-04-05 16:27:08.739 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:27:08.740 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/2 - 200 null application/json; charset=utf-8 18.4426ms
2025-04-05 16:27:08.758 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/2 - null null
2025-04-05 16:27:08.760 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:27:08.761 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:27:08.766 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:27:08.772 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:27:08.774 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 12.2344ms
2025-04-05 16:27:08.775 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:27:08.776 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/2 - 200 null application/json; charset=utf-8 18.3862ms
2025-04-05 16:27:09.642 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:27:09.646 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:27:09.668 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:27:09.674 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[is_read], [m].[sender_id], [m].[type]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-04-05 16:28:31.659 +07:00 [INF] Handling message: alo
2025-04-05 16:28:31.695 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 16:28:31.706 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 16:28:31.714 +07:00 [INF] Message saved to DB: 4
2025-04-05 16:28:31.717 +07:00 [INF] Transaction committed for message: 4
2025-04-05 16:28:31.719 +07:00 [INF] Message saved to Redis: {"Message":{"id":4,"content":"alo","sender_id":4,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T09:28:31.6938655Z","conversation_id":2},"Attachment":null}
2025-04-05 16:28:31.732 +07:00 [ERR] An error occurred using a transaction.
2025-04-05 16:28:31.740 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:28:31.745 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: This SqlTransaction has completed; it is no longer usable.
   at Microsoft.Data.SqlClient.SqlTransaction.ZombieCheck()
   at Microsoft.Data.SqlClient.SqlTransaction.Rollback()
   at System.Data.Common.DbTransaction.RollbackAsync(CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at server.Services.WebSocketService.webSocket.HandleMessage(Client client, MessageDTO message) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 342
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 112
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:28:31.779 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:28:31.783 +07:00 [ERR] Connection id "0HNBK4DS06MVR", Request id "0HNBK4DS06MVR:00000001": An unhandled exception was thrown by the application.
System.InvalidOperationException: This SqlTransaction has completed; it is no longer usable.
   at Microsoft.Data.SqlClient.SqlTransaction.ZombieCheck()
   at Microsoft.Data.SqlClient.SqlTransaction.Rollback()
   at System.Data.Common.DbTransaction.RollbackAsync(CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at server.Services.WebSocketService.webSocket.HandleMessage(Client client, MessageDTO message) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 342
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 112
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:28:31.818 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 82175.8158ms
2025-04-05 16:28:36.857 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:28:36.867 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:28:36.901 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:28:37.599 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:28:37.606 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/2 - null null
2025-04-05 16:28:37.613 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:28:37.632 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:28:37.650 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:28:37.667 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:28:37.715 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE [m].[conversation_id] = @__conversation_id_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-04-05 16:28:37.720 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[is_read], [m].[sender_id], [m].[type]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-04-05 16:28:37.736 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:28:37.744 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 80.4164ms
2025-04-05 16:28:37.748 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:28:37.750 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/2 - 200 null application/json; charset=utf-8 144.1294ms
2025-04-05 16:28:37.779 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/2 - null null
2025-04-05 16:28:37.782 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:28:37.783 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:28:37.793 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:28:37.799 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:28:37.805 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 20.4567ms
2025-04-05 16:28:37.810 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:28:37.812 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/2 - 200 null application/json; charset=utf-8 33.6497ms
2025-04-05 16:28:37.879 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/2 - null null
2025-04-05 16:28:37.886 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:28:37.889 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:28:37.901 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:28:37.917 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:28:37.929 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 33.4451ms
2025-04-05 16:28:37.951 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:28:37.955 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/2 - 200 null application/json; charset=utf-8 76.0107ms
2025-04-05 16:28:40.322 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/4 - null null
2025-04-05 16:28:40.343 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:28:40.355 +07:00 [INF] Route matched with {action = "GetReceivedFriendRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetReceivedFriendRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 16:28:40.426 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[SenderId], [f].[ReceiverId], [u].[username] AS [Username], [u].[avatar_url] AS [AvatarUrl], [f].[Status], [f].[CreatedAt], 0 AS [MutualFriendsCount]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-04-05 16:28:40.433 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[FriendRequestDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:28:40.446 +07:00 [INF] Executed action server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app) in 84.2003ms
2025-04-05 16:28:40.450 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetReceivedFriendRequests (Message_app)'
2025-04-05 16:28:40.464 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/requests/received/4 - 200 null application/json; charset=utf-8 142.2636ms
2025-04-05 16:28:53.588 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/friends/search?username=thanhdat&senderId=4 - null null
2025-04-05 16:28:53.609 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.SearchUsers (Message_app)'
2025-04-05 16:28:53.623 +07:00 [INF] Route matched with {action = "SearchUsers", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SearchUsers(System.String, Int32) on controller server.Controllers.FriendsController (Message_app).
2025-04-05 16:28:53.650 +07:00 [WRN] The query uses a row limiting operator ('Skip'/'Take') without an 'OrderBy' operator. This may lead to unpredictable results. If the 'Distinct' operator is used after 'OrderBy', then make sure to use the 'OrderBy' operator after 'Distinct' as the ordering would otherwise get erased.
2025-04-05 16:28:53.671 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_2='?' (DbType = Int32), @__usernameQuery_0_contains='?' (Size = 200), @__currentUserId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_2) [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[username] LIKE @__usernameQuery_0_contains ESCAPE N'\' AND [u].[id] <> @__currentUserId_1
2025-04-05 16:28:53.679 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:28:53.683 +07:00 [INF] Executed action server.Controllers.FriendsController.SearchUsers (Message_app) in 55.3361ms
2025-04-05 16:28:53.689 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.SearchUsers (Message_app)'
2025-04-05 16:28:53.690 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/friends/search?username=thanhdat&senderId=4 - 200 null application/json; charset=utf-8 102.1667ms
2025-04-05 16:29:12.816 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:29:12.830 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:29:12.856 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:29:12.865 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:29:12.873 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:29:12.881 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:29:12.885 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 7.1999ms
2025-04-05 16:29:12.891 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:29:12.919 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:29:12.942 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 85.9156ms
2025-04-05 16:29:12.977 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:29:13.000 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:29:13.008 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:29:13.020 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:29:13.035 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:29:13.048 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 32.2393ms
2025-04-05 16:29:13.055 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:29:13.058 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 81.9224ms
2025-04-05 16:29:13.079 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:29:13.084 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:29:13.091 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:29:13.102 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:29:13.115 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:29:13.119 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 21.996ms
2025-04-05 16:29:13.126 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:29:13.128 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 49.1389ms
2025-04-05 16:29:19.082 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:29:19.090 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/2 - null null
2025-04-05 16:29:19.098 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:29:19.107 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:29:19.118 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:29:19.126 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:29:19.164 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE [m].[conversation_id] = @__conversation_id_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-04-05 16:29:19.175 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[is_read], [m].[sender_id], [m].[type]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-04-05 16:29:19.186 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:29:19.195 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 50.57ms
2025-04-05 16:29:19.199 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:29:19.202 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/2 - 200 null application/json; charset=utf-8 112.2058ms
2025-04-05 16:29:19.240 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/2 - null null
2025-04-05 16:29:19.250 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:29:19.251 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:29:19.260 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:29:19.264 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:29:19.265 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 9.3805ms
2025-04-05 16:29:19.266 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:29:19.268 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/2 - 200 null application/json; charset=utf-8 27.7104ms
2025-04-05 16:29:19.322 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/2 - null null
2025-04-05 16:29:19.329 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:29:19.330 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:29:19.339 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:29:19.358 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:29:19.364 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 30.1835ms
2025-04-05 16:29:19.366 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:29:19.367 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/2 - 200 null application/json; charset=utf-8 45.6706ms
2025-04-05 16:35:28.188 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:35:28.201 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:35:28.272 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:35:28.280 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:35:28.284 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:35:28.292 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:35:28.298 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:35:28.301 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 5.53ms
2025-04-05 16:35:28.308 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:35:28.310 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 38.2057ms
2025-04-05 16:35:28.335 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:35:28.339 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:35:28.340 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:35:28.347 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:35:28.349 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:35:28.354 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.387ms
2025-04-05 16:35:28.355 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:35:28.358 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 22.8999ms
2025-04-05 16:35:28.375 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:35:28.378 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:35:28.382 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:35:28.389 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:35:28.392 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:35:28.394 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.0002ms
2025-04-05 16:35:28.400 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:35:28.402 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 27.6845ms
2025-04-05 16:36:00.479 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:36:00.479 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:36:00.480 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:36:00.480 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:36:00.486 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x8BE43345): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:36:00.481 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:36:00.482 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:36:00.484 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:36:00.485 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:36:00.481 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:36:00.500 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:36:00.500 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:36:00.545 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:36:00.593 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:36:00.664 +07:00 [ERR] Connection id "0HNBK4DS06MVJ", Request id "0HNBK4DS06MVJ:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:36:00.621 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:36:00.624 +07:00 [ERR] Connection id "0HNBK4DS06MVS", Request id "0HNBK4DS06MVS:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x8BE43345): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:36:00.661 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:36:00.661 +07:00 [ERR] Connection id "0HNBK4DS06MVT", Request id "0HNBK4DS06MVT:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:36:00.620 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:36:00.679 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 580616.9126ms
2025-04-05 16:36:00.694 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:36:00.710 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 443853.1384ms
2025-04-05 16:36:00.711 +07:00 [ERR] Connection id "0HNBK4DS06N03", Request id "0HNBK4DS06N03:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:36:00.722 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 443123.1843ms
2025-04-05 16:36:00.722 +07:00 [ERR] Connection id "0HNBK4DS06N0B", Request id "0HNBK4DS06N0B:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:36:00.728 +07:00 [ERR] Connection id "0HNBK4DS06N07", Request id "0HNBK4DS06N07:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:36:00.742 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 407925.9964ms
2025-04-05 16:36:00.757 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 32568.7441ms
2025-04-05 16:36:00.774 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 401692.2517ms
2025-04-05 16:41:03.420 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 53
2025-04-05 16:41:03.428 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:41:03.431 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 16:41:03.453 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 16:41:03.471 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 16:41:03.485 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 48.7838ms
2025-04-05 16:41:03.491 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:41:03.493 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 73.5538ms
2025-04-05 16:41:04.124 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/5 - null null
2025-04-05 16:41:04.132 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:41:04.136 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:41:04.152 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:41:04.170 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:41:04.175 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 31.5745ms
2025-04-05 16:41:04.180 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:41:04.183 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 59.0031ms
2025-04-05 16:41:10.669 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:41:10.674 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:41:10.897 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:41:10.948 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:41:10.961 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:41:10.964 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:41:10.976 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:41:10.980 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 6.8354ms
2025-04-05 16:41:10.983 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:41:10.986 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 37.8035ms
2025-04-05 16:41:11.052 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:41:11.058 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:41:11.060 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:41:11.069 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:41:11.076 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:41:11.079 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 17.1056ms
2025-04-05 16:41:11.082 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:41:11.084 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 32.1557ms
2025-04-05 16:41:11.115 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:41:11.127 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:41:11.130 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:41:11.138 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:41:11.146 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:41:11.241 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 107.8869ms
2025-04-05 16:41:11.246 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:41:11.248 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 133.1396ms
2025-04-05 16:42:21.827 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:42:21.829 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:42:21.835 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:42:21.846 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:42:21.854 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:42:21.870 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:42:21.879 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 14.3894ms
2025-04-05 16:42:21.883 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:42:21.886 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 56.5453ms
2025-04-05 16:42:21.887 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:42:21.996 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:42:22.001 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:42:22.005 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:42:22.039 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:42:22.044 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:42:22.046 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.952ms
2025-04-05 16:42:22.051 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:42:22.053 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 57.3638ms
2025-04-05 16:42:22.080 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:42:22.086 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:42:22.088 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:42:22.099 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:42:22.103 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:42:22.107 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 12.8995ms
2025-04-05 16:42:22.111 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:42:22.113 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 32.8724ms
2025-04-05 16:43:03.403 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:43:03.409 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:43:03.432 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:43:03.454 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:43:03.474 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:43:03.516 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[is_read], [m].[sender_id], [m].[type]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-04-05 16:43:03.516 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:43:03.554 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:43:03.563 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 15.1738ms
2025-04-05 16:43:03.572 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:43:03.584 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 151.7812ms
2025-04-05 16:43:03.681 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:43:03.685 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:43:03.686 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:43:03.697 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:43:03.702 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:43:03.705 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 16.1999ms
2025-04-05 16:43:03.710 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:43:03.713 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 32.6529ms
2025-04-05 16:43:03.734 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:43:03.744 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:43:03.749 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:43:03.762 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:43:03.767 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:43:03.769 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 12.0199ms
2025-04-05 16:43:03.773 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:43:03.775 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 41.0483ms
2025-04-05 16:43:20.977 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:43:20.978 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:43:20.994 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:43:21.013 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:43:21.033 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:43:21.039 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:43:21.069 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:43:21.079 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 15.4947ms
2025-04-05 16:43:21.086 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:43:21.091 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 112.9087ms
2025-04-05 16:43:21.238 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:43:21.254 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:43:21.256 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:43:21.268 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:43:21.274 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:43:21.280 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 15.3537ms
2025-04-05 16:43:21.285 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:43:21.287 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 48.7441ms
2025-04-05 16:43:21.311 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:43:21.321 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:43:21.324 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:43:21.333 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:43:21.339 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:43:21.347 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 15.086ms
2025-04-05 16:43:21.354 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:43:21.367 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 56.0593ms
2025-04-05 16:43:35.883 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 53
2025-04-05 16:43:35.900 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:43:35.904 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 16:43:35.923 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 16:43:35.933 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 16:43:35.938 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 21.9264ms
2025-04-05 16:43:35.941 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:43:35.947 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 64.2809ms
2025-04-05 16:43:36.144 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/5 - null null
2025-04-05 16:43:36.159 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:43:36.164 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:43:36.185 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:43:36.199 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:43:36.202 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 32.9731ms
2025-04-05 16:43:36.206 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:43:36.208 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 63.5345ms
2025-04-05 16:46:13.289 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:46:13.298 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:46:13.323 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:46:13.323 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/4 - null null
2025-04-05 16:46:13.345 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:46:13.349 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:46:13.362 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE [m].[conversation_id] = @__conversation_id_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-04-05 16:46:13.372 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-04-05 16:46:13.375 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 21.2052ms
2025-04-05 16:46:13.378 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:46:13.382 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/4 - 404 null text/plain; charset=utf-8 59.2712ms
2025-04-05 16:46:13.436 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/4 - null null
2025-04-05 16:46:13.442 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:46:13.444 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:46:13.454 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:46:13.458 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:46:13.461 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 10.6913ms
2025-04-05 16:46:13.464 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:46:13.471 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 35.6326ms
2025-04-05 16:46:13.524 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/4 - null null
2025-04-05 16:46:13.534 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:46:13.539 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:46:13.553 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:46:13.562 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:46:13.567 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 18.5725ms
2025-04-05 16:46:13.571 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:46:13.574 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 49.9201ms
2025-04-05 16:46:29.683 +07:00 [INF] Handling message: hello
2025-04-05 16:46:29.688 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 16:46:29.704 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 16:46:29.712 +07:00 [INF] Message saved to DB: 5
2025-04-05 16:46:29.719 +07:00 [INF] Transaction committed for message: 5
2025-04-05 16:46:29.723 +07:00 [INF] Message saved to Redis: {"Message":{"id":5,"content":"hello","sender_id":5,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T09:46:29.6876424Z","conversation_id":4},"Attachment":null}
2025-04-05 16:47:16.145 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:47:16.145 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:47:16.146 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:47:16.147 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:47:16.159 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (1237853001): The remote party closed the WebSocket connection without completing the close handshake. ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:47:16.151 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:47:16.153 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:47:16.157 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:47:16.149 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:47:16.222 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:47:16.246 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:47:16.259 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:47:16.268 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:47:16.268 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 16:47:16.269 +07:00 [ERR] Connection id "0HNBK4DS06N0H", Request id "0HNBK4DS06N0H:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (1237853001): The remote party closed the WebSocket connection without completing the close handshake. ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:47:16.270 +07:00 [ERR] Connection id "0HNBK4DS06N13", Request id "0HNBK4DS06N13:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:47:16.271 +07:00 [ERR] Connection id "0HNBK4DS06N0U", Request id "0HNBK4DS06N0U:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:47:16.272 +07:00 [ERR] Connection id "0HNBK4DS06N0L", Request id "0HNBK4DS06N0L:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:47:16.285 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-04-05 16:47:16.297 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 365627.8069ms
2025-04-05 16:47:16.312 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 63023.4294ms
2025-04-05 16:47:16.323 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 235346.0363ms
2025-04-05 16:47:16.332 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 294505.3437ms
2025-04-05 16:47:16.332 +07:00 [ERR] Connection id "0HNBK4DS06N0P", Request id "0HNBK4DS06N0P:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 88
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 71
   at Program.<>c.<<<Main>$>b__0_2>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 85
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-04-05 16:47:16.366 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 252962.5013ms
2025-04-05 16:47:59.986 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - application/json 57
2025-04-05 16:47:59.997 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:48:00.004 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-04-05 16:48:00.029 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-04-05 16:48:00.039 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-04-05 16:48:00.045 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 25.4631ms
2025-04-05 16:48:00.048 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-04-05 16:48:00.052 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Auth/login - 200 null application/json; charset=utf-8 66.1234ms
2025-04-05 16:48:01.529 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - null null
2025-04-05 16:48:01.535 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:48:01.540 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:48:01.564 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Participants] AS [p]
INNER JOIN [Conversations] AS [c] ON [p].[conversation_id] = [c].[id]
WHERE [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:48:01.575 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.Conversation, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:48:01.583 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 29.5111ms
2025-04-05 16:48:01.588 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-04-05 16:48:01.595 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 65.9096ms
2025-04-05 16:48:07.013 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:48:07.020 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/4 - null null
2025-04-05 16:48:07.020 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:48:07.029 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:48:07.033 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:48:07.045 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:48:07.051 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 7.1332ms
2025-04-05 16:48:07.056 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:48:07.062 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/4 - 200 null application/json; charset=utf-8 42.1498ms
2025-04-05 16:48:07.134 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:48:07.143 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[is_read], [m].[sender_id], [m].[type]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-04-05 16:48:07.174 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/4 - null null
2025-04-05 16:48:07.179 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:48:07.180 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:48:07.191 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:48:07.194 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:48:07.198 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 11.0538ms
2025-04-05 16:48:07.204 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:48:07.208 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 34.0751ms
2025-04-05 16:48:07.227 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/4 - null null
2025-04-05 16:48:07.231 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:48:07.234 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:48:07.243 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:48:07.246 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:48:07.248 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.178ms
2025-04-05 16:48:07.254 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:48:07.256 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 28.2661ms
2025-04-05 16:48:28.144 +07:00 [INF] Handling message: biết bố m là ai ko?
2025-04-05 16:48:28.153 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 16:48:28.172 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 16:48:28.183 +07:00 [INF] Message saved to DB: 6
2025-04-05 16:48:28.186 +07:00 [INF] Transaction committed for message: 6
2025-04-05 16:48:28.189 +07:00 [INF] Message saved to Redis: {"Message":{"id":6,"content":"bi\u1EBFt b\u1ED1 m l\u00E0 ai ko?","sender_id":2,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T09:48:28.1520565Z","conversation_id":4},"Attachment":null}
2025-04-05 16:48:34.312 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:48:34.325 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:48:34.343 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/4 - null null
2025-04-05 16:48:34.353 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:48:34.354 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:48:34.455 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:48:34.463 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:48:34.483 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 21.3781ms
2025-04-05 16:48:34.486 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:48:34.488 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/4 - 200 null application/json; charset=utf-8 145.037ms
2025-04-05 16:48:34.528 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/4 - null null
2025-04-05 16:48:34.533 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:48:34.535 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:48:34.549 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:48:34.556 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:48:34.559 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 15.482ms
2025-04-05 16:48:34.565 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:48:34.567 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 38.5547ms
2025-04-05 16:48:34.585 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/4 - null null
2025-04-05 16:48:34.589 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:48:34.592 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:48:34.599 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:48:34.602 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:48:34.604 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 9.0491ms
2025-04-05 16:48:34.607 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:48:34.608 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 22.7586ms
2025-04-05 16:48:45.538 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.2:5053/api/Message/uploadFile - multipart/form-data; boundary=--dio-boundary-1896646927 2873885
2025-04-05 16:48:45.552 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-04-05 16:48:45.556 +07:00 [INF] Route matched with {action = "UploadFile", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UploadFile(Microsoft.AspNetCore.Http.IFormFile) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:48:58.827 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (DbType = Single), @p1='?' (Size = 50), @p2='?' (Size = 255), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Attachments] ([FileSize], [file_type], [file_url], [is_temporary], [message_id], [uploaded_at])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-04-05 16:48:58.838 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType13`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:48:58.844 +07:00 [INF] Executed action server.Controllers.MessageController.UploadFile (Message_app) in 13280.616ms
2025-04-05 16:48:58.855 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.UploadFile (Message_app)'
2025-04-05 16:48:58.861 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.2:5053/api/Message/uploadFile - 200 null application/json; charset=utf-8 13323.371ms
2025-04-05 16:48:58.881 +07:00 [INF] Handling message: FILE
2025-04-05 16:48:58.886 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 16:48:58.893 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 16:48:58.898 +07:00 [INF] Message saved to DB: 7
2025-04-05 16:48:58.899 +07:00 [INF] Processing attachment with ID 2
2025-04-05 16:48:58.904 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM [Attachments] AS [a]
WHERE [a].[id] = @__p_0
2025-04-05 16:48:58.910 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 16:48:58.920 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p6='?' (DbType = Int32), @p0='?' (DbType = Single), @p1='?' (Size = 50), @p2='?' (Size = 255), @p3='?' (DbType = Boolean), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime2), @p14='?' (DbType = Int32), @p7='?' (Size = 500), @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime2), @p10='?' (DbType = Boolean), @p11='?' (DbType = Boolean), @p12='?' (DbType = Int32), @p13='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Attachments] SET [FileSize] = @p0, [file_type] = @p1, [file_url] = @p2, [is_temporary] = @p3, [message_id] = @p4, [uploaded_at] = @p5
OUTPUT 1
WHERE [id] = @p6;
UPDATE [Messages] SET [content] = @p7, [conversation_id] = @p8, [created_at] = @p9, [isFile] = @p10, [is_read] = @p11, [sender_id] = @p12, [type] = @p13
OUTPUT 1
WHERE [id] = @p14;
2025-04-05 16:48:58.927 +07:00 [INF] Transaction committed for message: 7
2025-04-05 16:48:58.930 +07:00 [INF] Message saved to Redis: {"Message":{"id":7,"content":"FILE","sender_id":2,"is_read":false,"type":"message","isFile":true,"created_at":"2025-04-05T09:48:58.8841196Z","conversation_id":4},"Attachment":{"id":2,"file_url":"https://res.cloudinary.com/ddai7zukq/image/upload/v1743846537/message_images/message_image_8e395601-fac7-4d6c-b9e8-53b84c508e7b.jpg","FileSize":2.7405825,"file_type":"application/octet-stream","uploaded_at":"2025-04-05T09:48:58.8185097","is_temporary":false,"message_id":7}}
2025-04-05 16:49:14.282 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:49:14.296 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:49:14.306 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:49:14.334 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:49:14.343 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:49:14.318 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:49:14.350 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:49:14.359 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 12.2864ms
2025-04-05 16:49:14.363 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:49:14.365 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 58.6112ms
2025-04-05 16:49:14.407 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:49:14.410 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:49:14.411 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:49:14.417 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:49:14.426 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:49:14.428 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 14.2578ms
2025-04-05 16:49:14.430 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:49:14.432 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 25.0193ms
2025-04-05 16:49:14.460 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:49:14.463 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:49:14.465 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:49:14.472 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:49:14.475 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:49:14.477 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 10.2919ms
2025-04-05 16:49:14.479 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:49:14.481 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 20.6179ms
2025-04-05 16:49:37.591 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:49:37.599 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:49:37.621 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:49:37.643 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:49:37.648 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:49:37.663 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:49:37.670 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:49:37.672 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.1657ms
2025-04-05 16:49:37.677 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:49:37.680 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 58.498ms
2025-04-05 16:49:37.748 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:49:37.756 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:49:37.777 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:49:37.806 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:49:37.814 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:49:37.818 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 20.7198ms
2025-04-05 16:49:37.824 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:49:37.827 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 78.7687ms
2025-04-05 16:49:37.860 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:49:37.864 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:49:37.866 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:49:37.876 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:49:37.878 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:49:37.882 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 11.7968ms
2025-04-05 16:49:37.883 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:49:37.885 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 25.3499ms
2025-04-05 16:49:42.874 +07:00 [INF] Handling message: lo cc
2025-04-05 16:49:42.888 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-04-05 16:49:42.896 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-04-05 16:49:42.912 +07:00 [INF] Message saved to DB: 8
2025-04-05 16:49:42.921 +07:00 [INF] Transaction committed for message: 8
2025-04-05 16:49:42.927 +07:00 [INF] Message saved to Redis: {"Message":{"id":8,"content":"lo cc","sender_id":2,"is_read":false,"type":"message","isFile":false,"created_at":"2025-04-05T09:49:42.8874355Z","conversation_id":1},"Attachment":null}
2025-04-05 16:50:06.115 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-04-05 16:50:06.231 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-04-05 16:50:06.270 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-04-05 16:50:06.273 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-04-05 16:50:06.274 +07:00 [INF] Hosting environment: Development
2025-04-05 16:50:06.275 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-04-05 16:50:08.104 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:50:08.105 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:50:08.105 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - null null
2025-04-05 16:50:08.139 +07:00 [WRN] Failed to determine the https port for redirect.
2025-04-05 16:50:08.158 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:50:08.158 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:50:08.158 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:50:08.179 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32) on controller server.Controllers.MessageController (Message_app).
2025-04-05 16:50:08.240 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-04-05 16:50:08.269 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 86.3153ms
2025-04-05 16:50:08.271 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-04-05 16:50:08.275 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Message/getMessages/1 - 200 null application/json; charset=utf-8 169.5406ms
2025-04-05 16:50:08.275 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:50:08.275 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:50:08.315 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - null null
2025-04-05 16:50:08.321 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:50:08.331 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-04-05 16:50:08.416 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[is_group], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-04-05 16:50:08.448 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-04-05 16:50:08.461 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 126.4033ms
2025-04-05 16:50:08.462 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-04-05 16:50:08.464 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Conversation/get_first_conversation/1 - 200 null application/json; charset=utf-8 149.4914ms
2025-04-05 16:50:08.481 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - null null
2025-04-05 16:50:08.484 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:50:08.489 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-04-05 16:50:08.499 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[conversation_id], [p].[is_deleted], [p].[joined_at], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-04-05 16:50:08.509 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType14`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-04-05 16:50:08.516 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 23.6862ms
2025-04-05 16:50:08.516 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-04-05 16:50:08.517 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/api/Participant/get_participants/1 - 200 null application/json; charset=utf-8 35.8665ms
2025-04-05 16:50:09.735 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:50:09.739 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:50:09.755 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:50:09.762 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:50:09.764 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:50:09.766 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:50:09.768 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:50:09.770 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - null null
2025-04-05 16:50:09.772 +07:00 [INF] Executing endpoint '/ws/chat'
2025-04-05 16:50:09.779 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:50:09.785 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:50:09.790 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-04-05 16:51:13.956 +07:00 [INF] Application is shutting down...
2025-04-05 16:51:43.973 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:51:43.973 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:51:43.973 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:51:43.973 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:51:43.973 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:51:43.973 +07:00 [INF] Executed endpoint '/ws/chat'
2025-04-05 16:51:43.978 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 94212.4375ms
2025-04-05 16:51:43.979 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 94209.0606ms
2025-04-05 16:51:43.982 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 94246.9741ms
2025-04-05 16:51:43.987 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 95884.8624ms
2025-04-05 16:51:43.991 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 95889.3548ms
2025-04-05 16:51:43.996 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/ws/chat - 101 null null 94234.5388ms
2025-04-05 17:08:09.312 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-04-05 17:08:09.452 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-04-05 17:08:09.492 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-04-05 17:08:09.494 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-04-05 17:08:09.495 +07:00 [INF] Hosting environment: Development
2025-04-05 17:08:09.496 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-04-05 17:12:16.250 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/swagger - null null
2025-04-05 17:12:16.308 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/swagger - 301 0 null 62.333ms
2025-04-05 17:12:16.316 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/swagger/index.html - null null
2025-04-05 17:12:16.453 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/swagger/index.html - 200 null text/html;charset=utf-8 137.3987ms
2025-04-05 17:12:16.464 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/swagger/swagger-ui-bundle.js - null null
2025-04-05 17:12:16.464 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/swagger/index.css - null null
2025-04-05 17:12:16.465 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/swagger/swagger-ui.css - null null
2025-04-05 17:12:16.465 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/swagger/swagger-ui-standalone-preset.js - null null
2025-04-05 17:12:16.466 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/swagger/index.js - null null
2025-04-05 17:12:16.495 +07:00 [INF] Sending file. Request path: '/index.css'. Physical path: 'N/A'
2025-04-05 17:12:16.503 +07:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2025-04-05 17:12:16.505 +07:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-04-05 17:12:16.509 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/swagger/index.js - 200 null application/javascript;charset=utf-8 42.6448ms
2025-04-05 17:12:16.510 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/swagger/index.css - 200 202 text/css 45.4318ms
2025-04-05 17:12:16.513 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/swagger/swagger-ui.css - 200 152035 text/css 47.7037ms
2025-04-05 17:12:16.514 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/swagger/swagger-ui-standalone-preset.js - 200 230007 text/javascript 48.5129ms
2025-04-05 17:12:16.529 +07:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-04-05 17:12:16.537 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/swagger/swagger-ui-bundle.js - 200 1457477 text/javascript 73.5364ms
2025-04-05 17:12:17.327 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/swagger/v1/swagger.json - null null
2025-04-05 17:12:17.387 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.2:5053/swagger/favicon-32x32.png - null null
2025-04-05 17:12:17.391 +07:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2025-04-05 17:12:17.394 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/swagger/favicon-32x32.png - 200 628 image/png 7.6926ms
2025-04-05 17:12:17.476 +07:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Failed to generate Operation for action - server.Controllers.MessageController.UploadFile (Message_app). See inner exception
 ---> Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Error reading parameter(s) for action server.Controllers.MessageController.UploadFile (Message_app) as [FromForm] attribute used with IFormFile. Please refer to https://github.com/domaindrivendev/Swashbuckle.AspNetCore#handle-forms-and-file-uploads for more information
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateParametersAsync(ApiDescription apiDescription, SchemaRepository schemaRespository, Func`3 parameterGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateParametersAsync(ApiDescription apiDescription, SchemaRepository schemaRespository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository, Func`3 parametersGenerator, Func`3 bodyGenerator, Func`3 applyFilters)
   --- End of inner exception stack trace ---
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository, Func`3 parametersGenerator, Func`3 bodyGenerator, Func`3 applyFilters)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationAsync(ApiDescription apiDescription, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository, Func`3 operationsGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-04-05 17:12:17.505 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.2:5053/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 177.9839ms
2025-04-05 17:15:30.257 +07:00 [INF] Application is shutting down...
2025-04-05 17:15:35.443 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-04-05 17:15:35.575 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-04-05 17:15:35.621 +07:00 [WRN] Overriding address(es) 'http://0.0.0.0:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-04-05 17:15:35.632 +07:00 [INF] Now listening on: http://[::]:5053
2025-04-05 17:15:35.633 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-04-05 17:15:35.634 +07:00 [INF] Hosting environment: Development
2025-04-05 17:15:35.635 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
