2025-05-22 10:30:51.857 +07:00 [INF] Executed DbCommand (41ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 10:30:52.079 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 10:30:52.179 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 10:30:52.191 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 10:30:52.192 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 10:30:52.192 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 10:30:52.192 +07:00 [INF] Hosting environment: Development
2025-05-22 10:30:52.192 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 10:30:59.828 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 10:30:59.857 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:30:59.872 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 45.2824ms
2025-05-22 10:30:59.876 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:30:59.878 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:30:59.913 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:30:59.914 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 10:30:59.991 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:31:00.020 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:31:00.028 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 4.4276ms
2025-05-22 10:31:00.029 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:31:00.031 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method27(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:31:00.059 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 182.894ms
2025-05-22 10:31:00.067 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:31:00.068 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:31:00.070 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:31:00.073 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:31:00.073 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:31:00.074 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.7147ms
2025-05-22 10:31:00.075 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:31:00.075 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method27(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:31:00.077 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 10.6156ms
2025-05-22 10:31:00.084 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:31:00.084 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:31:00.084 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:31:00.087 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:31:00.088 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:31:00.089 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.7172ms
2025-05-22 10:31:00.089 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:31:00.090 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method27(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:31:00.092 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 8.399ms
2025-05-22 10:31:09.108 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 10:31:09.126 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:31:09.127 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:31:09.128 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:31:09.164 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 10:31:09.166 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:33:18.421 +07:00 [INF] Executed DbCommand (40ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 10:33:18.655 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 10:33:18.736 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 10:33:18.747 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 10:33:18.748 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 10:33:18.748 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 10:33:18.748 +07:00 [INF] Hosting environment: Development
2025-05-22 10:33:18.748 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 10:33:22.785 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 10:33:22.877 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 10:33:22.945 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:33:23.228 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 10:33:23.230 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:33:23.232 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:33:23.240 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:33:29.458 +07:00 [INF] Handling message from user 3: a
2025-05-22 10:33:29.524 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 10:33:29.525 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:33:29.530 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 5.5485ms
2025-05-22 10:33:29.533 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:33:29.534 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:33:29.535 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:33:29.538 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:33:29.562 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:33:29.568 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 2.9976ms
2025-05-22 10:33:29.569 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:33:29.571 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method27(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:33:29.601 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 67.2021ms
2025-05-22 10:33:29.601 +07:00 [INF] Executed DbCommand (32ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 10:33:29.616 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:33:29.617 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:33:29.618 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:33:29.618 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:33:29.618 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:33:29.619 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.7691ms
2025-05-22 10:33:29.620 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:33:29.621 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method27(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:33:29.624 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 7.9036ms
2025-05-22 10:33:29.630 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:33:29.631 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:33:29.631 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:33:29.632 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:33:29.632 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:33:29.633 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.6696ms
2025-05-22 10:33:29.633 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:33:29.634 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Unable to resolve service for type 'server.Services.IFcmService' while attempting to activate 'FcmBackend.Controllers.NotificationController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method27(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:33:29.636 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 5.1947ms
2025-05-22 10:33:29.787 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:33:29.798 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 10:33:29.813 +07:00 [INF] Message saved to DB with ID: 351
2025-05-22 10:33:29.817 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:33:29.821 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 10:33:29.830 +07:00 [INF] Transaction committed for message: 351
2025-05-22 10:33:29.848 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:33:29.866 +07:00 [INF] Saved message 351 to Redis
2025-05-22 10:33:29.867 +07:00 [INF] Added message 351 to conversation 45
2025-05-22 10:33:29.886 +07:00 [INF] Published message to channel conversation:45
2025-05-22 10:36:59.189 +07:00 [INF] Executed DbCommand (41ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 10:36:59.312 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 10:36:59.414 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 10:36:59.424 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 10:36:59.424 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 10:36:59.425 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 10:36:59.425 +07:00 [INF] Hosting environment: Development
2025-05-22 10:36:59.425 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 10:36:59.677 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 10:36:59.718 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 10:36:59.734 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:36:59.993 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 10:36:59.995 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:36:59.996 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:36:59.997 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:37:15.992 +07:00 [INF] Handling message from user 3: a
2025-05-22 10:37:16.042 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 10:37:16.043 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:37:16.045 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 2.92ms
2025-05-22 10:37:16.047 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:37:16.048 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:37:16.049 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:37:16.050 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:37:16.064 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:37:16.079 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 10:37:16.222 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:37:16.234 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 10:37:16.249 +07:00 [INF] Message saved to DB with ID: 352
2025-05-22 10:37:16.252 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:37:16.258 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 10:37:16.264 +07:00 [INF] Transaction committed for message: 352
2025-05-22 10:37:16.280 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:37:16.290 +07:00 [INF] Saved message 352 to Redis
2025-05-22 10:37:16.291 +07:00 [INF] Added message 352 to conversation 45
2025-05-22 10:37:16.306 +07:00 [INF] Published message to channel conversation:45
2025-05-22 10:37:17.784 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 10:37:17.786 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 1719.7588ms
2025-05-22 10:37:17.786 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:37:17.786 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 1738.9415ms
2025-05-22 10:37:17.794 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:37:17.794 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:37:17.796 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:37:17.797 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:37:17.798 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:37:17.803 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 10:37:17.803 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 5.2927ms
2025-05-22 10:37:17.803 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:37:17.804 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 10.1636ms
2025-05-22 10:37:17.811 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:37:17.811 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:37:17.811 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:37:17.811 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:37:17.812 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:37:17.813 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 10:37:17.814 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 2.0676ms
2025-05-22 10:37:17.814 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:37:17.814 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 3.2786ms
2025-05-22 10:38:09.811 +07:00 [INF] Application is shutting down...
2025-05-22 10:38:39.823 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 10:38:39.823 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 10:38:39.827 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 99834.0587ms
2025-05-22 10:38:39.827 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 100152.7076ms
2025-05-22 10:39:32.622 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 10:39:32.745 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 10:39:32.784 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 10:39:32.792 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 10:39:32.792 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 10:39:32.792 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 10:39:32.792 +07:00 [INF] Hosting environment: Development
2025-05-22 10:39:32.792 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 10:39:34.211 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 10:39:34.246 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 10:39:34.260 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:39:36.569 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 10:39:36.571 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:39:36.573 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:39:36.575 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:39:44.649 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 10:39:44.653 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 10:39:44.694 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 10:39:44.703 +07:00 [ERR] Connection id "0HNCOS92DRTTN", Request id "0HNCOS92DRTTN:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 92
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 10:39:44.719 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 10508.174ms
2025-05-22 10:39:52.492 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 10:39:52.493 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 15924.3139ms
2025-05-22 10:41:10.485 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-22 10:41:10.489 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:10.493 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 7.716ms
2025-05-22 10:41:10.497 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-22 10:41:10.498 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:10.500 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:10.506 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:41:10.541 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 10:41:10.819 +07:00 [INF] Executed DbCommand (55ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 10:41:10.904 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 10:41:10.940 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 396.5607ms
2025-05-22 10:41:10.940 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:41:10.944 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 447.1383ms
2025-05-22 10:41:10.961 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 10:41:10.962 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:10.962 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:10.963 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:41:11.087 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 10:41:11.088 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:11.090 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:11.090 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:41:11.097 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 10:41:11.266 +07:00 [INF] Executed DbCommand (39ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 10:41:11.268 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 10:41:11.278 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 181.2977ms
2025-05-22 10:41:11.278 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:41:11.279 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 191.7151ms
2025-05-22 10:41:11.289 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 10:41:11.290 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:11.290 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.714ms
2025-05-22 10:41:11.293 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 10:41:11.293 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:11.294 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:11.294 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:41:11.298 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 10:41:11.298 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:41:11.321 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-22 10:41:11.323 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-22 10:41:11.324 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-22 10:41:11.325 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-22 10:41:11.326 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-22 10:41:11.326 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-22 10:41:11.327 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-22 10:41:11.327 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-22 10:41:11.328 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-22 10:41:11.329 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-22 10:41:11.329 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-22 10:41:11.330 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-22 10:41:11.330 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-22 10:41:11.331 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-22 10:41:11.331 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-22 10:41:11.332 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-22 10:41:11.333 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-22 10:41:11.334 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-22 10:41:11.335 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-22 10:41:11.336 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-22 10:41:11.337 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-22 10:41:11.408 +07:00 [INF] Executed DbCommand (40ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 10:41:11.458 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 10:41:11.474 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 175.6299ms
2025-05-22 10:41:11.474 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:41:11.475 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 182.0208ms
2025-05-22 10:41:19.664 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - application/json 169
2025-05-22 10:41:19.670 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - 404 0 null 6.3934ms
2025-05-22 10:41:19.671 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://192.168.1.5:5053/api/Notification/token, Response status code: 404
2025-05-22 10:41:37.471 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - application/json 58
2025-05-22 10:41:37.474 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:41:37.474 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 10:41:37.488 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 10:41:37.489 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 10:41:37.489 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 15.0268ms
2025-05-22 10:41:37.489 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 10:41:37.490 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - 200 null application/json; charset=utf-8 18.3226ms
2025-05-22 10:41:38.566 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 10:41:38.567 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:41:38.569 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - null null
2025-05-22 10:41:38.572 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:41:38.572 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 10:41:38.591 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 10:41:38.596 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 10:41:38.597 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 24.9964ms
2025-05-22 10:41:38.597 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 10:41:38.597 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 27.7179ms
2025-05-22 10:41:38.777 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:41:38.779 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-22 10:41:38.780 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-22 10:41:38.782 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-22 10:41:38.782 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-22 10:41:38.783 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-22 10:41:38.783 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-22 10:41:38.783 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-22 10:41:38.784 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-22 10:41:38.786 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-22 10:41:38.787 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-22 10:41:38.788 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-22 10:41:38.789 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-22 10:41:38.789 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-22 10:41:38.789 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-22 10:41:38.789 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-22 10:41:38.790 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-22 10:41:38.790 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-22 10:41:38.791 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-22 10:41:38.791 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-22 10:41:38.792 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-22 10:41:38.792 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-22 10:41:38.792 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-22 10:41:38.792 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-22 10:41:39.276 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - null null
2025-05-22 10:41:39.278 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:41:39.278 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 10:41:39.297 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 10:41:39.310 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 10:41:39.314 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 35.7465ms
2025-05-22 10:41:39.314 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 10:41:39.314 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 37.9398ms
2025-05-22 10:41:49.220 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 10:41:49.221 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:49.221 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - 204 null null 0.569ms
2025-05-22 10:41:49.223 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 10:41:49.223 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:49.224 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:49.224 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 10:41:49.230 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 10:41:49.283 +07:00 [INF] Retrieved 10 messages from Redis for conversation 45
2025-05-22 10:41:49.285 +07:00 [INF] Retrieved 10 messages from Redis for conversation 45 and user 3
2025-05-22 10:41:49.285 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 10:41:49.288 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 58.5793ms
2025-05-22 10:41:49.289 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 10:41:49.289 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - 200 null application/json; charset=utf-8 65.669ms
2025-05-22 10:41:49.296 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 10:41:49.296 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:49.296 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - 204 null null 0.2475ms
2025-05-22 10:41:49.297 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 10:41:49.297 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:49.297 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:49.297 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 10:41:49.301 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 10:41:49.348 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 10:41:49.382 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 10:41:49.385 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 84.4805ms
2025-05-22 10:41:49.385 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 10:41:49.386 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 88.4199ms
2025-05-22 10:41:49.392 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 10:41:49.392 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:49.393 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.3518ms
2025-05-22 10:41:49.394 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 10:41:49.394 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:49.394 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:49.394 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 10:41:49.397 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 10:41:49.409 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 10:41:49.413 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 10:41:49.416 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 19.0797ms
2025-05-22 10:41:49.416 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 10:41:49.416 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 22.4651ms
2025-05-22 10:41:53.554 +07:00 [INF] Handling message from user 3: m
2025-05-22 10:41:53.582 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 10:41:53.666 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 10:41:53.666 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:53.667 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.4679ms
2025-05-22 10:41:53.668 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:41:53.669 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:53.669 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:53.669 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:41:53.673 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:41:53.732 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:41:53.777 +07:00 [INF] Executed DbCommand (39ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 10:41:53.792 +07:00 [INF] Message saved to DB with ID: 353
2025-05-22 10:41:53.795 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:41:53.807 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 10:41:53.815 +07:00 [INF] Transaction committed for message: 353
2025-05-22 10:41:53.820 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:41:53.826 +07:00 [INF] Saved message 353 to Redis
2025-05-22 10:41:53.828 +07:00 [INF] Added message 353 to conversation 45
2025-05-22 10:41:53.833 +07:00 [INF] Published message to channel conversation:45
2025-05-22 10:41:54.092 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 10:41:54.093 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 420.0856ms
2025-05-22 10:41:54.093 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:41:54.093 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 424.6529ms
2025-05-22 10:41:54.101 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:41:54.101 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:54.101 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:54.102 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:41:54.103 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:41:54.106 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 10:41:54.107 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 4.0015ms
2025-05-22 10:41:54.107 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:41:54.107 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 6.5357ms
2025-05-22 10:41:54.118 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 10:41:54.119 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:54.119 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:41:54.120 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:41:54.120 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:41:54.122 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 10:41:54.122 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 1.8798ms
2025-05-22 10:41:54.122 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:41:54.123 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 4.7247ms
2025-05-22 10:43:36.434 +07:00 [INF] Handling message from user 3: ac
2025-05-22 10:43:36.450 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 10:43:36.456 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:43:36.469 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 10:43:36.470 +07:00 [INF] Message saved to DB with ID: 354
2025-05-22 10:43:36.471 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:43:36.478 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 10:43:36.479 +07:00 [INF] Transaction committed for message: 354
2025-05-22 10:43:36.486 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:43:36.488 +07:00 [INF] Saved message 354 to Redis
2025-05-22 10:43:36.489 +07:00 [INF] Added message 354 to conversation 45
2025-05-22 10:43:36.491 +07:00 [INF] Published message to channel conversation:45
2025-05-22 10:43:36.610 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 10:43:36.610 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:43:36.610 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.316ms
2025-05-22 10:43:36.611 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 10:43:36.611 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:43:36.612 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:43:36.612 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:43:36.614 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:43:36.617 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 10:43:36.618 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 3.3735ms
2025-05-22 10:43:36.618 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:43:36.618 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 6.4317ms
2025-05-22 10:43:36.648 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 10:43:36.648 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:43:36.656 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:43:36.656 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:43:36.656 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:43:36.658 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 10:43:36.659 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 2.4989ms
2025-05-22 10:43:36.659 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:43:36.659 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 10.8272ms
2025-05-22 10:43:36.673 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 10:43:36.673 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:43:36.673 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:43:36.673 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:43:36.673 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:43:36.674 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 10:43:36.674 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.8537ms
2025-05-22 10:43:36.674 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:43:36.674 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 1.9195ms
2025-05-22 10:54:14.249 +07:00 [INF] Application is shutting down...
2025-05-22 10:54:44.271 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 10:54:44.271 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 10:54:44.272 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 785705.5833ms
2025-05-22 10:54:44.272 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 813310.8136ms
2025-05-22 10:54:49.784 +07:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 10:54:49.911 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 10:54:49.970 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 10:54:49.979 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 10:54:49.980 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 10:54:49.980 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 10:54:49.980 +07:00 [INF] Hosting environment: Development
2025-05-22 10:54:49.980 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 10:54:50.150 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 10:54:50.172 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:54:50.202 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:54:50.203 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 10:54:50.236 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:54:50.369 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 10:54:50.372 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 10:54:57.767 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 10:54:57.767 +07:00 [INF] Handling message from user 3: as
2025-05-22 10:54:57.768 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:54:57.772 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 3.9039ms
2025-05-22 10:54:57.785 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 10:54:57.786 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:54:57.797 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:54:57.801 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:54:57.843 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:54:57.976 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 10:54:58.339 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:54:58.357 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 10:54:58.395 +07:00 [INF] Message saved to DB with ID: 355
2025-05-22 10:54:58.400 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 10:54:58.409 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 10:54:58.430 +07:00 [INF] Transaction committed for message: 355
2025-05-22 10:54:58.468 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 10:54:58.488 +07:00 [INF] Saved message 355 to Redis
2025-05-22 10:54:58.488 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 10:54:58.493 +07:00 [INF] Added message 355 to conversation 45
2025-05-22 10:54:58.495 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 647.7796ms
2025-05-22 10:54:58.496 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:54:58.497 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 711.953ms
2025-05-22 10:54:58.506 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 10:54:58.508 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:54:58.510 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:54:58.511 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:54:58.511 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:54:58.519 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 10:54:58.521 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 9.1003ms
2025-05-22 10:54:58.525 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:54:58.529 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 20.6755ms
2025-05-22 10:54:58.536 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 10:54:58.536 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:54:58.536 +07:00 [INF] CORS policy execution successful.
2025-05-22 10:54:58.541 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:54:58.543 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 10:54:58.549 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 10:54:58.550 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 5.9141ms
2025-05-22 10:54:58.550 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 10:54:58.550 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 14.7538ms
2025-05-22 10:54:58.562 +07:00 [INF] Published message to channel conversation:45
2025-05-22 11:17:21.205 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 11:17:21.207 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 103
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 11:17:21.311 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 11:17:21.321 +07:00 [ERR] Connection id "0HNCOSHJCTP1O", Request id "0HNCOSHJCTP1O:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 103
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 11:17:21.350 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 1350980.627ms
2025-05-22 11:47:19.482 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 11:47:19.482 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 11:50:19.683 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 11:50:19.683 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 103
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 11:50:19.691 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 11:50:19.691 +07:00 [ERR] Connection id "0HNCOSHJCTP1Q", Request id "0HNCOSHJCTP1Q:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 103
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 11:50:19.694 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 180212.4229ms
2025-05-22 12:01:58.426 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 12:01:58.427 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 103
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 12:01:58.429 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 12:01:58.430 +07:00 [ERR] Connection id "0HNCOSHJCTP1N", Request id "0HNCOSHJCTP1N:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 103
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 12:01:58.434 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 4028285.904ms
2025-05-22 12:50:00.614 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 12:50:00.614 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 12:52:58.199 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 12:52:58.199 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 12:52:58.201 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 12:52:58.201 +07:00 [ERR] Connection id "0HNCOSHJCTP1R", Request id "0HNCOSHJCTP1R:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client)
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 12:52:58.203 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 177589.0644ms
2025-05-22 12:53:49.510 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-22 12:53:49.518 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:53:49.522 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 11.8377ms
2025-05-22 12:53:49.527 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-22 12:53:49.528 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:53:49.531 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:53:49.536 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 12:53:49.574 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 12:53:50.009 +07:00 [INF] Executed DbCommand (39ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 12:53:50.073 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 12:53:50.103 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 528.0613ms
2025-05-22 12:53:50.103 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 12:53:50.109 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 582.1372ms
2025-05-22 12:53:50.125 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 12:53:50.126 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:53:50.127 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:53:50.127 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 12:53:50.170 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 12:53:50.193 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-22 12:53:50.193 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-22 12:53:50.194 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-22 12:53:50.195 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-22 12:53:50.195 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-22 12:53:50.196 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-22 12:53:50.196 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-22 12:53:50.197 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-22 12:53:50.198 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-22 12:53:50.200 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-22 12:53:50.201 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-22 12:53:50.201 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-22 12:53:50.202 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-22 12:53:50.202 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-22 12:53:50.202 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-22 12:53:50.203 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-22 12:53:50.203 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-22 12:53:50.203 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-22 12:53:50.203 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-22 12:53:50.204 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-22 12:53:50.205 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-22 12:53:50.282 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 12:53:50.283 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:53:50.285 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:53:50.285 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 12:53:50.289 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 12:53:50.381 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 12:53:50.383 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 12:53:50.394 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 104.339ms
2025-05-22 12:53:50.394 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 12:53:50.394 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 111.9378ms
2025-05-22 12:53:50.535 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 12:53:50.535 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:53:50.535 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3155ms
2025-05-22 12:53:50.536 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 12:53:50.536 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:53:50.536 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:53:50.536 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 12:53:50.540 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 12:53:50.651 +07:00 [INF] Executed DbCommand (29ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 12:53:50.669 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 12:53:50.688 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 147.8957ms
2025-05-22 12:53:50.688 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 12:53:50.688 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 152.439ms
2025-05-22 12:53:56.197 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - application/json 169
2025-05-22 12:53:56.205 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - 404 0 null 7.2577ms
2025-05-22 12:53:56.209 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://192.168.1.5:5053/api/Notification/token, Response status code: 404
2025-05-22 12:54:36.606 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - application/json 169
2025-05-22 12:54:36.608 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - 404 0 null 1.9054ms
2025-05-22 12:54:36.608 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://192.168.1.5:5053/api/Notification/token, Response status code: 404
2025-05-22 12:54:36.609 +07:00 [INF] Connection id "0HNCOSHJCTP1V", Request id "0HNCOSHJCTP1V:00000001": the application completed without reading the entire request body.
2025-05-22 12:55:02.346 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - application/json 58
2025-05-22 12:55:02.357 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 12:55:02.357 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 12:55:02.421 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 12:55:02.422 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 12:55:02.422 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 65.2126ms
2025-05-22 12:55:02.423 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 12:55:02.423 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - 200 null application/json; charset=utf-8 76.2675ms
2025-05-22 12:55:02.939 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 12:55:02.942 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 12:55:03.715 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - null null
2025-05-22 12:55:03.718 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 12:55:03.719 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 12:55:03.725 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 12:55:03.726 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-22 12:55:03.727 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-22 12:55:03.733 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-22 12:55:03.733 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-22 12:55:03.733 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-22 12:55:03.733 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-22 12:55:03.733 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-22 12:55:03.733 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-22 12:55:03.733 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-22 12:55:03.733 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-22 12:55:03.737 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-22 12:55:03.737 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-22 12:55:03.738 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-22 12:55:03.738 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-22 12:55:03.739 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-22 12:55:03.739 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-22 12:55:03.739 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-22 12:55:03.740 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-22 12:55:03.740 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-22 12:55:03.740 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-22 12:55:03.740 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-22 12:55:03.741 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-22 12:55:03.741 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-22 12:55:03.757 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 12:55:03.761 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 12:55:03.762 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 42.7857ms
2025-05-22 12:55:03.762 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 12:55:03.762 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 47.1969ms
2025-05-22 12:55:03.941 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - null null
2025-05-22 12:55:03.942 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 12:55:03.942 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 12:55:03.961 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 12:55:03.971 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 12:55:03.973 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 30.7338ms
2025-05-22 12:55:03.973 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 12:55:03.973 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 32.6954ms
2025-05-22 12:55:07.776 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 12:55:07.777 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:07.777 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - 204 null null 0.4513ms
2025-05-22 12:55:07.778 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 12:55:07.778 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:07.778 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:07.779 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 12:55:07.782 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 12:55:07.868 +07:00 [INF] Retrieved 13 messages from Redis for conversation 45
2025-05-22 12:55:07.872 +07:00 [INF] Retrieved 13 messages from Redis for conversation 45 and user 3
2025-05-22 12:55:07.872 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 12:55:07.875 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 92.194ms
2025-05-22 12:55:07.875 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 12:55:07.875 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - 200 null application/json; charset=utf-8 96.6968ms
2025-05-22 12:55:07.887 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 12:55:07.887 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:07.887 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - 204 null null 0.239ms
2025-05-22 12:55:07.888 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 12:55:07.889 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:07.889 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:07.889 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 12:55:07.892 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 12:55:07.938 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 12:55:07.956 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 12:55:07.959 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 67.3951ms
2025-05-22 12:55:07.959 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 12:55:07.960 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 71.2104ms
2025-05-22 12:55:07.970 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 12:55:07.970 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:07.970 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.2582ms
2025-05-22 12:55:07.972 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 12:55:07.972 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:07.972 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:07.972 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 12:55:07.976 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 12:55:07.988 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 12:55:07.990 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 12:55:07.993 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 17.6279ms
2025-05-22 12:55:07.994 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 12:55:07.994 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 22.081ms
2025-05-22 12:55:17.963 +07:00 [INF] Handling message from user 3: m
2025-05-22 12:55:17.980 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 12:55:18.002 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 12:55:18.047 +07:00 [INF] Executed DbCommand (45ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 12:55:18.049 +07:00 [INF] Message saved to DB with ID: 356
2025-05-22 12:55:18.051 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 12:55:18.063 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 12:55:18.064 +07:00 [INF] Transaction committed for message: 356
2025-05-22 12:55:18.071 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 12:55:18.075 +07:00 [INF] Saved message 356 to Redis
2025-05-22 12:55:18.076 +07:00 [INF] Added message 356 to conversation 45
2025-05-22 12:55:18.080 +07:00 [INF] Published message to channel conversation:45
2025-05-22 12:55:18.085 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 12:55:18.085 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:18.086 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.4592ms
2025-05-22 12:55:18.088 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 12:55:18.088 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:18.088 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:18.089 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 12:55:18.092 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 12:55:18.108 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 12:55:18.108 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 15.7987ms
2025-05-22 12:55:18.108 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 12:55:18.108 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 20.3635ms
2025-05-22 12:55:18.225 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 12:55:18.226 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:18.226 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:18.226 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 12:55:18.226 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 12:55:18.227 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 12:55:18.227 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.7265ms
2025-05-22 12:55:18.227 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 12:55:18.227 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 1.437ms
2025-05-22 12:55:18.247 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 12:55:18.247 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:18.247 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:55:18.248 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 12:55:18.248 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 12:55:18.254 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 12:55:18.261 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 13.0009ms
2025-05-22 12:55:18.261 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 12:55:18.261 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 14.1774ms
2025-05-22 12:56:18.623 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 12:56:18.941 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 12:56:19.021 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 12:56:19.029 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 12:56:19.029 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 12:56:19.030 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 12:56:19.030 +07:00 [INF] Hosting environment: Development
2025-05-22 12:56:19.030 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 12:56:21.144 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 12:56:21.239 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 12:56:21.291 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 12:56:22.321 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 12:56:22.324 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:56:22.326 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:56:22.328 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 12:56:47.395 +07:00 [INF] Handling message from user 3: t
2025-05-22 12:56:47.454 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 12:56:47.455 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:56:47.458 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 3.0403ms
2025-05-22 12:56:47.461 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 12:56:47.462 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:56:47.463 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:56:47.465 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 12:56:47.485 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 12:56:47.508 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 12:56:47.672 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 12:56:47.685 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 12:56:47.704 +07:00 [INF] Message saved to DB with ID: 357
2025-05-22 12:56:47.708 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 12:56:47.713 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 12:56:47.724 +07:00 [INF] Transaction committed for message: 357
2025-05-22 12:56:47.752 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 12:56:47.770 +07:00 [INF] Saved message 357 to Redis
2025-05-22 12:56:47.772 +07:00 [INF] Added message 357 to conversation 45
2025-05-22 12:56:47.798 +07:00 [INF] Published message to channel conversation:45
2025-05-22 12:56:48.535 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 12:56:48.539 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 1050.647ms
2025-05-22 12:56:48.539 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 12:56:48.539 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 1078.0877ms
2025-05-22 12:56:48.545 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 12:56:48.546 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:56:48.549 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:56:48.549 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 12:56:48.550 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 12:56:48.555 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 12:56:48.555 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 4.9819ms
2025-05-22 12:56:48.556 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 12:56:48.556 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 10.3088ms
2025-05-22 12:56:48.563 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 12:56:48.564 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:56:48.573 +07:00 [INF] CORS policy execution successful.
2025-05-22 12:56:48.574 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 12:56:48.575 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 12:56:48.582 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 12:56:48.583 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 5.0388ms
2025-05-22 12:56:48.583 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 12:56:48.583 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 19.7781ms
2025-05-22 12:59:57.069 +07:00 [INF] Application is shutting down...
2025-05-22 13:00:27.092 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 13:00:27.092 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 13:00:27.096 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 245955.5539ms
2025-05-22 13:00:27.096 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 244775.478ms
2025-05-22 13:00:42.532 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 13:00:42.639 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 13:00:42.684 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 13:00:42.691 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 13:00:42.692 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 13:00:42.692 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 13:00:42.692 +07:00 [INF] Hosting environment: Development
2025-05-22 13:00:42.692 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 13:00:46.850 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 13:00:46.865 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:00:46.887 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:00:46.888 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 13:00:46.905 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 13:00:47.417 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 13:00:47.420 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 13:01:08.837 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 13:01:08.844 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 102
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 13:01:08.904 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 13:01:08.916 +07:00 [ERR] Connection id "0HNCOUNVF892K", Request id "0HNCOUNVF892K:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 220
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 203
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 102
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 13:01:08.933 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 21515.1131ms
2025-05-22 13:01:17.339 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 13:01:17.339 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 30490.0485ms
2025-05-22 13:02:07.295 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - application/json 169
2025-05-22 13:02:07.333 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - 404 0 null 40.3561ms
2025-05-22 13:02:07.336 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://192.168.1.5:5053/api/Notification/token, Response status code: 404
2025-05-22 13:02:23.775 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - application/json 58
2025-05-22 13:02:23.801 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 13:02:23.841 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 13:02:24.165 +07:00 [INF] Executed DbCommand (82ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 13:02:24.255 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 13:02:24.295 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 451.384ms
2025-05-22 13:02:24.295 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 13:02:24.301 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - 200 null application/json; charset=utf-8 526.0596ms
2025-05-22 13:02:25.569 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 13:02:25.573 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 13:02:25.575 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - null null
2025-05-22 13:02:25.578 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 13:02:25.594 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 13:02:25.646 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - null null
2025-05-22 13:02:25.646 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 13:02:25.650 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 13:02:25.712 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:02:25.731 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-22 13:02:25.732 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-22 13:02:25.732 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-22 13:02:25.733 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-22 13:02:25.733 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-22 13:02:25.734 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-22 13:02:25.735 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-22 13:02:25.735 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-22 13:02:25.736 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-22 13:02:25.737 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-22 13:02:25.737 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-22 13:02:25.738 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-22 13:02:25.739 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-22 13:02:25.739 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 13:02:25.739 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-22 13:02:25.740 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-22 13:02:25.741 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-22 13:02:25.741 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-22 13:02:25.741 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-22 13:02:25.742 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-22 13:02:25.742 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-22 13:02:25.743 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-22 13:02:25.743 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-22 13:02:25.744 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-22 13:02:25.746 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 13:02:25.759 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 164.3097ms
2025-05-22 13:02:25.759 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 13:02:25.759 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 184.3106ms
2025-05-22 13:02:25.788 +07:00 [INF] Executed DbCommand (37ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 13:02:25.813 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 13:02:25.818 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 168.0823ms
2025-05-22 13:02:25.818 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 13:02:25.818 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 172.7625ms
2025-05-22 13:02:33.988 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-22 13:02:33.989 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:33.992 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 4.2736ms
2025-05-22 13:02:33.995 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-22 13:02:33.995 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:33.997 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:33.997 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 13:02:33.997 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 13:02:34.006 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 13:02:34.008 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 13:02:34.009 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 11.0957ms
2025-05-22 13:02:34.009 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 13:02:34.009 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 14.014ms
2025-05-22 13:02:34.035 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 13:02:34.036 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:34.036 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:34.036 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 13:02:34.163 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 13:02:34.164 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:34.165 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:34.166 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 13:02:34.166 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 13:02:34.171 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 13:02:34.172 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 13:02:34.173 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 7.0175ms
2025-05-22 13:02:34.173 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 13:02:34.173 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 10.0602ms
2025-05-22 13:02:34.311 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:02:34.312 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-22 13:02:34.313 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-22 13:02:34.314 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-22 13:02:34.314 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-22 13:02:34.314 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-22 13:02:34.314 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-22 13:02:34.314 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-22 13:02:34.314 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-22 13:02:34.314 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-22 13:02:34.314 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-22 13:02:34.314 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-22 13:02:34.314 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-22 13:02:34.314 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-22 13:02:34.315 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-22 13:02:34.315 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-22 13:02:34.316 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-22 13:02:34.316 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-22 13:02:34.316 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-22 13:02:34.316 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-22 13:02:34.316 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-22 13:02:34.316 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-22 13:02:34.401 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 13:02:34.401 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:34.401 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.4184ms
2025-05-22 13:02:34.402 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 13:02:34.403 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:34.404 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:34.404 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 13:02:34.405 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 13:02:34.409 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 13:02:34.428 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 13:02:34.442 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 37.0457ms
2025-05-22 13:02:34.442 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 13:02:34.442 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 39.8202ms
2025-05-22 13:02:37.839 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 13:02:37.839 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:37.839 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - 204 null null 0.5505ms
2025-05-22 13:02:37.841 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 13:02:37.841 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:37.841 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:37.841 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 13:02:37.845 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 13:02:37.888 +07:00 [INF] Retrieved 15 messages from Redis for conversation 45
2025-05-22 13:02:37.890 +07:00 [INF] Retrieved 15 messages from Redis for conversation 45 and user 3
2025-05-22 13:02:37.891 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 13:02:37.893 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 47.6245ms
2025-05-22 13:02:37.893 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 13:02:37.893 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - 200 null application/json; charset=utf-8 52.1915ms
2025-05-22 13:02:37.903 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 13:02:37.903 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:37.903 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - 204 null null 0.4628ms
2025-05-22 13:02:37.905 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 13:02:37.905 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:37.905 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:37.905 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 13:02:37.907 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 13:02:37.956 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 13:02:37.990 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 13:02:37.992 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 84.621ms
2025-05-22 13:02:37.992 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 13:02:37.992 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 87.7753ms
2025-05-22 13:02:38.000 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 13:02:38.000 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:38.000 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.2783ms
2025-05-22 13:02:38.002 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 13:02:38.002 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:38.002 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:38.002 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 13:02:38.006 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 13:02:38.016 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 13:02:38.020 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 13:02:38.021 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 15.5164ms
2025-05-22 13:02:38.021 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 13:02:38.022 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 20.0272ms
2025-05-22 13:02:45.229 +07:00 [INF] Handling message from user 3: sấ
2025-05-22 13:02:45.258 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 13:02:45.327 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 13:02:45.327 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:45.328 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.6248ms
2025-05-22 13:02:45.329 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 67
2025-05-22 13:02:45.329 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:45.331 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:45.331 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:02:45.334 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:02:45.405 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:02:45.446 +07:00 [INF] Executed DbCommand (39ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 13:02:45.462 +07:00 [INF] Message saved to DB with ID: 358
2025-05-22 13:02:45.465 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:02:45.478 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 13:02:45.488 +07:00 [INF] Transaction committed for message: 358
2025-05-22 13:02:45.495 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:02:45.501 +07:00 [INF] Saved message 358 to Redis
2025-05-22 13:02:45.503 +07:00 [INF] Added message 358 to conversation 45
2025-05-22 13:02:45.513 +07:00 [INF] Published message to channel conversation:45
2025-05-22 13:02:45.735 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:02:45.736 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 401.9325ms
2025-05-22 13:02:45.736 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:02:45.736 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 407.0138ms
2025-05-22 13:02:45.762 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 67
2025-05-22 13:02:45.763 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:45.763 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:45.764 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:02:45.764 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:02:45.768 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:02:45.769 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 4.1248ms
2025-05-22 13:02:45.769 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:02:45.769 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 6.7742ms
2025-05-22 13:02:45.778 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 67
2025-05-22 13:02:45.778 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:45.778 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:02:45.778 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:02:45.779 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:02:45.782 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:02:45.782 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 2.8043ms
2025-05-22 13:02:45.782 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:02:45.782 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 4.4436ms
2025-05-22 13:04:44.440 +07:00 [INF] Application is shutting down...
2025-05-22 13:05:14.457 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 13:05:14.457 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 13:05:14.459 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 168889.3915ms
2025-05-22 13:05:14.459 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 160423.4047ms
2025-05-22 13:05:24.485 +07:00 [INF] Executed DbCommand (46ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 13:05:24.727 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 13:05:24.809 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 13:05:24.824 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 13:05:24.825 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 13:05:24.826 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 13:05:24.828 +07:00 [INF] Hosting environment: Development
2025-05-22 13:05:24.829 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 13:05:26.869 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 13:05:26.894 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:05:26.923 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:05:26.925 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 13:05:26.950 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 13:05:29.629 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 13:05:29.635 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 13:05:33.581 +07:00 [INF] Handling message from user 3: ầ
2025-05-22 13:05:33.652 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 13:05:33.655 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:05:33.658 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 6.3958ms
2025-05-22 13:05:33.664 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 13:05:33.667 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:05:33.670 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:05:33.674 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:05:33.675 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 13:05:33.714 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:05:33.894 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:05:33.908 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 13:05:33.924 +07:00 [INF] Message saved to DB with ID: 359
2025-05-22 13:05:33.929 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:05:33.937 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 13:05:33.945 +07:00 [INF] Transaction committed for message: 359
2025-05-22 13:05:33.963 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:05:33.975 +07:00 [INF] Saved message 359 to Redis
2025-05-22 13:05:33.977 +07:00 [INF] Added message 359 to conversation 45
2025-05-22 13:05:33.996 +07:00 [INF] Published message to channel conversation:45
2025-05-22 13:05:35.405 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:05:35.410 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 1687.555ms
2025-05-22 13:05:35.413 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:05:35.415 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 1751.2755ms
2025-05-22 13:05:35.435 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 13:05:35.438 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:05:35.442 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:05:35.443 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:05:35.444 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:05:35.697 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:05:35.700 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 255.0263ms
2025-05-22 13:05:35.703 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:05:35.704 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 269.2354ms
2025-05-22 13:05:35.716 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 13:05:35.724 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:05:35.725 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:05:35.726 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:05:35.728 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:05:36.152 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:05:36.154 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 423.8641ms
2025-05-22 13:05:36.155 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:05:36.157 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 441.4653ms
2025-05-22 13:32:36.155 +07:00 [INF] Application is shutting down...
2025-05-22 13:43:49.009 +07:00 [INF] Executed DbCommand (65ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 13:43:49.168 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 13:43:49.250 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 13:43:49.262 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 13:43:49.262 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 13:43:49.263 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 13:43:49.263 +07:00 [INF] Hosting environment: Development
2025-05-22 13:43:49.263 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 13:44:22.517 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - application/json 169
2025-05-22 13:44:22.640 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 13:44:22.696 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - 404 0 null 183.2377ms
2025-05-22 13:44:22.699 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://192.168.1.5:5053/api/Notification/token, Response status code: 404
2025-05-22 13:44:36.862 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-22 13:44:36.865 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:36.871 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 8.6266ms
2025-05-22 13:44:36.873 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-22 13:44:36.874 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:36.877 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:36.882 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 13:44:36.917 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 13:44:37.085 +07:00 [INF] Executed DbCommand (53ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 13:44:37.170 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 13:44:37.224 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 303.7464ms
2025-05-22 13:44:37.225 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 13:44:37.228 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 355.0162ms
2025-05-22 13:44:37.249 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 13:44:37.251 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:37.251 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:37.254 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 13:44:37.367 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 13:44:37.367 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:37.368 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:37.368 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 13:44:37.373 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 13:44:37.518 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 13:44:37.521 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 13:44:37.535 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 161.162ms
2025-05-22 13:44:37.535 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 13:44:37.536 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 168.6897ms
2025-05-22 13:44:37.557 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 13:44:37.557 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:37.558 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.665ms
2025-05-22 13:44:37.559 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 13:44:37.559 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:37.560 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:37.560 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 13:44:37.573 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:44:37.574 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 13:44:37.601 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-22 13:44:37.602 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-22 13:44:37.603 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-22 13:44:37.604 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-22 13:44:37.605 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-22 13:44:37.605 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-22 13:44:37.607 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-22 13:44:37.607 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-22 13:44:37.608 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-22 13:44:37.609 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-22 13:44:37.610 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-22 13:44:37.610 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-22 13:44:37.611 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-22 13:44:37.611 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-22 13:44:37.612 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-22 13:44:37.613 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-22 13:44:37.614 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-22 13:44:37.614 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-22 13:44:37.615 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-22 13:44:37.616 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-22 13:44:37.617 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-22 13:44:37.673 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 13:44:37.687 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 13:44:37.702 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 127.7811ms
2025-05-22 13:44:37.702 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 13:44:37.702 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 142.8949ms
2025-05-22 13:44:54.780 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - application/json 58
2025-05-22 13:44:54.783 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 13:44:54.783 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 13:44:54.789 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 13:44:54.790 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 13:44:54.791 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 7.542ms
2025-05-22 13:44:54.791 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 13:44:54.791 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - 200 null application/json; charset=utf-8 11.3683ms
2025-05-22 13:44:55.935 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 13:44:55.936 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 13:44:55.939 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - null null
2025-05-22 13:44:55.941 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 13:44:55.941 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 13:44:55.961 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 13:44:55.967 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 13:44:55.968 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 26.3382ms
2025-05-22 13:44:55.968 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 13:44:55.968 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 28.799ms
2025-05-22 13:44:55.994 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:44:55.996 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-22 13:44:55.996 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-22 13:44:55.998 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-22 13:44:55.999 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-22 13:44:55.999 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-22 13:44:55.999 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-22 13:44:55.999 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-22 13:44:56.000 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-22 13:44:56.000 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-22 13:44:56.000 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-22 13:44:56.002 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-22 13:44:56.002 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-22 13:44:56.002 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-22 13:44:56.003 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-22 13:44:56.003 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-22 13:44:56.003 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-22 13:44:56.003 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-22 13:44:56.004 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-22 13:44:56.004 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-22 13:44:56.004 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-22 13:44:56.004 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-22 13:44:56.004 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-22 13:44:56.004 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-22 13:44:56.225 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - null null
2025-05-22 13:44:56.227 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 13:44:56.227 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 13:44:56.230 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 13:44:56.239 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 13:44:56.240 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 13.0808ms
2025-05-22 13:44:56.240 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 13:44:56.240 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 15.0509ms
2025-05-22 13:44:58.572 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 13:44:58.573 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:58.573 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - 204 null null 0.5976ms
2025-05-22 13:44:58.574 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 13:44:58.574 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:58.575 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:58.575 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 13:44:58.580 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 13:44:58.618 +07:00 [INF] Retrieved 17 messages from Redis for conversation 45
2025-05-22 13:44:58.620 +07:00 [INF] Retrieved 17 messages from Redis for conversation 45 and user 3
2025-05-22 13:44:58.620 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 13:44:58.623 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 43.1991ms
2025-05-22 13:44:58.623 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 13:44:58.623 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - 200 null application/json; charset=utf-8 49.0152ms
2025-05-22 13:44:58.633 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 13:44:58.633 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:58.633 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - 204 null null 0.3533ms
2025-05-22 13:44:58.634 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 13:44:58.635 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:58.635 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:58.635 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 13:44:58.639 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 13:44:58.681 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 13:44:58.714 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 13:44:58.717 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 77.9704ms
2025-05-22 13:44:58.717 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 13:44:58.717 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 82.6117ms
2025-05-22 13:44:58.724 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 13:44:58.724 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:58.725 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.5099ms
2025-05-22 13:44:58.726 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 13:44:58.726 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:58.726 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:44:58.726 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 13:44:58.729 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 13:44:58.739 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 13:44:58.742 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 13:44:58.744 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 14.8137ms
2025-05-22 13:44:58.744 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 13:44:58.744 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 18.2694ms
2025-05-22 13:45:04.748 +07:00 [INF] Handling message from user 3: mn
2025-05-22 13:45:04.776 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 13:45:04.883 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 13:45:04.883 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:45:04.884 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 1.922ms
2025-05-22 13:45:04.886 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 13:45:04.886 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:45:04.887 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:45:04.887 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:45:04.891 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:45:04.947 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:45:04.986 +07:00 [INF] Executed DbCommand (35ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 13:45:05.005 +07:00 [INF] Message saved to DB with ID: 360
2025-05-22 13:45:05.009 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:45:05.020 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 13:45:05.030 +07:00 [INF] Transaction committed for message: 360
2025-05-22 13:45:05.035 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:45:05.042 +07:00 [INF] Saved message 360 to Redis
2025-05-22 13:45:05.044 +07:00 [INF] Added message 360 to conversation 45
2025-05-22 13:45:05.053 +07:00 [INF] Published message to channel conversation:45
2025-05-22 13:45:05.288 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:45:05.289 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 397.4117ms
2025-05-22 13:45:05.289 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:45:05.289 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 403.299ms
2025-05-22 13:45:05.298 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 13:45:05.298 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:45:05.299 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:45:05.300 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:45:05.300 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:45:05.303 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:45:05.303 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 3.1299ms
2025-05-22 13:45:05.303 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:45:05.303 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 5.7022ms
2025-05-22 13:45:05.324 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 13:45:05.324 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:45:05.324 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:45:05.325 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:45:05.325 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:45:05.327 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:45:05.327 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 2.0711ms
2025-05-22 13:45:05.327 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:45:05.327 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 2.8568ms
2025-05-22 13:45:19.078 +07:00 [INF] Application is shutting down...
2025-05-22 13:45:49.097 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 13:45:49.097 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 13:45:49.098 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 71849.4017ms
2025-05-22 13:45:49.098 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 53163.1518ms
2025-05-22 13:46:32.116 +07:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 13:46:32.219 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 13:46:32.266 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 13:46:32.273 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 13:46:32.274 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 13:46:32.274 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 13:46:32.274 +07:00 [INF] Hosting environment: Development
2025-05-22 13:46:32.274 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 13:46:32.297 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 13:46:32.311 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:46:32.329 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:46:32.330 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 13:46:32.350 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 13:46:39.786 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 13:46:39.794 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 7498.1468ms
2025-05-22 13:47:39.342 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-22 13:47:39.345 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:47:39.408 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 65.4617ms
2025-05-22 13:47:39.410 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-22 13:47:39.411 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:47:39.413 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:47:39.416 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 13:47:39.448 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 13:47:39.605 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 13:47:39.694 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 13:47:39.738 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 286.8952ms
2025-05-22 13:47:39.738 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 13:47:39.741 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 330.5338ms
2025-05-22 13:47:39.761 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 13:47:39.762 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:47:39.764 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:47:39.767 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 13:47:39.880 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 13:47:39.881 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:47:39.882 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:47:39.883 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 13:47:39.890 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 13:47:40.013 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 13:47:40.015 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 13:47:40.024 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 133.675ms
2025-05-22 13:47:40.024 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 13:47:40.024 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 144.0247ms
2025-05-22 13:47:40.066 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:47:40.085 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-22 13:47:40.086 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-22 13:47:40.087 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-22 13:47:40.087 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-22 13:47:40.088 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-22 13:47:40.089 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-22 13:47:40.090 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-22 13:47:40.091 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-22 13:47:40.091 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-22 13:47:40.092 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-22 13:47:40.092 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-22 13:47:40.093 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-22 13:47:40.094 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-22 13:47:40.094 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-22 13:47:40.094 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-22 13:47:40.095 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-22 13:47:40.095 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-22 13:47:40.096 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-22 13:47:40.102 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-22 13:47:40.103 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-22 13:47:40.104 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-22 13:47:40.154 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 13:47:40.154 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:47:40.154 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.6152ms
2025-05-22 13:47:40.156 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 13:47:40.156 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:47:40.156 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:47:40.156 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 13:47:40.159 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 13:47:40.226 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 13:47:40.244 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 13:47:40.258 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 98.6506ms
2025-05-22 13:47:40.259 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 13:47:40.259 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 103.2498ms
2025-05-22 13:47:44.652 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - application/json 169
2025-05-22 13:47:44.656 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Notification/token - 404 0 null 4.1534ms
2025-05-22 13:47:44.657 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://192.168.1.5:5053/api/Notification/token, Response status code: 404
2025-05-22 13:47:44.659 +07:00 [INF] Connection id "0HNCOVHHLSSBB", Request id "0HNCOVHHLSSBB:00000001": the application completed without reading the entire request body.
2025-05-22 13:48:09.868 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - application/json 58
2025-05-22 13:48:09.874 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 13:48:09.875 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 13:48:09.892 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 13:48:09.894 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 13:48:09.895 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 20.0852ms
2025-05-22 13:48:09.895 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 13:48:09.895 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - 200 null application/json; charset=utf-8 27.0928ms
2025-05-22 13:48:11.124 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 13:48:11.124 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 13:48:11.137 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - null null
2025-05-22 13:48:11.139 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 13:48:11.139 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 13:48:11.162 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 13:48:11.171 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 13:48:11.173 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 33.3084ms
2025-05-22 13:48:11.173 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 13:48:11.173 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 36.5855ms
2025-05-22 13:48:11.197 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:48:11.198 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-22 13:48:11.200 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-22 13:48:11.204 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-22 13:48:11.205 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-22 13:48:11.205 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-22 13:48:11.205 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-22 13:48:11.205 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-22 13:48:11.205 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-22 13:48:11.206 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-22 13:48:11.206 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-22 13:48:11.208 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-22 13:48:11.208 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-22 13:48:11.208 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-22 13:48:11.209 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-22 13:48:11.209 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-22 13:48:11.209 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-22 13:48:11.209 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-22 13:48:11.210 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-22 13:48:11.210 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-22 13:48:11.210 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-22 13:48:11.210 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-22 13:48:11.211 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-22 13:48:11.211 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-22 13:48:11.945 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - null null
2025-05-22 13:48:11.949 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 13:48:11.950 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 13:48:11.968 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 13:48:11.974 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 13:48:11.975 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 25.1648ms
2025-05-22 13:48:11.975 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 13:48:11.975 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 30.132ms
2025-05-22 13:48:19.770 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 13:48:19.771 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:19.771 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - 204 null null 1.4266ms
2025-05-22 13:48:19.773 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 13:48:19.774 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:19.774 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:19.774 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 13:48:19.788 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 13:48:19.841 +07:00 [INF] Retrieved 18 messages from Redis for conversation 45
2025-05-22 13:48:19.843 +07:00 [INF] Retrieved 18 messages from Redis for conversation 45 and user 3
2025-05-22 13:48:19.844 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 13:48:19.848 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 59.1285ms
2025-05-22 13:48:19.848 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 13:48:19.848 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - 200 null application/json; charset=utf-8 74.6442ms
2025-05-22 13:48:19.860 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 13:48:19.860 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:19.860 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - 204 null null 0.3589ms
2025-05-22 13:48:19.861 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 13:48:19.861 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:19.861 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:19.861 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 13:48:19.865 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 13:48:19.913 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 13:48:19.956 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 13:48:19.958 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 92.9231ms
2025-05-22 13:48:19.958 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 13:48:19.958 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 97.1107ms
2025-05-22 13:48:19.965 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 13:48:19.965 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:19.965 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.2949ms
2025-05-22 13:48:19.967 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 13:48:19.967 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:19.967 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:19.967 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 13:48:19.971 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 13:48:19.982 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 13:48:19.985 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 13:48:19.989 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 17.0716ms
2025-05-22 13:48:19.989 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 13:48:19.989 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 22.1799ms
2025-05-22 13:48:22.779 +07:00 [INF] Handling message from user 3: k
2025-05-22 13:48:22.800 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 13:48:22.882 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 13:48:22.883 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:22.883 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.4231ms
2025-05-22 13:48:22.884 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 13:48:22.885 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:22.886 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:22.886 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:48:22.889 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:48:22.919 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:48:22.958 +07:00 [INF] Executed DbCommand (36ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 13:48:22.973 +07:00 [INF] Message saved to DB with ID: 361
2025-05-22 13:48:22.976 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:48:22.987 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 13:48:22.995 +07:00 [INF] Transaction committed for message: 361
2025-05-22 13:48:23.002 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:48:23.007 +07:00 [INF] Saved message 361 to Redis
2025-05-22 13:48:23.008 +07:00 [INF] Added message 361 to conversation 45
2025-05-22 13:48:23.014 +07:00 [INF] Published message to channel conversation:45
2025-05-22 13:48:23.215 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:48:23.215 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 325.9499ms
2025-05-22 13:48:23.215 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:48:23.215 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 330.959ms
2025-05-22 13:48:23.230 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 13:48:23.230 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:23.230 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:23.230 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:48:23.231 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:48:23.232 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:48:23.232 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 1.694ms
2025-05-22 13:48:23.232 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:48:23.233 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 2.465ms
2025-05-22 13:48:23.248 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 13:48:23.248 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:23.248 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:48:23.249 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:48:23.249 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:48:23.252 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:48:23.253 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 3.5778ms
2025-05-22 13:48:23.253 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:48:23.253 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 4.9581ms
2025-05-22 13:53:00.203 +07:00 [INF] Handling message from user 3: s
2025-05-22 13:53:00.293 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 13:53:00.293 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:00.296 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 3.3526ms
2025-05-22 13:53:00.298 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 13:53:00.298 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:00.298 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:00.299 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:53:00.305 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:53:00.317 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:53:00.318 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 11.6952ms
2025-05-22 13:53:00.318 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:53:00.318 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 20.0398ms
2025-05-22 13:53:00.390 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 13:53:00.390 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:00.393 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:00.393 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:53:00.394 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:53:00.394 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:53:00.394 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.8346ms
2025-05-22 13:53:00.395 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:53:00.395 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 4.7769ms
2025-05-22 13:53:00.407 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 64
2025-05-22 13:53:00.408 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:00.408 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:00.408 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:53:00.408 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:53:00.410 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:53:00.410 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 2.2076ms
2025-05-22 13:53:00.411 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:53:00.411 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 3.5425ms
2025-05-22 13:53:00.437 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 13:53:00.440 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:53:00.453 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 13:53:00.454 +07:00 [INF] Message saved to DB with ID: 362
2025-05-22 13:53:00.454 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:53:00.461 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 13:53:00.461 +07:00 [INF] Transaction committed for message: 362
2025-05-22 13:53:00.470 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:53:00.471 +07:00 [INF] Saved message 362 to Redis
2025-05-22 13:53:00.471 +07:00 [INF] Added message 362 to conversation 45
2025-05-22 13:53:00.473 +07:00 [INF] Published message to channel conversation:45
2025-05-22 13:53:12.030 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Message/getMessages/45/2 - null null
2025-05-22 13:53:12.030 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 13:53:12.034 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 13:53:12.041 +07:00 [INF] Retrieved 20 messages from Redis for conversation 45
2025-05-22 13:53:12.041 +07:00 [INF] Retrieved 20 messages from Redis for conversation 45 and user 2
2025-05-22 13:53:12.041 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 13:53:12.043 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 8.5326ms
2025-05-22 13:53:12.043 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 13:53:12.043 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Message/getMessages/45/2 - 200 null application/json; charset=utf-8 12.9072ms
2025-05-22 13:53:12.104 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 13:53:12.105 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 13:53:12.107 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 13:53:12.117 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 13:53:12.120 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 13:53:12.125 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 18.2713ms
2025-05-22 13:53:12.126 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 13:53:12.126 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 21.6171ms
2025-05-22 13:53:12.178 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Participant/get_participants/45 - null null
2025-05-22 13:53:12.179 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 13:53:12.183 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 13:53:12.189 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 13:53:12.190 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 13:53:12.192 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.596ms
2025-05-22 13:53:12.192 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 13:53:12.192 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 13.623ms
2025-05-22 13:53:21.480 +07:00 [INF] Handling message from user 3: ád
2025-05-22 13:53:21.491 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 13:53:21.509 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:53:21.517 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 13:53:21.517 +07:00 [INF] Message saved to DB with ID: 363
2025-05-22 13:53:21.518 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:53:21.522 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 13:53:21.523 +07:00 [INF] Transaction committed for message: 363
2025-05-22 13:53:21.526 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:53:21.527 +07:00 [INF] Saved message 363 to Redis
2025-05-22 13:53:21.527 +07:00 [INF] Added message 363 to conversation 45
2025-05-22 13:53:21.531 +07:00 [INF] Published message to channel conversation:45
2025-05-22 13:53:21.663 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 13:53:21.663 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:21.663 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.4464ms
2025-05-22 13:53:21.665 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 13:53:21.665 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:21.665 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:21.665 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:53:21.665 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:53:21.666 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:53:21.666 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.749ms
2025-05-22 13:53:21.666 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:53:21.666 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 1.3453ms
2025-05-22 13:53:21.687 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 13:53:21.687 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:21.687 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:21.687 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:53:21.687 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:53:21.688 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:53:21.688 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 0.7987ms
2025-05-22 13:53:21.688 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:53:21.688 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 1.4683ms
2025-05-22 13:53:21.703 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 13:53:21.703 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:21.703 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:53:21.703 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:53:21.703 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:53:21.704 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:53:21.704 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 1.0167ms
2025-05-22 13:53:21.704 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:53:21.706 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 3.5832ms
2025-05-22 13:56:43.288 +07:00 [INF] Handling message from user 3: ád
2025-05-22 13:56:43.298 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 13:56:43.301 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:56:43.307 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 13:56:43.308 +07:00 [INF] Message saved to DB with ID: 364
2025-05-22 13:56:43.310 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:56:43.318 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 13:56:43.320 +07:00 [INF] Transaction committed for message: 364
2025-05-22 13:56:43.327 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:56:43.356 +07:00 [INF] Saved message 364 to Redis
2025-05-22 13:56:43.359 +07:00 [INF] Added message 364 to conversation 45
2025-05-22 13:56:43.368 +07:00 [INF] Published message to channel conversation:45
2025-05-22 13:56:43.504 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 13:56:43.504 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:56:43.505 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.7525ms
2025-05-22 13:56:43.507 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 13:56:43.508 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:56:43.508 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:56:43.508 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:56:43.513 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:56:43.519 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:56:43.519 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 6.106ms
2025-05-22 13:56:43.519 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:56:43.519 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 11.957ms
2025-05-22 13:56:43.533 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 13:56:43.533 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:56:43.542 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:56:43.542 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:56:43.542 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:56:43.543 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:56:43.544 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 1.1279ms
2025-05-22 13:56:43.544 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:56:43.544 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 10.5947ms
2025-05-22 13:56:43.559 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 13:56:43.559 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:56:43.559 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:56:43.560 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:56:43.560 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:56:43.561 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:56:43.561 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 1.3737ms
2025-05-22 13:56:43.561 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:56:43.561 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 2.5421ms
2025-05-22 13:56:49.674 +07:00 [INF] Application is shutting down...
2025-05-22 13:57:19.692 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 13:57:19.692 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 13:57:19.694 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 579932.6844ms
2025-05-22 13:57:19.694 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 548569.9504ms
2025-05-22 13:57:29.013 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 13:57:29.125 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 13:57:29.170 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 13:57:29.177 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 13:57:29.178 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 13:57:29.178 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 13:57:29.178 +07:00 [INF] Hosting environment: Development
2025-05-22 13:57:29.178 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 13:57:29.829 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 13:57:29.880 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 13:57:29.908 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 13:57:32.081 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 13:57:32.083 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:57:32.084 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:57:32.085 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 13:57:39.900 +07:00 [INF] Handling message from user 3: asd
2025-05-22 13:57:39.950 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 13:57:39.951 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:57:39.953 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 2.3243ms
2025-05-22 13:57:39.955 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 13:57:39.955 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:57:39.957 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:57:39.958 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:57:39.972 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:57:39.988 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 13:57:40.134 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:57:40.149 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 13:57:40.165 +07:00 [INF] Message saved to DB with ID: 365
2025-05-22 13:57:40.169 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 13:57:40.174 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 13:57:40.182 +07:00 [INF] Transaction committed for message: 365
2025-05-22 13:57:40.200 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 13:57:40.212 +07:00 [INF] Saved message 365 to Redis
2025-05-22 13:57:40.213 +07:00 [INF] Added message 365 to conversation 45
2025-05-22 13:57:40.232 +07:00 [INF] Published message to channel conversation:45
2025-05-22 13:57:42.643 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:57:42.647 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 2672.644ms
2025-05-22 13:57:42.647 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:57:42.649 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 2693.8787ms
2025-05-22 13:57:42.667 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 13:57:42.667 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:57:42.669 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:57:42.669 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:57:42.670 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:57:42.973 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:57:42.974 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 303.9068ms
2025-05-22 13:57:42.974 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:57:42.974 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 306.9424ms
2025-05-22 13:57:42.995 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 13:57:42.995 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:57:42.995 +07:00 [INF] CORS policy execution successful.
2025-05-22 13:57:42.995 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:57:42.995 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 13:57:43.790 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 13:57:43.791 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 795.3779ms
2025-05-22 13:57:43.791 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 13:57:43.791 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 796.2082ms
2025-05-22 14:01:51.518 +07:00 [INF] Handling message from user 3: asd
2025-05-22 14:01:51.622 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 14:01:51.623 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:01:51.626 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 4.1844ms
2025-05-22 14:01:51.632 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 14:01:51.632 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:01:51.632 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:01:51.633 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:01:51.633 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:01:51.674 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 14:01:51.684 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 14:01:51.695 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 14:01:51.696 +07:00 [INF] Message saved to DB with ID: 366
2025-05-22 14:01:51.700 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 14:01:51.712 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 14:01:51.714 +07:00 [INF] Transaction committed for message: 366
2025-05-22 14:01:51.723 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 14:01:51.727 +07:00 [INF] Saved message 366 to Redis
2025-05-22 14:01:51.728 +07:00 [INF] Added message 366 to conversation 45
2025-05-22 14:01:51.729 +07:00 [INF] Published message to channel conversation:45
2025-05-22 14:01:54.141 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:01:54.141 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 2507.9364ms
2025-05-22 14:01:54.141 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:01:54.142 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 2509.8513ms
2025-05-22 14:01:54.152 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 14:01:54.152 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:01:54.153 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:01:54.154 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:01:54.154 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:01:54.469 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:01:54.470 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 315.8452ms
2025-05-22 14:01:54.470 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:01:54.470 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 318.0343ms
2025-05-22 14:01:54.500 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 14:01:54.501 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:01:54.501 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:01:54.501 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:01:54.502 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:01:55.447 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:01:55.448 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 945.7621ms
2025-05-22 14:01:55.448 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:01:55.448 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 947.3899ms
2025-05-22 14:04:08.303 +07:00 [INF] Handling message from user 3: asf
2025-05-22 14:04:08.318 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 14:04:08.326 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 14:04:08.336 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 14:04:08.337 +07:00 [INF] Message saved to DB with ID: 367
2025-05-22 14:04:08.337 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 14:04:08.345 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 14:04:08.346 +07:00 [INF] Transaction committed for message: 367
2025-05-22 14:04:08.352 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 14:04:08.354 +07:00 [INF] Saved message 367 to Redis
2025-05-22 14:04:08.354 +07:00 [INF] Added message 367 to conversation 45
2025-05-22 14:04:08.355 +07:00 [INF] Published message to channel conversation:45
2025-05-22 14:04:08.390 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 14:04:08.391 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:04:08.391 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.4425ms
2025-05-22 14:04:08.392 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 14:04:08.392 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:04:08.393 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:04:08.393 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:04:08.394 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:04:09.867 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:04:09.868 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 1474.0523ms
2025-05-22 14:04:09.868 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:04:09.868 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 1476.1341ms
2025-05-22 14:04:09.889 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 14:04:09.889 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:04:09.890 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:04:09.890 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:04:09.890 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:04:10.708 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:04:10.708 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 818.1636ms
2025-05-22 14:04:10.709 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:04:10.709 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 820.2706ms
2025-05-22 14:04:10.741 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 14:04:10.741 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:04:10.741 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:04:10.742 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:04:10.742 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:04:11.040 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:04:11.040 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 297.8161ms
2025-05-22 14:04:11.040 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:04:11.041 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 299.8712ms
2025-05-22 14:06:12.726 +07:00 [INF] Handling message from user 3: dgsfdg
2025-05-22 14:06:12.743 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 14:06:12.746 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 14:06:12.756 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 14:06:12.756 +07:00 [INF] Message saved to DB with ID: 368
2025-05-22 14:06:12.757 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 14:06:12.762 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 14:06:12.763 +07:00 [INF] Transaction committed for message: 368
2025-05-22 14:06:12.769 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 14:06:12.770 +07:00 [INF] Saved message 368 to Redis
2025-05-22 14:06:12.771 +07:00 [INF] Added message 368 to conversation 45
2025-05-22 14:06:12.773 +07:00 [INF] Published message to channel conversation:45
2025-05-22 14:06:12.825 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 14:06:12.825 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:06:12.825 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.4695ms
2025-05-22 14:06:12.826 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 69
2025-05-22 14:06:12.827 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:06:12.827 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:06:12.827 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:06:12.832 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:06:14.137 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:06:14.137 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 1304.879ms
2025-05-22 14:06:14.137 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:06:14.137 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 1310.6719ms
2025-05-22 14:06:14.160 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 69
2025-05-22 14:06:14.160 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:06:14.169 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:06:14.169 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:06:14.170 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:06:14.269 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:06:14.269 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 98.7039ms
2025-05-22 14:06:14.269 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:06:14.269 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 108.9144ms
2025-05-22 14:06:14.285 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 69
2025-05-22 14:06:14.286 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:06:14.287 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:06:14.288 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:06:14.288 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:06:14.379 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:06:14.379 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 90.2484ms
2025-05-22 14:06:14.379 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:06:14.379 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 94.1729ms
2025-05-22 14:08:54.893 +07:00 [INF] Handling message from user 3: sdgsd
2025-05-22 14:08:54.914 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 14:08:54.916 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 14:08:54.927 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 14:08:54.928 +07:00 [INF] Message saved to DB with ID: 369
2025-05-22 14:08:54.929 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 14:08:54.934 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 14:08:54.935 +07:00 [INF] Transaction committed for message: 369
2025-05-22 14:08:54.941 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 14:08:54.943 +07:00 [INF] Saved message 369 to Redis
2025-05-22 14:08:54.943 +07:00 [INF] Added message 369 to conversation 45
2025-05-22 14:08:54.944 +07:00 [INF] Published message to channel conversation:45
2025-05-22 14:08:54.983 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 14:08:54.984 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:08:54.984 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 1.1834ms
2025-05-22 14:08:54.985 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 68
2025-05-22 14:08:54.986 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:08:54.986 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:08:54.986 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:08:54.986 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:08:56.315 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:08:56.316 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 1329.5461ms
2025-05-22 14:08:56.316 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:08:56.316 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 1330.2957ms
2025-05-22 14:08:56.338 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 68
2025-05-22 14:08:56.338 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:08:56.339 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:08:56.339 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:08:56.340 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:08:56.439 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:08:56.439 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 99.4544ms
2025-05-22 14:08:56.439 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:08:56.440 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 102.7014ms
2025-05-22 14:08:56.467 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 68
2025-05-22 14:08:56.468 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:08:56.468 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:08:56.468 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:08:56.469 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:08:56.597 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:08:56.597 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 128.0544ms
2025-05-22 14:08:56.597 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:08:56.597 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 129.6838ms
2025-05-22 14:13:29.551 +07:00 [INF] Handling message from user 3: adds
2025-05-22 14:13:29.652 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 14:13:29.653 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:13:29.653 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.3003ms
2025-05-22 14:13:29.655 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 67
2025-05-22 14:13:29.655 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:13:29.655 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:13:29.656 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:13:29.656 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:13:29.670 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 14:13:29.676 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 14:13:29.686 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 14:13:29.686 +07:00 [INF] Message saved to DB with ID: 370
2025-05-22 14:13:29.687 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 14:13:29.694 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 14:13:29.696 +07:00 [INF] Transaction committed for message: 370
2025-05-22 14:13:29.705 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 14:13:29.709 +07:00 [INF] Saved message 370 to Redis
2025-05-22 14:13:29.711 +07:00 [INF] Added message 370 to conversation 45
2025-05-22 14:13:29.712 +07:00 [INF] Published message to channel conversation:45
2025-05-22 14:13:31.077 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:13:31.078 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 1421.6202ms
2025-05-22 14:13:31.078 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:13:31.078 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 1422.6927ms
2025-05-22 14:13:31.087 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 67
2025-05-22 14:13:31.087 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:13:31.087 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:13:31.087 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:13:31.087 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:13:31.189 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:13:31.190 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 102.4447ms
2025-05-22 14:13:31.190 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:13:31.190 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 103.1898ms
2025-05-22 14:13:31.198 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 67
2025-05-22 14:13:31.199 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:13:31.199 +07:00 [INF] CORS policy execution successful.
2025-05-22 14:13:31.200 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:13:31.200 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 14:13:31.316 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 14:13:31.316 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 116.0359ms
2025-05-22 14:13:31.317 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 14:13:31.317 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 118.7887ms
2025-05-22 14:19:45.531 +07:00 [INF] Application is shutting down...
2025-05-22 14:20:15.544 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 14:20:15.544 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 14:20:15.544 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 1363463.4499ms
2025-05-22 14:20:15.544 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - 101 null null 1365717.2404ms
2025-05-22 14:20:36.295 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-05-22 14:20:36.342 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-05-22 14:20:36.347 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-05-22 14:20:36.350 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-05-22 14:20:36.374 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-05-22 14:20:36.387 +07:00 [INF] Applying migration '20250510004939_UpdateStoryReactionForeignKeys'.
2025-05-22 14:20:36.486 +07:00 [ERR] Failed executing DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    [lastMessageTime] datetime2 NULL,
    [lastMessage] nvarchar(max) NULL,
    [lastMessageSender] nvarchar(max) NULL,
    [img_url] nvarchar(max) NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-05-22 14:28:20.571 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-05-22 14:28:20.623 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-05-22 14:28:20.628 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-05-22 14:28:20.632 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-05-22 14:28:20.656 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-05-22 14:28:20.671 +07:00 [INF] Applying migration '20250510004939_UpdateStoryReactionForeignKeys'.
2025-05-22 14:28:20.755 +07:00 [ERR] Failed executing DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    [lastMessageTime] datetime2 NULL,
    [lastMessage] nvarchar(max) NULL,
    [lastMessageSender] nvarchar(max) NULL,
    [img_url] nvarchar(max) NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-05-22 14:32:29.113 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-05-22 14:32:29.154 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-05-22 14:32:29.174 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-05-22 14:33:00.863 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-05-22 14:33:00.908 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-05-22 14:33:00.912 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-05-22 14:33:00.914 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-05-22 14:33:00.933 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-05-22 14:33:00.946 +07:00 [INF] Applying migration '20250510004939_UpdateStoryReactionForeignKeys'.
2025-05-22 14:33:01.007 +07:00 [ERR] Failed executing DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    [lastMessageTime] datetime2 NULL,
    [lastMessage] nvarchar(max) NULL,
    [lastMessageSender] nvarchar(max) NULL,
    [img_url] nvarchar(max) NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-05-22 14:39:51.217 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-05-22 14:39:51.267 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-05-22 14:39:51.272 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-05-22 14:39:51.274 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-05-22 14:39:51.296 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-05-22 14:39:51.311 +07:00 [INF] Applying migration '20250522072021_fcmtoken'.
2025-05-22 14:39:51.345 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Users] ADD [fcmToken] nvarchar(max) NULL;
2025-05-22 14:39:51.351 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250522072021_fcmtoken', N'8.0.4');
2025-05-22 15:14:22.298 +07:00 [INF] Executed DbCommand (90ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 15:14:22.509 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 15:14:22.588 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 15:14:22.599 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 15:14:22.599 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 15:14:22.600 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 15:14:22.600 +07:00 [INF] Hosting environment: Development
2025-05-22 15:14:22.600 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 18:51:05.282 +07:00 [INF] Application is shutting down...
2025-05-22 18:51:14.508 +07:00 [INF] Executed DbCommand (40ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-22 18:51:14.634 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 18:51:14.679 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-22 18:51:14.687 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-22 18:51:14.687 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-22 18:51:14.687 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 18:51:14.687 +07:00 [INF] Hosting environment: Development
2025-05-22 18:51:14.687 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-22 18:53:25.776 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-22 18:53:25.827 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:53:25.838 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 65.0566ms
2025-05-22 18:53:25.842 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-22 18:53:25.843 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:53:25.891 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:53:25.892 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-22 18:53:25.937 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 18:53:25.972 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 18:53:26.219 +07:00 [INF] Executed DbCommand (45ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 18:53:26.307 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 18:53:26.346 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 370.9941ms
2025-05-22 18:53:26.346 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 18:53:26.351 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 509.0616ms
2025-05-22 18:53:26.372 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 18:53:26.377 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:53:26.378 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:53:26.380 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 18:53:26.496 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 18:53:26.497 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:53:26.499 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:53:26.502 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 18:53:26.510 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 18:53:26.673 +07:00 [INF] Executed DbCommand (33ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 18:53:26.676 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 18:53:26.687 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 176.5598ms
2025-05-22 18:53:26.687 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 18:53:26.688 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 192.0011ms
2025-05-22 18:53:26.694 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 18:53:26.695 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:53:26.696 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 2.1283ms
2025-05-22 18:53:26.699 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 18:53:26.699 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:53:26.700 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:53:26.700 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 18:53:26.705 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 18:53:26.706 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 18:53:26.722 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-22 18:53:26.723 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-22 18:53:26.724 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-22 18:53:26.724 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-22 18:53:26.725 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-22 18:53:26.726 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-22 18:53:26.726 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-22 18:53:26.727 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-22 18:53:26.727 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-22 18:53:26.728 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-22 18:53:26.728 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-22 18:53:26.729 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-22 18:53:26.730 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-22 18:53:26.731 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-22 18:53:26.731 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-22 18:53:26.732 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-22 18:53:26.733 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-22 18:53:26.734 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-22 18:53:26.734 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-22 18:53:26.735 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-22 18:53:26.735 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-22 18:53:26.787 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 18:53:26.802 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 18:53:26.814 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 107.1679ms
2025-05-22 18:53:26.814 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 18:53:26.814 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 115.3668ms
2025-05-22 18:54:45.445 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 18:54:45.449 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:45.449 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - 204 null null 4.8988ms
2025-05-22 18:54:45.452 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 18:54:45.453 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:45.453 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:45.454 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 18:54:45.467 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 18:54:45.523 +07:00 [INF] Retrieved 28 messages from Redis for conversation 45
2025-05-22 18:54:45.524 +07:00 [INF] Retrieved 28 messages from Redis for conversation 45 and user 3
2025-05-22 18:54:45.525 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 18:54:45.528 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 60.5037ms
2025-05-22 18:54:45.528 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 18:54:45.528 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - 200 null application/json; charset=utf-8 76.818ms
2025-05-22 18:54:45.540 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 18:54:45.540 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:45.540 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - 204 null null 0.4735ms
2025-05-22 18:54:45.541 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 18:54:45.541 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:45.543 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:45.543 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 18:54:45.547 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 18:54:45.608 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 18:54:45.644 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 18:54:45.647 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 99.2791ms
2025-05-22 18:54:45.647 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 18:54:45.647 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 105.9412ms
2025-05-22 18:54:45.656 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 18:54:45.656 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:45.657 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.3208ms
2025-05-22 18:54:45.658 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 18:54:45.658 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:45.658 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:45.658 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 18:54:45.661 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 18:54:45.673 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 18:54:45.680 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 18:54:45.683 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 21.1543ms
2025-05-22 18:54:45.683 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 18:54:45.683 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 25.6695ms
2025-05-22 18:54:55.372 +07:00 [INF] Handling message from user 3: sdaf
2025-05-22 18:54:55.394 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 18:54:55.462 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 18:54:55.462 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:55.462 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.4201ms
2025-05-22 18:54:55.464 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 18:54:55.465 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:55.465 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.2728ms
2025-05-22 18:54:55.465 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 18:54:55.465 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 18:54:55.465 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:55.465 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:55.465 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.2788ms
2025-05-22 18:54:55.465 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:55.466 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 18:54:55.467 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 18:54:55.467 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 18:54:55.467 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:55.467 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:55.468 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:55.468 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:54:55.468 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 18:54:55.468 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 18:54:55.471 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 18:54:55.471 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 18:54:55.471 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 18:54:55.483 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-05-22 18:54:55.483 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-05-22 18:54:55.483 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-05-22 18:54:55.505 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 33.919ms
2025-05-22 18:54:55.505 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 33.0436ms
2025-05-22 18:54:55.505 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 18:54:55.505 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 33.0828ms
2025-05-22 18:54:55.505 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 18:54:55.505 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 18:54:55.505 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 400 null application/problem+json; charset=utf-8 39.9289ms
2025-05-22 18:54:55.505 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 400 null application/problem+json; charset=utf-8 37.7261ms
2025-05-22 18:54:55.505 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 400 null application/problem+json; charset=utf-8 37.762ms
2025-05-22 18:54:55.522 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 18:54:55.576 +07:00 [INF] Executed DbCommand (51ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 18:54:55.591 +07:00 [INF] Message saved to DB with ID: 371
2025-05-22 18:54:55.593 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 18:54:55.607 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 18:54:55.616 +07:00 [INF] Transaction committed for message: 371
2025-05-22 18:54:55.622 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 18:54:55.628 +07:00 [INF] Saved message 371 to Redis
2025-05-22 18:54:55.630 +07:00 [INF] Added message 371 to conversation 45
2025-05-22 18:54:55.636 +07:00 [INF] Published message to channel conversation:45
2025-05-22 18:58:11.537 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-22 18:58:11.538 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:11.542 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 2.8538ms
2025-05-22 18:58:11.543 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-22 18:58:11.543 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:11.546 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:11.548 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 18:58:11.549 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 18:58:11.598 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 18:58:11.608 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 18:58:11.609 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 60.0824ms
2025-05-22 18:58:11.610 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 18:58:11.610 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 66.8392ms
2025-05-22 18:58:11.645 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 18:58:11.647 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:11.648 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:11.649 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 18:58:11.736 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 18:58:11.737 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:11.739 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:11.739 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 18:58:11.739 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 18:58:11.763 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 18:58:11.764 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 18:58:11.764 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 24.9197ms
2025-05-22 18:58:11.764 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 18:58:11.764 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 28.2662ms
2025-05-22 18:58:11.842 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 18:58:11.843 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-22 18:58:11.844 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-22 18:58:11.844 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-22 18:58:11.909 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 18:58:11.909 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:11.909 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.2816ms
2025-05-22 18:58:11.850 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 18:58:11.910 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 18:58:11.910 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:11.910 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:11.911 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 18:58:11.911 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 18:58:11.911 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 18:58:11.915 +07:00 [ERR] Connection id "0HNCP4T1A348B", Request id "0HNCP4T1A348B:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 18:58:11.919 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 285547.5199ms
2025-05-22 18:58:11.943 +07:00 [INF] Executed DbCommand (29ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 18:58:11.950 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 18:58:11.954 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 43.4171ms
2025-05-22 18:58:11.954 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 18:58:11.954 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 44.4099ms
2025-05-22 18:58:16.983 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 18:58:16.984 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:16.984 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:16.985 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 18:58:20.370 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 18:58:20.370 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:20.370 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - 204 null null 0.4011ms
2025-05-22 18:58:20.372 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 18:58:20.372 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:20.373 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:20.373 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 18:58:20.373 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 18:58:20.388 +07:00 [INF] Retrieved 29 messages from Redis for conversation 45
2025-05-22 18:58:20.388 +07:00 [INF] Retrieved 29 messages from Redis for conversation 45 and user 3
2025-05-22 18:58:20.388 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 18:58:20.389 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 15.3346ms
2025-05-22 18:58:20.389 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 18:58:20.389 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - 200 null application/json; charset=utf-8 16.975ms
2025-05-22 18:58:20.399 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 18:58:20.399 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:20.399 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - 204 null null 0.3329ms
2025-05-22 18:58:20.400 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 18:58:20.400 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:20.400 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:20.401 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 18:58:20.401 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 18:58:20.410 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 18:58:20.415 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 18:58:20.415 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 14.6079ms
2025-05-22 18:58:20.415 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 18:58:20.416 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 15.3153ms
2025-05-22 18:58:20.425 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 18:58:20.425 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:20.425 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.365ms
2025-05-22 18:58:20.427 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 18:58:20.427 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:20.428 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:20.428 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 18:58:20.428 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 18:58:20.433 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 18:58:20.434 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 18:58:20.435 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.3834ms
2025-05-22 18:58:20.435 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 18:58:20.435 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 8.1741ms
2025-05-22 18:58:23.301 +07:00 [INF] Handling message from user 3: sd
2025-05-22 18:58:23.320 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 18:58:23.334 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 18:58:23.343 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 18:58:23.344 +07:00 [INF] Message saved to DB with ID: 372
2025-05-22 18:58:23.345 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 18:58:23.351 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 18:58:23.352 +07:00 [INF] Transaction committed for message: 372
2025-05-22 18:58:23.356 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 18:58:23.359 +07:00 [INF] Saved message 372 to Redis
2025-05-22 18:58:23.359 +07:00 [INF] Added message 372 to conversation 45
2025-05-22 18:58:23.359 +07:00 [INF] Published message to channel conversation:45
2025-05-22 18:58:23.473 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 18:58:23.473 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:23.473 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.2764ms
2025-05-22 18:58:23.473 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 18:58:23.473 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:23.473 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 18:58:23.473 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.1798ms
2025-05-22 18:58:23.473 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:23.473 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.1769ms
2025-05-22 18:58:23.476 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 18:58:23.476 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 18:58:23.476 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:23.477 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 18:58:23.477 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:23.477 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:23.477 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:23.477 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:23.477 +07:00 [INF] CORS policy execution successful.
2025-05-22 18:58:23.477 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 18:58:23.477 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 18:58:23.477 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 18:58:23.477 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 18:58:23.477 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 18:58:23.477 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 18:58:23.493 +07:00 [INF] Sending notification to userId: 5, title: Tin nhắn mới trong nhóm, body: sd
2025-05-22 18:58:23.493 +07:00 [INF] Sending notification to userId: 6, title: Tin nhắn mới trong nhóm, body: sd
2025-05-22 18:58:23.493 +07:00 [INF] Sending notification to userId: 2, title: Tin nhắn mới trong nhóm, body: sd
2025-05-22 18:58:23.508 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[fcmToken]
FROM [Users] AS [u]
WHERE [u].[id] = @__Parse_0
2025-05-22 18:58:23.509 +07:00 [ERR] FCM token not found for userId: 6
2025-05-22 18:58:23.510 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 18:58:23.511 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 33.7416ms
2025-05-22 18:58:23.511 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 18:58:23.511 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 34.5631ms
2025-05-22 18:58:23.548 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[fcmToken]
FROM [Users] AS [u]
WHERE [u].[id] = @__Parse_0
2025-05-22 18:58:23.549 +07:00 [ERR] FCM token not found for userId: 5
2025-05-22 18:58:23.549 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 18:58:23.549 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 71.723ms
2025-05-22 18:58:23.549 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 18:58:23.549 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 73.0414ms
2025-05-22 18:58:23.552 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[fcmToken]
FROM [Users] AS [u]
WHERE [u].[id] = @__Parse_0
2025-05-22 18:58:23.552 +07:00 [ERR] FCM token not found for userId: 2
2025-05-22 18:58:23.552 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 18:58:23.552 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 75.3872ms
2025-05-22 18:58:23.553 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 18:58:23.553 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 76.2644ms
2025-05-22 19:01:52.284 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - application/json 58
2025-05-22 19:01:52.306 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 19:01:52.307 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 19:01:52.346 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 19:01:52.352 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 19:01:52.353 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 45.7652ms
2025-05-22 19:01:52.353 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 19:01:52.354 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.5:5053/api/Auth/login - 200 null application/json; charset=utf-8 69.3434ms
2025-05-22 19:01:53.512 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/ws/chat?userId=2 - null null
2025-05-22 19:01:53.520 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - null null
2025-05-22 19:01:53.524 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - null null
2025-05-22 19:01:53.528 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 19:01:53.528 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 19:01:53.528 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 19:01:53.528 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 19:01:53.528 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 19:01:53.552 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 19:01:53.552 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 19:01:53.562 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 19:01:53.571 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 42.6981ms
2025-05-22 19:01:53.571 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 19:01:53.571 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 47.0685ms
2025-05-22 19:01:53.587 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 19:01:53.590 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 61.5035ms
2025-05-22 19:01:53.590 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 19:01:53.590 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.5:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 69.5387ms
2025-05-22 19:01:53.751 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 19:01:53.757 +07:00 [INF] User 2 subscribed to channel conversation:3
2025-05-22 19:01:53.761 +07:00 [INF] User 2 subscribed to channel conversation:4
2025-05-22 19:01:53.761 +07:00 [INF] User 2 subscribed to channel conversation:19
2025-05-22 19:01:53.761 +07:00 [INF] User 2 subscribed to channel conversation:1
2025-05-22 19:01:53.761 +07:00 [INF] User 2 subscribed to channel conversation:25
2025-05-22 19:01:53.761 +07:00 [INF] User 2 subscribed to channel conversation:26
2025-05-22 19:01:53.762 +07:00 [INF] User 2 subscribed to channel conversation:27
2025-05-22 19:01:53.762 +07:00 [INF] User 2 subscribed to channel conversation:28
2025-05-22 19:01:53.762 +07:00 [INF] User 2 subscribed to channel conversation:29
2025-05-22 19:01:53.762 +07:00 [INF] User 2 subscribed to channel conversation:32
2025-05-22 19:01:53.763 +07:00 [INF] User 2 subscribed to channel conversation:33
2025-05-22 19:01:53.763 +07:00 [INF] User 2 subscribed to channel conversation:34
2025-05-22 19:01:53.763 +07:00 [INF] User 2 subscribed to channel conversation:35
2025-05-22 19:01:53.763 +07:00 [INF] User 2 subscribed to channel conversation:36
2025-05-22 19:01:53.763 +07:00 [INF] User 2 subscribed to channel conversation:37
2025-05-22 19:01:53.763 +07:00 [INF] User 2 subscribed to channel conversation:38
2025-05-22 19:01:53.763 +07:00 [INF] User 2 subscribed to channel conversation:39
2025-05-22 19:01:53.764 +07:00 [INF] User 2 subscribed to channel conversation:41
2025-05-22 19:01:53.764 +07:00 [INF] User 2 subscribed to channel conversation:40
2025-05-22 19:01:53.764 +07:00 [INF] User 2 subscribed to channel conversation:42
2025-05-22 19:01:53.764 +07:00 [INF] User 2 subscribed to channel conversation:44
2025-05-22 19:01:53.764 +07:00 [INF] User 2 subscribed to channel conversation:43
2025-05-22 19:01:53.764 +07:00 [INF] User 2 subscribed to channel conversation:45
2025-05-22 19:02:00.557 +07:00 [INF] Handling message from user 3: mm
2025-05-22 19:02:00.577 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 19:02:00.628 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 19:02:00.648 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 19:02:00.649 +07:00 [INF] Message saved to DB with ID: 373
2025-05-22 19:02:00.650 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 19:02:00.658 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 19:02:00.659 +07:00 [INF] Transaction committed for message: 373
2025-05-22 19:02:00.671 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 19:02:00.677 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 19:02:00.677 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:02:00.680 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 2.7111ms
2025-05-22 19:02:00.680 +07:00 [INF] Saved message 373 to Redis
2025-05-22 19:02:00.681 +07:00 [INF] Added message 373 to conversation 45
2025-05-22 19:02:00.681 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 19:02:00.681 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:02:00.681 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.1778ms
2025-05-22 19:02:00.681 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 19:02:00.681 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:02:00.681 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.1185ms
2025-05-22 19:02:00.682 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 19:02:00.682 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:02:00.682 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:02:00.682 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:02:00.683 +07:00 [INF] Published message to channel conversation:45
2025-05-22 19:02:00.683 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 19:02:00.683 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 65
2025-05-22 19:02:00.683 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:02:00.683 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:02:00.683 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:02:00.683 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:02:00.683 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:02:00.683 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:02:00.683 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 19:02:00.683 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 19:02:00.682 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 19:02:00.684 +07:00 [INF] Sending notification to userId: 2, title: Tin nhắn mới trong nhóm, body: mm
2025-05-22 19:02:00.684 +07:00 [INF] Sending notification to userId: 6, title: Tin nhắn mới trong nhóm, body: mm
2025-05-22 19:02:00.685 +07:00 [INF] Sending notification to userId: 5, title: Tin nhắn mới trong nhóm, body: mm
2025-05-22 19:02:00.699 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[fcmToken]
FROM [Users] AS [u]
WHERE [u].[id] = @__Parse_0
2025-05-22 19:02:00.700 +07:00 [ERR] FCM token not found for userId: 6
2025-05-22 19:02:00.700 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 19:02:00.701 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[fcmToken]
FROM [Users] AS [u]
WHERE [u].[id] = @__Parse_0
2025-05-22 19:02:00.703 +07:00 [ERR] FCM token not found for userId: 5
2025-05-22 19:02:00.703 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 19.7998ms
2025-05-22 19:02:00.703 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:02:00.703 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 19:02:00.704 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[fcmToken]
FROM [Users] AS [u]
WHERE [u].[id] = @__Parse_0
2025-05-22 19:02:00.704 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 19.7365ms
2025-05-22 19:02:00.703 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 20.6802ms
2025-05-22 19:02:00.704 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:02:00.704 +07:00 [ERR] FCM token not found for userId: 2
2025-05-22 19:02:00.704 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 22.0197ms
2025-05-22 19:02:00.704 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 19:02:00.704 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 20.7239ms
2025-05-22 19:02:00.704 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:02:00.704 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 21.4339ms
2025-05-22 19:08:49.880 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - null null
2025-05-22 19:08:49.881 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:49.881 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Auth/login - 204 null null 0.514ms
2025-05-22 19:08:49.882 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 57
2025-05-22 19:08:49.882 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:49.882 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:49.882 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 19:08:49.883 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 19:08:49.915 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 19:08:49.918 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-05-22 19:08:49.918 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 35.2216ms
2025-05-22 19:08:49.918 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 19:08:49.918 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 400 null application/json; charset=utf-8 36.449ms
2025-05-22 19:08:54.582 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Auth/login - application/json 60
2025-05-22 19:08:54.582 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:54.582 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:54.582 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 19:08:54.582 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-22 19:08:54.590 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[fcmToken], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-22 19:08:54.591 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-22 19:08:54.593 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 10.5961ms
2025-05-22 19:08:54.593 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-22 19:08:54.594 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Auth/login - 200 null application/json; charset=utf-8 12.4619ms
2025-05-22 19:08:54.622 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 19:08:54.622 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:54.622 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:54.622 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 19:08:54.719 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - null null
2025-05-22 19:08:54.719 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:54.720 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:54.720 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 19:08:54.720 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-22 19:08:54.728 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-22 19:08:54.728 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType8`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 19:08:54.728 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 8.288ms
2025-05-22 19:08:54.728 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-22 19:08:54.729 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/friends/GetAllFriends/3 - 200 null application/json; charset=utf-8 9.8333ms
2025-05-22 19:08:54.822 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-22 19:08:54.826 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 19:08:54.827 +07:00 [INF] User 3 subscribed to channel conversation:1
2025-05-22 19:08:54.828 +07:00 [INF] User 3 subscribed to channel conversation:2
2025-05-22 19:08:54.828 +07:00 [INF] User 3 subscribed to channel conversation:9
2025-05-22 19:08:54.829 +07:00 [INF] User 3 subscribed to channel conversation:19
2025-05-22 19:08:54.829 +07:00 [INF] User 3 subscribed to channel conversation:25
2025-05-22 19:08:54.829 +07:00 [INF] User 3 subscribed to channel conversation:26
2025-05-22 19:08:54.829 +07:00 [INF] User 3 subscribed to channel conversation:27
2025-05-22 19:08:54.829 +07:00 [INF] User 3 subscribed to channel conversation:28
2025-05-22 19:08:54.829 +07:00 [INF] User 3 subscribed to channel conversation:29
2025-05-22 19:08:54.829 +07:00 [INF] User 3 subscribed to channel conversation:32
2025-05-22 19:08:54.829 +07:00 [INF] User 3 subscribed to channel conversation:34
2025-05-22 19:08:54.829 +07:00 [INF] User 3 subscribed to channel conversation:35
2025-05-22 19:08:54.829 +07:00 [INF] User 3 subscribed to channel conversation:36
2025-05-22 19:08:54.829 +07:00 [INF] User 3 subscribed to channel conversation:37
2025-05-22 19:08:54.830 +07:00 [INF] User 3 subscribed to channel conversation:38
2025-05-22 19:08:54.830 +07:00 [INF] User 3 subscribed to channel conversation:39
2025-05-22 19:08:54.830 +07:00 [INF] User 3 subscribed to channel conversation:40
2025-05-22 19:08:54.830 +07:00 [INF] User 3 subscribed to channel conversation:42
2025-05-22 19:08:54.830 +07:00 [INF] User 3 subscribed to channel conversation:43
2025-05-22 19:08:54.830 +07:00 [INF] User 3 subscribed to channel conversation:44
2025-05-22 19:08:54.830 +07:00 [INF] User 3 subscribed to channel conversation:45
2025-05-22 19:08:54.823 +07:00 [ERR] An unhandled exception has occurred while executing the request.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-22 19:08:54.835 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-22 19:08:54.836 +07:00 [ERR] Connection id "0HNCP4T1A348G", Request id "0HNCP4T1A348G:00000001": An unhandled exception was thrown by the application.
StackExchange.Redis.RedisServerException: WRONGTYPE Operation against a key holding the wrong kind of value
   at server.Services.WebSocketService.webSocket.CleanupClient(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 547
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 205
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 107
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-22 19:08:54.840 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - 101 null null 643194.8427ms
2025-05-22 19:08:54.896 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 19:08:54.896 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:54.896 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_conversations/3 - 204 null null 0.3289ms
2025-05-22 19:08:54.899 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - null null
2025-05-22 19:08:54.899 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:54.899 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:54.899 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 19:08:54.899 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 19:08:54.913 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [p0].[id], [p0].[user_id], [p0].[conversation_id], [p0].[name], [p0].[is_deleted], [p0].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN [Participants] AS [p0] ON [c].[id] = [p0].[conversation_id]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-22 19:08:54.919 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 19:08:54.921 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 21.2326ms
2025-05-22 19:08:54.921 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-22 19:08:54.921 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_conversations/3 - 200 null application/json; charset=utf-8 22.5548ms
2025-05-22 19:08:59.906 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/ws/chat?userId=3 - null null
2025-05-22 19:08:59.907 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:59.908 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:08:59.908 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-22 19:09:08.959 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 19:09:08.959 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:08.959 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Message/getMessages/45/3 - 204 null null 0.6566ms
2025-05-22 19:09:08.960 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - null null
2025-05-22 19:09:08.961 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:08.961 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:08.961 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 19:09:08.961 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-22 19:09:08.972 +07:00 [INF] Retrieved 31 messages from Redis for conversation 45
2025-05-22 19:09:08.973 +07:00 [INF] Retrieved 31 messages from Redis for conversation 45 and user 3
2025-05-22 19:09:08.973 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 19:09:08.973 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 11.9268ms
2025-05-22 19:09:08.973 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-22 19:09:08.974 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Message/getMessages/45/3 - 200 null application/json; charset=utf-8 13.0201ms
2025-05-22 19:09:08.984 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 19:09:08.984 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:08.984 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Conversation/get_first_conversation/45 - 204 null null 0.18ms
2025-05-22 19:09:08.986 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - null null
2025-05-22 19:09:08.986 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:08.987 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:08.987 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 19:09:08.987 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-22 19:09:08.996 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[created_at], [t].[img_url], [t].[is_group], [t].[lastMessage], [t].[lastMessageSender], [t].[lastMessageTime], [t].[name], [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM (
    SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
    FROM [Conversations] AS [c]
    WHERE [c].[id] = @__conversation_id_0
) AS [t]
LEFT JOIN [Participants] AS [p] ON [t].[id] = [p].[conversation_id]
ORDER BY [t].[id]
2025-05-22 19:09:08.998 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-22 19:09:08.999 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 12.0026ms
2025-05-22 19:09:08.999 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-22 19:09:08.999 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Conversation/get_first_conversation/45 - 200 null application/json; charset=utf-8 13.7274ms
2025-05-22 19:09:09.007 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 19:09:09.007 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:09.007 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Participant/get_participants/45 - 204 null null 0.3434ms
2025-05-22 19:09:09.009 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - null null
2025-05-22 19:09:09.009 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:09.010 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:09.010 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 19:09:09.010 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-22 19:09:09.015 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-22 19:09:09.016 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 19:09:09.017 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.7168ms
2025-05-22 19:09:09.017 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-22 19:09:09.017 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Participant/get_participants/45 - 200 null application/json; charset=utf-8 7.7437ms
2025-05-22 19:09:15.630 +07:00 [INF] Handling message from user 3: kkk
2025-05-22 19:09:15.634 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 19:09:15.636 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 19:09:15.644 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 19:09:15.644 +07:00 [INF] Message saved to DB with ID: 374
2025-05-22 19:09:15.645 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 19:09:15.649 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 19:09:15.650 +07:00 [INF] Transaction committed for message: 374
2025-05-22 19:09:15.654 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 19:09:15.655 +07:00 [INF] Saved message 374 to Redis
2025-05-22 19:09:15.656 +07:00 [INF] Added message 374 to conversation 45
2025-05-22 19:09:15.656 +07:00 [INF] Published message to channel conversation:45
2025-05-22 19:09:15.840 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 19:09:15.841 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:15.841 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.4276ms
2025-05-22 19:09:15.843 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 19:09:15.844 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:15.844 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.1443ms
2025-05-22 19:09:15.844 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 19:09:15.844 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 19:09:15.844 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:15.844 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:15.844 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:15.844 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.1803ms
2025-05-22 19:09:15.844 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:09:15.844 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 19:09:15.845 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 19:09:15.846 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:15.846 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 19:09:15.846 +07:00 [INF] Sending notification to userId: 5, title: Tin nhắn mới trong nhóm, body: kkk
2025-05-22 19:09:15.846 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:15.846 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:15.846 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:09:15.846 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:09:15.846 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:09:15.846 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 19:09:15.846 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 19:09:15.847 +07:00 [INF] Sending notification to userId: 6, title: Tin nhắn mới trong nhóm, body: kkk
2025-05-22 19:09:15.847 +07:00 [INF] Sending notification to userId: 2, title: Tin nhắn mới trong nhóm, body: kkk
2025-05-22 19:09:15.850 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[fcmToken]
FROM [Users] AS [u]
WHERE [u].[id] = @__Parse_0
2025-05-22 19:09:15.850 +07:00 [ERR] FCM token not found for userId: 5
2025-05-22 19:09:15.850 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 19:09:15.850 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 6.0226ms
2025-05-22 19:09:15.850 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:09:15.850 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 6.7133ms
2025-05-22 19:09:15.858 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[fcmToken]
FROM [Users] AS [u]
WHERE [u].[id] = @__Parse_0
2025-05-22 19:09:15.858 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[fcmToken]
FROM [Users] AS [u]
WHERE [u].[id] = @__Parse_0
2025-05-22 19:09:15.858 +07:00 [ERR] FCM token not found for userId: 6
2025-05-22 19:09:15.858 +07:00 [ERR] FCM token not found for userId: 2
2025-05-22 19:09:15.859 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 19:09:15.859 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 19:09:15.859 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 12.8074ms
2025-05-22 19:09:15.859 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:09:15.859 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 12.8819ms
2025-05-22 19:09:15.859 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 13.3364ms
2025-05-22 19:09:15.859 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:09:15.859 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 13.6299ms
2025-05-22 19:14:40.329 +07:00 [INF] Handling message from user 3: ssa
2025-05-22 19:14:40.339 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-22 19:14:40.341 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 19:14:40.346 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-22 19:14:40.347 +07:00 [INF] Message saved to DB with ID: 375
2025-05-22 19:14:40.348 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-22 19:14:40.351 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-22 19:14:40.353 +07:00 [INF] Transaction committed for message: 375
2025-05-22 19:14:40.357 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-22 19:14:40.359 +07:00 [INF] Saved message 375 to Redis
2025-05-22 19:14:40.359 +07:00 [INF] Added message 375 to conversation 45
2025-05-22 19:14:40.364 +07:00 [INF] Published message to channel conversation:45
2025-05-22 19:14:40.514 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 19:14:40.515 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:14:40.515 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.2422ms
2025-05-22 19:14:40.516 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 19:14:40.516 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:14:40.516 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.3221ms
2025-05-22 19:14:40.516 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 19:14:40.517 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:14:40.517 +07:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - null null
2025-05-22 19:14:40.517 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:14:40.517 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:14:40.517 +07:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5053/api/Notification/send - 204 null null 0.2608ms
2025-05-22 19:14:40.517 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:14:40.517 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 19:14:40.517 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:14:40.518 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:14:40.518 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:14:40.518 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Notification/send - application/json 66
2025-05-22 19:14:40.518 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:14:40.522 +07:00 [INF] CORS policy execution successful.
2025-05-22 19:14:40.522 +07:00 [INF] Executing endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:14:40.525 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 19:14:40.526 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 19:14:40.526 +07:00 [INF] Route matched with {action = "SendNotification", controller = "Notification"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NotificationRequest) on controller FcmBackend.Controllers.NotificationController (Message_app).
2025-05-22 19:14:40.528 +07:00 [INF] Sending notification to userId: 5, title: Tin nhắn mới trong nhóm, body: ssa
2025-05-22 19:14:40.528 +07:00 [INF] Sending notification to userId: 2, title: Tin nhắn mới trong nhóm, body: ssa
2025-05-22 19:14:40.528 +07:00 [INF] Sending notification to userId: 6, title: Tin nhắn mới trong nhóm, body: ssa
2025-05-22 19:14:40.532 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[fcmToken]
FROM [Users] AS [u]
WHERE [u].[id] = @__Parse_0
2025-05-22 19:14:40.532 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[fcmToken]
FROM [Users] AS [u]
WHERE [u].[id] = @__Parse_0
2025-05-22 19:14:40.532 +07:00 [ERR] FCM token not found for userId: 6
2025-05-22 19:14:40.532 +07:00 [ERR] FCM token not found for userId: 2
2025-05-22 19:14:40.532 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 19:14:40.532 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 19:14:40.532 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 6.5538ms
2025-05-22 19:14:40.532 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 6.6961ms
2025-05-22 19:14:40.532 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:14:40.532 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:14:40.532 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 15.0292ms
2025-05-22 19:14:40.532 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 14.0601ms
2025-05-22 19:14:40.538 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[fcmToken]
FROM [Users] AS [u]
WHERE [u].[id] = @__Parse_0
2025-05-22 19:14:40.538 +07:00 [ERR] FCM token not found for userId: 5
2025-05-22 19:14:40.538 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-05-22 19:14:40.538 +07:00 [INF] Executed action FcmBackend.Controllers.NotificationController.SendNotification (Message_app) in 12.541ms
2025-05-22 19:14:40.538 +07:00 [INF] Executed endpoint 'FcmBackend.Controllers.NotificationController.SendNotification (Message_app)'
2025-05-22 19:14:40.538 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Notification/send - 500 null text/plain; charset=utf-8 21.9203ms
2025-05-22 19:15:03.407 +07:00 [INF] Application is shutting down...
