2025-03-16 20:27:32.921 +07:00 [INF] Executed DbCommand (153ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [Message_app_db];
2025-03-16 20:27:33.060 +07:00 [INF] Executed DbCommand (87ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [Message_app_db] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-03-16 20:27:33.084 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 20:27:33.092 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-03-16 20:27:33.132 +07:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-03-16 20:27:33.246 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-03-16 20:27:33.259 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 20:27:33.262 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-03-16 20:27:33.299 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-03-16 20:27:33.329 +07:00 [INF] Applying migration '20250316132715_InitialCreate'.
2025-03-16 20:27:33.483 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-03-16 20:27:33.489 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role] (
    [id] int NOT NULL IDENTITY,
    [role_name] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Role] PRIMARY KEY ([id])
);
2025-03-16 20:27:33.494 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [id] int NOT NULL IDENTITY,
    [username] nvarchar(200) NOT NULL,
    [password] nvarchar(max) NOT NULL,
    [passwordSalt] nvarchar(max) NOT NULL,
    [email] nvarchar(max) NOT NULL,
    [avatar_url] nvarchar(max) NOT NULL,
    [birthday] date NOT NULL,
    [created_at] datetime2 NOT NULL,
    [gender] bit NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([id])
);
2025-03-16 20:27:33.503 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [GroupSettings] (
    [Id] int NOT NULL IDENTITY,
    [ConversationId] int NOT NULL,
    [Privacy] bit NOT NULL,
    [AllowMemberInvite] bit NOT NULL,
    [AllowMemberEdit] bit NOT NULL,
    [CreatedBy] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [IsActive] bit NOT NULL,
    [ImageUrl] nvarchar(255) NOT NULL,
    CONSTRAINT [PK_GroupSettings] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_GroupSettings_Conversations_ConversationId] FOREIGN KEY ([ConversationId]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_GroupSettings_Users_CreatedBy] FOREIGN KEY ([CreatedBy]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:27:33.520 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Messages] (
    [id] int NOT NULL IDENTITY,
    [content] nvarchar(500) NOT NULL,
    [sender_id] int NOT NULL,
    [is_read] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    [conversation_id] int NOT NULL,
    CONSTRAINT [PK_Messages] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Messages_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Messages_Users_sender_id] FOREIGN KEY ([sender_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:27:33.527 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [MessageStatus] (
    [id] int NOT NULL IDENTITY,
    [message_id] int NOT NULL,
    [receiver_id] int NOT NULL,
    [status] nvarchar(50) NOT NULL,
    [updated_at] datetime2 NOT NULL,
    [Userid] int NULL,
    CONSTRAINT [PK_MessageStatus] PRIMARY KEY ([id]),
    CONSTRAINT [FK_MessageStatus_Users_Userid] FOREIGN KEY ([Userid]) REFERENCES [Users] ([id])
);
2025-03-16 20:27:33.547 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Notifications] (
    [id] int NOT NULL IDENTITY,
    [related_type] nvarchar(max) NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [user_id] int NOT NULL,
    [is_seen] bit NOT NULL,
    [related_id] int NOT NULL,
    CONSTRAINT [PK_Notifications] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Notifications_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:27:33.559 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [OTPs] (
    [Id] int NOT NULL IDENTITY,
    [UserId] int NOT NULL,
    [OTPCode] nvarchar(6) NOT NULL,
    [ExpiryDate] datetime2 NOT NULL,
    [IsUsed] bit NOT NULL,
    CONSTRAINT [PK_OTPs] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_OTPs_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:27:33.604 +07:00 [INF] Executed DbCommand (40ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Participants] (
    [id] int NOT NULL IDENTITY,
    [conversation_id] int NOT NULL,
    [user_id] int NOT NULL,
    [joined_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_Participants] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Participants_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Participants_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:27:33.634 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role_of_User] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [role_id] int NOT NULL,
    CONSTRAINT [PK_Role_of_User] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Role_of_User_Role_role_id] FOREIGN KEY ([role_id]) REFERENCES [Role] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Role_of_User_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:27:33.644 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Stories] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [expires_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Stories] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Stories_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:27:33.656 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Attachments] (
    [id] int NOT NULL IDENTITY,
    [file_url] nvarchar(255) NOT NULL,
    [FileSize] real NOT NULL,
    [file_type] nvarchar(50) NOT NULL,
    [uploaded_at] datetime2 NOT NULL,
    [message_id] int NOT NULL,
    CONSTRAINT [PK_Attachments] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Attachments_Messages_message_id] FOREIGN KEY ([message_id]) REFERENCES [Messages] ([id]) ON DELETE CASCADE
);
2025-03-16 20:27:33.860 +07:00 [ERR] Failed executing DbCommand (200ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [StoryReactions] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [story_id] int NOT NULL,
    [reaction_type] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_StoryReactions] PRIMARY KEY ([id]),
    CONSTRAINT [FK_StoryReactions_Stories_story_id] FOREIGN KEY ([story_id]) REFERENCES [Stories] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_StoryReactions_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:34:47.160 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 20:34:47.222 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-03-16 20:34:47.251 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-03-16 20:34:47.368 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-03-16 20:34:47.376 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 20:34:47.379 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-03-16 20:34:47.396 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-03-16 20:34:47.417 +07:00 [INF] Applying migration '20250316132715_InitialCreate'.
2025-03-16 20:34:47.515 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-03-16 20:34:47.518 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role] (
    [id] int NOT NULL IDENTITY,
    [role_name] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Role] PRIMARY KEY ([id])
);
2025-03-16 20:34:47.522 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [id] int NOT NULL IDENTITY,
    [username] nvarchar(200) NOT NULL,
    [password] nvarchar(max) NOT NULL,
    [passwordSalt] nvarchar(max) NOT NULL,
    [email] nvarchar(max) NOT NULL,
    [avatar_url] nvarchar(max) NOT NULL,
    [birthday] date NOT NULL,
    [created_at] datetime2 NOT NULL,
    [gender] bit NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([id])
);
2025-03-16 20:34:47.534 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [GroupSettings] (
    [Id] int NOT NULL IDENTITY,
    [ConversationId] int NOT NULL,
    [Privacy] bit NOT NULL,
    [AllowMemberInvite] bit NOT NULL,
    [AllowMemberEdit] bit NOT NULL,
    [CreatedBy] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [IsActive] bit NOT NULL,
    [ImageUrl] nvarchar(255) NOT NULL,
    CONSTRAINT [PK_GroupSettings] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_GroupSettings_Conversations_ConversationId] FOREIGN KEY ([ConversationId]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_GroupSettings_Users_CreatedBy] FOREIGN KEY ([CreatedBy]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:34:47.541 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Messages] (
    [id] int NOT NULL IDENTITY,
    [content] nvarchar(500) NOT NULL,
    [sender_id] int NOT NULL,
    [is_read] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    [conversation_id] int NOT NULL,
    CONSTRAINT [PK_Messages] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Messages_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Messages_Users_sender_id] FOREIGN KEY ([sender_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:34:47.555 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [MessageStatus] (
    [id] int NOT NULL IDENTITY,
    [message_id] int NOT NULL,
    [receiver_id] int NOT NULL,
    [status] nvarchar(50) NOT NULL,
    [updated_at] datetime2 NOT NULL,
    [Userid] int NULL,
    CONSTRAINT [PK_MessageStatus] PRIMARY KEY ([id]),
    CONSTRAINT [FK_MessageStatus_Users_Userid] FOREIGN KEY ([Userid]) REFERENCES [Users] ([id])
);
2025-03-16 20:34:47.563 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Notifications] (
    [id] int NOT NULL IDENTITY,
    [related_type] nvarchar(max) NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [user_id] int NOT NULL,
    [is_seen] bit NOT NULL,
    [related_id] int NOT NULL,
    CONSTRAINT [PK_Notifications] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Notifications_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:34:47.583 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [OTPs] (
    [Id] int NOT NULL IDENTITY,
    [UserId] int NOT NULL,
    [OTPCode] nvarchar(6) NOT NULL,
    [ExpiryDate] datetime2 NOT NULL,
    [IsUsed] bit NOT NULL,
    CONSTRAINT [PK_OTPs] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_OTPs_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:34:47.589 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Participants] (
    [id] int NOT NULL IDENTITY,
    [conversation_id] int NOT NULL,
    [user_id] int NOT NULL,
    [joined_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_Participants] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Participants_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Participants_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:34:47.607 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role_of_User] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [role_id] int NOT NULL,
    CONSTRAINT [PK_Role_of_User] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Role_of_User_Role_role_id] FOREIGN KEY ([role_id]) REFERENCES [Role] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Role_of_User_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:34:47.615 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Stories] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [expires_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Stories] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Stories_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:34:47.621 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Attachments] (
    [id] int NOT NULL IDENTITY,
    [file_url] nvarchar(255) NOT NULL,
    [FileSize] real NOT NULL,
    [file_type] nvarchar(50) NOT NULL,
    [uploaded_at] datetime2 NOT NULL,
    [message_id] int NOT NULL,
    CONSTRAINT [PK_Attachments] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Attachments_Messages_message_id] FOREIGN KEY ([message_id]) REFERENCES [Messages] ([id]) ON DELETE CASCADE
);
2025-03-16 20:34:47.637 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [StoryReactions] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [story_id] int NOT NULL,
    [reaction_type] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_StoryReactions] PRIMARY KEY ([id]),
    CONSTRAINT [FK_StoryReactions_Stories_story_id] FOREIGN KEY ([story_id]) REFERENCES [Stories] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_StoryReactions_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id])
);
2025-03-16 20:34:47.699 +07:00 [ERR] Failed executing DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [StoryViewers] (
    [id] int NOT NULL IDENTITY,
    [story_id] int NOT NULL,
    [user_id] int NOT NULL,
    [viewed_at] datetime2 NOT NULL,
    CONSTRAINT [PK_StoryViewers] PRIMARY KEY ([id]),
    CONSTRAINT [FK_StoryViewers_Stories_story_id] FOREIGN KEY ([story_id]) REFERENCES [Stories] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_StoryViewers_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:38:31.905 +07:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 20:38:32.214 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [Message_app_db] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
END;
2025-03-16 20:38:32.370 +07:00 [INF] Executed DbCommand (152ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
DROP DATABASE [Message_app_db];
2025-03-16 20:41:22.562 +07:00 [INF] No migrations were found in assembly 'Message_app'. A migration needs to be added before the database can be updated.
2025-03-16 20:41:24.001 +07:00 [INF] Executed DbCommand (158ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [Message_app_db];
2025-03-16 20:41:24.071 +07:00 [INF] Executed DbCommand (66ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [Message_app_db] SET READ_COMMITTED_SNAPSHOT ON;
END;
2025-03-16 20:41:24.090 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 20:41:24.095 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-03-16 20:41:24.124 +07:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-03-16 20:41:24.271 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-03-16 20:41:24.284 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 20:41:24.287 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-03-16 20:41:24.304 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-03-16 20:41:24.322 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-03-16 20:41:24.327 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-03-16 20:42:20.176 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 20:42:20.232 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-03-16 20:42:20.257 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-03-16 20:42:20.359 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-03-16 20:42:20.379 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 20:42:20.387 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-03-16 20:42:20.395 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-03-16 20:42:20.417 +07:00 [INF] Applying migration '20250316134208_InitialCreate'.
2025-03-16 20:42:20.497 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-03-16 20:42:20.501 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role] (
    [id] int NOT NULL IDENTITY,
    [role_name] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Role] PRIMARY KEY ([id])
);
2025-03-16 20:42:20.505 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [id] int NOT NULL IDENTITY,
    [username] nvarchar(200) NOT NULL,
    [password] nvarchar(max) NOT NULL,
    [passwordSalt] nvarchar(max) NOT NULL,
    [email] nvarchar(max) NOT NULL,
    [avatar_url] nvarchar(max) NOT NULL,
    [birthday] date NOT NULL,
    [created_at] datetime2 NOT NULL,
    [gender] bit NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([id])
);
2025-03-16 20:42:20.518 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [GroupSettings] (
    [Id] int NOT NULL IDENTITY,
    [ConversationId] int NOT NULL,
    [Privacy] bit NOT NULL,
    [AllowMemberInvite] bit NOT NULL,
    [AllowMemberEdit] bit NOT NULL,
    [CreatedBy] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [IsActive] bit NOT NULL,
    [ImageUrl] nvarchar(255) NOT NULL,
    CONSTRAINT [PK_GroupSettings] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_GroupSettings_Conversations_ConversationId] FOREIGN KEY ([ConversationId]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_GroupSettings_Users_CreatedBy] FOREIGN KEY ([CreatedBy]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:42:20.524 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Messages] (
    [id] int NOT NULL IDENTITY,
    [content] nvarchar(500) NOT NULL,
    [sender_id] int NOT NULL,
    [is_read] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    [conversation_id] int NOT NULL,
    CONSTRAINT [PK_Messages] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Messages_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Messages_Users_sender_id] FOREIGN KEY ([sender_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:42:20.529 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [MessageStatus] (
    [id] int NOT NULL IDENTITY,
    [message_id] int NOT NULL,
    [receiver_id] int NOT NULL,
    [status] nvarchar(50) NOT NULL,
    [updated_at] datetime2 NOT NULL,
    [Userid] int NULL,
    CONSTRAINT [PK_MessageStatus] PRIMARY KEY ([id]),
    CONSTRAINT [FK_MessageStatus_Users_Userid] FOREIGN KEY ([Userid]) REFERENCES [Users] ([id])
);
2025-03-16 20:42:20.539 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Notifications] (
    [id] int NOT NULL IDENTITY,
    [related_type] nvarchar(max) NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [user_id] int NOT NULL,
    [is_seen] bit NOT NULL,
    [related_id] int NOT NULL,
    CONSTRAINT [PK_Notifications] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Notifications_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:42:20.545 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [OTPs] (
    [Id] int NOT NULL IDENTITY,
    [UserId] int NOT NULL,
    [OTPCode] nvarchar(6) NOT NULL,
    [ExpiryDate] datetime2 NOT NULL,
    [IsUsed] bit NOT NULL,
    CONSTRAINT [PK_OTPs] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_OTPs_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:42:20.560 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Participants] (
    [id] int NOT NULL IDENTITY,
    [conversation_id] int NOT NULL,
    [user_id] int NOT NULL,
    [joined_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_Participants] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Participants_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Participants_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:42:20.566 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role_of_User] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [role_id] int NOT NULL,
    CONSTRAINT [PK_Role_of_User] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Role_of_User_Role_role_id] FOREIGN KEY ([role_id]) REFERENCES [Role] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Role_of_User_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:42:20.572 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Stories] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [expires_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Stories] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Stories_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:42:20.586 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Attachments] (
    [id] int NOT NULL IDENTITY,
    [file_url] nvarchar(255) NOT NULL,
    [FileSize] real NOT NULL,
    [file_type] nvarchar(50) NOT NULL,
    [uploaded_at] datetime2 NOT NULL,
    [message_id] int NOT NULL,
    CONSTRAINT [PK_Attachments] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Attachments_Messages_message_id] FOREIGN KEY ([message_id]) REFERENCES [Messages] ([id]) ON DELETE CASCADE
);
2025-03-16 20:42:20.642 +07:00 [ERR] Failed executing DbCommand (49ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [StoryReactions] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [story_id] int NOT NULL,
    [reaction_type] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_StoryReactions] PRIMARY KEY ([id]),
    CONSTRAINT [FK_StoryReactions_Stories_story_id] FOREIGN KEY ([story_id]) REFERENCES [Stories] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_StoryReactions_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:01.092 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 20:43:01.184 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-03-16 20:43:01.223 +07:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-03-16 20:43:01.331 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-03-16 20:43:01.339 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 20:43:01.342 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-03-16 20:43:01.359 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-03-16 20:43:01.392 +07:00 [INF] Applying migration '20250316134208_InitialCreate'.
2025-03-16 20:43:01.489 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-03-16 20:43:01.493 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role] (
    [id] int NOT NULL IDENTITY,
    [role_name] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Role] PRIMARY KEY ([id])
);
2025-03-16 20:43:01.498 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [id] int NOT NULL IDENTITY,
    [username] nvarchar(200) NOT NULL,
    [password] nvarchar(max) NOT NULL,
    [passwordSalt] nvarchar(max) NOT NULL,
    [email] nvarchar(max) NOT NULL,
    [avatar_url] nvarchar(max) NOT NULL,
    [birthday] date NOT NULL,
    [created_at] datetime2 NOT NULL,
    [gender] bit NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([id])
);
2025-03-16 20:43:01.512 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [GroupSettings] (
    [Id] int NOT NULL IDENTITY,
    [ConversationId] int NOT NULL,
    [Privacy] bit NOT NULL,
    [AllowMemberInvite] bit NOT NULL,
    [AllowMemberEdit] bit NOT NULL,
    [CreatedBy] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [IsActive] bit NOT NULL,
    [ImageUrl] nvarchar(255) NOT NULL,
    CONSTRAINT [PK_GroupSettings] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_GroupSettings_Conversations_ConversationId] FOREIGN KEY ([ConversationId]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_GroupSettings_Users_CreatedBy] FOREIGN KEY ([CreatedBy]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:01.527 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Messages] (
    [id] int NOT NULL IDENTITY,
    [content] nvarchar(500) NOT NULL,
    [sender_id] int NOT NULL,
    [is_read] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    [conversation_id] int NOT NULL,
    CONSTRAINT [PK_Messages] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Messages_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Messages_Users_sender_id] FOREIGN KEY ([sender_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:01.532 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [MessageStatus] (
    [id] int NOT NULL IDENTITY,
    [message_id] int NOT NULL,
    [receiver_id] int NOT NULL,
    [status] nvarchar(50) NOT NULL,
    [updated_at] datetime2 NOT NULL,
    [Userid] int NULL,
    CONSTRAINT [PK_MessageStatus] PRIMARY KEY ([id]),
    CONSTRAINT [FK_MessageStatus_Users_Userid] FOREIGN KEY ([Userid]) REFERENCES [Users] ([id])
);
2025-03-16 20:43:01.548 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Notifications] (
    [id] int NOT NULL IDENTITY,
    [related_type] nvarchar(max) NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [user_id] int NOT NULL,
    [is_seen] bit NOT NULL,
    [related_id] int NOT NULL,
    CONSTRAINT [PK_Notifications] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Notifications_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:01.554 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [OTPs] (
    [Id] int NOT NULL IDENTITY,
    [UserId] int NOT NULL,
    [OTPCode] nvarchar(6) NOT NULL,
    [ExpiryDate] datetime2 NOT NULL,
    [IsUsed] bit NOT NULL,
    CONSTRAINT [PK_OTPs] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_OTPs_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:01.559 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Participants] (
    [id] int NOT NULL IDENTITY,
    [conversation_id] int NOT NULL,
    [user_id] int NOT NULL,
    [joined_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_Participants] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Participants_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Participants_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:01.576 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role_of_User] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [role_id] int NOT NULL,
    CONSTRAINT [PK_Role_of_User] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Role_of_User_Role_role_id] FOREIGN KEY ([role_id]) REFERENCES [Role] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Role_of_User_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:01.592 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Stories] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [expires_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Stories] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Stories_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:01.625 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Attachments] (
    [id] int NOT NULL IDENTITY,
    [file_url] nvarchar(255) NOT NULL,
    [FileSize] real NOT NULL,
    [file_type] nvarchar(50) NOT NULL,
    [uploaded_at] datetime2 NOT NULL,
    [message_id] int NOT NULL,
    CONSTRAINT [PK_Attachments] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Attachments_Messages_message_id] FOREIGN KEY ([message_id]) REFERENCES [Messages] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:01.653 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [StoryReactions] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [story_id] int NOT NULL,
    [reaction_type] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_StoryReactions] PRIMARY KEY ([id]),
    CONSTRAINT [FK_StoryReactions_Stories_story_id] FOREIGN KEY ([story_id]) REFERENCES [Stories] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_StoryReactions_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id])
);
2025-03-16 20:43:01.723 +07:00 [ERR] Failed executing DbCommand (53ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [StoryViewers] (
    [id] int NOT NULL IDENTITY,
    [story_id] int NOT NULL,
    [user_id] int NOT NULL,
    [viewed_at] datetime2 NOT NULL,
    CONSTRAINT [PK_StoryViewers] PRIMARY KEY ([id]),
    CONSTRAINT [FK_StoryViewers_Stories_story_id] FOREIGN KEY ([story_id]) REFERENCES [Stories] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_StoryViewers_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:34.824 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 20:43:34.907 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-03-16 20:43:34.942 +07:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-03-16 20:43:35.037 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-03-16 20:43:35.048 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 20:43:35.051 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-03-16 20:43:35.070 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-03-16 20:43:35.092 +07:00 [INF] Applying migration '20250316134208_InitialCreate'.
2025-03-16 20:43:35.184 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Conversations] (
    [id] int NOT NULL IDENTITY,
    [name] nvarchar(100) NOT NULL,
    [is_group] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Conversations] PRIMARY KEY ([id])
);
2025-03-16 20:43:35.188 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role] (
    [id] int NOT NULL IDENTITY,
    [role_name] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Role] PRIMARY KEY ([id])
);
2025-03-16 20:43:35.192 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [id] int NOT NULL IDENTITY,
    [username] nvarchar(200) NOT NULL,
    [password] nvarchar(max) NOT NULL,
    [passwordSalt] nvarchar(max) NOT NULL,
    [email] nvarchar(max) NOT NULL,
    [avatar_url] nvarchar(max) NOT NULL,
    [birthday] date NOT NULL,
    [created_at] datetime2 NOT NULL,
    [gender] bit NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([id])
);
2025-03-16 20:43:35.197 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [GroupSettings] (
    [Id] int NOT NULL IDENTITY,
    [ConversationId] int NOT NULL,
    [Privacy] bit NOT NULL,
    [AllowMemberInvite] bit NOT NULL,
    [AllowMemberEdit] bit NOT NULL,
    [CreatedBy] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [IsActive] bit NOT NULL,
    [ImageUrl] nvarchar(255) NOT NULL,
    CONSTRAINT [PK_GroupSettings] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_GroupSettings_Conversations_ConversationId] FOREIGN KEY ([ConversationId]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_GroupSettings_Users_CreatedBy] FOREIGN KEY ([CreatedBy]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:35.207 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Messages] (
    [id] int NOT NULL IDENTITY,
    [content] nvarchar(500) NOT NULL,
    [sender_id] int NOT NULL,
    [is_read] bit NOT NULL,
    [created_at] datetime2 NOT NULL,
    [conversation_id] int NOT NULL,
    CONSTRAINT [PK_Messages] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Messages_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Messages_Users_sender_id] FOREIGN KEY ([sender_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:35.214 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [MessageStatus] (
    [id] int NOT NULL IDENTITY,
    [message_id] int NOT NULL,
    [receiver_id] int NOT NULL,
    [status] nvarchar(50) NOT NULL,
    [updated_at] datetime2 NOT NULL,
    [Userid] int NULL,
    CONSTRAINT [PK_MessageStatus] PRIMARY KEY ([id]),
    CONSTRAINT [FK_MessageStatus_Users_Userid] FOREIGN KEY ([Userid]) REFERENCES [Users] ([id])
);
2025-03-16 20:43:35.223 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Notifications] (
    [id] int NOT NULL IDENTITY,
    [related_type] nvarchar(max) NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [user_id] int NOT NULL,
    [is_seen] bit NOT NULL,
    [related_id] int NOT NULL,
    CONSTRAINT [PK_Notifications] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Notifications_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:35.233 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [OTPs] (
    [Id] int NOT NULL IDENTITY,
    [UserId] int NOT NULL,
    [OTPCode] nvarchar(6) NOT NULL,
    [ExpiryDate] datetime2 NOT NULL,
    [IsUsed] bit NOT NULL,
    CONSTRAINT [PK_OTPs] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_OTPs_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:35.238 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Participants] (
    [id] int NOT NULL IDENTITY,
    [conversation_id] int NOT NULL,
    [user_id] int NOT NULL,
    [joined_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_Participants] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Participants_Conversations_conversation_id] FOREIGN KEY ([conversation_id]) REFERENCES [Conversations] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Participants_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:35.243 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Role_of_User] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [role_id] int NOT NULL,
    CONSTRAINT [PK_Role_of_User] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Role_of_User_Role_role_id] FOREIGN KEY ([role_id]) REFERENCES [Role] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Role_of_User_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:35.255 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Stories] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [content] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [expires_at] datetime2 NOT NULL,
    CONSTRAINT [PK_Stories] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Stories_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:35.262 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Attachments] (
    [id] int NOT NULL IDENTITY,
    [file_url] nvarchar(255) NOT NULL,
    [FileSize] real NOT NULL,
    [file_type] nvarchar(50) NOT NULL,
    [uploaded_at] datetime2 NOT NULL,
    [message_id] int NOT NULL,
    CONSTRAINT [PK_Attachments] PRIMARY KEY ([id]),
    CONSTRAINT [FK_Attachments_Messages_message_id] FOREIGN KEY ([message_id]) REFERENCES [Messages] ([id]) ON DELETE CASCADE
);
2025-03-16 20:43:35.278 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [StoryReactions] (
    [id] int NOT NULL IDENTITY,
    [user_id] int NOT NULL,
    [story_id] int NOT NULL,
    [reaction_type] nvarchar(max) NOT NULL,
    [created_at] datetime2 NOT NULL,
    [is_deleted] bit NOT NULL,
    CONSTRAINT [PK_StoryReactions] PRIMARY KEY ([id]),
    CONSTRAINT [FK_StoryReactions_Stories_story_id] FOREIGN KEY ([story_id]) REFERENCES [Stories] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_StoryReactions_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id])
);
2025-03-16 20:43:35.293 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [StoryViewers] (
    [id] int NOT NULL IDENTITY,
    [story_id] int NOT NULL,
    [user_id] int NOT NULL,
    [viewed_at] datetime2 NOT NULL,
    CONSTRAINT [PK_StoryViewers] PRIMARY KEY ([id]),
    CONSTRAINT [FK_StoryViewers_Stories_story_id] FOREIGN KEY ([story_id]) REFERENCES [Stories] ([id]) ON DELETE CASCADE,
    CONSTRAINT [FK_StoryViewers_Users_user_id] FOREIGN KEY ([user_id]) REFERENCES [Users] ([id])
);
2025-03-16 20:43:35.333 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Attachments_message_id] ON [Attachments] ([message_id]);
2025-03-16 20:43:35.337 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_GroupSettings_ConversationId] ON [GroupSettings] ([ConversationId]);
2025-03-16 20:43:35.352 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_GroupSettings_CreatedBy] ON [GroupSettings] ([CreatedBy]);
2025-03-16 20:43:35.356 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Messages_conversation_id] ON [Messages] ([conversation_id]);
2025-03-16 20:43:35.378 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Messages_sender_id] ON [Messages] ([sender_id]);
2025-03-16 20:43:35.384 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_MessageStatus_Userid] ON [MessageStatus] ([Userid]);
2025-03-16 20:43:35.389 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Notifications_user_id] ON [Notifications] ([user_id]);
2025-03-16 20:43:35.408 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_OTPs_UserId] ON [OTPs] ([UserId]);
2025-03-16 20:43:35.412 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Participants_conversation_id] ON [Participants] ([conversation_id]);
2025-03-16 20:43:35.416 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Participants_user_id] ON [Participants] ([user_id]);
2025-03-16 20:43:35.428 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Role_of_User_role_id] ON [Role_of_User] ([role_id]);
2025-03-16 20:43:35.437 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Role_of_User_user_id] ON [Role_of_User] ([user_id]);
2025-03-16 20:43:35.441 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Stories_user_id] ON [Stories] ([user_id]);
2025-03-16 20:43:35.445 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_StoryReactions_story_id] ON [StoryReactions] ([story_id]);
2025-03-16 20:43:35.448 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_StoryReactions_user_id] ON [StoryReactions] ([user_id]);
2025-03-16 20:43:35.463 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_StoryViewers_story_id] ON [StoryViewers] ([story_id]);
2025-03-16 20:43:35.470 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_StoryViewers_user_id] ON [StoryViewers] ([user_id]);
2025-03-16 20:43:35.476 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250316134208_InitialCreate', N'9.0.2');
2025-03-16 20:43:35.489 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-03-16 21:06:24.472 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 21:06:24.548 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-03-16 21:06:24.595 +07:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-03-16 21:06:24.720 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-03-16 21:06:24.730 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-03-16 21:06:24.733 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-03-16 21:06:24.745 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-03-16 21:06:24.762 +07:00 [INF] Applying migration '20250316140612_AddFriendTables'.
2025-03-16 21:06:24.882 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [FriendRequests] (
    [Id] int NOT NULL IDENTITY,
    [SenderId] int NOT NULL,
    [ReceiverId] int NOT NULL,
    [Status] nvarchar(20) NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    CONSTRAINT [PK_FriendRequests] PRIMARY KEY ([Id]),
    CONSTRAINT [CK_FriendRequest_SenderReceiver] CHECK ([SenderId] != [ReceiverId]),
    CONSTRAINT [FK_FriendRequests_Users_ReceiverId] FOREIGN KEY ([ReceiverId]) REFERENCES [Users] ([id]) ON DELETE NO ACTION,
    CONSTRAINT [FK_FriendRequests_Users_SenderId] FOREIGN KEY ([SenderId]) REFERENCES [Users] ([id]) ON DELETE NO ACTION
);
2025-03-16 21:06:24.889 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Friends] (
    [Id] int NOT NULL IDENTITY,
    [UserId1] int NOT NULL,
    [UserId2] int NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    CONSTRAINT [PK_Friends] PRIMARY KEY ([Id]),
    CONSTRAINT [CK_Friends_User1User2] CHECK ([UserId1] != [UserId2]),
    CONSTRAINT [FK_Friends_Users_UserId1] FOREIGN KEY ([UserId1]) REFERENCES [Users] ([id]) ON DELETE NO ACTION,
    CONSTRAINT [FK_Friends_Users_UserId2] FOREIGN KEY ([UserId2]) REFERENCES [Users] ([id]) ON DELETE NO ACTION
);
2025-03-16 21:06:24.894 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_FriendRequests_ReceiverId] ON [FriendRequests] ([ReceiverId]);
2025-03-16 21:06:24.897 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_FriendRequests_SenderId] ON [FriendRequests] ([SenderId]);
2025-03-16 21:06:24.902 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX [IX_Friends_UserId1_UserId2] ON [Friends] ([UserId1], [UserId2]);
2025-03-16 21:06:24.906 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Friends_UserId2] ON [Friends] ([UserId2]);
2025-03-16 21:06:24.926 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250316140612_AddFriendTables', N'9.0.2');
2025-03-16 21:06:24.931 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-03-16 22:32:14.989 +07:00 [INF] User profile is available. Using 'C:\Users\luong\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-03-16 22:32:15.175 +07:00 [INF] Now listening on: http://localhost:5053
2025-03-16 22:32:15.178 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-03-16 22:32:15.179 +07:00 [INF] Hosting environment: Development
2025-03-16 22:32:15.179 +07:00 [INF] Content root path: D:\StudioProject\Message-App\server
2025-03-16 22:32:16.363 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/index.html - null null
2025-03-16 22:32:16.739 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/index.html - 200 null text/html;charset=utf-8 385.6325ms
2025-03-16 22:32:16.755 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/swagger-ui.css - null null
2025-03-16 22:32:16.755 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/index.css - null null
2025-03-16 22:32:16.763 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/_framework/aspnetcore-browser-refresh.js - null null
2025-03-16 22:32:16.766 +07:00 [INF] The file /index.css was not modified
2025-03-16 22:32:16.766 +07:00 [INF] The file /swagger-ui.css was not modified
2025-03-16 22:32:16.766 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/swagger-ui-standalone-preset.js - null null
2025-03-16 22:32:16.767 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/swagger-ui.css - 304 null text/css 13.7056ms
2025-03-16 22:32:16.767 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/index.css - 304 null text/css 11.9343ms
2025-03-16 22:32:16.767 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/swagger-ui-bundle.js - null null
2025-03-16 22:32:16.770 +07:00 [INF] The file /swagger-ui-bundle.js was not modified
2025-03-16 22:32:16.770 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/swagger-ui-bundle.js - 304 null text/javascript 5.7011ms
2025-03-16 22:32:16.773 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/index.js - null null
2025-03-16 22:32:16.773 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/_framework/aspnetcore-browser-refresh.js - 200 13732 application/javascript; charset=utf-8 10.449ms
2025-03-16 22:32:16.778 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/index.js - 200 null application/javascript;charset=utf-8 5.2259ms
2025-03-16 22:32:16.810 +07:00 [INF] The file /swagger-ui-standalone-preset.js was not modified
2025-03-16 22:32:16.811 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/swagger-ui-standalone-preset.js - 304 null text/javascript 44.6809ms
2025-03-16 22:32:17.201 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/v1/swagger.json - null null
2025-03-16 22:32:17.275 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/favicon-32x32.png - null null
2025-03-16 22:32:17.283 +07:00 [INF] The file /favicon-32x32.png was not modified
2025-03-16 22:32:17.286 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/favicon-32x32.png - 304 null image/png 11.7497ms
2025-03-16 22:32:17.476 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 275.0981ms
2025-03-16 22:35:29.610 +07:00 [INF] User profile is available. Using 'C:\Users\luong\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-03-16 22:35:29.747 +07:00 [INF] Now listening on: http://localhost:5053
2025-03-16 22:35:29.750 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-03-16 22:35:29.750 +07:00 [INF] Hosting environment: Development
2025-03-16 22:35:29.750 +07:00 [INF] Content root path: D:\StudioProject\Message-App\server
2025-03-16 22:35:30.120 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/index.html - null null
2025-03-16 22:35:30.415 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/index.html - 200 null text/html;charset=utf-8 298.1509ms
2025-03-16 22:35:30.427 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/index.js - null null
2025-03-16 22:35:30.430 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/_framework/aspnetcore-browser-refresh.js - null null
2025-03-16 22:35:30.434 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/index.js - 200 null application/javascript;charset=utf-8 8.3233ms
2025-03-16 22:35:30.438 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/_framework/aspnetcore-browser-refresh.js - 200 13732 application/javascript; charset=utf-8 7.5408ms
2025-03-16 22:35:30.753 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/v1/swagger.json - null null
2025-03-16 22:35:30.944 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 191.7828ms
2025-03-16 22:37:04.580 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Friends/send-request - application/json 38
2025-03-16 22:37:04.634 +07:00 [INF] CORS policy execution successful.
2025-03-16 22:37:04.636 +07:00 [WRN] Failed to determine the https port for redirect.
2025-03-16 22:37:06.326 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.SendFriendRequest (Message_app)'
2025-03-16 22:37:06.348 +07:00 [INF] Route matched with {action = "SendFriendRequest", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendFriendRequest(FriendRequestDto) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:37:09.378 +07:00 [INF] Executed DbCommand (118ms) [Parameters=[@__senderId_0='?' (DbType = Int32), @__receiverId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status]
FROM [FriendRequests] AS [f]
WHERE [f].[SenderId] = @__senderId_0 AND [f].[ReceiverId] = @__receiverId_1 AND [f].[Status] = N'Pending'
2025-03-16 22:37:09.491 +07:00 [INF] Executed action server.Controllers.FriendsController.SendFriendRequest (Message_app) in 3139.5435ms
2025-03-16 22:37:09.492 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.SendFriendRequest (Message_app)'
2025-03-16 22:37:09.494 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Friend request already sent
   at server.Services.FriendSV.SendFriendRequestAsync(Int32 senderId, Int32 receiverId) in D:\StudioProject\Message-App\server\Services\FriendService\FriendSV.cs:line 30
   at server.Controllers.FriendsController.SendFriendRequest(FriendRequestDto request) in D:\StudioProject\Message-App\server\Controllers\FriendsController.cs:line 22
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-03-16 22:37:09.538 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Friends/send-request - 500 null text/plain; charset=utf-8 4958.7607ms
2025-03-16 22:37:18.303 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Friends/send-request - application/json 38
2025-03-16 22:37:18.307 +07:00 [INF] CORS policy execution successful.
2025-03-16 22:37:18.310 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.SendFriendRequest (Message_app)'
2025-03-16 22:37:18.311 +07:00 [INF] Route matched with {action = "SendFriendRequest", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendFriendRequest(FriendRequestDto) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:37:18.410 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__senderId_0='?' (DbType = Int32), @__receiverId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status]
FROM [FriendRequests] AS [f]
WHERE [f].[SenderId] = @__senderId_0 AND [f].[ReceiverId] = @__receiverId_1 AND [f].[Status] = N'Pending'
2025-03-16 22:37:18.555 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [FriendRequests] ([CreatedAt], [ReceiverId], [SenderId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2025-03-16 22:37:18.657 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-03-16 22:37:18.779 +07:00 [WRN] User 3 not connected or WebSocket closed.
2025-03-16 22:37:18.789 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-03-16 22:37:18.806 +07:00 [INF] Executed action server.Controllers.FriendsController.SendFriendRequest (Message_app) in 494.2954ms
2025-03-16 22:37:18.806 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.SendFriendRequest (Message_app)'
2025-03-16 22:37:18.809 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Friends/send-request - 200 null application/json; charset=utf-8 506.1368ms
2025-03-16 22:37:38.211 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/requests/3 - null null
2025-03-16 22:37:38.214 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:37:38.240 +07:00 [INF] Route matched with {action = "GetPendingRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPendingRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:37:38.411 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-03-16 22:37:38.413 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.FriendRequest, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:37:38.468 +07:00 [INF] Executed action server.Controllers.FriendsController.GetPendingRequests (Message_app) in 227.1294ms
2025-03-16 22:37:38.474 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:37:38.477 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Text.Json.JsonException: A possible object cycle was detected. This can either be due to a cycle or if the object depth is larger than the maximum allowed depth of 32. Consider using ReferenceHandler.Preserve on JsonSerializerOptions to support cycles. Path: $.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Id.
   at System.Text.Json.ThrowHelper.ThrowJsonException_SerializerCycleDetected(Int32 maxDepth)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.ListOfTConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.WriteCore(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.SerializeAsync(PipeWriter pipeWriter, T rootValue, Int32 flushThreshold, CancellationToken cancellationToken, Object rootValueBoxed)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.SerializeAsync(PipeWriter pipeWriter, T rootValue, Int32 flushThreshold, CancellationToken cancellationToken, Object rootValueBoxed)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.SerializeAsync(PipeWriter pipeWriter, T rootValue, Int32 flushThreshold, CancellationToken cancellationToken, Object rootValueBoxed)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter.WriteResponseBodyAsync(OutputFormatterWriteContext context, Encoding selectedEncoding)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResultFilterAsync>g__Awaited|30_0[TFilter,TFilterAsync](ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-03-16 22:37:38.501 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/requests/3 - 500 null text/plain; charset=utf-8 290.0769ms
2025-03-16 22:37:44.108 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/requests/2 - null null
2025-03-16 22:37:44.109 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:37:44.109 +07:00 [INF] Route matched with {action = "GetPendingRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPendingRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:37:44.148 +07:00 [INF] Executed DbCommand (34ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-03-16 22:37:44.149 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.FriendRequest, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:37:44.150 +07:00 [INF] Executed action server.Controllers.FriendsController.GetPendingRequests (Message_app) in 40.9895ms
2025-03-16 22:37:44.151 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:37:44.151 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Text.Json.JsonException: A possible object cycle was detected. This can either be due to a cycle or if the object depth is larger than the maximum allowed depth of 32. Consider using ReferenceHandler.Preserve on JsonSerializerOptions to support cycles. Path: $.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Id.
   at System.Text.Json.ThrowHelper.ThrowJsonException_SerializerCycleDetected(Int32 maxDepth)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.ListOfTConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.WriteCore(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.SerializeAsync(PipeWriter pipeWriter, T rootValue, Int32 flushThreshold, CancellationToken cancellationToken, Object rootValueBoxed)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.SerializeAsync(PipeWriter pipeWriter, T rootValue, Int32 flushThreshold, CancellationToken cancellationToken, Object rootValueBoxed)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.SerializeAsync(PipeWriter pipeWriter, T rootValue, Int32 flushThreshold, CancellationToken cancellationToken, Object rootValueBoxed)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter.WriteResponseBodyAsync(OutputFormatterWriteContext context, Encoding selectedEncoding)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResultFilterAsync>g__Awaited|30_0[TFilter,TFilterAsync](ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-03-16 22:37:44.182 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/requests/2 - 500 null text/plain; charset=utf-8 73.7143ms
2025-03-16 22:37:47.178 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/requests/1 - null null
2025-03-16 22:37:47.179 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:37:47.179 +07:00 [INF] Route matched with {action = "GetPendingRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPendingRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:37:47.186 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-03-16 22:37:47.186 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.FriendRequest, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:37:47.187 +07:00 [INF] Executed action server.Controllers.FriendsController.GetPendingRequests (Message_app) in 7.6864ms
2025-03-16 22:37:47.187 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:37:47.187 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/requests/1 - 200 null application/json; charset=utf-8 8.8962ms
2025-03-16 22:38:07.130 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/1 - null 0
2025-03-16 22:38:07.131 +07:00 [INF] CORS policy execution successful.
2025-03-16 22:38:07.131 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:38:07.135 +07:00 [INF] Route matched with {action = "AcceptFriendRequest", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AcceptFriendRequest(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:38:07.190 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[@__requestId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[Id] = @__requestId_0
2025-03-16 22:38:07.278 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (Size = 20), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [FriendRequests] SET [Status] = @p0
OUTPUT 1
WHERE [Id] = @p1;
INSERT INTO [Friends] ([CreatedAt], [UserId1], [UserId2])
OUTPUT INSERTED.[Id]
VALUES (@p2, @p3, @p4);
2025-03-16 22:38:07.300 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-03-16 22:38:07.306 +07:00 [WRN] User 1 not connected or WebSocket closed.
2025-03-16 22:38:07.306 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-03-16 22:38:07.306 +07:00 [INF] Executed action server.Controllers.FriendsController.AcceptFriendRequest (Message_app) in 171.1388ms
2025-03-16 22:38:07.306 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:38:07.307 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/1 - 200 null application/json; charset=utf-8 176.3296ms
2025-03-16 22:38:17.304 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/3 - null 0
2025-03-16 22:38:17.305 +07:00 [INF] CORS policy execution successful.
2025-03-16 22:38:17.305 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:38:17.305 +07:00 [INF] Route matched with {action = "AcceptFriendRequest", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AcceptFriendRequest(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:38:17.312 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__requestId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[Id] = @__requestId_0
2025-03-16 22:38:17.313 +07:00 [INF] Executed action server.Controllers.FriendsController.AcceptFriendRequest (Message_app) in 7.8921ms
2025-03-16 22:38:17.314 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:38:17.315 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Invalid or already processed friend request
   at server.Services.FriendSV.AcceptFriendRequestAsync(Int32 requestId) in D:\StudioProject\Message-App\server\Services\FriendService\FriendSV.cs:line 69
   at server.Controllers.FriendsController.AcceptFriendRequest(Int32 requestId) in D:\StudioProject\Message-App\server\Controllers\FriendsController.cs:line 38
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-03-16 22:38:17.318 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/3 - 500 null text/plain; charset=utf-8 14.0496ms
2025-03-16 22:38:27.796 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Friends/reject-request/3 - null 0
2025-03-16 22:38:27.796 +07:00 [INF] CORS policy execution successful.
2025-03-16 22:38:27.796 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.RejectFriendRequest (Message_app)'
2025-03-16 22:38:27.801 +07:00 [INF] Route matched with {action = "RejectFriendRequest", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RejectFriendRequest(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:38:27.840 +07:00 [INF] Executed DbCommand (33ms) [Parameters=[@__requestId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[Id] = @__requestId_0
2025-03-16 22:38:27.843 +07:00 [INF] Executed action server.Controllers.FriendsController.RejectFriendRequest (Message_app) in 41.8967ms
2025-03-16 22:38:27.843 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.RejectFriendRequest (Message_app)'
2025-03-16 22:38:27.843 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Invalid or already processed friend request
   at server.Services.FriendSV.RejectFriendRequestAsync(Int32 requestId) in D:\StudioProject\Message-App\server\Services\FriendService\FriendSV.cs:line 100
   at server.Controllers.FriendsController.RejectFriendRequest(Int32 requestId) in D:\StudioProject\Message-App\server\Controllers\FriendsController.cs:line 46
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-03-16 22:38:27.848 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Friends/reject-request/3 - 500 null text/plain; charset=utf-8 52.7374ms
2025-03-16 22:38:30.969 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Friends/reject-request/1 - null 0
2025-03-16 22:38:30.969 +07:00 [INF] CORS policy execution successful.
2025-03-16 22:38:30.969 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.RejectFriendRequest (Message_app)'
2025-03-16 22:38:30.969 +07:00 [INF] Route matched with {action = "RejectFriendRequest", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RejectFriendRequest(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:38:30.976 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__requestId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[Id] = @__requestId_0
2025-03-16 22:38:30.982 +07:00 [INF] Executed action server.Controllers.FriendsController.RejectFriendRequest (Message_app) in 12.9649ms
2025-03-16 22:38:30.983 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.RejectFriendRequest (Message_app)'
2025-03-16 22:38:30.983 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Invalid or already processed friend request
   at server.Services.FriendSV.RejectFriendRequestAsync(Int32 requestId) in D:\StudioProject\Message-App\server\Services\FriendService\FriendSV.cs:line 100
   at server.Controllers.FriendsController.RejectFriendRequest(Int32 requestId) in D:\StudioProject\Message-App\server\Controllers\FriendsController.cs:line 46
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-03-16 22:38:30.991 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Friends/reject-request/1 - 500 null text/plain; charset=utf-8 22.4596ms
2025-03-16 22:38:36.036 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/list/1 - null null
2025-03-16 22:38:36.037 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriends (Message_app)'
2025-03-16 22:38:36.040 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:38:36.125 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT ~CAST([f].[UserId1] ^ @__userId_0 AS bit), [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[gender], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-03-16 22:38:36.126 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:38:36.128 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriends (Message_app) in 88.0783ms
2025-03-16 22:38:36.128 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriends (Message_app)'
2025-03-16 22:38:36.128 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/list/1 - 200 null application/json; charset=utf-8 91.6592ms
2025-03-16 22:38:47.188 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/list/3 - null null
2025-03-16 22:38:47.188 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriends (Message_app)'
2025-03-16 22:38:47.189 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:38:47.218 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT ~CAST([f].[UserId1] ^ @__userId_0 AS bit), [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[gender], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-03-16 22:38:47.219 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:38:47.220 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriends (Message_app) in 31.3897ms
2025-03-16 22:38:47.220 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriends (Message_app)'
2025-03-16 22:38:47.224 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/list/3 - 200 null application/json; charset=utf-8 35.6363ms
2025-03-16 22:38:53.052 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/list/2 - null null
2025-03-16 22:38:53.052 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriends (Message_app)'
2025-03-16 22:38:53.053 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:38:53.059 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT ~CAST([f].[UserId1] ^ @__userId_0 AS bit), [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[gender], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-03-16 22:38:53.060 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:38:53.060 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriends (Message_app) in 7.5803ms
2025-03-16 22:38:53.061 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriends (Message_app)'
2025-03-16 22:38:53.061 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/list/2 - 200 null application/json; charset=utf-8 9.2129ms
2025-03-16 22:48:10.641 +07:00 [INF] User profile is available. Using 'C:\Users\luong\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-03-16 22:48:10.881 +07:00 [INF] Now listening on: http://localhost:5053
2025-03-16 22:48:10.884 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-03-16 22:48:10.885 +07:00 [INF] Hosting environment: Development
2025-03-16 22:48:10.885 +07:00 [INF] Content root path: D:\StudioProject\Message-App\server
2025-03-16 22:48:11.865 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/index.html - null null
2025-03-16 22:48:12.195 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/index.html - 200 null text/html;charset=utf-8 338.6447ms
2025-03-16 22:48:12.229 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/index.js - null null
2025-03-16 22:48:12.243 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/_framework/aspnetcore-browser-refresh.js - null null
2025-03-16 22:48:12.243 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/index.js - 200 null application/javascript;charset=utf-8 22.3883ms
2025-03-16 22:48:13.146 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/_framework/aspnetcore-browser-refresh.js - 200 13732 application/javascript; charset=utf-8 902.3994ms
2025-03-16 22:48:13.256 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/v1/swagger.json - null null
2025-03-16 22:48:13.618 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 361.0888ms
2025-03-16 22:48:32.337 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/requests/1 - null null
2025-03-16 22:48:32.398 +07:00 [WRN] Failed to determine the https port for redirect.
2025-03-16 22:48:32.815 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:48:32.887 +07:00 [INF] Route matched with {action = "GetPendingRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPendingRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:48:35.161 +07:00 [INF] Executed DbCommand (39ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-03-16 22:48:35.196 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.FriendRequest, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:48:35.278 +07:00 [INF] Executed action server.Controllers.FriendsController.GetPendingRequests (Message_app) in 2385.5826ms
2025-03-16 22:48:35.279 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:48:35.287 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/requests/1 - 200 null application/json; charset=utf-8 2950.1485ms
2025-03-16 22:48:50.294 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Friends/send-request - application/json 38
2025-03-16 22:48:50.314 +07:00 [INF] CORS policy execution successful.
2025-03-16 22:48:50.333 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.SendFriendRequest (Message_app)'
2025-03-16 22:48:50.341 +07:00 [INF] Route matched with {action = "SendFriendRequest", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendFriendRequest(FriendRequestDto) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:48:50.425 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__senderId_0='?' (DbType = Int32), @__receiverId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status]
FROM [FriendRequests] AS [f]
WHERE [f].[SenderId] = @__senderId_0 AND [f].[ReceiverId] = @__receiverId_1 AND [f].[Status] = N'Pending'
2025-03-16 22:48:50.690 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [FriendRequests] ([CreatedAt], [ReceiverId], [SenderId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2025-03-16 22:48:50.740 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-03-16 22:48:50.831 +07:00 [WRN] User 2 not connected or WebSocket closed.
2025-03-16 22:48:50.832 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-03-16 22:48:50.835 +07:00 [INF] Executed action server.Controllers.FriendsController.SendFriendRequest (Message_app) in 493.6524ms
2025-03-16 22:48:50.835 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.SendFriendRequest (Message_app)'
2025-03-16 22:48:50.836 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Friends/send-request - 200 null application/json; charset=utf-8 541.7337ms
2025-03-16 22:48:56.718 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/requests/2 - null null
2025-03-16 22:48:56.721 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:48:56.721 +07:00 [INF] Route matched with {action = "GetPendingRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPendingRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:48:56.942 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-03-16 22:48:56.944 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.FriendRequest, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:48:56.984 +07:00 [INF] Executed action server.Controllers.FriendsController.GetPendingRequests (Message_app) in 263.0532ms
2025-03-16 22:48:56.991 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:48:56.995 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Text.Json.JsonException: A possible object cycle was detected. This can either be due to a cycle or if the object depth is larger than the maximum allowed depth of 32. Consider using ReferenceHandler.Preserve on JsonSerializerOptions to support cycles. Path: $.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Id.
   at System.Text.Json.ThrowHelper.ThrowJsonException_SerializerCycleDetected(Int32 maxDepth)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.ListOfTConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.WriteCore(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.SerializeAsync(PipeWriter pipeWriter, T rootValue, Int32 flushThreshold, CancellationToken cancellationToken, Object rootValueBoxed)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.SerializeAsync(PipeWriter pipeWriter, T rootValue, Int32 flushThreshold, CancellationToken cancellationToken, Object rootValueBoxed)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.SerializeAsync(PipeWriter pipeWriter, T rootValue, Int32 flushThreshold, CancellationToken cancellationToken, Object rootValueBoxed)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter.WriteResponseBodyAsync(OutputFormatterWriteContext context, Encoding selectedEncoding)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResultFilterAsync>g__Awaited|30_0[TFilter,TFilterAsync](ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-03-16 22:48:57.045 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/requests/2 - 500 null text/plain; charset=utf-8 326.7097ms
2025-03-16 22:49:01.709 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/requests/1 - null null
2025-03-16 22:49:01.710 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:49:01.710 +07:00 [INF] Route matched with {action = "GetPendingRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPendingRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:49:01.716 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-03-16 22:49:01.716 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.FriendRequest, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:49:01.716 +07:00 [INF] Executed action server.Controllers.FriendsController.GetPendingRequests (Message_app) in 6.4842ms
2025-03-16 22:49:01.717 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:49:01.717 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/requests/1 - 200 null application/json; charset=utf-8 7.5603ms
2025-03-16 22:49:12.705 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/requests/1 - null null
2025-03-16 22:49:12.705 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:49:12.706 +07:00 [INF] Route matched with {action = "GetPendingRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPendingRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:49:12.732 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-03-16 22:49:12.733 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.FriendRequest, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:49:12.734 +07:00 [INF] Executed action server.Controllers.FriendsController.GetPendingRequests (Message_app) in 27.9327ms
2025-03-16 22:49:12.735 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:49:12.736 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/requests/1 - 200 null application/json; charset=utf-8 30.622ms
2025-03-16 22:49:18.435 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/requests/2 - null null
2025-03-16 22:49:18.435 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:49:18.436 +07:00 [INF] Route matched with {action = "GetPendingRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPendingRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:49:18.440 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-03-16 22:49:18.441 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.FriendRequest, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:49:18.444 +07:00 [INF] Executed action server.Controllers.FriendsController.GetPendingRequests (Message_app) in 8.3499ms
2025-03-16 22:49:18.445 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:49:18.446 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Text.Json.JsonException: A possible object cycle was detected. This can either be due to a cycle or if the object depth is larger than the maximum allowed depth of 32. Consider using ReferenceHandler.Preserve on JsonSerializerOptions to support cycles. Path: $.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Sender.SentFriendRequests.Id.
   at System.Text.Json.ThrowHelper.ThrowJsonException_SerializerCycleDetected(Int32 maxDepth)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.IEnumerableDefaultConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonPropertyInfo`1.GetMemberAndWriteJson(Object obj, WriteStack& state, Utf8JsonWriter writer)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryWrite(Utf8JsonWriter writer, T value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Converters.ListOfTConverter`2.OnWriteResume(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonCollectionConverter`2.OnTryWrite(Utf8JsonWriter writer, TCollection value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.TryWrite(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.JsonConverter`1.WriteCore(Utf8JsonWriter writer, T& value, JsonSerializerOptions options, WriteStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.SerializeAsync(PipeWriter pipeWriter, T rootValue, Int32 flushThreshold, CancellationToken cancellationToken, Object rootValueBoxed)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.SerializeAsync(PipeWriter pipeWriter, T rootValue, Int32 flushThreshold, CancellationToken cancellationToken, Object rootValueBoxed)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.SerializeAsync(PipeWriter pipeWriter, T rootValue, Int32 flushThreshold, CancellationToken cancellationToken, Object rootValueBoxed)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter.WriteResponseBodyAsync(OutputFormatterWriteContext context, Encoding selectedEncoding)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResultFilterAsync>g__Awaited|30_0[TFilter,TFilterAsync](ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-03-16 22:49:18.509 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/requests/2 - 500 null text/plain; charset=utf-8 74.4441ms
2025-03-16 22:52:29.471 +07:00 [INF] User profile is available. Using 'C:\Users\luong\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-03-16 22:52:29.651 +07:00 [INF] Now listening on: http://localhost:5053
2025-03-16 22:52:29.655 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-03-16 22:52:29.656 +07:00 [INF] Hosting environment: Development
2025-03-16 22:52:29.656 +07:00 [INF] Content root path: D:\StudioProject\Message-App\server
2025-03-16 22:52:30.212 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/index.html - null null
2025-03-16 22:52:30.568 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/index.html - 200 null text/html;charset=utf-8 358.2619ms
2025-03-16 22:52:30.624 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/index.js - null null
2025-03-16 22:52:30.624 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/_framework/aspnetcore-browser-refresh.js - null null
2025-03-16 22:52:30.631 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/_framework/aspnetcore-browser-refresh.js - 200 13732 application/javascript; charset=utf-8 7.7065ms
2025-03-16 22:52:30.631 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/index.js - 200 null application/javascript;charset=utf-8 7.6409ms
2025-03-16 22:52:31.000 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/swagger/v1/swagger.json - null null
2025-03-16 22:52:31.305 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 304.838ms
2025-03-16 22:52:41.429 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/requests/2 - null null
2025-03-16 22:52:41.488 +07:00 [WRN] Failed to determine the https port for redirect.
2025-03-16 22:52:41.535 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:52:41.571 +07:00 [INF] Route matched with {action = "GetPendingRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPendingRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:52:43.129 +07:00 [INF] Executed DbCommand (37ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status]
FROM [FriendRequests] AS [f]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-03-16 22:52:43.239 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.FriendRequest, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:52:43.345 +07:00 [INF] Executed action server.Controllers.FriendsController.GetPendingRequests (Message_app) in 1767.5163ms
2025-03-16 22:52:43.346 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:52:43.361 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/requests/2 - 200 null application/json; charset=utf-8 1932.17ms
2025-03-16 22:52:51.142 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/requests/1 - null null
2025-03-16 22:52:51.147 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:52:51.148 +07:00 [INF] Route matched with {action = "GetPendingRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPendingRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:52:51.224 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status]
FROM [FriendRequests] AS [f]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-03-16 22:52:51.225 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.FriendRequest, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:52:51.226 +07:00 [INF] Executed action server.Controllers.FriendsController.GetPendingRequests (Message_app) in 77.9951ms
2025-03-16 22:52:51.226 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:52:51.227 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/requests/1 - 200 null application/json; charset=utf-8 84.168ms
2025-03-16 22:52:53.826 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/requests/2 - null null
2025-03-16 22:52:53.830 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:52:53.830 +07:00 [INF] Route matched with {action = "GetPendingRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPendingRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:52:53.936 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status]
FROM [FriendRequests] AS [f]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-03-16 22:52:53.938 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.FriendRequest, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:52:53.938 +07:00 [INF] Executed action server.Controllers.FriendsController.GetPendingRequests (Message_app) in 108.2472ms
2025-03-16 22:52:53.938 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:52:53.939 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/requests/2 - 200 null application/json; charset=utf-8 113.3566ms
2025-03-16 22:52:55.365 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/requests/3 - null null
2025-03-16 22:52:55.366 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:52:55.366 +07:00 [INF] Route matched with {action = "GetPendingRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPendingRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:52:55.371 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status]
FROM [FriendRequests] AS [f]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-03-16 22:52:55.372 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.FriendRequest, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:52:55.373 +07:00 [INF] Executed action server.Controllers.FriendsController.GetPendingRequests (Message_app) in 6.6488ms
2025-03-16 22:52:55.374 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:52:55.374 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/requests/3 - 200 null application/json; charset=utf-8 8.9592ms
2025-03-16 22:52:58.525 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/requests/2 - null null
2025-03-16 22:52:58.525 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:52:58.525 +07:00 [INF] Route matched with {action = "GetPendingRequests", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPendingRequests(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:52:58.540 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status]
FROM [FriendRequests] AS [f]
WHERE [f].[ReceiverId] = @__userId_0 AND [f].[Status] = N'Pending'
2025-03-16 22:52:58.541 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.FriendRequest, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:52:58.542 +07:00 [INF] Executed action server.Controllers.FriendsController.GetPendingRequests (Message_app) in 16.2575ms
2025-03-16 22:52:58.542 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetPendingRequests (Message_app)'
2025-03-16 22:52:58.543 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/requests/2 - 200 null application/json; charset=utf-8 17.8415ms
2025-03-16 22:55:03.649 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/6 - null 0
2025-03-16 22:55:03.650 +07:00 [INF] CORS policy execution successful.
2025-03-16 22:55:03.655 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:55:03.668 +07:00 [INF] Route matched with {action = "AcceptFriendRequest", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AcceptFriendRequest(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:55:03.792 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__requestId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[Id] = @__requestId_0
2025-03-16 22:55:03.795 +07:00 [INF] Executed action server.Controllers.FriendsController.AcceptFriendRequest (Message_app) in 125.8407ms
2025-03-16 22:55:03.795 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:55:03.796 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Invalid or already processed friend request
   at server.Services.FriendSV.AcceptFriendRequestAsync(Int32 requestId) in D:\StudioProject\Message-App\server\Services\FriendService\FriendSV.cs:line 68
   at server.Controllers.FriendsController.AcceptFriendRequest(Int32 requestId) in D:\StudioProject\Message-App\server\Controllers\FriendsController.cs:line 38
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-03-16 22:55:04.211 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/6 - 500 null text/plain; charset=utf-8 561.5105ms
2025-03-16 22:55:06.792 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/1 - null 0
2025-03-16 22:55:06.793 +07:00 [INF] CORS policy execution successful.
2025-03-16 22:55:06.793 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:55:06.793 +07:00 [INF] Route matched with {action = "AcceptFriendRequest", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AcceptFriendRequest(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:55:06.796 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[Id] = @__requestId_0
2025-03-16 22:55:06.797 +07:00 [INF] Executed action server.Controllers.FriendsController.AcceptFriendRequest (Message_app) in 3.535ms
2025-03-16 22:55:06.797 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:55:06.798 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Invalid or already processed friend request
   at server.Services.FriendSV.AcceptFriendRequestAsync(Int32 requestId) in D:\StudioProject\Message-App\server\Services\FriendService\FriendSV.cs:line 68
   at server.Controllers.FriendsController.AcceptFriendRequest(Int32 requestId) in D:\StudioProject\Message-App\server\Controllers\FriendsController.cs:line 38
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-03-16 22:55:06.814 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/1 - 500 null text/plain; charset=utf-8 21.7289ms
2025-03-16 22:55:09.099 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/2 - null 0
2025-03-16 22:55:09.099 +07:00 [INF] CORS policy execution successful.
2025-03-16 22:55:09.099 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:55:09.100 +07:00 [INF] Route matched with {action = "AcceptFriendRequest", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AcceptFriendRequest(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:55:09.102 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[Id] = @__requestId_0
2025-03-16 22:55:09.102 +07:00 [INF] Executed action server.Controllers.FriendsController.AcceptFriendRequest (Message_app) in 2.4024ms
2025-03-16 22:55:09.102 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:55:09.103 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Invalid or already processed friend request
   at server.Services.FriendSV.AcceptFriendRequestAsync(Int32 requestId) in D:\StudioProject\Message-App\server\Services\FriendService\FriendSV.cs:line 68
   at server.Controllers.FriendsController.AcceptFriendRequest(Int32 requestId) in D:\StudioProject\Message-App\server\Controllers\FriendsController.cs:line 38
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-03-16 22:55:09.106 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/2 - 500 null text/plain; charset=utf-8 7.3987ms
2025-03-16 22:55:10.680 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/3 - null 0
2025-03-16 22:55:10.680 +07:00 [INF] CORS policy execution successful.
2025-03-16 22:55:10.680 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:55:10.681 +07:00 [INF] Route matched with {action = "AcceptFriendRequest", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AcceptFriendRequest(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:55:10.683 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[Id] = @__requestId_0
2025-03-16 22:55:10.683 +07:00 [INF] Executed action server.Controllers.FriendsController.AcceptFriendRequest (Message_app) in 2.5736ms
2025-03-16 22:55:10.683 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:55:10.683 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: Invalid or already processed friend request
   at server.Services.FriendSV.AcceptFriendRequestAsync(Int32 requestId) in D:\StudioProject\Message-App\server\Services\FriendService\FriendSV.cs:line 68
   at server.Controllers.FriendsController.AcceptFriendRequest(Int32 requestId) in D:\StudioProject\Message-App\server\Controllers\FriendsController.cs:line 38
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-03-16 22:55:10.687 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/3 - 500 null text/plain; charset=utf-8 6.487ms
2025-03-16 22:55:12.803 +07:00 [INF] Request starting HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/5 - null 0
2025-03-16 22:55:12.803 +07:00 [INF] CORS policy execution successful.
2025-03-16 22:55:12.803 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:55:12.803 +07:00 [INF] Route matched with {action = "AcceptFriendRequest", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AcceptFriendRequest(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:55:12.828 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__requestId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [f].[Id], [f].[CreatedAt], [f].[ReceiverId], [f].[SenderId], [f].[Status], [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [FriendRequests] AS [f]
INNER JOIN [Users] AS [u] ON [f].[SenderId] = [u].[id]
WHERE [f].[Id] = @__requestId_0
2025-03-16 22:55:13.039 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (Size = 20), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [FriendRequests] SET [Status] = @p0
OUTPUT 1
WHERE [Id] = @p1;
INSERT INTO [Friends] ([CreatedAt], [UserId1], [UserId2])
OUTPUT INSERTED.[Id]
VALUES (@p2, @p3, @p4);
2025-03-16 22:55:13.095 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-03-16 22:55:13.113 +07:00 [WRN] User 1 not connected or WebSocket closed.
2025-03-16 22:55:13.113 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-03-16 22:55:13.114 +07:00 [INF] Executed action server.Controllers.FriendsController.AcceptFriendRequest (Message_app) in 311.1564ms
2025-03-16 22:55:13.115 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.AcceptFriendRequest (Message_app)'
2025-03-16 22:55:13.115 +07:00 [INF] Request finished HTTP/1.1 POST http://localhost:5053/api/Friends/accept-request/5 - 200 null application/json; charset=utf-8 311.9092ms
2025-03-16 22:55:41.264 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/list/1 - null null
2025-03-16 22:55:41.264 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriends (Message_app)'
2025-03-16 22:55:41.267 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:55:41.337 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT ~CAST([f].[UserId1] ^ @__userId_0 AS bit), [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[gender], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-03-16 22:55:41.338 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:55:41.343 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriends (Message_app) in 75.8392ms
2025-03-16 22:55:41.343 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriends (Message_app)'
2025-03-16 22:55:41.344 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/list/1 - 200 null application/json; charset=utf-8 79.7988ms
2025-03-16 22:55:45.327 +07:00 [INF] Request starting HTTP/1.1 GET http://localhost:5053/api/Friends/list/2 - null null
2025-03-16 22:55:45.327 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetFriends (Message_app)'
2025-03-16 22:55:45.327 +07:00 [INF] Route matched with {action = "GetFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-03-16 22:55:45.330 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT ~CAST([f].[UserId1] ^ @__userId_0 AS bit), [u].[id], [u].[avatar_url], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[password], [u].[passwordSalt], [u].[username], [u0].[id], [u0].[avatar_url], [u0].[birthday], [u0].[created_at], [u0].[email], [u0].[gender], [u0].[password], [u0].[passwordSalt], [u0].[username]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-03-16 22:55:45.331 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.Models.User, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-03-16 22:55:45.334 +07:00 [INF] Executed action server.Controllers.FriendsController.GetFriends (Message_app) in 6.3723ms
2025-03-16 22:55:45.335 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetFriends (Message_app)'
2025-03-16 22:55:45.335 +07:00 [INF] Request finished HTTP/1.1 GET http://localhost:5053/api/Friends/list/2 - 200 null application/json; charset=utf-8 8.2615ms
