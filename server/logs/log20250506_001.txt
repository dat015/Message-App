2025-05-06 22:00:39.092 +07:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-06 22:00:39.267 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-06 22:00:39.349 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-06 22:00:39.358 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-06 22:00:39.359 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-06 22:00:39.359 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-06 22:00:39.359 +07:00 [INF] Hosting environment: Development
2025-05-06 22:00:39.359 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-06 22:01:07.114 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-06 22:01:07.114 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-06 22:01:07.153 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-06 22:01:07.208 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-06 22:01:07.208 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-06 22:01:07.355 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-06 22:01:07.355 +07:00 [INF] Executed DbCommand (22ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-06 22:01:07.377 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-06 22:01:07.378 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-06 22:01:07.386 +07:00 [INF] Saved message 88 to Redis
2025-05-06 22:01:07.386 +07:00 [INF] Saved message 88 to Redis
2025-05-06 22:01:07.387 +07:00 [INF] Added message 88 to conversation 3
2025-05-06 22:01:07.387 +07:00 [INF] Added message 88 to conversation 3
2025-05-06 22:01:07.388 +07:00 [INF] Saved message 70 to Redis
2025-05-06 22:01:07.388 +07:00 [INF] Saved message 70 to Redis
2025-05-06 22:01:07.389 +07:00 [INF] Added message 70 to conversation 3
2025-05-06 22:01:07.389 +07:00 [INF] Added message 70 to conversation 3
2025-05-06 22:01:07.390 +07:00 [INF] Saved message 65 to Redis
2025-05-06 22:01:07.390 +07:00 [INF] Saved message 65 to Redis
2025-05-06 22:01:07.390 +07:00 [INF] Added message 65 to conversation 3
2025-05-06 22:01:07.390 +07:00 [INF] Added message 65 to conversation 3
2025-05-06 22:01:07.391 +07:00 [INF] Saved message 48 to Redis
2025-05-06 22:01:07.391 +07:00 [INF] Saved message 48 to Redis
2025-05-06 22:01:07.391 +07:00 [INF] Added message 48 to conversation 3
2025-05-06 22:01:07.391 +07:00 [INF] Added message 48 to conversation 3
2025-05-06 22:01:07.397 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-06 22:01:07.399 +07:00 [INF] Saved message 111 to Redis
2025-05-06 22:01:07.399 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-06 22:01:07.399 +07:00 [INF] Added message 111 to conversation 4
2025-05-06 22:01:07.400 +07:00 [INF] Message 111 already exists in Redis
2025-05-06 22:01:07.400 +07:00 [INF] Message 97 already exists in Redis
2025-05-06 22:01:07.400 +07:00 [INF] Saved message 97 to Redis
2025-05-06 22:01:07.401 +07:00 [INF] Added message 97 to conversation 4
2025-05-06 22:01:07.401 +07:00 [INF] Message 96 already exists in Redis
2025-05-06 22:01:07.401 +07:00 [INF] Saved message 96 to Redis
2025-05-06 22:01:07.402 +07:00 [INF] Added message 96 to conversation 4
2025-05-06 22:01:07.402 +07:00 [INF] Message 89 already exists in Redis
2025-05-06 22:01:07.402 +07:00 [INF] Saved message 89 to Redis
2025-05-06 22:01:07.403 +07:00 [INF] Added message 89 to conversation 4
2025-05-06 22:01:07.403 +07:00 [INF] Saved message 69 to Redis
2025-05-06 22:01:07.403 +07:00 [INF] Message 69 already exists in Redis
2025-05-06 22:01:07.404 +07:00 [INF] Added message 69 to conversation 4
2025-05-06 22:01:07.408 +07:00 [INF] Message 67 already exists in Redis
2025-05-06 22:01:07.409 +07:00 [INF] Saved message 67 to Redis
2025-05-06 22:01:07.410 +07:00 [INF] Added message 67 to conversation 4
2025-05-06 22:01:07.410 +07:00 [INF] Saved message 66 to Redis
2025-05-06 22:01:07.411 +07:00 [INF] Added message 66 to conversation 4
2025-05-06 22:01:07.411 +07:00 [INF] Message 66 already exists in Redis
2025-05-06 22:01:07.412 +07:00 [INF] Saved message 63 to Redis
2025-05-06 22:01:07.413 +07:00 [INF] Added message 63 to conversation 4
2025-05-06 22:01:07.413 +07:00 [INF] Saved message 63 to Redis
2025-05-06 22:01:07.416 +07:00 [INF] Added message 63 to conversation 4
2025-05-06 22:01:07.416 +07:00 [INF] Saved message 58 to Redis
2025-05-06 22:01:07.416 +07:00 [INF] Message 58 already exists in Redis
2025-05-06 22:01:07.416 +07:00 [INF] Added message 58 to conversation 4
2025-05-06 22:01:07.418 +07:00 [INF] Saved message 56 to Redis
2025-05-06 22:01:07.419 +07:00 [INF] Added message 56 to conversation 4
2025-05-06 22:01:07.419 +07:00 [INF] Saved message 56 to Redis
2025-05-06 22:01:07.420 +07:00 [INF] Added message 56 to conversation 4
2025-05-06 22:01:07.421 +07:00 [INF] Message 53 already exists in Redis
2025-05-06 22:01:07.421 +07:00 [INF] Saved message 53 to Redis
2025-05-06 22:01:07.422 +07:00 [INF] Added message 53 to conversation 4
2025-05-06 22:01:07.422 +07:00 [INF] Saved message 52 to Redis
2025-05-06 22:01:07.423 +07:00 [INF] Message 52 already exists in Redis
2025-05-06 22:01:07.423 +07:00 [INF] Added message 52 to conversation 4
2025-05-06 22:01:07.424 +07:00 [INF] Message 50 already exists in Redis
2025-05-06 22:01:07.424 +07:00 [INF] Saved message 50 to Redis
2025-05-06 22:01:07.424 +07:00 [INF] Added message 50 to conversation 4
2025-05-06 22:01:07.425 +07:00 [INF] Message 47 already exists in Redis
2025-05-06 22:01:07.425 +07:00 [INF] Saved message 47 to Redis
2025-05-06 22:01:07.426 +07:00 [INF] Added message 47 to conversation 4
2025-05-06 22:01:07.426 +07:00 [INF] Saved message 46 to Redis
2025-05-06 22:01:07.426 +07:00 [INF] Message 46 already exists in Redis
2025-05-06 22:01:07.426 +07:00 [INF] Added message 46 to conversation 4
2025-05-06 22:01:07.427 +07:00 [INF] Message 45 already exists in Redis
2025-05-06 22:01:07.427 +07:00 [INF] Saved message 45 to Redis
2025-05-06 22:01:07.428 +07:00 [INF] Added message 45 to conversation 4
2025-05-06 22:01:07.429 +07:00 [INF] Message 44 already exists in Redis
2025-05-06 22:01:07.429 +07:00 [INF] Saved message 44 to Redis
2025-05-06 22:01:07.430 +07:00 [INF] Added message 44 to conversation 4
2025-05-06 22:01:07.431 +07:00 [INF] Saved message 43 to Redis
2025-05-06 22:01:07.431 +07:00 [INF] Message 43 already exists in Redis
2025-05-06 22:01:07.431 +07:00 [INF] Added message 43 to conversation 4
2025-05-06 22:01:07.433 +07:00 [INF] Saved message 42 to Redis
2025-05-06 22:01:07.433 +07:00 [INF] Saved message 42 to Redis
2025-05-06 22:01:07.434 +07:00 [INF] Added message 42 to conversation 4
2025-05-06 22:01:07.434 +07:00 [INF] Added message 42 to conversation 4
2025-05-06 22:01:07.435 +07:00 [INF] Message 41 already exists in Redis
2025-05-06 22:01:07.435 +07:00 [INF] Saved message 41 to Redis
2025-05-06 22:01:07.436 +07:00 [INF] Saved message 40 to Redis
2025-05-06 22:01:07.436 +07:00 [INF] Added message 41 to conversation 4
2025-05-06 22:01:07.437 +07:00 [INF] Added message 40 to conversation 4
2025-05-06 22:01:07.437 +07:00 [INF] Message 40 already exists in Redis
2025-05-06 22:01:07.438 +07:00 [INF] Saved message 39 to Redis
2025-05-06 22:01:07.439 +07:00 [INF] Added message 39 to conversation 4
2025-05-06 22:01:07.439 +07:00 [INF] Saved message 39 to Redis
2025-05-06 22:01:07.440 +07:00 [INF] Added message 39 to conversation 4
2025-05-06 22:01:07.441 +07:00 [INF] Message 38 already exists in Redis
2025-05-06 22:01:07.441 +07:00 [INF] Saved message 38 to Redis
2025-05-06 22:01:07.441 +07:00 [INF] Added message 38 to conversation 4
2025-05-06 22:01:07.442 +07:00 [INF] Message 37 already exists in Redis
2025-05-06 22:01:07.442 +07:00 [INF] Saved message 37 to Redis
2025-05-06 22:01:07.442 +07:00 [INF] Added message 37 to conversation 4
2025-05-06 22:01:07.443 +07:00 [INF] Message 36 already exists in Redis
2025-05-06 22:01:07.443 +07:00 [INF] Saved message 36 to Redis
2025-05-06 22:01:07.443 +07:00 [INF] Added message 36 to conversation 4
2025-05-06 22:01:07.443 +07:00 [INF] Message 35 already exists in Redis
2025-05-06 22:01:07.444 +07:00 [INF] Saved message 35 to Redis
2025-05-06 22:01:07.444 +07:00 [INF] Added message 35 to conversation 4
2025-05-06 22:01:07.444 +07:00 [INF] Message 34 already exists in Redis
2025-05-06 22:01:07.445 +07:00 [INF] Saved message 34 to Redis
2025-05-06 22:01:07.445 +07:00 [INF] Added message 34 to conversation 4
2025-05-06 22:01:07.445 +07:00 [INF] Message 33 already exists in Redis
2025-05-06 22:01:07.445 +07:00 [INF] Saved message 33 to Redis
2025-05-06 22:01:07.446 +07:00 [INF] Added message 33 to conversation 4
2025-05-06 22:01:07.446 +07:00 [INF] Message 32 already exists in Redis
2025-05-06 22:01:07.446 +07:00 [INF] Saved message 32 to Redis
2025-05-06 22:01:07.447 +07:00 [INF] Added message 32 to conversation 4
2025-05-06 22:01:07.447 +07:00 [INF] Message 31 already exists in Redis
2025-05-06 22:01:07.447 +07:00 [INF] Saved message 31 to Redis
2025-05-06 22:01:07.448 +07:00 [INF] Added message 31 to conversation 4
2025-05-06 22:01:07.448 +07:00 [INF] Message 30 already exists in Redis
2025-05-06 22:01:07.448 +07:00 [INF] Saved message 30 to Redis
2025-05-06 22:01:07.449 +07:00 [INF] Added message 30 to conversation 4
2025-05-06 22:01:07.449 +07:00 [INF] Message 29 already exists in Redis
2025-05-06 22:01:07.449 +07:00 [INF] Saved message 29 to Redis
2025-05-06 22:01:07.450 +07:00 [INF] Added message 29 to conversation 4
2025-05-06 22:01:07.450 +07:00 [INF] Message 28 already exists in Redis
2025-05-06 22:01:07.451 +07:00 [INF] Saved message 28 to Redis
2025-05-06 22:01:07.452 +07:00 [INF] Added message 28 to conversation 4
2025-05-06 22:01:07.452 +07:00 [INF] Saved message 27 to Redis
2025-05-06 22:01:07.452 +07:00 [INF] Message 27 already exists in Redis
2025-05-06 22:01:07.453 +07:00 [INF] Added message 27 to conversation 4
2025-05-06 22:01:07.454 +07:00 [INF] Saved message 26 to Redis
2025-05-06 22:01:07.454 +07:00 [INF] Saved message 26 to Redis
2025-05-06 22:01:07.454 +07:00 [INF] Added message 26 to conversation 4
2025-05-06 22:01:07.454 +07:00 [INF] Added message 26 to conversation 4
2025-05-06 22:01:07.455 +07:00 [INF] Saved message 25 to Redis
2025-05-06 22:01:07.455 +07:00 [INF] Saved message 25 to Redis
2025-05-06 22:01:07.456 +07:00 [INF] Added message 25 to conversation 4
2025-05-06 22:01:07.456 +07:00 [INF] Added message 25 to conversation 4
2025-05-06 22:01:07.457 +07:00 [INF] Saved message 24 to Redis
2025-05-06 22:01:07.457 +07:00 [INF] Saved message 24 to Redis
2025-05-06 22:01:07.457 +07:00 [INF] Added message 24 to conversation 4
2025-05-06 22:01:07.457 +07:00 [INF] Added message 24 to conversation 4
2025-05-06 22:01:07.458 +07:00 [INF] Saved message 23 to Redis
2025-05-06 22:01:07.458 +07:00 [INF] Saved message 23 to Redis
2025-05-06 22:01:07.459 +07:00 [INF] Added message 23 to conversation 4
2025-05-06 22:01:07.459 +07:00 [INF] Added message 23 to conversation 4
2025-05-06 22:01:07.460 +07:00 [INF] Saved message 22 to Redis
2025-05-06 22:01:07.460 +07:00 [INF] Saved message 22 to Redis
2025-05-06 22:01:07.460 +07:00 [INF] Added message 22 to conversation 4
2025-05-06 22:01:07.460 +07:00 [INF] Added message 22 to conversation 4
2025-05-06 22:01:07.461 +07:00 [INF] Saved message 21 to Redis
2025-05-06 22:01:07.461 +07:00 [INF] Saved message 21 to Redis
2025-05-06 22:01:07.462 +07:00 [INF] Added message 21 to conversation 4
2025-05-06 22:01:07.462 +07:00 [INF] Added message 21 to conversation 4
2025-05-06 22:01:07.463 +07:00 [INF] Saved message 20 to Redis
2025-05-06 22:01:07.463 +07:00 [INF] Saved message 20 to Redis
2025-05-06 22:01:07.463 +07:00 [INF] Added message 20 to conversation 4
2025-05-06 22:01:07.463 +07:00 [INF] Added message 20 to conversation 4
2025-05-06 22:01:07.464 +07:00 [INF] Saved message 19 to Redis
2025-05-06 22:01:07.464 +07:00 [INF] Saved message 19 to Redis
2025-05-06 22:01:07.465 +07:00 [INF] Added message 19 to conversation 4
2025-05-06 22:01:07.465 +07:00 [INF] Added message 19 to conversation 4
2025-05-06 22:01:07.466 +07:00 [INF] Saved message 18 to Redis
2025-05-06 22:01:07.466 +07:00 [INF] Saved message 18 to Redis
2025-05-06 22:01:07.466 +07:00 [INF] Added message 18 to conversation 4
2025-05-06 22:01:07.466 +07:00 [INF] Added message 18 to conversation 4
2025-05-06 22:01:07.467 +07:00 [INF] Message 17 already exists in Redis
2025-05-06 22:01:07.467 +07:00 [INF] Saved message 17 to Redis
2025-05-06 22:01:07.467 +07:00 [INF] Added message 17 to conversation 4
2025-05-06 22:01:07.467 +07:00 [INF] Message 16 already exists in Redis
2025-05-06 22:01:07.467 +07:00 [INF] Saved message 16 to Redis
2025-05-06 22:01:07.468 +07:00 [INF] Added message 16 to conversation 4
2025-05-06 22:01:07.468 +07:00 [INF] Message 15 already exists in Redis
2025-05-06 22:01:07.468 +07:00 [INF] Saved message 15 to Redis
2025-05-06 22:01:07.469 +07:00 [INF] Added message 15 to conversation 4
2025-05-06 22:01:07.469 +07:00 [INF] Message 14 already exists in Redis
2025-05-06 22:01:07.469 +07:00 [INF] Saved message 14 to Redis
2025-05-06 22:01:07.470 +07:00 [INF] Added message 14 to conversation 4
2025-05-06 22:01:07.470 +07:00 [INF] Saved message 13 to Redis
2025-05-06 22:01:07.470 +07:00 [INF] Message 13 already exists in Redis
2025-05-06 22:01:07.471 +07:00 [INF] Added message 13 to conversation 4
2025-05-06 22:01:07.471 +07:00 [INF] Saved message 12 to Redis
2025-05-06 22:01:07.472 +07:00 [INF] Saved message 12 to Redis
2025-05-06 22:01:07.472 +07:00 [INF] Added message 12 to conversation 4
2025-05-06 22:01:07.472 +07:00 [INF] Added message 12 to conversation 4
2025-05-06 22:01:07.472 +07:00 [INF] Message 10 already exists in Redis
2025-05-06 22:01:07.472 +07:00 [INF] Saved message 10 to Redis
2025-05-06 22:01:07.473 +07:00 [INF] Added message 10 to conversation 4
2025-05-06 22:01:07.475 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-06 22:01:07.475 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-06 22:02:37.719 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-06 22:02:37.719 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-06 22:02:37.732 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadResult(ReadResult& result)
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at System.IO.Pipelines.Pipe.DefaultPipeReader.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-06 22:02:37.733 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadResult(ReadResult& result)
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at System.IO.Pipelines.Pipe.DefaultPipeReader.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware.<Invoke>g__AwaitMatcher|10_0(EndpointRoutingMiddleware middleware, HttpContext httpContext, Task`1 matcherTask)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-06 22:02:37.848 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-06 22:02:37.858 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-06 22:02:37.877 +07:00 [ERR] Connection id "0HNCCLRA52LJ7", Request id "0HNCCLRA52LJ7:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadResult(ReadResult& result)
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at System.IO.Pipelines.Pipe.DefaultPipeReader.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware.<Invoke>g__AwaitMatcher|10_0(EndpointRoutingMiddleware middleware, HttpContext httpContext, Task`1 matcherTask)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-06 22:02:37.877 +07:00 [ERR] Connection id "0HNCCLRA52LJ6", Request id "0HNCCLRA52LJ6:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
 ---> Microsoft.AspNetCore.Connections.ConnectionResetException: An existing connection was forcibly closed by the remote host.
 ---> System.Net.Sockets.SocketException (10054): An existing connection was forcibly closed by the remote host.
   --- End of inner exception stack trace ---
   at System.IO.Pipelines.Pipe.GetReadResult(ReadResult& result)
   at System.IO.Pipelines.Pipe.GetReadAsyncResult()
   at System.IO.Pipelines.Pipe.DefaultPipeReader.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1UpgradeMessageBody.ReadAsyncInternalAwaited(ValueTask`1 readTask, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.IO.Stream.ReadAtLeastAsyncCore(Memory`1 buffer, Int32 minimumBytes, Boolean throwOnEndOfStream, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-06 22:02:37.921 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 90804.3197ms
2025-05-06 22:02:37.917 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 90797.8579ms
2025-05-06 22:05:07.401 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-06 22:05:07.412 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 22:05:07.486 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-06 22:05:07.784 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-06 22:05:08.000 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-06 22:05:08.109 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 616.0116ms
2025-05-06 22:05:08.110 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 22:05:08.117 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 716.1378ms
2025-05-06 22:05:09.181 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-06 22:05:09.188 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 22:05:09.196 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-06 22:05:09.318 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-06 22:05:09.319 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 22:05:09.320 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-06 22:05:09.327 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 22:05:09.335 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 22:05:09.372 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 175.2088ms
2025-05-06 22:05:09.372 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 22:05:09.372 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 191.6478ms
2025-05-06 22:05:09.480 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[UserId], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id] AS [UserId], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0 AND [p].[is_deleted] = CAST(0 AS bit))
ORDER BY [c].[id]
2025-05-06 22:05:09.515 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 22:05:09.518 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 182.3903ms
2025-05-06 22:05:09.518 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 22:05:09.519 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 201.2096ms
2025-05-06 22:05:10.050 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-06 22:05:10.051 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-06 22:05:10.123 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-06 22:05:10.136 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-06 22:05:54.320 +07:00 [INF] Executed DbCommand (41ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-06 22:05:54.532 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-06 22:05:54.641 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-06 22:05:54.653 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-06 22:05:54.653 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-06 22:05:54.654 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-06 22:05:54.654 +07:00 [INF] Hosting environment: Development
2025-05-06 22:05:54.655 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-06 22:05:57.557 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-06 22:05:57.600 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-06 22:05:57.711 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-06 22:05:57.881 +07:00 [INF] Executed DbCommand (35ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-06 22:05:57.908 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-06 22:06:26.844 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-06 22:06:26.854 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 22:06:26.880 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-06 22:06:26.981 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-06 22:06:27.077 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-06 22:06:27.116 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 234.6001ms
2025-05-06 22:06:27.118 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 22:06:27.126 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 281.6249ms
2025-05-06 22:06:27.394 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-06 22:06:27.398 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-06 22:06:27.400 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 22:06:27.400 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 22:06:27.405 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 22:06:27.405 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-06 22:06:44.036 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-06 22:06:44.039 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 22:06:44.049 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 16643.5181ms
2025-05-06 22:06:44.049 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 22:06:44.050 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 16656.001ms
2025-05-06 22:06:44.064 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[UserId], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id] AS [UserId], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-06 22:08:30.611 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 22:08:30.616 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 123210.5146ms
2025-05-06 22:08:30.616 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 22:08:30.616 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 499 null application/json; charset=utf-8 123218.5029ms
2025-05-06 22:11:27.445 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-06 22:11:27.449 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 22:11:27.450 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-06 22:11:27.471 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-06 22:11:27.472 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-06 22:11:27.473 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 22.9723ms
2025-05-06 22:11:27.473 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 22:11:27.473 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 28.1421ms
2025-05-06 22:11:28.710 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-06 22:11:28.710 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-06 22:11:28.715 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 22:11:28.715 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 22:11:28.715 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 22:11:28.716 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-06 22:11:44.169 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-06 22:11:44.170 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 22:11:44.171 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 15454.3665ms
2025-05-06 22:11:44.171 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 22:11:44.171 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 15461.2725ms
2025-05-06 22:11:44.187 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[UserId], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id] AS [UserId], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-06 22:11:44.188 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 22:11:44.189 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 15473.607ms
2025-05-06 22:11:44.189 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 22:11:44.189 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 15479.2266ms
2025-05-06 22:11:44.752 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-06 22:11:44.754 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-06 22:11:45.002 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-06 22:11:45.014 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-06 22:11:45.024 +07:00 [INF] Saved message 88 to Redis
2025-05-06 22:11:45.025 +07:00 [INF] Added message 88 to conversation 3
2025-05-06 22:11:45.027 +07:00 [INF] Saved message 70 to Redis
2025-05-06 22:11:45.027 +07:00 [INF] Added message 70 to conversation 3
2025-05-06 22:11:45.028 +07:00 [INF] Saved message 65 to Redis
2025-05-06 22:11:45.028 +07:00 [INF] Added message 65 to conversation 3
2025-05-06 22:11:45.029 +07:00 [INF] Saved message 48 to Redis
2025-05-06 22:11:45.030 +07:00 [INF] Added message 48 to conversation 3
2025-05-06 22:11:45.033 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-06 22:11:45.034 +07:00 [INF] Saved message 111 to Redis
2025-05-06 22:11:45.034 +07:00 [INF] Added message 111 to conversation 4
2025-05-06 22:11:45.035 +07:00 [INF] Saved message 97 to Redis
2025-05-06 22:11:45.035 +07:00 [INF] Added message 97 to conversation 4
2025-05-06 22:11:45.036 +07:00 [INF] Saved message 96 to Redis
2025-05-06 22:11:45.036 +07:00 [INF] Added message 96 to conversation 4
2025-05-06 22:11:45.036 +07:00 [INF] Saved message 89 to Redis
2025-05-06 22:11:45.036 +07:00 [INF] Added message 89 to conversation 4
2025-05-06 22:11:45.037 +07:00 [INF] Saved message 69 to Redis
2025-05-06 22:11:45.037 +07:00 [INF] Added message 69 to conversation 4
2025-05-06 22:11:45.038 +07:00 [INF] Saved message 67 to Redis
2025-05-06 22:11:45.038 +07:00 [INF] Added message 67 to conversation 4
2025-05-06 22:11:45.039 +07:00 [INF] Saved message 66 to Redis
2025-05-06 22:11:45.039 +07:00 [INF] Added message 66 to conversation 4
2025-05-06 22:11:45.039 +07:00 [INF] Saved message 63 to Redis
2025-05-06 22:11:45.039 +07:00 [INF] Added message 63 to conversation 4
2025-05-06 22:11:45.040 +07:00 [INF] Saved message 58 to Redis
2025-05-06 22:11:45.040 +07:00 [INF] Added message 58 to conversation 4
2025-05-06 22:11:45.041 +07:00 [INF] Saved message 56 to Redis
2025-05-06 22:11:45.041 +07:00 [INF] Added message 56 to conversation 4
2025-05-06 22:11:45.041 +07:00 [INF] Saved message 53 to Redis
2025-05-06 22:11:45.042 +07:00 [INF] Added message 53 to conversation 4
2025-05-06 22:11:45.042 +07:00 [INF] Saved message 52 to Redis
2025-05-06 22:11:45.042 +07:00 [INF] Added message 52 to conversation 4
2025-05-06 22:11:45.043 +07:00 [INF] Saved message 50 to Redis
2025-05-06 22:11:45.043 +07:00 [INF] Added message 50 to conversation 4
2025-05-06 22:11:45.044 +07:00 [INF] Saved message 47 to Redis
2025-05-06 22:11:45.044 +07:00 [INF] Added message 47 to conversation 4
2025-05-06 22:11:45.044 +07:00 [INF] Saved message 46 to Redis
2025-05-06 22:11:45.044 +07:00 [INF] Added message 46 to conversation 4
2025-05-06 22:11:45.045 +07:00 [INF] Saved message 45 to Redis
2025-05-06 22:11:45.045 +07:00 [INF] Added message 45 to conversation 4
2025-05-06 22:11:45.045 +07:00 [INF] Saved message 44 to Redis
2025-05-06 22:11:45.046 +07:00 [INF] Added message 44 to conversation 4
2025-05-06 22:11:45.047 +07:00 [INF] Saved message 43 to Redis
2025-05-06 22:11:45.047 +07:00 [INF] Added message 43 to conversation 4
2025-05-06 22:11:45.048 +07:00 [INF] Saved message 42 to Redis
2025-05-06 22:11:45.048 +07:00 [INF] Added message 42 to conversation 4
2025-05-06 22:11:45.049 +07:00 [INF] Saved message 41 to Redis
2025-05-06 22:11:45.049 +07:00 [INF] Added message 41 to conversation 4
2025-05-06 22:11:45.050 +07:00 [INF] Saved message 40 to Redis
2025-05-06 22:11:45.050 +07:00 [INF] Added message 40 to conversation 4
2025-05-06 22:11:45.050 +07:00 [INF] Saved message 39 to Redis
2025-05-06 22:11:45.051 +07:00 [INF] Added message 39 to conversation 4
2025-05-06 22:11:45.051 +07:00 [INF] Saved message 38 to Redis
2025-05-06 22:11:45.051 +07:00 [INF] Added message 38 to conversation 4
2025-05-06 22:11:45.052 +07:00 [INF] Saved message 37 to Redis
2025-05-06 22:11:45.052 +07:00 [INF] Added message 37 to conversation 4
2025-05-06 22:11:45.052 +07:00 [INF] Saved message 36 to Redis
2025-05-06 22:11:45.053 +07:00 [INF] Added message 36 to conversation 4
2025-05-06 22:11:45.053 +07:00 [INF] Saved message 35 to Redis
2025-05-06 22:11:45.053 +07:00 [INF] Added message 35 to conversation 4
2025-05-06 22:11:45.054 +07:00 [INF] Saved message 34 to Redis
2025-05-06 22:11:45.054 +07:00 [INF] Added message 34 to conversation 4
2025-05-06 22:11:45.055 +07:00 [INF] Saved message 33 to Redis
2025-05-06 22:11:45.055 +07:00 [INF] Added message 33 to conversation 4
2025-05-06 22:11:45.055 +07:00 [INF] Saved message 32 to Redis
2025-05-06 22:11:45.055 +07:00 [INF] Added message 32 to conversation 4
2025-05-06 22:11:45.056 +07:00 [INF] Saved message 31 to Redis
2025-05-06 22:11:45.056 +07:00 [INF] Added message 31 to conversation 4
2025-05-06 22:11:45.057 +07:00 [INF] Saved message 30 to Redis
2025-05-06 22:11:45.057 +07:00 [INF] Added message 30 to conversation 4
2025-05-06 22:11:45.057 +07:00 [INF] Saved message 29 to Redis
2025-05-06 22:11:45.057 +07:00 [INF] Added message 29 to conversation 4
2025-05-06 22:11:45.058 +07:00 [INF] Saved message 28 to Redis
2025-05-06 22:11:45.058 +07:00 [INF] Added message 28 to conversation 4
2025-05-06 22:11:45.059 +07:00 [INF] Saved message 27 to Redis
2025-05-06 22:11:45.059 +07:00 [INF] Added message 27 to conversation 4
2025-05-06 22:11:45.059 +07:00 [INF] Saved message 26 to Redis
2025-05-06 22:11:45.060 +07:00 [INF] Added message 26 to conversation 4
2025-05-06 22:11:45.060 +07:00 [INF] Saved message 25 to Redis
2025-05-06 22:11:45.060 +07:00 [INF] Added message 25 to conversation 4
2025-05-06 22:11:45.061 +07:00 [INF] Saved message 24 to Redis
2025-05-06 22:11:45.061 +07:00 [INF] Added message 24 to conversation 4
2025-05-06 22:11:45.061 +07:00 [INF] Saved message 23 to Redis
2025-05-06 22:11:45.062 +07:00 [INF] Added message 23 to conversation 4
2025-05-06 22:11:45.062 +07:00 [INF] Saved message 22 to Redis
2025-05-06 22:11:45.062 +07:00 [INF] Added message 22 to conversation 4
2025-05-06 22:11:45.064 +07:00 [INF] Saved message 21 to Redis
2025-05-06 22:11:45.064 +07:00 [INF] Added message 21 to conversation 4
2025-05-06 22:11:45.065 +07:00 [INF] Saved message 20 to Redis
2025-05-06 22:11:45.065 +07:00 [INF] Added message 20 to conversation 4
2025-05-06 22:11:45.065 +07:00 [INF] Saved message 19 to Redis
2025-05-06 22:11:45.066 +07:00 [INF] Added message 19 to conversation 4
2025-05-06 22:11:45.066 +07:00 [INF] Saved message 18 to Redis
2025-05-06 22:11:45.066 +07:00 [INF] Added message 18 to conversation 4
2025-05-06 22:11:45.067 +07:00 [INF] Saved message 17 to Redis
2025-05-06 22:11:45.067 +07:00 [INF] Added message 17 to conversation 4
2025-05-06 22:11:45.068 +07:00 [INF] Saved message 16 to Redis
2025-05-06 22:11:45.068 +07:00 [INF] Added message 16 to conversation 4
2025-05-06 22:11:45.068 +07:00 [INF] Saved message 15 to Redis
2025-05-06 22:11:45.069 +07:00 [INF] Added message 15 to conversation 4
2025-05-06 22:11:45.069 +07:00 [INF] Saved message 14 to Redis
2025-05-06 22:11:45.069 +07:00 [INF] Added message 14 to conversation 4
2025-05-06 22:11:45.070 +07:00 [INF] Saved message 13 to Redis
2025-05-06 22:11:45.070 +07:00 [INF] Added message 13 to conversation 4
2025-05-06 22:11:45.070 +07:00 [INF] Saved message 12 to Redis
2025-05-06 22:11:45.071 +07:00 [INF] Added message 12 to conversation 4
2025-05-06 22:11:45.071 +07:00 [INF] Saved message 10 to Redis
2025-05-06 22:11:45.071 +07:00 [INF] Added message 10 to conversation 4
2025-05-06 22:12:01.142 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-06 22:12:01.143 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-06 22:12:01.153 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 22:12:01.177 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-06 22:12:01.179 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-06 22:12:01.255 +07:00 [INF] Executed DbCommand (60ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[UserId], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id] AS [UserId], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-06 22:12:17.100 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-06 22:15:55.933 +07:00 [INF] Executed DbCommand (31ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-06 22:15:55.936 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-06 22:15:55.938 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 234784.4698ms
2025-05-06 22:15:55.938 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-06 22:15:55.938 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - 499 null application/json; charset=utf-8 234795.825ms
2025-05-06 22:16:01.882 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-06 22:16:01.882 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-06 22:16:01.882 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 22:16:01.889 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-06 22:16:01.893 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-06 22:16:01.956 +07:00 [INF] Executed DbCommand (61ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[UserId], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id] AS [UserId], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-06 22:16:05.906 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-06 22:16:05.906 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 4024.1902ms
2025-05-06 22:16:05.907 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-06 22:16:05.907 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 4025.0175ms
2025-05-06 22:17:25.057 +07:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-06 22:17:25.176 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-06 22:17:25.215 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-06 22:17:25.229 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-06 22:17:25.230 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-06 22:17:25.230 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-06 22:17:25.230 +07:00 [INF] Hosting environment: Development
2025-05-06 22:17:25.230 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-06 22:17:27.955 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-06 22:17:28.003 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-06 22:17:28.020 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-06 22:17:28.190 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-06 22:17:36.468 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-06 22:17:36.481 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-06 22:17:36.539 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 22:17:36.789 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-06 22:17:36.992 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-06 22:17:37.241 +07:00 [INF] Executed DbCommand (53ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[UserId], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id] AS [UserId], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-06 22:17:37.579 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Conversations] ([created_at], [img_url], [is_group], [lastMessage], [lastMessageSender], [lastMessageTime], [name])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2025-05-06 22:17:37.729 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@__user_id_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
WHERE [u].[id] IN (
    SELECT [u0].[value]
    FROM OPENJSON(@__user_id_0) WITH ([value] int '$') AS [u0]
)
2025-05-06 22:17:37.855 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (Size = 4000), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Participants] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([adder], [conversation_id], [img_url], [is_deleted], [joined_at], [name], [role], [user_id])
VALUES (i.[adder], i.[conversation_id], i.[img_url], i.[is_deleted], i.[joined_at], i.[name], i.[role], i.[user_id])
OUTPUT INSERTED.[id], i._Position;
2025-05-06 22:17:37.895 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-06 22:17:37.962 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 1418.5947ms
2025-05-06 22:17:37.964 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-06 22:17:37.972 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 1502.8827ms
2025-05-06 22:17:38.363 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/7/2 - null null
2025-05-06 22:17:38.370 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 22:17:38.386 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 22:17:38.428 +07:00 [INF] Retrieved 0 messages from Redis for conversation 7
2025-05-06 22:17:38.467 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-06 22:17:38.552 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-06 22:17:38.554 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-06 22:17:38.557 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 170.7981ms
2025-05-06 22:17:38.558 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 22:17:38.560 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/7/2 - 404 null text/plain; charset=utf-8 196.5961ms
2025-05-06 22:17:38.715 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/7 - null null
2025-05-06 22:17:38.717 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 22:17:38.725 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 22:17:38.751 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 22:17:38.752 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 22:17:38.795 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 69.2174ms
2025-05-06 22:17:38.795 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 22:17:38.796 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/7 - 200 null application/json; charset=utf-8 81.1479ms
2025-05-06 22:17:38.831 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/7 - null null
2025-05-06 22:17:38.832 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 22:17:38.851 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 22:17:38.883 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 22:17:38.886 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 22:17:38.919 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 67.6287ms
2025-05-06 22:17:38.919 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 22:17:38.920 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/7 - 200 null application/json; charset=utf-8 88.4171ms
2025-05-06 22:17:46.568 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/4 - null null
2025-05-06 22:17:46.568 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-06 22:17:46.569 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 22:17:46.579 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-06 22:17:46.583 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-06 22:17:46.593 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[UserId], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id] AS [UserId], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-06 22:17:46.602 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-06 22:17:46.604 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 35.3768ms
2025-05-06 22:17:46.605 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-06 22:17:46.606 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/4 - 200 null application/json; charset=utf-8 38.1846ms
2025-05-06 22:17:46.946 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/3/2 - null null
2025-05-06 22:17:46.948 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 22:17:46.949 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 22:17:46.980 +07:00 [INF] Retrieved 4 messages from Redis for conversation 3
2025-05-06 22:17:46.983 +07:00 [INF] Retrieved 4 messages from Redis for conversation 3 and user 2
2025-05-06 22:17:46.983 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 22:17:46.993 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 44.2441ms
2025-05-06 22:17:46.993 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 22:17:46.994 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/3/2 - 200 null application/json; charset=utf-8 47.1744ms
2025-05-06 22:17:47.095 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/3 - null null
2025-05-06 22:17:47.096 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 22:17:47.097 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 22:17:47.104 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 22:17:47.108 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 22:17:47.114 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 16.4564ms
2025-05-06 22:17:47.116 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 22:17:47.118 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/3 - 200 null application/json; charset=utf-8 23.467ms
2025-05-06 22:17:47.175 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - null null
2025-05-06 22:17:47.177 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 22:17:47.177 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 22:17:47.179 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 22:17:47.180 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 22:17:47.181 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.6863ms
2025-05-06 22:17:47.181 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 22:17:47.181 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - 200 null application/json; charset=utf-8 6.6203ms
2025-05-06 22:17:51.647 +07:00 [INF] Handling message from user 2: o
2025-05-06 22:17:51.651 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 22:17:51.764 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 22:17:51.771 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-06 22:17:51.777 +07:00 [INF] Message saved to DB with ID: 115
2025-05-06 22:17:51.783 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 22:17:51.793 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-06 22:17:51.810 +07:00 [INF] Transaction committed for message: 115
2025-05-06 22:17:51.821 +07:00 [INF] Saved message 115 to Redis
2025-05-06 22:17:51.823 +07:00 [INF] Added message 115 to conversation 3
2025-05-06 22:17:51.840 +07:00 [INF] Published message to channel conversation:3
2025-05-06 22:17:58.673 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-06 22:17:58.675 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-06 22:17:58.675 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 22:17:58.679 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-06 22:17:58.684 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-06 22:17:58.695 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[UserId], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id] AS [UserId], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-06 22:17:58.696 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-06 22:17:58.697 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 22.0901ms
2025-05-06 22:17:58.698 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-06 22:17:58.700 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 26.0421ms
2025-05-06 22:17:58.948 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/7/2 - null null
2025-05-06 22:17:58.949 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 22:17:58.949 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 22:17:58.956 +07:00 [INF] Retrieved 0 messages from Redis for conversation 7
2025-05-06 22:17:58.962 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__user_id_0='?' (DbType = Int32), @__conversationId_1='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[cleared_at]
FROM [messageDeletions] AS [m]
WHERE [m].[user_id] = @__user_id_0 AND CAST([m].[conversation_id] AS bigint) = @__conversationId_1
2025-05-06 22:17:58.971 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[content], [t].[conversation_id], [t].[created_at], [t].[isFile], [t].[isRecalled], [t].[is_read], [t].[sender_id], [t].[type], [a].[id], [a].[FileSize], [a].[file_type], [a].[file_url], [a].[is_temporary], [a].[message_id], [a].[uploaded_at]
FROM (
    SELECT TOP(@__p_1) [m].[id], [m].[content], [m].[conversation_id], [m].[created_at], [m].[isFile], [m].[isRecalled], [m].[is_read], [m].[sender_id], [m].[type]
    FROM [Messages] AS [m]
    WHERE CAST([m].[conversation_id] AS bigint) = @__conversationId_0
    ORDER BY [m].[created_at] DESC
) AS [t]
LEFT JOIN [Attachments] AS [a] ON [t].[id] = [a].[message_id]
ORDER BY [t].[created_at] DESC, [t].[id]
2025-05-06 22:17:58.971 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'System.String'.
2025-05-06 22:17:58.972 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 23.0443ms
2025-05-06 22:17:58.972 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 22:17:58.973 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/7/2 - 404 null text/plain; charset=utf-8 24.5186ms
2025-05-06 22:17:58.998 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/7 - null null
2025-05-06 22:17:58.998 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 22:17:58.998 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 22:17:59.001 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 22:17:59.001 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 22:17:59.002 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 3.419ms
2025-05-06 22:17:59.002 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 22:17:59.002 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/7 - 200 null application/json; charset=utf-8 4.4647ms
2025-05-06 22:17:59.023 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/7 - null null
2025-05-06 22:17:59.024 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 22:17:59.024 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 22:17:59.027 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 22:17:59.028 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 22:17:59.029 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.5792ms
2025-05-06 22:17:59.029 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 22:17:59.029 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/7 - 200 null application/json; charset=utf-8 5.438ms
2025-05-06 22:18:03.449 +07:00 [INF] Handling message from user 2: oaka
2025-05-06 22:18:03.454 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 22:18:03.465 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 22:18:03.472 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-06 22:18:03.473 +07:00 [INF] Message saved to DB with ID: 116
2025-05-06 22:18:03.474 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 22:18:03.481 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-06 22:18:03.483 +07:00 [INF] Transaction committed for message: 116
2025-05-06 22:18:03.486 +07:00 [INF] Saved message 116 to Redis
2025-05-06 22:18:03.487 +07:00 [INF] Added message 116 to conversation 7
2025-05-06 22:18:03.488 +07:00 [INF] Published message to channel conversation:7
2025-05-06 22:18:23.225 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - null null
2025-05-06 22:18:23.226 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-06 22:18:23.226 +07:00 [INF] Route matched with {action = "OpenConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] OpenConversation(Int32, Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 22:18:23.234 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-06 22:18:23.236 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[id] = @__p_0
2025-05-06 22:18:23.313 +07:00 [INF] Executed DbCommand (76ms) [Parameters=[@__user1_0='?' (DbType = Int32), @__user2_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[id], [t].[name], [t].[is_group], [t].[created_at], [t].[lastMessage], [t].[lastMessageTime], [t].[img_url], [t0].[Id], [t0].[UserId], [t0].[ConversationId], [t0].[Name], [t0].[IsDeleted], [t0].[img_url]
FROM (
    SELECT TOP(1) [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url]
    FROM [Conversations] AS [c]
    WHERE [c].[is_group] = CAST(0 AS bit) AND (
        SELECT COUNT(*)
        FROM [Participants] AS [p]
        WHERE [c].[id] = [p].[conversation_id]) = 2 AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p0]
        WHERE [c].[id] = [p0].[conversation_id] AND [p0].[user_id] = @__user1_0) AND EXISTS (
        SELECT 1
        FROM [Participants] AS [p1]
        WHERE [c].[id] = [p1].[conversation_id] AND [p1].[user_id] = @__user2_1)
) AS [t]
LEFT JOIN (
    SELECT [p2].[id] AS [Id], [p2].[user_id] AS [UserId], [p2].[conversation_id] AS [ConversationId], [p2].[name] AS [Name], [p2].[is_deleted] AS [IsDeleted], [p2].[img_url]
    FROM [Participants] AS [p2]
    WHERE [p2].[is_deleted] = CAST(0 AS bit)
) AS [t0] ON [t].[id] = [t0].[ConversationId]
ORDER BY [t].[id]
2025-05-06 22:18:23.314 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.ConversationDto'.
2025-05-06 22:18:23.314 +07:00 [INF] Executed action server.Controllers.ConversationController.OpenConversation (Message_app) in 87.0085ms
2025-05-06 22:18:23.314 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.OpenConversation (Message_app)'
2025-05-06 22:18:23.314 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/open_conversation/2/3 - 200 null application/json; charset=utf-8 88.954ms
2025-05-06 22:18:23.552 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/7/2 - null null
2025-05-06 22:18:23.552 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 22:18:23.552 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 22:18:23.556 +07:00 [INF] Retrieved 1 messages from Redis for conversation 7
2025-05-06 22:18:23.556 +07:00 [INF] Retrieved 1 messages from Redis for conversation 7 and user 2
2025-05-06 22:18:23.556 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 22:18:23.557 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 4.1541ms
2025-05-06 22:18:23.557 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 22:18:23.558 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/7/2 - 200 null application/json; charset=utf-8 5.624ms
2025-05-06 22:18:23.580 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/7 - null null
2025-05-06 22:18:23.581 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 22:18:23.581 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 22:18:23.589 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 22:18:23.589 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 22:18:23.589 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 8.2786ms
2025-05-06 22:18:23.589 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 22:18:23.589 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/7 - 200 null application/json; charset=utf-8 9.5398ms
2025-05-06 22:18:23.623 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/7 - null null
2025-05-06 22:18:23.623 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 22:18:23.623 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 22:18:23.630 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 22:18:23.631 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 22:18:23.631 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 7.5501ms
2025-05-06 22:18:23.631 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 22:18:23.631 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/7 - 200 null application/json; charset=utf-8 8.2934ms
2025-05-06 22:21:16.110 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-06 22:21:16.112 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-06 22:21:16.176 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-06 22:21:16.178 +07:00 [ERR] Connection id "0HNCCM4EF93UT", Request id "0HNCCM4EF93UT:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-06 22:21:16.183 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 228229.7994ms
2025-05-06 22:26:56.030 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-06 22:26:56.142 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-06 22:26:56.182 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-06 22:26:56.192 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-06 22:26:56.192 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-06 22:26:56.193 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-06 22:26:56.193 +07:00 [INF] Hosting environment: Development
2025-05-06 22:26:56.193 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-06 22:39:03.496 +07:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[id], [u].[username], [u].[avatar_url]
FROM [Users] AS [u]
2025-05-06 22:39:03.595 +07:00 [INF] User profile is available. Using 'C:\Users\Thao\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-06 22:39:03.631 +07:00 [WRN] Overriding address(es) 'http://localhost:5053'. Binding to endpoints defined via IConfiguration and/or UseKestrel() instead.
2025-05-06 22:39:03.638 +07:00 [INF] Now listening on: http://[::]:5053
2025-05-06 22:39:03.638 +07:00 [INF] Now listening on: http://0.0.0.0:5053
2025-05-06 22:39:03.639 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-06 22:39:03.639 +07:00 [INF] Hosting environment: Development
2025-05-06 22:39:03.639 +07:00 [INF] Content root path: C:\Users\Thao\source\Flutter\Message_app\server
2025-05-06 23:12:07.788 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 53
2025-05-06 23:12:08.096 +07:00 [WRN] Failed to determine the https port for redirect.
2025-05-06 23:12:08.195 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 23:12:08.320 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-06 23:12:08.921 +07:00 [INF] Executed DbCommand (45ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-06 23:12:09.180 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-06 23:12:09.376 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 1047.5247ms
2025-05-06 23:12:09.380 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 23:12:09.391 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 1622.6531ms
2025-05-06 23:12:09.904 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - null null
2025-05-06 23:12:09.933 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 23:12:09.940 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-06 23:12:09.981 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - null null
2025-05-06 23:12:09.986 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 23:12:10.002 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:12:10.206 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-06 23:12:10.208 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:12:10.232 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 290.8863ms
2025-05-06 23:12:10.232 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 23:12:10.232 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - 200 null application/json; charset=utf-8 328.7525ms
2025-05-06 23:12:10.245 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[id], [c].[name], [c].[is_group], [c].[created_at], [c].[lastMessage], [c].[lastMessageTime], [c].[img_url], [t].[Id], [t].[UserId], [t].[ConversationId], [t].[Name], [t].[IsDeleted], [t].[img_url]
FROM [Conversations] AS [c]
LEFT JOIN (
    SELECT [p0].[id] AS [Id], [p0].[user_id] AS [UserId], [p0].[conversation_id] AS [ConversationId], [p0].[name] AS [Name], [p0].[is_deleted] AS [IsDeleted], [p0].[img_url]
    FROM [Participants] AS [p0]
    WHERE [p0].[is_deleted] = CAST(0 AS bit)
) AS [t] ON [c].[id] = [t].[ConversationId]
WHERE EXISTS (
    SELECT 1
    FROM [Participants] AS [p]
    WHERE [c].[id] = [p].[conversation_id] AND [p].[user_id] = @__userId_0)
ORDER BY [c].[id]
2025-05-06 23:12:10.296 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:12:10.298 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 296.1498ms
2025-05-06 23:12:10.299 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 23:12:10.299 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 318.3913ms
2025-05-06 23:12:10.518 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-06 23:12:10.518 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-06 23:12:10.706 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-06 23:12:10.741 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__p_1='?' (DbType = Int32), @__conversationId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(@__p_1) [m].[id], [m].[conversation_id], [m].[sender_id], [m].[content], [m].[created_at], [m].[isFile], [m].[type], [m].[isRecalled]
FROM [Messages] AS [m]
WHERE [m].[conversation_id] = @__conversationId_0
ORDER BY [m].[created_at] DESC
2025-05-06 23:12:10.752 +07:00 [INF] Saved message 114 to Redis
2025-05-06 23:12:10.754 +07:00 [INF] Added message 114 to conversation 1
2025-05-06 23:12:10.756 +07:00 [INF] Saved message 113 to Redis
2025-05-06 23:12:10.756 +07:00 [INF] Added message 113 to conversation 1
2025-05-06 23:12:10.757 +07:00 [INF] Saved message 112 to Redis
2025-05-06 23:12:10.757 +07:00 [INF] Added message 112 to conversation 1
2025-05-06 23:12:10.758 +07:00 [INF] Saved message 110 to Redis
2025-05-06 23:12:10.758 +07:00 [INF] Added message 110 to conversation 1
2025-05-06 23:12:10.759 +07:00 [INF] Saved message 109 to Redis
2025-05-06 23:12:10.760 +07:00 [INF] Added message 109 to conversation 1
2025-05-06 23:12:10.764 +07:00 [INF] Saved message 108 to Redis
2025-05-06 23:12:10.764 +07:00 [INF] Added message 108 to conversation 1
2025-05-06 23:12:10.765 +07:00 [INF] Saved message 107 to Redis
2025-05-06 23:12:10.766 +07:00 [INF] Added message 107 to conversation 1
2025-05-06 23:12:10.767 +07:00 [INF] Saved message 106 to Redis
2025-05-06 23:12:10.767 +07:00 [INF] Added message 106 to conversation 1
2025-05-06 23:12:10.768 +07:00 [INF] Saved message 105 to Redis
2025-05-06 23:12:10.768 +07:00 [INF] Added message 105 to conversation 1
2025-05-06 23:12:10.770 +07:00 [INF] Saved message 104 to Redis
2025-05-06 23:12:10.770 +07:00 [INF] Added message 104 to conversation 1
2025-05-06 23:12:10.771 +07:00 [INF] Saved message 103 to Redis
2025-05-06 23:12:10.772 +07:00 [INF] Added message 103 to conversation 1
2025-05-06 23:12:10.773 +07:00 [INF] Saved message 102 to Redis
2025-05-06 23:12:10.773 +07:00 [INF] Added message 102 to conversation 1
2025-05-06 23:12:10.774 +07:00 [INF] Saved message 101 to Redis
2025-05-06 23:12:10.775 +07:00 [INF] Added message 101 to conversation 1
2025-05-06 23:12:10.776 +07:00 [INF] Saved message 100 to Redis
2025-05-06 23:12:10.779 +07:00 [INF] Added message 100 to conversation 1
2025-05-06 23:12:10.781 +07:00 [INF] Saved message 99 to Redis
2025-05-06 23:12:10.781 +07:00 [INF] Added message 99 to conversation 1
2025-05-06 23:12:10.783 +07:00 [INF] Saved message 98 to Redis
2025-05-06 23:12:10.784 +07:00 [INF] Added message 98 to conversation 1
2025-05-06 23:12:10.785 +07:00 [INF] Saved message 95 to Redis
2025-05-06 23:12:10.785 +07:00 [INF] Added message 95 to conversation 1
2025-05-06 23:12:10.786 +07:00 [INF] Saved message 94 to Redis
2025-05-06 23:12:10.787 +07:00 [INF] Added message 94 to conversation 1
2025-05-06 23:12:10.789 +07:00 [INF] Saved message 93 to Redis
2025-05-06 23:12:10.789 +07:00 [INF] Added message 93 to conversation 1
2025-05-06 23:12:10.790 +07:00 [INF] Saved message 92 to Redis
2025-05-06 23:12:10.791 +07:00 [INF] Added message 92 to conversation 1
2025-05-06 23:12:10.792 +07:00 [INF] Saved message 91 to Redis
2025-05-06 23:12:10.792 +07:00 [INF] Added message 91 to conversation 1
2025-05-06 23:12:10.793 +07:00 [INF] Saved message 90 to Redis
2025-05-06 23:12:10.793 +07:00 [INF] Added message 90 to conversation 1
2025-05-06 23:12:10.796 +07:00 [INF] Saved message 87 to Redis
2025-05-06 23:12:10.796 +07:00 [INF] Added message 87 to conversation 1
2025-05-06 23:12:10.797 +07:00 [INF] Saved message 86 to Redis
2025-05-06 23:12:10.797 +07:00 [INF] Added message 86 to conversation 1
2025-05-06 23:12:10.798 +07:00 [INF] Saved message 85 to Redis
2025-05-06 23:12:10.799 +07:00 [INF] Added message 85 to conversation 1
2025-05-06 23:12:10.799 +07:00 [INF] Saved message 84 to Redis
2025-05-06 23:12:10.800 +07:00 [INF] Added message 84 to conversation 1
2025-05-06 23:12:10.800 +07:00 [INF] Saved message 83 to Redis
2025-05-06 23:12:10.801 +07:00 [INF] Added message 83 to conversation 1
2025-05-06 23:12:10.801 +07:00 [INF] Saved message 82 to Redis
2025-05-06 23:12:10.802 +07:00 [INF] Added message 82 to conversation 1
2025-05-06 23:12:10.803 +07:00 [INF] Saved message 81 to Redis
2025-05-06 23:12:10.804 +07:00 [INF] Added message 81 to conversation 1
2025-05-06 23:12:10.805 +07:00 [INF] Saved message 80 to Redis
2025-05-06 23:12:10.805 +07:00 [INF] Added message 80 to conversation 1
2025-05-06 23:12:10.806 +07:00 [INF] Saved message 79 to Redis
2025-05-06 23:12:10.807 +07:00 [INF] Added message 79 to conversation 1
2025-05-06 23:12:10.807 +07:00 [INF] Saved message 78 to Redis
2025-05-06 23:12:10.808 +07:00 [INF] Added message 78 to conversation 1
2025-05-06 23:12:10.809 +07:00 [INF] Saved message 77 to Redis
2025-05-06 23:12:10.809 +07:00 [INF] Added message 77 to conversation 1
2025-05-06 23:12:10.810 +07:00 [INF] Saved message 76 to Redis
2025-05-06 23:12:10.812 +07:00 [INF] Added message 76 to conversation 1
2025-05-06 23:12:10.813 +07:00 [INF] Saved message 75 to Redis
2025-05-06 23:12:10.813 +07:00 [INF] Added message 75 to conversation 1
2025-05-06 23:12:10.814 +07:00 [INF] Saved message 74 to Redis
2025-05-06 23:12:10.814 +07:00 [INF] Added message 74 to conversation 1
2025-05-06 23:12:10.815 +07:00 [INF] Saved message 73 to Redis
2025-05-06 23:12:10.816 +07:00 [INF] Added message 73 to conversation 1
2025-05-06 23:12:10.818 +07:00 [INF] Saved message 72 to Redis
2025-05-06 23:12:10.818 +07:00 [INF] Added message 72 to conversation 1
2025-05-06 23:12:10.819 +07:00 [INF] Saved message 71 to Redis
2025-05-06 23:12:10.819 +07:00 [INF] Added message 71 to conversation 1
2025-05-06 23:12:10.820 +07:00 [INF] Saved message 68 to Redis
2025-05-06 23:12:10.820 +07:00 [INF] Added message 68 to conversation 1
2025-05-06 23:12:10.821 +07:00 [INF] Saved message 64 to Redis
2025-05-06 23:12:10.821 +07:00 [INF] Added message 64 to conversation 1
2025-05-06 23:12:10.822 +07:00 [INF] Saved message 62 to Redis
2025-05-06 23:12:10.823 +07:00 [INF] Added message 62 to conversation 1
2025-05-06 23:12:10.824 +07:00 [INF] Saved message 61 to Redis
2025-05-06 23:12:10.824 +07:00 [INF] Added message 61 to conversation 1
2025-05-06 23:12:10.825 +07:00 [INF] Saved message 60 to Redis
2025-05-06 23:12:10.825 +07:00 [INF] Added message 60 to conversation 1
2025-05-06 23:12:10.827 +07:00 [INF] Saved message 59 to Redis
2025-05-06 23:12:10.827 +07:00 [INF] Added message 59 to conversation 1
2025-05-06 23:12:10.830 +07:00 [INF] Saved message 57 to Redis
2025-05-06 23:12:10.830 +07:00 [INF] Added message 57 to conversation 1
2025-05-06 23:12:10.831 +07:00 [INF] Saved message 55 to Redis
2025-05-06 23:12:10.831 +07:00 [INF] Added message 55 to conversation 1
2025-05-06 23:12:10.832 +07:00 [INF] Saved message 54 to Redis
2025-05-06 23:12:10.833 +07:00 [INF] Added message 54 to conversation 1
2025-05-06 23:12:10.834 +07:00 [INF] Saved message 51 to Redis
2025-05-06 23:12:10.834 +07:00 [INF] Added message 51 to conversation 1
2025-05-06 23:12:10.835 +07:00 [INF] Saved message 49 to Redis
2025-05-06 23:12:10.835 +07:00 [INF] Added message 49 to conversation 1
2025-05-06 23:12:26.371 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-06 23:12:26.375 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 23:12:26.376 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-06 23:12:26.438 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-06 23:12:26.442 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-06 23:12:26.443 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 66.3604ms
2025-05-06 23:12:26.443 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 23:12:26.443 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 71.8545ms
2025-05-06 23:12:27.551 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-06 23:12:27.557 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 23:12:27.557 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-06 23:12:27.593 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-06 23:12:27.596 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:12:27.597 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 39.0792ms
2025-05-06 23:12:27.597 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 23:12:27.599 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 47.8386ms
2025-05-06 23:12:27.952 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-06 23:12:27.956 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 23:12:27.956 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:12:28.004 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:12:28.004 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 48.2525ms
2025-05-06 23:12:28.005 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 23:12:28.005 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 53.2335ms
2025-05-06 23:12:28.471 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-06 23:12:28.472 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-06 23:12:28.546 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-06 23:12:35.516 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - null null
2025-05-06 23:12:35.516 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:12:35.525 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:12:35.570 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:12:35.604 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:12:35.611 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 85.8049ms
2025-05-06 23:12:35.612 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:12:35.615 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - 200 null application/json; charset=utf-8 98.0441ms
2025-05-06 23:12:36.090 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/3/2 - null null
2025-05-06 23:12:36.090 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:12:36.095 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 23:12:36.187 +07:00 [INF] Retrieved 5 messages from Redis for conversation 3
2025-05-06 23:12:36.195 +07:00 [INF] Retrieved 5 messages from Redis for conversation 3 and user 2
2025-05-06 23:12:36.197 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:12:36.206 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 110.472ms
2025-05-06 23:12:36.206 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:12:36.206 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/3/2 - 200 null application/json; charset=utf-8 116.7535ms
2025-05-06 23:12:36.298 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/3 - null null
2025-05-06 23:12:36.300 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:12:36.308 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:12:36.372 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:12:36.418 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 23:12:36.422 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 113.3108ms
2025-05-06 23:12:36.422 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:12:36.422 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/3 - 200 null application/json; charset=utf-8 124.3163ms
2025-05-06 23:12:36.475 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - null null
2025-05-06 23:12:36.488 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:12:36.488 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:12:36.517 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:12:36.520 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:12:36.525 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 36.8803ms
2025-05-06 23:12:36.526 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:12:36.526 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/3 - 200 null application/json; charset=utf-8 50.4266ms
2025-05-06 23:12:39.037 +07:00 [INF] Handling message from user 2: xjjd
2025-05-06 23:12:39.047 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:12:39.370 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:12:39.392 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-06 23:12:39.441 +07:00 [INF] Message saved to DB with ID: 117
2025-05-06 23:12:39.452 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:12:39.462 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-06 23:12:39.499 +07:00 [INF] Transaction committed for message: 117
2025-05-06 23:12:39.522 +07:00 [INF] Saved message 117 to Redis
2025-05-06 23:12:39.523 +07:00 [INF] Added message 117 to conversation 3
2025-05-06 23:12:39.539 +07:00 [INF] Published message to channel conversation:3
2025-05-06 23:12:42.251 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-06 23:12:42.252 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:12:42.252 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:12:42.270 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:12:42.276 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:12:42.277 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 24.6027ms
2025-05-06 23:12:42.286 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:12:42.287 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 35.6631ms
2025-05-06 23:12:42.528 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-06 23:12:42.529 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:12:42.530 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 23:12:42.593 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4
2025-05-06 23:12:42.593 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-06 23:12:42.593 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:12:42.595 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 64.8973ms
2025-05-06 23:12:42.595 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:12:42.595 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 67.0219ms
2025-05-06 23:12:42.672 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-06 23:12:42.673 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:12:42.673 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:12:42.680 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:12:42.681 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 23:12:42.681 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.8542ms
2025-05-06 23:12:42.681 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:12:42.681 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 8.8378ms
2025-05-06 23:12:42.705 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-06 23:12:42.705 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:12:42.705 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:12:42.708 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:12:42.709 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:12:42.709 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 4.0519ms
2025-05-06 23:12:42.709 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:12:42.709 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 4.7942ms
2025-05-06 23:12:45.258 +07:00 [INF] Handling message from user 2: hzjsj
2025-05-06 23:12:45.285 +07:00 [INF] Executed DbCommand (24ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:12:45.306 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:12:45.317 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-06 23:12:45.321 +07:00 [INF] Message saved to DB with ID: 118
2025-05-06 23:12:45.337 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:12:45.343 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-06 23:12:45.353 +07:00 [INF] Transaction committed for message: 118
2025-05-06 23:12:45.355 +07:00 [INF] Saved message 118 to Redis
2025-05-06 23:12:45.356 +07:00 [INF] Added message 118 to conversation 4
2025-05-06 23:12:45.359 +07:00 [INF] Published message to channel conversation:4
2025-05-06 23:53:00.241 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-06 23:53:00.247 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:53:00.248 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:53:00.276 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:53:00.280 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:53:00.280 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 32.2962ms
2025-05-06 23:53:00.281 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:53:00.281 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 40.539ms
2025-05-06 23:53:00.548 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - null null
2025-05-06 23:53:00.548 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:53:00.548 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 23:53:00.577 +07:00 [INF] Retrieved 51 messages from Redis for conversation 4
2025-05-06 23:53:00.577 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-06 23:53:00.578 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:53:00.579 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 30.501ms
2025-05-06 23:53:00.579 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:53:00.579 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 31.5352ms
2025-05-06 23:53:00.711 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-06 23:53:00.712 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:53:00.712 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:53:00.718 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:53:00.719 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 23:53:00.719 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.1983ms
2025-05-06 23:53:00.719 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:53:00.719 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 8.4659ms
2025-05-06 23:53:00.883 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-06 23:53:00.883 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:53:00.883 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:53:00.886 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:53:00.887 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:53:00.887 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.7506ms
2025-05-06 23:53:00.887 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:53:00.887 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 4.5222ms
2025-05-06 23:53:07.608 +07:00 [INF] Handling message from user 5: ewfwf
2025-05-06 23:53:07.615 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:53:07.638 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:53:07.647 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-06 23:53:07.647 +07:00 [INF] Message saved to DB with ID: 119
2025-05-06 23:53:07.649 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:53:07.655 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-06 23:53:07.657 +07:00 [INF] Transaction committed for message: 119
2025-05-06 23:53:07.659 +07:00 [INF] Saved message 119 to Redis
2025-05-06 23:53:07.660 +07:00 [INF] Added message 119 to conversation 4
2025-05-06 23:53:07.661 +07:00 [INF] Published message to channel conversation:4
2025-05-06 23:53:16.607 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-06 23:53:16.608 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:53:16.608 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 23:53:16.656 +07:00 [INF] Retrieved 52 messages from Redis for conversation 4
2025-05-06 23:53:16.657 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-06 23:53:16.657 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:53:16.657 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 49.28ms
2025-05-06 23:53:16.657 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:53:16.658 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 50.6667ms
2025-05-06 23:53:16.954 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-06 23:53:16.955 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:53:16.955 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:53:16.960 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:53:16.961 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 23:53:16.961 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 6.0996ms
2025-05-06 23:53:16.961 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:53:16.961 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 6.9788ms
2025-05-06 23:53:17.135 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-06 23:53:17.136 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:53:17.136 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:53:17.141 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:53:17.142 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:53:17.143 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 6.3572ms
2025-05-06 23:53:17.143 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:53:17.145 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 9.9313ms
2025-05-06 23:53:22.281 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-06 23:53:22.282 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:53:22.282 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 23:53:22.322 +07:00 [INF] Retrieved 52 messages from Redis for conversation 4
2025-05-06 23:53:22.323 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-06 23:53:22.324 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:53:22.325 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 42.3924ms
2025-05-06 23:53:22.325 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:53:22.325 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 43.5488ms
2025-05-06 23:53:22.384 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-06 23:53:22.384 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:53:22.384 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:53:22.395 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:53:22.395 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 23:53:22.395 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 11.1101ms
2025-05-06 23:53:22.396 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:53:22.396 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 11.8521ms
2025-05-06 23:53:22.436 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-06 23:53:22.436 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:53:22.437 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:53:22.450 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:53:22.452 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:53:22.453 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 15.9689ms
2025-05-06 23:53:22.453 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:53:22.453 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 17.0258ms
2025-05-06 23:53:25.315 +07:00 [INF] Handling message from user 2: đbh
2025-05-06 23:53:25.321 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:53:25.323 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:53:25.323 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-06 23:53:25.324 +07:00 [INF] Message saved to DB with ID: 120
2025-05-06 23:53:25.330 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:53:25.331 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-06 23:53:25.332 +07:00 [INF] Transaction committed for message: 120
2025-05-06 23:53:25.335 +07:00 [INF] Saved message 120 to Redis
2025-05-06 23:53:25.335 +07:00 [INF] Added message 120 to conversation 4
2025-05-06 23:53:25.336 +07:00 [INF] Published message to channel conversation:4
2025-05-06 23:53:33.784 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-06 23:53:33.785 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:53:33.785 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 23:53:33.820 +07:00 [INF] Retrieved 53 messages from Redis for conversation 4
2025-05-06 23:53:33.820 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-06 23:53:33.820 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:53:33.822 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 36.4419ms
2025-05-06 23:53:33.822 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:53:33.822 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 37.9469ms
2025-05-06 23:53:33.877 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-06 23:53:33.878 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:53:33.879 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:53:33.883 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:53:33.883 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 23:53:33.884 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.3304ms
2025-05-06 23:53:33.884 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:53:33.884 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 7.8013ms
2025-05-06 23:53:33.924 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-06 23:53:33.925 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:53:33.925 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:53:33.932 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:53:33.933 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:53:33.934 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 8.6075ms
2025-05-06 23:53:33.934 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:53:33.935 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 10.2812ms
2025-05-06 23:53:37.032 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - null null
2025-05-06 23:53:37.032 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:53:37.032 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 23:53:37.056 +07:00 [INF] Retrieved 53 messages from Redis for conversation 4
2025-05-06 23:53:37.056 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-06 23:53:37.056 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:53:37.057 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 24.2808ms
2025-05-06 23:53:37.057 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:53:37.057 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 25.148ms
2025-05-06 23:53:37.141 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-06 23:53:37.142 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:53:37.142 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:53:37.147 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:53:37.147 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 23:53:37.148 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 5.6028ms
2025-05-06 23:53:37.148 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:53:37.148 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 6.6855ms
2025-05-06 23:53:37.188 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-06 23:53:37.188 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:53:37.188 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:53:37.191 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:53:37.191 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:53:37.192 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.3765ms
2025-05-06 23:53:37.192 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:53:37.192 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 4.1544ms
2025-05-06 23:54:14.865 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - null null
2025-05-06 23:54:14.866 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:54:14.866 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 23:54:14.902 +07:00 [INF] Retrieved 53 messages from Redis for conversation 4
2025-05-06 23:54:14.902 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-06 23:54:14.902 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:54:14.903 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 37.0074ms
2025-05-06 23:54:14.903 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:54:14.904 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 38.3537ms
2025-05-06 23:54:14.975 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-06 23:54:14.976 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:54:14.976 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:54:14.987 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:54:14.987 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 23:54:14.989 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 12.8682ms
2025-05-06 23:54:14.989 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:54:14.989 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 14.0361ms
2025-05-06 23:54:15.026 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-06 23:54:15.026 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:54:15.027 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:54:15.037 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:54:15.038 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:54:15.038 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 11.2783ms
2025-05-06 23:54:15.038 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:54:15.038 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 11.9216ms
2025-05-06 23:54:30.807 +07:00 [INF] Handling message from user 5: retetqw
2025-05-06 23:54:30.810 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:54:30.814 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:54:30.826 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-06 23:54:30.826 +07:00 [INF] Message saved to DB with ID: 121
2025-05-06 23:54:30.829 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:54:30.836 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-06 23:54:30.837 +07:00 [INF] Transaction committed for message: 121
2025-05-06 23:54:30.839 +07:00 [INF] Saved message 121 to Redis
2025-05-06 23:54:30.839 +07:00 [INF] Added message 121 to conversation 4
2025-05-06 23:54:30.839 +07:00 [INF] Published message to channel conversation:4
2025-05-06 23:54:40.211 +07:00 [INF] Handling message from user 5: sdf
2025-05-06 23:54:40.216 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:54:40.222 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:54:40.224 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-06 23:54:40.224 +07:00 [INF] Message saved to DB with ID: 122
2025-05-06 23:54:40.225 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:54:40.228 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-06 23:54:40.231 +07:00 [INF] Transaction committed for message: 122
2025-05-06 23:54:40.236 +07:00 [INF] Saved message 122 to Redis
2025-05-06 23:54:40.236 +07:00 [INF] Added message 122 to conversation 4
2025-05-06 23:54:40.237 +07:00 [INF] Published message to channel conversation:4
2025-05-06 23:56:46.030 +07:00 [INF] Handling message from user 5: asasd
2025-05-06 23:56:46.043 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:56:46.045 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:56:46.053 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-06 23:56:46.054 +07:00 [INF] Message saved to DB with ID: 123
2025-05-06 23:56:46.054 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:56:46.058 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-06 23:56:46.059 +07:00 [INF] Transaction committed for message: 123
2025-05-06 23:56:46.061 +07:00 [INF] Saved message 123 to Redis
2025-05-06 23:56:46.062 +07:00 [INF] Added message 123 to conversation 4
2025-05-06 23:56:46.062 +07:00 [INF] Published message to channel conversation:4
2025-05-06 23:56:55.710 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-06 23:56:55.715 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-06 23:56:55.818 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-06 23:56:55.822 +07:00 [ERR] Connection id "0HNCCN2VSLHMS", Request id "0HNCCN2VSLHMS:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-06 23:56:55.835 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - 101 null null 2667363.431ms
2025-05-06 23:57:02.396 +07:00 [INF] Executed endpoint '/ws/chat'
2025-05-06 23:57:02.397 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-05-06 23:57:02.406 +07:00 [WRN] The response has already started, the error page middleware will not be executed.
2025-05-06 23:57:02.408 +07:00 [ERR] Connection id "0HNCCN2VSLHMO", Request id "0HNCCN2VSLHMO:00000001": An unhandled exception was thrown by the application.
System.Net.WebSockets.WebSocketException (0x80004005): The remote party closed the WebSocket connection without completing the close handshake.
   at System.Net.WebSockets.ManagedWebSocket.ThrowEOFUnexpected()
   at System.Net.WebSockets.ManagedWebSocket.EnsureBufferContainsAsync(Int32 minimumRequiredBytes, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.WebSockets.ManagedWebSocket.ReceiveAsyncPrivate[TResult](Memory`1 payloadBuffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.ValueTaskSourceAsTask.<>c.<.cctor>b__4_0(Object state)
--- End of stack trace from previous location ---
   at server.Services.WebSocketService.webSocket.Receiver(Client client) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 108
   at server.Services.WebSocketService.webSocket.HandleWebSocket(HttpContext context) in C:\Users\Thao\source\Flutter\Message_app\server\Services\WebSocketService\websocket.cs:line 91
   at Program.<>c.<<<Main>$>b__0_4>d.MoveNext() in C:\Users\Thao\source\Flutter\Message_app\server\Program.cs:line 89
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-05-06 23:57:02.420 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - 101 null null 2691902.7523ms
2025-05-06 23:58:49.261 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 57
2025-05-06 23:58:49.326 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 23:58:49.347 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-06 23:58:49.521 +07:00 [INF] Executed DbCommand (43ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-06 23:58:49.565 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-06 23:58:49.576 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 225.9899ms
2025-05-06 23:58:49.576 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 23:58:49.576 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 323.3185ms
2025-05-06 23:58:50.763 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - null null
2025-05-06 23:58:50.765 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 23:58:50.766 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:58:50.777 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:58:50.780 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 14.6674ms
2025-05-06 23:58:50.781 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 23:58:50.781 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/2 - 200 null application/json; charset=utf-8 18.5432ms
2025-05-06 23:58:51.192 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=2 - null null
2025-05-06 23:58:51.193 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-06 23:58:51.282 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-06 23:58:51.743 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - null null
2025-05-06 23:58:51.743 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 23:58:51.744 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-06 23:58:51.772 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-06 23:58:51.774 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:58:51.774 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 30.6854ms
2025-05-06 23:58:51.774 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 23:58:51.775 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/2 - 200 null application/json; charset=utf-8 31.4865ms
2025-05-06 23:59:08.764 +07:00 [INF] Request starting HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - application/json 53
2025-05-06 23:59:08.764 +07:00 [INF] Executing endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 23:59:08.764 +07:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(server.DTO.AuthDTO.LoginDTO) on controller Message_app.Controllers.AuthController (Message_app).
2025-05-06 23:59:08.780 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__email_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[id], [u].[avatar_url], [u].[bio], [u].[birthday], [u].[created_at], [u].[email], [u].[gender], [u].[interests], [u].[location], [u].[password], [u].[passwordSalt], [u].[username]
FROM [Users] AS [u]
WHERE [u].[email] = @__email_0
2025-05-06 23:59:08.782 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.DTO.AuthDTO.LoginRespose'.
2025-05-06 23:59:08.783 +07:00 [INF] Executed action Message_app.Controllers.AuthController.Login (Message_app) in 18.4074ms
2025-05-06 23:59:08.783 +07:00 [INF] Executed endpoint 'Message_app.Controllers.AuthController.Login (Message_app)'
2025-05-06 23:59:08.784 +07:00 [INF] Request finished HTTP/1.1 POST http://192.168.1.10:5053/api/Auth/login - 200 null application/json; charset=utf-8 20.2055ms
2025-05-06 23:59:09.401 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - null null
2025-05-06 23:59:09.401 +07:00 [INF] Executing endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 23:59:09.401 +07:00 [INF] Route matched with {action = "GetAllFriends", controller = "Friends"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllFriends(Int32) on controller server.Controllers.FriendsController (Message_app).
2025-05-06 23:59:09.411 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[username]
    ELSE [u0].[username]
END AS [username], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[avatar_url]
    ELSE [u0].[avatar_url]
END AS [avatar], CASE
    WHEN [f].[UserId1] = @__userId_0 THEN [u].[id]
    ELSE [u0].[id]
END AS [friendId], @__userId_0 AS [userId]
FROM [Friends] AS [f]
INNER JOIN [Users] AS [u] ON [f].[UserId2] = [u].[id]
INNER JOIN [Users] AS [u0] ON [f].[UserId1] = [u0].[id]
WHERE [f].[UserId1] = @__userId_0 OR [f].[UserId2] = @__userId_0
2025-05-06 23:59:09.412 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType5`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[server.DTO.FriendDTO, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:59:09.412 +07:00 [INF] Executed action server.Controllers.FriendsController.GetAllFriends (Message_app) in 10.9407ms
2025-05-06 23:59:09.412 +07:00 [INF] Executed endpoint 'server.Controllers.FriendsController.GetAllFriends (Message_app)'
2025-05-06 23:59:09.412 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/friends/GetAllFriends/5 - 200 null application/json; charset=utf-8 11.4711ms
2025-05-06 23:59:09.522 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - null null
2025-05-06 23:59:09.522 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 23:59:09.522 +07:00 [INF] Route matched with {action = "GetConversations", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversations(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:59:09.523 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.ConversationDto, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:59:09.524 +07:00 [INF] Executed action server.Controllers.ConversationController.GetConversations (Message_app) in 1.7455ms
2025-05-06 23:59:09.524 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetConversations (Message_app)'
2025-05-06 23:59:09.524 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_conversations/5 - 200 null application/json; charset=utf-8 2.2625ms
2025-05-06 23:59:09.763 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/ws/chat?userId=5 - null null
2025-05-06 23:59:09.764 +07:00 [INF] Executing endpoint '/ws/chat'
2025-05-06 23:59:09.818 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__client_UserId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[conversation_id]
FROM [Participants] AS [p]
WHERE [p].[user_id] = @__client_UserId_0 AND [p].[is_deleted] = CAST(0 AS bit)
2025-05-06 23:59:24.204 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-06 23:59:24.204 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:59:24.204 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:59:24.218 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:59:24.222 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:59:24.223 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 18.3628ms
2025-05-06 23:59:24.223 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:59:24.223 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 19.0414ms
2025-05-06 23:59:24.389 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - null null
2025-05-06 23:59:24.389 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:59:24.389 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 23:59:24.420 +07:00 [INF] Retrieved 56 messages from Redis for conversation 4
2025-05-06 23:59:24.422 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 5
2025-05-06 23:59:24.422 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:59:24.426 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 35.8866ms
2025-05-06 23:59:24.426 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:59:24.426 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/5 - 200 null application/json; charset=utf-8 37.7178ms
2025-05-06 23:59:24.613 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-06 23:59:24.613 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:59:24.614 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:59:24.630 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:59:24.631 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 23:59:24.631 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 17.1318ms
2025-05-06 23:59:24.631 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:59:24.631 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 17.9996ms
2025-05-06 23:59:24.702 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-06 23:59:24.702 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:59:24.702 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:59:24.705 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:59:24.705 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:59:24.706 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.3743ms
2025-05-06 23:59:24.706 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:59:24.706 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 4.1001ms
2025-05-06 23:59:30.942 +07:00 [INF] Handling message from user 5: kjkn
2025-05-06 23:59:30.950 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:59:30.976 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:59:31.012 +07:00 [INF] Executed DbCommand (36ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-06 23:59:31.013 +07:00 [INF] Message saved to DB with ID: 124
2025-05-06 23:59:31.014 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:59:31.025 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-06 23:59:31.027 +07:00 [INF] Transaction committed for message: 124
2025-05-06 23:59:31.029 +07:00 [INF] Saved message 124 to Redis
2025-05-06 23:59:31.031 +07:00 [INF] Added message 124 to conversation 4
2025-05-06 23:59:31.031 +07:00 [INF] Published message to channel conversation:4
2025-05-06 23:59:34.474 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-06 23:59:34.474 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:59:34.474 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:59:34.479 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:59:34.479 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:59:34.479 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 5.3283ms
2025-05-06 23:59:34.480 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:59:34.480 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 5.9244ms
2025-05-06 23:59:34.795 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - null null
2025-05-06 23:59:34.795 +07:00 [INF] Executing endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:59:34.796 +07:00 [INF] Route matched with {action = "GetMessages", controller = "Message"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessages(Int32, Int32) on controller server.Controllers.MessageController (Message_app).
2025-05-06 23:59:34.848 +07:00 [INF] Retrieved 57 messages from Redis for conversation 4
2025-05-06 23:59:34.848 +07:00 [INF] Retrieved 50 messages from Redis for conversation 4 and user 2
2025-05-06 23:59:34.848 +07:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[server.DTO.MessageWithAttachment, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-06 23:59:34.849 +07:00 [INF] Executed action server.Controllers.MessageController.GetMessages (Message_app) in 52.9386ms
2025-05-06 23:59:34.849 +07:00 [INF] Executed endpoint 'server.Controllers.MessageController.GetMessages (Message_app)'
2025-05-06 23:59:34.849 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Message/getMessages/4/2 - 200 null application/json; charset=utf-8 53.8461ms
2025-05-06 23:59:35.064 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - null null
2025-05-06 23:59:35.065 +07:00 [INF] Executing endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:59:35.065 +07:00 [INF] Route matched with {action = "GetFirstConversation", controller = "Conversation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetFirstConversation(Int32) on controller server.Controllers.ConversationController (Message_app).
2025-05-06 23:59:35.069 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:59:35.072 +07:00 [INF] Executing OkObjectResult, writing value of type 'server.Models.Conversation'.
2025-05-06 23:59:35.072 +07:00 [INF] Executed action server.Controllers.ConversationController.GetFirstConversation (Message_app) in 7.4557ms
2025-05-06 23:59:35.073 +07:00 [INF] Executed endpoint 'server.Controllers.ConversationController.GetFirstConversation (Message_app)'
2025-05-06 23:59:35.073 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Conversation/get_first_conversation/4 - 200 null application/json; charset=utf-8 8.8285ms
2025-05-06 23:59:35.106 +07:00 [INF] Request starting HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - null null
2025-05-06 23:59:35.107 +07:00 [INF] Executing endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:59:35.107 +07:00 [INF] Route matched with {action = "GetParticipants", controller = "Participant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetParticipants(Int32) on controller server.Controllers.ParticipantController (Message_app).
2025-05-06 23:59:35.110 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversation_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[id], [p].[adder], [p].[conversation_id], [p].[img_url], [p].[is_deleted], [p].[joined_at], [p].[name], [p].[role], [p].[user_id]
FROM [Participants] AS [p]
WHERE [p].[conversation_id] = @__conversation_id_0
2025-05-06 23:59:35.111 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType17`1[[System.Collections.Generic.List`1[[server.Models.Participants, Message_app, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-06 23:59:35.111 +07:00 [INF] Executed action server.Controllers.ParticipantController.GetParticipants (Message_app) in 3.5177ms
2025-05-06 23:59:35.111 +07:00 [INF] Executed endpoint 'server.Controllers.ParticipantController.GetParticipants (Message_app)'
2025-05-06 23:59:35.111 +07:00 [INF] Request finished HTTP/1.1 GET http://192.168.1.10:5053/api/Participant/get_participants/4 - 200 null application/json; charset=utf-8 4.7804ms
2025-05-06 23:59:40.276 +07:00 [INF] Handling message from user 5: werw
2025-05-06 23:59:40.281 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:59:40.284 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:59:40.286 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-06 23:59:40.286 +07:00 [INF] Message saved to DB with ID: 125
2025-05-06 23:59:40.289 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:59:40.290 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-06 23:59:40.291 +07:00 [INF] Transaction committed for message: 125
2025-05-06 23:59:40.292 +07:00 [INF] Saved message 125 to Redis
2025-05-06 23:59:40.292 +07:00 [INF] Added message 125 to conversation 4
2025-05-06 23:59:40.292 +07:00 [INF] Published message to channel conversation:4
2025-05-06 23:59:59.106 +07:00 [INF] Handling message from user 2: c
2025-05-06 23:59:59.109 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[id], [c].[created_at], [c].[img_url], [c].[is_group], [c].[lastMessage], [c].[lastMessageSender], [c].[lastMessageTime], [c].[name]
FROM [Conversations] AS [c]
WHERE [c].[id] = @__p_0
2025-05-06 23:59:59.113 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:59:59.115 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 500), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Boolean), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Messages] ([content], [conversation_id], [created_at], [isFile], [isRecalled], [is_read], [sender_id], [type])
OUTPUT INSERTED.[id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-05-06 23:59:59.117 +07:00 [INF] Message saved to DB with ID: 126
2025-05-06 23:59:59.117 +07:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-05-06 23:59:59.122 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 4000), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime2), @p6='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [Conversations] SET [created_at] = @p0, [img_url] = @p1, [is_group] = @p2, [lastMessage] = @p3, [lastMessageSender] = @p4, [lastMessageTime] = @p5, [name] = @p6
OUTPUT 1
WHERE [id] = @p7;
2025-05-06 23:59:59.124 +07:00 [INF] Transaction committed for message: 126
2025-05-06 23:59:59.125 +07:00 [INF] Saved message 126 to Redis
2025-05-06 23:59:59.126 +07:00 [INF] Added message 126 to conversation 4
2025-05-06 23:59:59.126 +07:00 [INF] Published message to channel conversation:4
